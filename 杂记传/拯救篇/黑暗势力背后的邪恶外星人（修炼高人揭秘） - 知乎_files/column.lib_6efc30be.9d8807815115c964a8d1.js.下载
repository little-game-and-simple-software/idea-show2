"use strict";(self.webpackChunkheifetz=self.webpackChunkheifetz||[]).push([[6856],{17292:function(e,t,i){i.d(t,{ZP:function(){return Me}});var n=i(67541),r=i.n(n),a=i(6885),s=i.n(a),o=i(48146),c=i.n(o),_=i(52346),d=i.n(_),u=i(53700),l=i.n(u),h=i(27822),f=i.n(h),p=i(47913),m=i.n(p),v=i(23061),g=i.n(v),y=i(67051),E=i.n(y),b=i(87363),A=i.n(b),T=i(36484).lW;function S(e,t,i){if(t&&!Array.isArray(t)&&"number"==typeof t.length){var n=t.length;return x(t,void 0!==i&&i<n?i:n)}return e(t,i)}function R(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=function(e,t){if(!e)return;if("string"==typeof e)return x(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return x(e,t)}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==i.return||i.return()}finally{if(o)throw a}}}}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function L(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,n=m()(e);if(t){var r=m()(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return f()(this,i)}}!function(){try{if("undefined"!=typeof document){var e=document.createElement("style");e.appendChild(document.createTextNode(".kwai-player{position:relative;z-index:1;display:inline-block}.kwai-player video{display:block;width:100%;height:100%}.kwai-player canvas{display:block;margin:0 auto;max-width:100%;max-height:100%}.kwai-player-poster{width:100%;height:100%;position:absolute;left:0;top:0;background-color:#333;background-size:cover}.kwai-player-hotzone{display:block;width:100%;height:100%;position:absolute;left:0;top:0}.kwai-player-controls{position:absolute;left:0;bottom:0;width:100%}")),document.head.appendChild(e)}}catch(e){console.error("vite-plugin-css-injected-by-js",e)}}();var C=Object.defineProperty,D=function(e,t,i){return function(e,t,i){t in e?C(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i}(e,"symbol"!=typeof t?t+"":t,i),i},I=Object.defineProperty,w=function(e,t,i){return function(e,t,i){t in e?I(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i}(e,"symbol"!=typeof t?t+"":t,i),i};function k(e,t){return t&&0!==t.length||(t=[e],e=""),e="kwai-p"+(e?"::"+e:""),t.unshift("["+e+"] > "),t}var O=function(){function e(){g()(this,e)}return E()(e,null,[{key:"level",value:function(t){switch(e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=e.ENABLE_DEBUG=e.ENABLE_VERBOSE=!1,t){case"e":e.ENABLE_ERROR=!0;break;case"w":e.ENABLE_ERROR=e.ENABLE_WARN=!0;break;case"i":e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=!0;break;case"d":e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=e.ENABLE_DEBUG=!0;break;case"v":e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=e.ENABLE_DEBUG=e.ENABLE_VERBOSE=!0}}},{key:"e",value:function(t){if(e.ENABLE_ERROR){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];var a=k(t,n);(console.error||console.warn||console.log).apply(console,a)}}},{key:"w",value:function(t){if(e.ENABLE_WARN){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];var a=k(t,n);(console.warn||console.log).apply(console,a)}}},{key:"i",value:function(t){if(e.ENABLE_INFO){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];var a=k(t,n);(console.info||console.log).apply(console,a)}}},{key:"d",value:function(t){if(e.ENABLE_DEBUG){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];var a=k(t,n);(console.debug||console.log).apply(console,a)}}},{key:"v",value:function(t){if(e.ENABLE_VERBOSE){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];var a=k(t,n);console.log.apply(console,a)}}}]),e}(),N=O;w(N,"ENABLE_ERROR",!0),w(N,"ENABLE_WARN",!1),w(N,"ENABLE_INFO",!1),w(N,"ENABLE_DEBUG",!1),w(N,"ENABLE_VERBOSE",!1);var P=function(){function e(){g()(this,e),w(this,"timeout",6048e5)}return E()(e,[{key:"write",value:function(t,i){if(e.available)try{localStorage.setItem(t,JSON.stringify({value:i,time:Date.now()}))}catch(e){}}},{key:"read",value:function(t){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.available)try{var n=localStorage.getItem(t);if(n){var r=JSON.parse(n),a=r.value,s=r.time,o=void 0===s?0:s;if(!i)return a;if(Date.now()-o<this.timeout)return a}}catch(e){}}}],[{key:"available",get:function(){if(void 0===e._available)try{localStorage.setItem("alg","test"),e._available=!0}catch(t){e._available=!1}return e._available}}]),e}(),M=P;function V(){var e=new M;N.level(e.read("kwai-player-log"))}w(M,"_available");var F=function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=49)}([function(e,t,i){var n,r;(r=n||(n={})).METADATA="metadata",r.PARSING_INIT_SEGMENT="parsingInitSegment",r.PARSING_DATA="parsingData",r.PARSED_DATA="parsedData",r.SCRIPT_PARSED="scriptParsed",r.KEY_FRAME_INDEXS="keyFrameIndexs",r.VIDEO_FRAME_INFO="videoFrameInfo",r.DISCONTINUITY="discontinuity",r.REPORT="report",r.LOAD_END="loadEnd",r.ERROR="error",r.MANIFEST_PARSED="manifestParsed",r.LEVEL_SWITCHING="levelSwitching",r.LEVEL_SWITCHED="levelSwitched",r.LEVEL_SWITCH_PLAYING="levelSwitchPlaying",r.LEVEL_SWITCH_FAILED="levelSwitchFailed",r.LEVEL_LOADED="levelLoaded",r.LEVEL_UPDATED="levelUpdated",r.AUDIO_TRACK_SWITCHING="audioTrackSwitching",r.AUDIO_TRACK_SWITCHED="audioTrackSwitched",r.AUDIO_TRACK_UPDATED="audioTrackUpdated",r.HLS_KEY_LOADED="hlsKeyLoaded",r.AUDIO_TRACK_LOADED="audioLoaded",r.SUBTITLE_TRACK_LOADED="subtitleTrackLoaded",r.SUBTITLE_LOADED="subtitleLoaded",r.SUBTITLE_TRACK_SWITCHED="subtitleTrackSwitched",r.BUFFER_FLUSHING="bufferFlushing",r.VIDEO_SEEK="vdeoSeek",r.PRELOAD_COMPLETE="preloadComplete",r.ABR_NEXT="abrNext",r.PRIV_NAL="privNal",r.RAW_DATA="rawData",r.MP4_NOT_FASTSTART="mp4NotFaststart",r.VIDEO_CODEC_DETECTED="videoCodecChange",r.H265_DETECTED="h265Detected",r.VIDEO_RENDERER_CHANGE="videoRendererChange",r.DEC_LIB_LOADED="decLibLoaded",r.DEC_INIT_COMPLETE="decoderInitComplete",r.DEC_VIDEO_READY="decVideoReady",r.STEP="step",r.RENDERER_BUF_EXPIRED="rendererBufExpired",r.RENDERER_SEEK="rendererSeek",r.RENDERER_BUF_UPDATE="rendererBufUpdate",r.RENDERER_DRAW="rendererDraw",r.DECODER_FRAME="decoderFrame",r.DECODER_IMG="decoderImg",r.DECODER_SEEK="decoderSeek",r.DECODER_SEEK_ABORT="decoderSeekAbort",r.DECODER_WAITING="decoderWaiting",r.DECODER_DATA_END="decoderDataEnd",r.DECODER_DROP_FRAME="decocerDropFrame",r.MEDIA_CONNECTED="mediaConnected",r.LOADER_CHUNK_ARRIVAL="loaderChunkArrival",r.DEMUXER_DETECTED="demuxerDetected",r.MEDIA_DEMUX="mediaDemux",r.KEY_FRAME="keyFrame",r.MUX_INFO="muxInfo",r.USE_BACKUP="useBackup",r.NEW_SOURCE="newSource",r.DOWNLOAD="download",r.STOP_LOAD="stopLoad",r.LOAD="load",r.WAITING="wating",r.LOADEDDATA="loadeddata",r.CANPLAY="canplay",r.SEEKING="seeking",r.SEEK_WITH_LOAD="onSeekWithLoad",r.SEEKED="seeked",r.PLAYING="playing",r.PAUSE="pause",r.PLAY="play",r.ENDED="ended",r.TIMEUPDATE="timeupdate",r.PROGRESS="progress",r.RATE_CHANGE="ratechange",r.DURATION_CHANGE="durationchange",r.HEARTBEAT="heartbeat",r.MSE_OPEN="mseOpen",r.MSE_UPDATE="mseUpdate",r.MSE_BUFFER_FULL="mseBufferFull",r.MSE_REMOVE="mseRemove",r.RETRY="retry",r.INIT_PTS_FOUND="initPtsFopund",r.FALLBACK_H264="fallbackH264",t.a=n},function(e,t,i){var n,r,a,s,o,c,_,d,u,l,h,f,p,m,v,g,y;i.d(t,"b",(function(){return n})),i.d(t,"p",(function(){return r})),i.d(t,"o",(function(){return a})),i.d(t,"c",(function(){return s})),i.d(t,"i",(function(){return o})),i.d(t,"g",(function(){return c})),i.d(t,"h",(function(){return _})),i.d(t,"n",(function(){return d})),i.d(t,"m",(function(){return u})),i.d(t,"j",(function(){return l})),i.d(t,"d",(function(){return h})),i.d(t,"e",(function(){return f})),i.d(t,"l",(function(){return p})),i.d(t,"a",(function(){return m})),i.d(t,"k",(function(){return v})),i.d(t,"f",(function(){return g})),(y=n||(n={})).unknown="unknown",y.h264="h264",y.hevc="hevc",y.av1="av1",y.kvc3="kvc3",y.kvc4="kvc4",y.kvc5="kvc5",y.aac="aac",y.mp3="mp3",y.opus="opus",y.yuv="yuv",y.rawvideo="rawvideo",function(e){e.kvc3="kvc3",e.kvc4="kvc4",e.kvc5="kvc5",e.h265="h265",e.kw265="kw265"}(r||(r={})),function(e){e.video="video",e.canvas="canvas"}(a||(a={})),function(e){e.buildin="buildin",e.wasm="wasm",e.none="none",e.unsupported="unsupported"}(s||(s={})),function(e){e.KWAI_FLV_ABR="kwaiFlvAbr",e.KWAI_FLV_MP="kwaiFlvMultipart",e.KWAI="kwai",e.FILE="file",e.OTHERS="others"}(o||(o={})),function(e){e.flv="flv",e.hls="hls",e.hls_ts="hls_ts",e.hls_fmp4="hls_fmp4",e.webrtc="webrtc",e.mp4="mp4",e.raw="raw",e.mp3="mp3",e.aac="aac",e.matroska="matroska",e.ts="ts",e.ivf="ivf",e.yuv="yuv",e.unknown="unknown"}(c||(c={})),function(e){e.LIVE="live_retry",e.RTC="rtc_retry",e.CODEC_AUDIO="codec_audio",e.CODEC_REMUX_TYPE="codec_remux_type",e.CORE_NATIVE="core_native",e.CORE_MSE="core_mse",e.REMUX_WORKER="remux_worker",e.HEVC_DEC="hevc_dec",e.FALLBACK_H264="fallback_h264"}(_||(_={})),function(e){e.AUTO="auto",e.ALL_NON_REF="allNonRef",e.MIN="min"}(d||(d={})),function(e){e.NONE="none",e.WAITING="waiting"}(u||(u={})),function(e){e.NEXT="next",e.PREV="prev"}(l||(l={})),function(e){e.STANDARD="standard",e.QUERY_START_END="queryStartEnd"}(h||(h={})),function(e){e.MAIN="main",e.AUDIO="audio",e.SUBTITLE="subtitle"}(f||(f={})),function(e){e.VIDEO="video",e.AUDIO="audio"}(p||(p={})),function(e){e.unknown="unknown",e.native="native",e.mse="mse",e.rtc="rtc"}(m||(m={})),function(e){e[e.Normal=0]="Normal",e[e.V360=1]="V360",e[e.V180=2]="V180"}(v||(v={})),function(e){e[e.normal=0]="normal",e[e.internal=1]="internal",e[e.retry=2]="retry"}(g||(g={}))},function(e,t,i){var n,r;function a(e,t){return t&&0!==t.length||(t=[e],e=""),e="kwai-k"+(e?"::"+e:""),t.unshift("["+e+"] > "),t}i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return s})),(r=n||(n={})).LEVEL_ERROR="e",r.LEVEL_WARN="w",r.LEVEL_INFO="i",r.LEVEL_DEBUG="d",r.LEVEL_VERBOSE="v";var s=function(){function e(){}return e.level=function(t){switch(e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=e.ENABLE_DEBUG=e.ENABLE_VERBOSE=!1,t){case n.LEVEL_ERROR:e.ENABLE_ERROR=!0;break;case n.LEVEL_WARN:e.ENABLE_ERROR=e.ENABLE_WARN=!0;break;case n.LEVEL_INFO:e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=!0;break;case n.LEVEL_DEBUG:e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=e.ENABLE_DEBUG=!0;break;case n.LEVEL_VERBOSE:e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=e.ENABLE_DEBUG=e.ENABLE_VERBOSE=!0}},e.e=function(t){if(e.ENABLE_ERROR){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];var s=a(t,n);(console.error||console.warn||console.log).apply(console,s)}},e.w=function(t){if(e.ENABLE_WARN){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];var s=a(t,n);(console.warn||console.log).apply(console,s)}},e.i=function(t){if(e.ENABLE_INFO){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];var s=a(t,n);(console.info||console.log).apply(console,s)}},e.d=function(t){if(e.ENABLE_DEBUG){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];var s=a(t,n);(console.debug||console.log).apply(console,s)}},e.v=function(t){if(e.ENABLE_VERBOSE){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];var s=a(t,n);console.log.apply(console,s)}},e}();s.ENABLE_ERROR=!0,s.ENABLE_WARN=!1,s.ENABLE_INFO=!1,s.ENABLE_DEBUG=!1,s.ENABLE_VERBOSE=!1},function(e,t,i){var n,r,a;i.d(t,"b",(function(){return n})),i.d(t,"a",(function(){return r})),i.d(t,"c",(function(){return s})),(a=n||(n={})).NETWORK_ERROR="networkError",a.MEDIA_ERROR="mediaError",a.KEY_SYSTEM_ERROR="keySystemError",a.MUX_ERROR="muxError",a.OTHER_ERROR="otherError",a.MSE_ERROR="mseError",a.DECODER_ERROR="decoderError",a.RENDERER_ERROR="rendererError",function(e){e[e.LOAD_ERROR=10]="LOAD_ERROR",e[e.MANIFEST_LOAD_ERROR=11]="MANIFEST_LOAD_ERROR",e[e.LEVEL_LOAD_ERROR=12]="LEVEL_LOAD_ERROR",e[e.AUDIO_TRACK_LOAD_ERROR=13]="AUDIO_TRACK_LOAD_ERROR",e[e.KEY_LOAD_ERROR=14]="KEY_LOAD_ERROR",e[e.KEY_SYSTEM_LICENSE_REQUEST_FAILED=15]="KEY_SYSTEM_LICENSE_REQUEST_FAILED",e[e.DEC_LIB_LOAD_ERROR=16]="DEC_LIB_LOAD_ERROR",e[e.RTC_SDP_LOAD_ERROR=17]="RTC_SDP_LOAD_ERROR",e[e.SUBTITLE_TRACK_LOAD_ERROR=18]="SUBTITLE_TRACK_LOAD_ERROR",e[e.CANNOT_SEEK=100]="CANNOT_SEEK",e[e.VIDEO_ERROR=101]="VIDEO_ERROR",e[e.UNSUPPORTED=102]="UNSUPPORTED",e[e.CONFIG_ERROR=103]="CONFIG_ERROR",e[e.OTHER=104]="OTHER",e[e.UNKNOWN=105]="UNKNOWN",e[e.CANNOT_SEEK_BY_FRAME_INDEX=106]="CANNOT_SEEK_BY_FRAME_INDEX",e[e.SRC_EMPTY=107]="SRC_EMPTY",e[e.VIDEO_ERROR_1=111]="VIDEO_ERROR_1",e[e.VIDEO_ERROR_2=112]="VIDEO_ERROR_2",e[e.VIDEO_ERROR_3=113]="VIDEO_ERROR_3",e[e.VIDEO_ERROR_4=114]="VIDEO_ERROR_4",e[e.MEDIASOURCE_ERROR=200]="MEDIASOURCE_ERROR",e[e.ADDSOURCEBUFFER_ERROR=201]="ADDSOURCEBUFFER_ERROR",e[e.SOURCEBUFFER_ERROR=202]="SOURCEBUFFER_ERROR",e[e.ENDOFSTREAM_ERROR=203]="ENDOFSTREAM_ERROR",e[e.APPENDBUFFER_ERROR=204]="APPENDBUFFER_ERROR",e[e.CHANGETYPE_ERROR=205]="CHANGETYPE_ERROR",e[e.PARSING_ERROR=301]="PARSING_ERROR",e[e.REMUX_ERROR=302]="REMUX_ERROR",e[e.REMUX_ALLOC_ERROR=303]="REMUX_ALLOC_ERROR",e[e.REMUX_WORKER_ERROR=304]="REMUX_WORKER_ERROR",e[e.DEMUX_NOT_FOUND=305]="DEMUX_NOT_FOUND",e[e.MANIFEST_PARSING_ERROR=400]="MANIFEST_PARSING_ERROR",e[e.KEY_SYSTEM_NO_ACCESS=500]="KEY_SYSTEM_NO_ACCESS",e[e.KEY_SYSTEM_NO_SESSION=501]="KEY_SYSTEM_NO_SESSION",e[e.KEY_SYSTEM_URL_ERROR=502]="KEY_SYSTEM_URL_ERROR",e[e.KEY_SYSTEM_NO_KEYS=505]="KEY_SYSTEM_NO_KEYS",e[e.FRAG_DECRYPT_ERROR=506]="FRAG_DECRYPT_ERROR",e[e.KEY_SYSTEM_NO_INIT_DATA=507]="KEY_SYSTEM_NO_INIT_DATA",e[e.KEY_SYSTEM_UNSUPPORTED=508]="KEY_SYSTEM_UNSUPPORTED",e[e.DECODER_LOAD_ERROR=600]="DECODER_LOAD_ERROR",e[e.DECODER_INIT_ERROR=601]="DECODER_INIT_ERROR",e[e.DECODER_DRAW_ERROR=602]="DECODER_DRAW_ERROR",e[e.DECODER_WEBGL_ERROR=603]="DECODER_WEBGL_ERROR",e[e.DECODER_UNSUPPORTED=604]="DECODER_UNSUPPORTED",e[e.PRELOAD_ERROR=700]="PRELOAD_ERROR",e[e.LIVE_DISCONNECTED_ERROR=1009]="LIVE_DISCONNECTED_ERROR",e[e.WEBRTC_DISCONNECTED_ERROR=1010]="WEBRTC_DISCONNECTED_ERROR",e[e.WEBRTC_FAILED_ERROR=1011]="WEBRTC_FAILED_ERROR",e[e.WEBRTC_CLOSED_ERROR=1012]="WEBRTC_CLOSED_ERROR",e[e.WEBRTC_ICE_CANDIDATE_ERROR=1013]="WEBRTC_ICE_CANDIDATE_ERROR",e[e.WEBRTC_ICE_CONNECTION_ERROR=1014]="WEBRTC_ICE_CONNECTION_ERROR",e[e.WEBRTC_OFFER_ERROR=1015]="WEBRTC_OFFER_ERROR",e[e.WEBRTC_ANSWER_ERROR=1016]="WEBRTC_ANSWER_ERROR",e[e.WEBRTC_TRANSMISSION_DATA_NULL=1017]="WEBRTC_TRANSMISSION_DATA_NULL",e[e.WEBRTC_CONNECT_TIMEOUT=1018]="WEBRTC_CONNECT_TIMEOUT",e[e.WEBRTC_CONNECT_FAILED=1019]="WEBRTC_CONNECT_FAILED"}(r||(r={}));var s=[r.VIDEO_ERROR,r.VIDEO_ERROR_1,r.VIDEO_ERROR_2,r.VIDEO_ERROR_3,r.VIDEO_ERROR_4]},function(e,t,i){function n(e,t,i){var n=i?t+i:e.byteLength-1;return String.fromCharCode.apply(null,e.subarray(t,n))}function r(e,t,i){void 0===t&&(t=0),void 0===i&&(i=!1);var n;return(n=i?(e[t+1]<<8)+e[t]:(e[t]<<8)+e[t+1])<0?65536+n:n}function a(e,t,i){void 0===t&&(t=0),void 0===i&&(i=!1);var n;return(n=i?(e[t+2]<<16)+(e[t+1]<<8)+e[t]:(e[t]<<16)+(e[t+1]<<8)+e[t+2])<0?16777215+n:n}function s(e,t,i){void 0===t&&(t=0),void 0===i&&(i=!1);var n;return(n=i?e[t+3]*Math.pow(2,24)+(e[t+2]<<16)+(e[t+1]<<8)+e[t]:e[t]*Math.pow(2,24)+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3])<0?4294967296+n:n}function o(e,t,i){void 0===i&&(i=!1);var n=0;return 2147483648&(n=i?e[t+3]*Math.pow(2,24)+(e[t+2]<<16)+(e[t+1]<<8)+e[t]:e[t]*Math.pow(2,24)+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3])&&(n=n-1-4294967295),n}function c(e,t,i){return void 0===t&&(t=0),void 0===i&&(i=!1),i?e[t+7]*Math.pow(2,56)+e[t+6]*Math.pow(2,48)+e[t+5]*Math.pow(2,40)+e[t+4]*Math.pow(2,32)+e[t+3]*Math.pow(2,24)+(e[t+2]<<16)+(e[t+1]<<8)+e[t]:e[t]*Math.pow(2,56)+e[t+1]*Math.pow(2,48)+e[t+2]*Math.pow(2,40)+e[t+3]*Math.pow(2,32)+e[t+4]*Math.pow(2,24)+(e[t+5]<<16)+(e[t+6]<<8)+e[t+7]}function _(e,t){if(e.length!==t.length)return!1;for(var i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}i.d(t,"a",(function(){return n})),i.d(t,"d",(function(){return r})),i.d(t,"e",(function(){return a})),i.d(t,"f",(function(){return s})),i.d(t,"c",(function(){return o})),i.d(t,"g",(function(){return c})),i.d(t,"b",(function(){return _}))},function(e,t){function i(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}e.exports=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,i){var n,r;i.d(t,"a",(function(){return n})),(r=n||(n={}))[r.HEVC_NAL_TRAIL_N=0]="HEVC_NAL_TRAIL_N",r[r.HEVC_NAL_TRAIL_R=1]="HEVC_NAL_TRAIL_R",r[r.HEVC_NAL_TSA_N=2]="HEVC_NAL_TSA_N",r[r.HEVC_NAL_TSA_R=3]="HEVC_NAL_TSA_R",r[r.HEVC_NAL_STSA_N=4]="HEVC_NAL_STSA_N",r[r.HEVC_NAL_STSA_R=5]="HEVC_NAL_STSA_R",r[r.HEVC_NAL_RADL_N=6]="HEVC_NAL_RADL_N",r[r.HEVC_NAL_RADL_R=7]="HEVC_NAL_RADL_R",r[r.HEVC_NAL_RASL_N=8]="HEVC_NAL_RASL_N",r[r.HEVC_NAL_RASL_R=9]="HEVC_NAL_RASL_R",r[r.HEVC_NAL_VCL_N10=10]="HEVC_NAL_VCL_N10",r[r.HEVC_NAL_VCL_R11=11]="HEVC_NAL_VCL_R11",r[r.HEVC_NAL_VCL_N12=12]="HEVC_NAL_VCL_N12",r[r.HEVC_NAL_VCL_R13=13]="HEVC_NAL_VCL_R13",r[r.HEVC_NAL_VCL_N14=14]="HEVC_NAL_VCL_N14",r[r.HEVC_NAL_VCL_R15=15]="HEVC_NAL_VCL_R15",r[r.HEVC_NAL_BLA_W_LP=16]="HEVC_NAL_BLA_W_LP",r[r.HEVC_NAL_BLA_W_RADL=17]="HEVC_NAL_BLA_W_RADL",r[r.HEVC_NAL_BLA_N_LP=18]="HEVC_NAL_BLA_N_LP",r[r.HEVC_NAL_IDR_W_RADL=19]="HEVC_NAL_IDR_W_RADL",r[r.HEVC_NAL_IDR_N_LP=20]="HEVC_NAL_IDR_N_LP",r[r.HEVC_NAL_CRA_NUT=21]="HEVC_NAL_CRA_NUT",r[r.HEVC_NAL_RSV_IRAP_VCL22=22]="HEVC_NAL_RSV_IRAP_VCL22",r[r.HEVC_NAL_RSV_IRAP_VCL23=23]="HEVC_NAL_RSV_IRAP_VCL23",r[r.HEVC_NAL_RSV_VCL24=24]="HEVC_NAL_RSV_VCL24",r[r.HEVC_NAL_RSV_VCL25=25]="HEVC_NAL_RSV_VCL25",r[r.HEVC_NAL_RSV_VCL26=26]="HEVC_NAL_RSV_VCL26",r[r.HEVC_NAL_RSV_VCL27=27]="HEVC_NAL_RSV_VCL27",r[r.HEVC_NAL_RSV_VCL28=28]="HEVC_NAL_RSV_VCL28",r[r.HEVC_NAL_RSV_VCL29=29]="HEVC_NAL_RSV_VCL29",r[r.HEVC_NAL_RSV_VCL30=30]="HEVC_NAL_RSV_VCL30",r[r.HEVC_NAL_RSV_VCL31=31]="HEVC_NAL_RSV_VCL31",r[r.HEVC_NAL_VPS=32]="HEVC_NAL_VPS",r[r.HEVC_NAL_SPS=33]="HEVC_NAL_SPS",r[r.HEVC_NAL_PPS=34]="HEVC_NAL_PPS",r[r.HEVC_NAL_AUD=35]="HEVC_NAL_AUD",r[r.HEVC_NAL_EOS_NUT=36]="HEVC_NAL_EOS_NUT",r[r.HEVC_NAL_EOB_NUT=37]="HEVC_NAL_EOB_NUT",r[r.HEVC_NAL_FD_NUT=38]="HEVC_NAL_FD_NUT",r[r.HEVC_NAL_SEI_PREFIX=39]="HEVC_NAL_SEI_PREFIX",r[r.HEVC_NAL_SEI_SUFFIX=40]="HEVC_NAL_SEI_SUFFIX",r[r.HEVC_NAL_RSV_NVCL41=41]="HEVC_NAL_RSV_NVCL41",r[r.HEVC_NAL_RSV_NVCL42=42]="HEVC_NAL_RSV_NVCL42",r[r.HEVC_NAL_RSV_NVCL43=43]="HEVC_NAL_RSV_NVCL43",r[r.HEVC_NAL_RSV_NVCL44=44]="HEVC_NAL_RSV_NVCL44",r[r.HEVC_NAL_RSV_NVCL45=45]="HEVC_NAL_RSV_NVCL45",r[r.HEVC_NAL_RSV_NVCL46=46]="HEVC_NAL_RSV_NVCL46",r[r.HEVC_NAL_RSV_NVCL47=47]="HEVC_NAL_RSV_NVCL47",r[r.HEVC_NAL_UNSPEC48=48]="HEVC_NAL_UNSPEC48",r[r.HEVC_NAL_UNSPEC49=49]="HEVC_NAL_UNSPEC49",r[r.HEVC_NAL_UNSPEC50=50]="HEVC_NAL_UNSPEC50",r[r.HEVC_NAL_UNSPEC51=51]="HEVC_NAL_UNSPEC51",r[r.HEVC_NAL_UNSPEC52=52]="HEVC_NAL_UNSPEC52",r[r.HEVC_NAL_UNSPEC53=53]="HEVC_NAL_UNSPEC53",r[r.HEVC_NAL_UNSPEC54=54]="HEVC_NAL_UNSPEC54",r[r.HEVC_NAL_UNSPEC55=55]="HEVC_NAL_UNSPEC55",r[r.HEVC_NAL_UNSPEC56=56]="HEVC_NAL_UNSPEC56",r[r.HEVC_NAL_UNSPEC57=57]="HEVC_NAL_UNSPEC57",r[r.HEVC_NAL_UNSPEC58=58]="HEVC_NAL_UNSPEC58",r[r.HEVC_NAL_UNSPEC59=59]="HEVC_NAL_UNSPEC59",r[r.HEVC_NAL_UNSPEC60=60]="HEVC_NAL_UNSPEC60",r[r.HEVC_NAL_UNSPEC61=61]="HEVC_NAL_UNSPEC61",r[r.HEVC_NAL_UNSPEC62=62]="HEVC_NAL_UNSPEC62",r[r.PRIV_NAL_MAGIC_HEVC=63]="PRIV_NAL_MAGIC_HEVC",r[r.NAL_UNIT_INVALID=64]="NAL_UNIT_INVALID"},function(e,t){function i(){return e.exports=i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},e.exports.__esModule=!0,e.exports.default=e.exports,i.apply(this,arguments)}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,i){var n=i(7),r=i.n(n),a={};!function(e){if("undefined"!=typeof navigator){e=e?e.toLowerCase():navigator.userAgent.toLowerCase();var t=/(edge)\/([\w.]+)/.exec(e)||/(edg)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(iemobile)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(e)||[],i=/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(android)/.exec(e)||/(windows)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||[],n={browser:t[5]||t[3]||t[1]||"",version:t[2]||t[4]||"0",majorVersion:t[4]||t[2]||"0",platform:i[0]||""},s={x5:/ tbs\//.test(e),xweb:/ xweb\//.test(e)};if(n.browser){s[n.browser]=!0;var o=n.majorVersion.split(".");s.version={major:parseInt(n.majorVersion,10),string:n.version},o.length>1&&(s.version.minor=parseInt(o[1],10)),o.length>2&&(s.version.build=parseInt(o[2],10))}for(var c in n.platform&&(s[n.platform]=!0),(s.chrome||s.opr||s.safari)&&(s.webkit=!0),(s.rv||s.iemobile)&&(s.rv&&delete s.rv,n.browser="msie",s.msie=!0),(s.edg||s.edge)&&(delete s.edg,delete s.edge,n.browser="msedge",s.msedge=!0),s.opr&&(n.browser="opera",s.opera=!0),s.safari&&s.android&&(n.browser="android",s.android=!0),(s.android||s.iphone||s.ipad)&&(s.mobile=!0),s.ios=s.iphone||s.ipad,s.name=n.browser,s.platform=n.platform,a)a.hasOwnProperty(c)&&delete a[c];r()(a,s)}}(),t.a=a},function(e,t,i){i.d(t,"a",(function(){return n}));var n=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)}},function(e,t,i){var n,r,a,s,o;i.d(t,"d",(function(){return n})),i.d(t,"a",(function(){return r})),i.d(t,"c",(function(){return a})),i.d(t,"b",(function(){return s})),(o=n||(n={}))[o.video=1]="video",o[o.audio=2]="audio",function(e){e[e.ADTS=0]="ADTS",e[e.ASC=1]="ASC"}(r||(r={})),function(e){e.videoFrame="videoFrame",e.decoderConfig="decoderConfig"}(a||(a={})),function(e){e.UNKNOWN="unknown",e.FLV="flv",e.FMP4="fmp4",e.TS="ts",e.MP4="mp4",e.RAW="raw",e.IVF="ivf",e.YUV="yuv"}(s||(s={}))},function(e,t,i){i.d(t,"c",(function(){return n})),i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return a})),i.d(t,"d",(function(){return s})),i.d(t,"h",(function(){return o})),i.d(t,"e",(function(){return c})),i.d(t,"i",(function(){return _})),i.d(t,"f",(function(){return d})),i.d(t,"g",(function(){return u}));var n=1048576,r=10485760,a=25,s=9e4,o=9e4,c=1e3,_=.1,d=240,u=1e3},function(e,t,i){var n=i(43);e.exports=function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,n(e,t)},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,i){var n,r;i.d(t,"a",(function(){return n})),(r=n||(n={})).INIT_265="init265",r.APPEND_DATA="appendData",r.MEDIA_INFO="mediaInfo",r.UPDATE_STATE="updateState",r.RESET="reset",r.DESTROY="destroy",r.STEP="step",r.SEEK="seek",r.END_OF_DATA="endOfData",r.DEC_DROP_FRAME="dropFrame",r.FLUSH="flush",r.EXPIRED_DATA_SYNC="expiredDataSync",r.INIT_RENDERER="initRenderer"},function(e,t,i){var n,r="object"==typeof Reflect?Reflect:null,a=r&&"function"==typeof r.apply?r.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};n=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(e,t){return new Promise((function(i,n){function r(i){e.removeListener(t,a),n(i)}function a(){"function"==typeof e.removeListener&&e.removeListener("error",r),i([].slice.call(arguments))}var s,o;v(e,t,a,{once:!0}),"error"!==t&&(o=r,"function"==typeof(s=e).on&&v(s,"error",o,{once:!0}))}))},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var c=10;function _(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function d(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function u(e,t,i,n){var r,a,s,o;if(_(i),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),a=e._events),s=a[t]),void 0===s)s=a[t]=i,++e._eventsCount;else if("function"==typeof s?s=a[t]=n?[i,s]:[s,i]:n?s.unshift(i):s.push(i),(r=d(e))>0&&s.length>r&&!s.warned){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,o=c,console&&console.warn&&console.warn(o)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,i){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},r=l.bind(n);return r.listener=i,n.wrapFn=r,r}function f(e,t,i){var n=e._events;if(void 0===n)return[];var r=n[t];return void 0===r?[]:"function"==typeof r?i?[r.listener||r]:[r]:i?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(r):m(r,r.length)}function p(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function m(e,t){for(var i=new Array(t),n=0;n<t;++n)i[n]=e[n];return i}function v(e,t,i,n){if("function"==typeof e.on)n.once?e.once(t,i):e.on(t,i);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function r(a){n.once&&e.removeEventListener(t,r),i(a)}))}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return d(this)},o.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var n="error"===e,r=this._events;if(void 0!==r)n=n&&void 0===r.error;else if(!n)return!1;if(n){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var o=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw o.context=s,o}var c=r[e];if(void 0===c)return!1;if("function"==typeof c)a(c,this,t);else{var _=c.length,d=m(c,_);for(i=0;i<_;++i)a(d[i],this,t)}return!0},o.prototype.addListener=function(e,t){return u(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return u(this,e,t,!0)},o.prototype.once=function(e,t){return _(t),this.on(e,h(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return _(t),this.prependListener(e,h(this,e,t)),this},o.prototype.removeListener=function(e,t){var i,n,r,a,s;if(_(t),void 0===(n=this._events))return this;if(void 0===(i=n[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(r=-1,a=i.length-1;a>=0;a--)if(i[a]===t||i[a].listener===t){s=i[a].listener,r=a;break}if(r<0)return this;0===r?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,r),1===i.length&&(n[e]=i[0]),void 0!==n.removeListener&&this.emit("removeListener",e,s||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,i,n;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var r,a=Object.keys(i);for(n=0;n<a.length;++n)"removeListener"!==(r=a[n])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},o.prototype.listeners=function(e){return f(this,e,!0)},o.prototype.rawListeners=function(e){return f(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):p.call(e,t)},o.prototype.listenerCount=p,o.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},function(e,t,i){var n,r;i.d(t,"f",(function(){return n})),i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return o})),i.d(t,"d",(function(){return c})),i.d(t,"e",(function(){return _})),(r=n||(n={}))[r.AUDIO=8]="AUDIO",r[r.VIDEO=9]="VIDEO",r[r.SCRIPT=18]="SCRIPT";var a=13,s=11,o=4,c=5,_=function(){this.tagType=n.VIDEO,this.dataSize=0,this.timestamp=0,this.size=0,this.cts=0,this.frameType=0,this.codecId=0,this.body=void 0,this.packetType=void 0}},function(e,t,i){var n,r,a,s,o,c,_,d;i.d(t,"a",(function(){return o})),i.d(t,"d",(function(){return c})),i.d(t,"c",(function(){return _})),i.d(t,"b",(function(){return u})),i.d(t,"e",(function(){return m})),(d=o||(o={}))[d.AVCOL_PRI_RESERVED0=0]="AVCOL_PRI_RESERVED0",d[d.AVCOL_PRI_BT709=1]="AVCOL_PRI_BT709",d[d.AVCOL_PRI_UNSPECIFIED=2]="AVCOL_PRI_UNSPECIFIED",d[d.AVCOL_PRI_RESERVED=3]="AVCOL_PRI_RESERVED",d[d.AVCOL_PRI_BT470M=4]="AVCOL_PRI_BT470M",d[d.AVCOL_PRI_BT470BG=5]="AVCOL_PRI_BT470BG",d[d.AVCOL_PRI_SMPTE170M=6]="AVCOL_PRI_SMPTE170M",d[d.AVCOL_PRI_SMPTE240M=7]="AVCOL_PRI_SMPTE240M",d[d.AVCOL_PRI_FILM=8]="AVCOL_PRI_FILM",d[d.AVCOL_PRI_BT2020=9]="AVCOL_PRI_BT2020",d[d.AVCOL_PRI_SMPTE428=10]="AVCOL_PRI_SMPTE428",d[d.AVCOL_PRI_SMPTEST428_1=10]="AVCOL_PRI_SMPTEST428_1",d[d.AVCOL_PRI_SMPTE431=11]="AVCOL_PRI_SMPTE431",d[d.AVCOL_PRI_SMPTE432=12]="AVCOL_PRI_SMPTE432",d[d.AVCOL_PRI_EBU3213=22]="AVCOL_PRI_EBU3213",d[d.AVCOL_PRI_JEDEC_P22=22]="AVCOL_PRI_JEDEC_P22",d[d.AVCOL_PRI_NB=23]="AVCOL_PRI_NB",function(e){e[e.AVCOL_TRC_RESERVED0=0]="AVCOL_TRC_RESERVED0",e[e.AVCOL_TRC_BT709=1]="AVCOL_TRC_BT709",e[e.AVCOL_TRC_UNSPECIFIED=2]="AVCOL_TRC_UNSPECIFIED",e[e.AVCOL_TRC_RESERVED=3]="AVCOL_TRC_RESERVED",e[e.AVCOL_TRC_GAMMA22=4]="AVCOL_TRC_GAMMA22",e[e.AVCOL_TRC_GAMMA28=5]="AVCOL_TRC_GAMMA28",e[e.AVCOL_TRC_SMPTE170M=6]="AVCOL_TRC_SMPTE170M",e[e.AVCOL_TRC_SMPTE240M=7]="AVCOL_TRC_SMPTE240M",e[e.AVCOL_TRC_LINEAR=8]="AVCOL_TRC_LINEAR",e[e.AVCOL_TRC_LOG=9]="AVCOL_TRC_LOG",e[e.AVCOL_TRC_LOG_SQRT=10]="AVCOL_TRC_LOG_SQRT",e[e.AVCOL_TRC_IEC61966_2_4=11]="AVCOL_TRC_IEC61966_2_4",e[e.AVCOL_TRC_BT1361_ECG=12]="AVCOL_TRC_BT1361_ECG",e[e.AVCOL_TRC_IEC61966_2_1=13]="AVCOL_TRC_IEC61966_2_1",e[e.AVCOL_TRC_BT2020_10=14]="AVCOL_TRC_BT2020_10",e[e.AVCOL_TRC_BT2020_12=15]="AVCOL_TRC_BT2020_12",e[e.AVCOL_TRC_SMPTE2084=16]="AVCOL_TRC_SMPTE2084",e[e.AVCOL_TRC_SMPTEST2084=16]="AVCOL_TRC_SMPTEST2084",e[e.AVCOL_TRC_SMPTE428=17]="AVCOL_TRC_SMPTE428",e[e.AVCOL_TRC_SMPTEST428_1=17]="AVCOL_TRC_SMPTEST428_1",e[e.AVCOL_TRC_ARIB_STD_B67=18]="AVCOL_TRC_ARIB_STD_B67",e[e.AVCOL_TRC_NB=19]="AVCOL_TRC_NB"}(c||(c={})),function(e){e[e.AVCOL_SPC_RGB=0]="AVCOL_SPC_RGB",e[e.AVCOL_SPC_BT709=1]="AVCOL_SPC_BT709",e[e.AVCOL_SPC_UNSPECIFIED=2]="AVCOL_SPC_UNSPECIFIED",e[e.AVCOL_SPC_RESERVED=3]="AVCOL_SPC_RESERVED",e[e.AVCOL_SPC_FCC=4]="AVCOL_SPC_FCC",e[e.AVCOL_SPC_BT470BG=5]="AVCOL_SPC_BT470BG",e[e.AVCOL_SPC_SMPTE170M=6]="AVCOL_SPC_SMPTE170M",e[e.AVCOL_SPC_SMPTE240M=7]="AVCOL_SPC_SMPTE240M",e[e.AVCOL_SPC_YCGCO=8]="AVCOL_SPC_YCGCO",e[e.AVCOL_SPC_YCOCG=8]="AVCOL_SPC_YCOCG",e[e.AVCOL_SPC_BT2020_NCL=9]="AVCOL_SPC_BT2020_NCL",e[e.AVCOL_SPC_BT2020_CL=10]="AVCOL_SPC_BT2020_CL",e[e.AVCOL_SPC_SMPTE2085=11]="AVCOL_SPC_SMPTE2085",e[e.AVCOL_SPC_CHROMA_DERIVED_NCL=12]="AVCOL_SPC_CHROMA_DERIVED_NCL",e[e.AVCOL_SPC_CHROMA_DERIVED_CL=13]="AVCOL_SPC_CHROMA_DERIVED_CL",e[e.AVCOL_SPC_ICTCP=14]="AVCOL_SPC_ICTCP",e[e.AVCOL_SPC_NB=15]="AVCOL_SPC_NB"}(_||(_={}));var u,l=((n={})[o.AVCOL_PRI_RESERVED0]="reserved",n[o.AVCOL_PRI_BT709]="bt709",n[o.AVCOL_PRI_UNSPECIFIED]="unknown",n[o.AVCOL_PRI_RESERVED]="reserved",n[o.AVCOL_PRI_BT470M]="bt470m",n[o.AVCOL_PRI_BT470BG]="bt470bg",n[o.AVCOL_PRI_SMPTE170M]="smpte170m",n[o.AVCOL_PRI_SMPTE240M]="smpte240m",n[o.AVCOL_PRI_FILM]="film",n[o.AVCOL_PRI_BT2020]="bt2020",n[o.AVCOL_PRI_SMPTE428]="smpte428",n[o.AVCOL_PRI_SMPTE431]="smpte431",n[o.AVCOL_PRI_SMPTE432]="smpte432",n[o.AVCOL_PRI_EBU3213]="ebu3213",n),h=((r={})[c.AVCOL_TRC_RESERVED0]="reserved",r[c.AVCOL_TRC_BT709]="bt709",r[c.AVCOL_TRC_UNSPECIFIED]="unknown",r[c.AVCOL_TRC_RESERVED]="reserved",r[c.AVCOL_TRC_GAMMA22]="bt470m",r[c.AVCOL_TRC_GAMMA28]="bt470bg",r[c.AVCOL_TRC_SMPTE170M]="smpte170m",r[c.AVCOL_TRC_SMPTE240M]="smpte240m",r[c.AVCOL_TRC_LINEAR]="linear",r[c.AVCOL_TRC_LOG]="log100",r[c.AVCOL_TRC_LOG_SQRT]="log316",r[c.AVCOL_TRC_IEC61966_2_4]="iec61966-2-4",r[c.AVCOL_TRC_BT1361_ECG]="bt1361e",r[c.AVCOL_TRC_IEC61966_2_1]="iec61966-2-1",r[c.AVCOL_TRC_BT2020_10]="bt2020-10",r[c.AVCOL_TRC_BT2020_12]="bt2020-12",r[c.AVCOL_TRC_SMPTE2084]="smpte2084",r[c.AVCOL_TRC_SMPTE428]="smpte428",r[c.AVCOL_TRC_ARIB_STD_B67]="arib-std-b67",r),f=((a={})[_.AVCOL_SPC_RGB]="gbr",a[_.AVCOL_SPC_BT709]="bt709",a[_.AVCOL_SPC_UNSPECIFIED]="unknown",a[_.AVCOL_SPC_RESERVED]="reserved",a[_.AVCOL_SPC_FCC]="fcc",a[_.AVCOL_SPC_BT470BG]="bt470bg",a[_.AVCOL_SPC_SMPTE170M]="smpte170m",a[_.AVCOL_SPC_SMPTE240M]="smpte240m",a[_.AVCOL_SPC_YCGCO]="ycgco",a[_.AVCOL_SPC_BT2020_NCL]="bt2020nc",a[_.AVCOL_SPC_BT2020_CL]="bt2020c",a[_.AVCOL_SPC_SMPTE2085]="smpte2085",a[_.AVCOL_SPC_CHROMA_DERIVED_NCL]="chroma-derived-nc",a[_.AVCOL_SPC_CHROMA_DERIVED_CL]="chroma-derived-c",a[_.AVCOL_SPC_ICTCP]="ictcp",a);!function(e){e[e.AVCOL_RANGE_UNSPECIFIED=0]="AVCOL_RANGE_UNSPECIFIED",e[e.AVCOL_RANGE_MPEG=1]="AVCOL_RANGE_MPEG",e[e.AVCOL_RANGE_JPEG=2]="AVCOL_RANGE_JPEG"}(u||(u={}));var p=((s={})[u.AVCOL_RANGE_UNSPECIFIED]="unknown",s[u.AVCOL_RANGE_MPEG]="tv",s[u.AVCOL_RANGE_JPEG]="pc",s);function m(e){if(e&&"number"==typeof e.colorRange&&"number"==typeof e.matrixCoefficients&&"number"==typeof e.colourPrimaries&&"number"==typeof e.transferCharacteristics){var t=f[e.matrixCoefficients],i=l[e.colourPrimaries],n=h[e.transferCharacteristics];return t===i&&t===n?"("+(e.colorRange?p[e.colorRange]+" ":"")+t+")":"("+(e.colorRange?p[e.colorRange]+" ":"")+t+"/"+i+"/"+n+")"}return""}},function(e,t,i){i.d(t,"b",(function(){return o})),i.d(t,"a",(function(){return c}));var n=i(11),r=i(1),a=i(10);function s(e,t){return{type:e,id:a.d[e],pid:-1,inputTimescale:n.d,timescale:n.d,codec:"",sequenceNumber:0,samples:[],mp4Samples:[],duration:t,sampleDuration:0,fillDuration:0}}function o(e){var t=s(r.l.VIDEO,e);return t.width=0,t.height=0,t.rotation=0,t.pixelRatio=[],t.profile="",t.level="",t.chromaFormat="",t.fps=0,t.codecType=r.b.unknown,t}function c(e){var t=s(r.l.AUDIO,e);return t.config=[],t.samplerate=0,t.channelCount=0,t.codecType=r.b.unknown,t}},function(e,t,i){i.d(t,"e",(function(){return _})),i.d(t,"f",(function(){return d})),i.d(t,"c",(function(){return u})),i.d(t,"d",(function(){return l})),i.d(t,"b",(function(){return h})),i.d(t,"a",(function(){return f}));var n=i(11),r=i(3),a=i(0),s=i(10),o=i(2),c=i(4);function _(e,t){return!!(t+1<e.length&&function(e,t){return 255===e[t]&&240==(246&e[t+1])}(e,t))}function d(e,t){return e.asc!==Object(c.d)(t)}function u(e,t,i,n,o){if(void 0===o&&(o=""),d(e,i)||!e.samplerate||!e.configParsed){var _=n===s.a.ADTS?{objectType:1+((192&(f=i)[0])>>>6),sampleingIndex:(60&f[0])>>>2,chanelConfig:(1&f[0])<<2|(192&f[1])>>>6}:function(e){return{objectType:e[0]>>>3,sampleingIndex:(7&e[0])<<1|e[1]>>>7,chanelConfig:(120&e[1])>>>3}}(i);if(_.sampleingIndex<0||_.sampleingIndex>=13){var u={type:r.b.MUX_ERROR,details:r.a.PARSING_ERROR,fatal:!0,reason:"invalid sampling index:"+_.sampleingIndex};return void t.emit(a.a.ERROR,u)}if(_.chanelConfig<0||_.chanelConfig>=8){var h={type:r.b.MUX_ERROR,details:r.a.PARSING_ERROR,fatal:!0,reason:"invalid chanelConfig:"+_.chanelConfig};return void t.emit(a.a.ERROR,h)}l(e,_,o),e.asc=Object(c.d)(i),e.configParsed=!0}var f}function l(e,t,i){void 0===i&&(i="");var n=function(e,t){void 0===t&&(t="");var i,n,r=e.objectType,a=e.sampleingIndex,s=e.chanelConfig,c=navigator.userAgent.toLowerCase(),_=t||"mp4a.40."+r,d=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return o.b.v("manifest codec:"+t+",data:type:"+r+",sampleingIndex:"+a+"["+d[a]+"Hz],channelConfig:"+s),/firefox/i.test(c)?a>=6?(r=5,n=new Array(4),i=a-3):(r=2,n=new Array(2),i=a):-1!==c.indexOf("android")?(r=2,n=new Array(2),i=a):(r=5,n=new Array(4),t&&(-1!==t.indexOf("mp4a.40.29")||-1!==t.indexOf("mp4a.40.5"))||!t&&a>=6?i=a-3:((t&&-1!==t.indexOf("mp4a.40.2")&&(a>=6&&1===s||/vivaldi/i.test(c))||!t&&1===s)&&(r=2,n=new Array(2)),i=a)),n[0]=r<<3,n[0]|=(14&a)>>1,n[1]|=(1&a)<<7,n[1]|=s<<3,5===r&&(n[1]|=(14&i)>>1,n[2]=(1&i)<<7,n[2]|=8,n[3]=0),{config:n,samplerate:d[a],channelCount:s,codec:"mp4a.40."+r,manifestCodec:_}}(t,i);n&&(e.config=n.config,e.samplerate=n.samplerate,e.channelCount=n.channelCount,e.codec=n.codec,e.manifestCodec=n.manifestCodec,e.sampleDuration=h(e.samplerate),o.b.v("parsed codec:"+e.codec+",rate:"+n.samplerate+",nb channel:"+n.channelCount))}function h(e){return 1024*n.d/e}function f(e,t,i,n,r){var a,s,o,c,_,d,u,l,f=(a=t,s=i,o=n,c=r,_=h(e.samplerate),u=a.length,l=function(e,t){return 1&e[t+1]?7:9}(a,s),d=function(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}(a,s),(d-=l)>0&&s+l+d<=u?{headerLength:l,frameLength:d,stamp:o+c*_}:null);if(f){var p=f.frameLength,m=f.headerLength,v=f.stamp,g=m+p,y=Math.max(0,i+g-t.length);y?new Uint8Array(g-m).set(t.subarray(i+m,t.length),0):t.subarray(i+m,i+g);var E={unit:t.subarray(i+m,i+m+p),pts:v,dts:v,streamDTS:0};return y||e.samples.push(E),{sample:E,length:g,missing:y}}}},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,i){var n=i(5),r=i.n(n),a=function(){function e(){this._size=0,this._cache=[],this._index=0,this._offset=0}var t=e.prototype;return t.put=function(t){if(this.unreadLen+t.byteLength>=e.MAX_CACHE_SIZE)throw new Error("max cache size");this._cache.push(t),this._size+=t.byteLength},t.get=function(e){if(!(e>this.unreadLen)){var t,i=this._cache[this._index];if(0===this._offset&&e===i.byteLength)e===i.buffer.byteLength?t=i:(t=new Uint8Array(e)).set(i),this._index++,this._offset=0;else{t=new Uint8Array(e);for(var n=0,r=0,a=0;n<e;)a=this._offset,r=Math.min(i.byteLength,e-n+a),0===a&&r===i.byteLength?t.set(i,n):t.set(i.subarray(a,r),n),n+=r-a,r>=i.byteLength?(this._index++,i=this._cache[this._index],this._offset=0):this._offset=r}return this._collateCache(),t}},t.read=function(e){if(!(e>this.unreadLen)){for(var t=new Uint8Array(e),i=this._index,n=0,r=0,a=this._offset;n<e;){var s=this._cache[i];i>0&&(a=0),r=Math.min(s.byteLength,e-n+a),t.set(s.subarray(a,r),n),n+=r-a,i++}return t}},t.skip=function(e){var t=this._offset+e;if(!(t>this._size)){if(t===this._size)this.clear();else for(;t>0;){var i=this._cache[this._index].byteLength;t<i?(this._offset=t,t=0):t===i?(this._offset=0,t=0,this._index++):(this._offset=0,t-=i,this._index++)}this._collateCache()}},t.clear=function(){this._size=0,this._cache=[],this._index=0,this._offset=0},t._collateCache=function(){for(;this._index;){var e=this._cache.shift();e&&(this._size-=e.byteLength),this._index--}},r()(e,[{key:"unreadLen",get:function(){return this._size-this._offset}}]),e}();a.MAX_CACHE_SIZE=104857600,t.a=a},function(e,t,i){var n,r,a;i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return r})),(a=n||(n={}))[a.AV_PIX_FMT_MONO=0]="AV_PIX_FMT_MONO",a[a.AV_PIX_FMT_YUV420P=1]="AV_PIX_FMT_YUV420P",a[a.AV_PIX_FMT_YUV422P=2]="AV_PIX_FMT_YUV422P",a[a.AV_PIX_FMT_YUV444P=3]="AV_PIX_FMT_YUV444P",function(e){e[e.normal=0]="normal",e[e.fill=1]="fill"}(r||(r={}))},function(e,t,i){i.d(t,"b",(function(){return o})),i.d(t,"a",(function(){return c}));var n,r=i(7),a=i.n(r),s={preferLowPowerToHighPerformance:!0,preserveDrawingBuffer:!0};function o(e){return e.getContext("webgl",s)||e.getContext("experimental-webgl",s)}function c(){if(!n){var e="undefined"==typeof HTMLCanvasElement?new OffscreenCanvas(1,1):document.createElement("canvas");_(e,n={webGL:!1,performance:!1},!0)||_(e,n,!1)}return n}function _(e,t,i){void 0===i&&(i=!1);var n=!1,r=a()({failIfMajorPerformanceCaveat:i},s);try{var o=e.getContext("webgl",r)||e.getContext("experimental-webgl",r);if(o){var c=o.getExtension("WEBGL_debug_renderer_info");t.webGL=!0,t.performance=i,null!=c&&c.UNMASKED_VENDOR_WEBGL&&(t.vendor=o.getParameter(null==c?void 0:c.UNMASKED_VENDOR_WEBGL)),null!=c&&c.UNMASKED_RENDERER_WEBGL&&(t.renderer=o.getParameter(null==c?void 0:c.UNMASKED_RENDERER_WEBGL)),n=!0;var _=o.getExtension("WEBGL_lose_context");_&&_.loseContext()}}catch(e){}return n}},function(e,t,n){var r=n(45),a=n(46),s=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,o=/[\n\r\t]/g,c=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,_=/:\d+$/,d=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,u=/^[a-zA-Z]:/;function l(e){return(e||"").toString().replace(s,"")}var h=[["#","hash"],["?","query"],function(e,t){return m(t.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],f={hash:1,query:1};function p(e){var t,n=("undefined"!=typeof window?window:void 0!==i.g?i.g:"undefined"!=typeof self?self:{}).location||{},r={},a=typeof(e=e||n);if("blob:"===e.protocol)r=new g(unescape(e.pathname),{});else if("string"===a)for(t in r=new g(e,{}),f)delete r[t];else if("object"===a){for(t in e)t in f||(r[t]=e[t]);void 0===r.slashes&&(r.slashes=c.test(e.href))}return r}function m(e){return"file:"===e||"ftp:"===e||"http:"===e||"https:"===e||"ws:"===e||"wss:"===e}function v(e,t){e=(e=l(e)).replace(o,""),t=t||{};var i,n=d.exec(e),r=n[1]?n[1].toLowerCase():"",a=!!n[2],s=!!n[3],c=0;return a?s?(i=n[2]+n[3]+n[4],c=n[2].length+n[3].length):(i=n[2]+n[4],c=n[2].length):s?(i=n[3]+n[4],c=n[3].length):i=n[4],"file:"===r?c>=2&&(i=i.slice(2)):m(r)?i=n[4]:r?a&&(i=i.slice(2)):c>=2&&m(t.protocol)&&(i=n[4]),{protocol:r,slashes:a||m(r),slashesCount:c,rest:i}}function g(e,t,i){if(e=(e=l(e)).replace(o,""),!(this instanceof g))return new g(e,t,i);var n,s,c,_,d,f,y=h.slice(),E=typeof t,b=this,A=0;for("object"!==E&&"string"!==E&&(i=t,t=null),i&&"function"!=typeof i&&(i=a.parse),n=!(s=v(e||"",t=p(t))).protocol&&!s.slashes,b.slashes=s.slashes||n&&t.slashes,b.protocol=s.protocol||t.protocol||"",e=s.rest,("file:"===s.protocol&&(2!==s.slashesCount||u.test(e))||!s.slashes&&(s.protocol||s.slashesCount<2||!m(b.protocol)))&&(y[3]=[/(.*)/,"pathname"]);A<y.length;A++)"function"!=typeof(_=y[A])?(c=_[0],f=_[1],c!=c?b[f]=e:"string"==typeof c?~(d="@"===c?e.lastIndexOf(c):e.indexOf(c))&&("number"==typeof _[2]?(b[f]=e.slice(0,d),e=e.slice(d+_[2])):(b[f]=e.slice(d),e=e.slice(0,d))):(d=c.exec(e))&&(b[f]=d[1],e=e.slice(0,d.index)),b[f]=b[f]||n&&_[3]&&t[f]||"",_[4]&&(b[f]=b[f].toLowerCase())):e=_(e,b);i&&(b.query=i(b.query)),n&&t.slashes&&"/"!==b.pathname.charAt(0)&&(""!==b.pathname||""!==t.pathname)&&(b.pathname=function(e,t){if(""===e)return t;for(var i=(t||"/").split("/").slice(0,-1).concat(e.split("/")),n=i.length,r=i[n-1],a=!1,s=0;n--;)"."===i[n]?i.splice(n,1):".."===i[n]?(i.splice(n,1),s++):s&&(0===n&&(a=!0),i.splice(n,1),s--);return a&&i.unshift(""),"."!==r&&".."!==r||i.push(""),i.join("/")}(b.pathname,t.pathname)),"/"!==b.pathname.charAt(0)&&m(b.protocol)&&(b.pathname="/"+b.pathname),r(b.port,b.protocol)||(b.host=b.hostname,b.port=""),b.username=b.password="",b.auth&&(~(d=b.auth.indexOf(":"))?(b.username=b.auth.slice(0,d),b.username=encodeURIComponent(decodeURIComponent(b.username)),b.password=b.auth.slice(d+1),b.password=encodeURIComponent(decodeURIComponent(b.password))):b.username=encodeURIComponent(decodeURIComponent(b.auth)),b.auth=b.password?b.username+":"+b.password:b.username),b.origin="file:"!==b.protocol&&m(b.protocol)&&b.host?b.protocol+"//"+b.host:"null",b.href=b.toString()}g.prototype={set:function(e,t,i){var n=this;switch(e){case"query":"string"==typeof t&&t.length&&(t=(i||a.parse)(t)),n[e]=t;break;case"port":n[e]=t,r(t,n.protocol)?t&&(n.host=n.hostname+":"+t):(n.host=n.hostname,n[e]="");break;case"hostname":n[e]=t,n.port&&(t+=":"+n.port),n.host=t;break;case"host":n[e]=t,_.test(t)?(t=t.split(":"),n.port=t.pop(),n.hostname=t.join(":")):(n.hostname=t,n.port="");break;case"protocol":n.protocol=t.toLowerCase(),n.slashes=!i;break;case"pathname":case"hash":if(t){var s="pathname"===e?"/":"#";n[e]=t.charAt(0)!==s?s+t:t}else n[e]=t;break;case"username":case"password":n[e]=encodeURIComponent(t);break;case"auth":var o=t.indexOf(":");~o?(n.username=t.slice(0,o),n.username=encodeURIComponent(decodeURIComponent(n.username)),n.password=t.slice(o+1),n.password=encodeURIComponent(decodeURIComponent(n.password))):n.username=encodeURIComponent(decodeURIComponent(t))}for(var c=0;c<h.length;c++){var d=h[c];d[4]&&(n[d[1]]=n[d[1]].toLowerCase())}return n.auth=n.password?n.username+":"+n.password:n.username,n.origin="file:"!==n.protocol&&m(n.protocol)&&n.host?n.protocol+"//"+n.host:"null",n.href=n.toString(),n},toString:function(e){e&&"function"==typeof e||(e=a.stringify);var t,i=this,n=i.host,r=i.protocol;r&&":"!==r.charAt(r.length-1)&&(r+=":");var s=r+(i.protocol&&i.slashes||m(i.protocol)?"//":"");return i.username?(s+=i.username,i.password&&(s+=":"+i.password),s+="@"):i.password?(s+=":"+i.password,s+="@"):"file:"!==i.protocol&&m(i.protocol)&&!n&&"/"!==i.pathname&&(s+="@"),(":"===n[n.length-1]||_.test(i.hostname)&&!i.port)&&(n+=":"),s+=n+i.pathname,(t="object"==typeof i.query?e(i.query):i.query)&&(s+="?"!==t.charAt(0)?"?"+t:t),i.hash&&(s+=i.hash),s}},g.extractProtocol=v,g.location=p,g.trimLeft=l,g.qs=a,e.exports=g},function(e,t,i){var n=i(34),r=i(1),a=i(2),s=i(18),o={chanelConfig:2,objectType:2,sampleingIndex:7},c="audio-helper",_=function(){function e(){}return e.initAudioForFillSilent=function(e,t){void 0===t&&(t=""),e.codec||(s.d(e,o,t||(/firefox/.test(navigator.userAgent.toLowerCase())?"mp4a.40.2":"mp4a.40.5")),e.codecType=r.b.aac)},e.fillAACFrameByCount=function(t,i,r,a,o){void 0===a&&(a=0),void 0===o&&(o=""),e.initAudioForFillSilent(t,o);var c=n.a.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(c&&r>0){for(var _=s.b(t.samplerate),d=i||0,u=0;u<r;u++)t.samples.push({unit:c,pts:d,dts:d,duration:_,streamDTS:a+_*u}),d+=_;return t.fillDuration+=_*r,d}return i},e.ensureAudioFrame=function(t,i,n,r){if(void 0===n&&(n=""),i.samples.length){if(0===t.samples.length){var s=i.samples[0].pts;a.b.w(c,"fill audio before remux frame @"+s+" has audio data:"+t.samples.length,i.samples.length),e.fillAACFrameByCount(t,s,1,i.samples[0].streamDTS,n)}var o=i.samples[i.samples.length-1],_=o.dts-(t.samples.length?t.samples[t.samples.length-1].dts:i.samples[0].dts);(_>1*i.inputTimescale||_/i.inputTimescale>0&&r)&&(a.b.w(c,"fill audio @end"),e.fillAACFrameByCount(t,o.dts,1,o.streamDTS,n))}},e}();t.a=_},function(e,t,i){i.d(t,"a",(function(){return G}));var n=i(7),r=i.n(n),a=i(5),s=i.n(a),o=i(3),c=i(0),_=i(24),d=i(1),u=i(10),l=i(8),h=i(2),f=i(34),p=i(11),m=i(17),v=Object(m.b)(0);v.bitDepth=8,v.chromaFormat="4:2:0",v.codec="avc1.64000a",v.colorInfo={colorRange:1,colourPrimaries:2,transferCharacteristics:0,matrixCoefficients:0},v.fps=15,v.height=48,v.id=1,v.inputTimescale=p.d,v.level="1.0",v.pixelRatio=[1,1],v.profile="High",v.sampleDuration=6e3,v.width=64,v.decConf=new Uint8Array([1,100,0,10,255,225,0,24,103,100,0,10,172,114,4,68,122,16,0,0,3,0,16,0,0,3,3,32,241,34,88,70,1,0,6,104,232,67,143,44,139]);var g=[{type:5,data:new Uint8Array([101,136,129,0,5,127,254,246,115,124,10,107,109,176,149,46,5,118,246,150,55,45,60,239,89,160,124,49,129])}],y=function(){function e(){}return e.getFillTrackBySamples=function(e,t){if(t.length){e.bitDepth=v.bitDepth,e.chromaFormat=v.chromaFormat,e.codec=v.codec,e.colorInfo=v.colorInfo,e.fps=e.fps||v.fps,e.id=v.id,e.inputTimescale=v.inputTimescale,e.level=v.level,e.pixelRatio=v.pixelRatio,e.profile=v.profile,e.sampleDuration=v.sampleDuration,e.width=v.width,e.height=v.height,e.duration=1/0,e.decConf=v.decConf,e.outputRaw=!1;for(var i=e.inputTimescale/e.fps||3e3,n=t[0].dts,r=t[0].streamDTS,a=0;n<=t[t.length-1].dts;)e.samples.push({cts:0,dts:n,key:!0,pts:n,streamDTS:r,units:g}),n+=i,r+=i,a++;return e.fillDuration+=i*a,e}},e}(),E=Math.pow(2,32)-1,b={video:new Uint8Array([0,0,0,45,104,100,108,114,0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),audio:new Uint8Array([0,0,0,45,104,100,108,114,0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0])},A=new Uint8Array([0,0,0,24,102,116,121,112,105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),T=new Uint8Array([0,0,0,16,115,116,116,115,0,0,0,0,0,0,0,0]),S=new Uint8Array([0,0,0,16,115,116,115,99,0,0,0,0,0,0,0,0]),R=new Uint8Array([0,0,0,16,115,116,99,111,0,0,0,0,0,0,0,0]),x=new Uint8Array([0,0,0,20,115,116,115,122,0,0,0,0,0,0,0,0,0,0,0,0]),L=new Uint8Array([0,0,0,36,100,105,110,102,0,0,0,28,100,114,101,102,0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),C=new Uint8Array([0,0,0,20,118,109,104,100,0,0,0,1,0,0,0,0,0,0,0,0]),D=new Uint8Array([0,0,0,16,115,109,104,100,0,0,0,0,0,0,0,0]),I=new Uint8Array([0,0,0,120,109,118,104,100,1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]),w=new Uint8Array([0,0,0,104,116,107,104,100,1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0]),k=new Uint8Array([0,0,0,32,116,114,101,120,0,0,0,0,0,0,0,2,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]),O=new Uint8Array([0,0,0,44,109,100,104,100,1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,0,0,172,68,0,0,0,0,0,0,0,0,85,196,0,0]),N=new Uint8Array([0,0,0,93,115,116,115,100,0,0,0,0,0,0,0,1,0,0,0,77,109,112,52,97,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,2,0,16,0,0,0,0,172,68,0,0,0,0,0,41,101,115,100,115,0,0,0,0,3,27,0,1,0,4,19,64,21,0,0,0,0,0,0,0,0,0,0,0,5]),P=new Uint8Array([0,0,0,52,115,116,115,100,0,0,0,0,0,0,0,1,0,0,0,36,46,109,112,51,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,2,0,16,0,0,0,0,0,0,0,0]),M=new Uint8Array([0,0,0,71,115,116,115,100,0,0,0,0,0,0,0,1,0,0,0,55,79,112,117,115,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,2,0,16,0,0,0,0,0,0,0,0,0,0,0,19,100,79,112,115,0,2,0,0,0,0,0,0,0,0,0]),V=new Uint8Array([0,0,0,0,115,116,115,100,0,0,0,0,0,0,0,1,0,0,0,0,97,118,48,49,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,0,2,208,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,107,119,97,105,45,118,105,100,101,111,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]),F=new Uint8Array([255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64]),U=new Uint8Array([0,0,0,0,0,1,0,0,0,0,0,0,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64]),B=new Uint8Array([0,0,0,0,255,255,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64]),H=function(){function e(){}return e.moov=function(t,i){for(var n=A,r=t.length,a=e.types.avc1;r--;)t[r].type===d.l.VIDEO&&(0===t[r].codec.indexOf("hev1")?a=e.types.hev1:0===t[r].codec.indexOf("av01")&&(a=e.types.av01));var s=n.byteLength+e._getMoovLen(t,i),o={data:new Uint8Array(s),offset:0};return o.data.set(n,0),o.data.set(a,16),o.offset+=n.byteLength,e._writeMoov(o,t,i),o.data},e.videoMediaSegment=function(t,i,n,r){var a=0===n.codec.indexOf("av01")?0:4,s=8+n.mp4Samples.reduce((function(e,t){return e+t.units.reduce((function(e,t){return e+t.data.byteLength+a}),0)}),0),o=e._getMediaSegmentData(n,s,r);return e._mediaSegmentHead(o,t,i,n,s,r),n.samples.forEach((function(e){e.units.forEach((function(e){var t=e.data.byteLength;a?(o.data[o.offset]=t>>24&255,o.data[o.offset+1]=t>>16&255,o.data[o.offset+2]=t>>8&255,o.data[o.offset+3]=255&t,o.data.set(e.data,o.offset+a),o.offset+=a+t):(o.data.set(e.data,o.offset),o.offset+=t)}))})),o.data},e.audioMediaSegment=function(t,i,n,r){var a=8+n.mp4Samples.reduce((function(e,t){return e+t.unit.byteLength}),0),s=e._getMediaSegmentData(n,a,r);return e._mediaSegmentHead(s,t,i,n,a,r),n.mp4Samples.forEach((function(e){s.data.set(e.unit,s.offset),s.offset+=e.unit.byteLength})),s.data},e.audioRawMpeg=function(t){var i=8+t.mp4Samples.reduce((function(e,t){return e+t.unit.byteLength}),0),n={data:new Uint8Array(i),offset:0};return e._writeBoxHead(n,e.types.mdat,i),t.mp4Samples.forEach((function(e){n.data.set(e.unit,n.offset),n.offset+=e.unit.byteLength})),n.data},e._getMoovLen=function(t,i){var n=t.reduce((function(t,i){return t+e._getTrakLen(i)}),0),r=i?i.reduce((function(e,t){return e+t.byteLength+8}),0):0;return 8+I.byteLength+n+e._getMvexLen(t)+r},e._writeMoov=function(t,i,n){var r=this,a=e._getMoovLen(i,n);e._writeBoxHead(t,e.types.moov,a),e._writeMvhd(t,i[0].timescale,i[0].duration),i.forEach((function(i){e._writeTrak(t,i)})),e._writeMvex(t,i),n&&n.forEach((function(e){r._writePssh(t,e)}))},e._writePssh=function(t,i){this._writeBoxHead(t,e.types.pssh,i.byteLength+8),t.data.set(i,t.offset),t.offset+=i.byteLength},e._getMoofLen=function(e){return 104+17*e.mp4Samples.length+this._getEncLen(e)},e._writeEnc=function(t,i,n){if(this._getEncLen(i)){var r=this._getSaizLen(i);this._writeBoxHead(t,e.types.saiz,r),t.offset+=5;var a=i.samples.length;t.data[t.offset]=a>>24&255,t.data[t.offset+1]=a>>16&255,t.data[t.offset+2]=a>>8&255,t.data[t.offset+3]=255&a,t.offset+=4,i.samples.forEach((function(e){e.auxiliaryInfo&&(t.data[t.offset]=e.auxiliaryInfo.enc.byteLength),t.offset++}));var s=this._getSaioLen();this._writeBoxHead(t,e.types.saio,s),t.offset+=4,t.data[t.offset+3]=1,t.offset+=4;var o=t.offset-n+4+16;t.data[t.offset]=o>>24&255,t.data[t.offset+1]=o>>16&255,t.data[t.offset+2]=o>>8&255,t.data[t.offset+3]=255&o,t.offset+=4;var c=this._getSencLen(i);this._writeBoxHead(t,e.types.senc,c),i.useSubSampleEnc&&(t.data[t.offset+3]=2),t.offset+=4,t.data[t.offset]=a>>24&255,t.data[t.offset+1]=a>>16&255,t.data[t.offset+2]=a>>8&255,t.data[t.offset+3]=255&a,t.offset+=4,i.samples.forEach((function(e){e.auxiliaryInfo&&(t.data.set(e.auxiliaryInfo.enc,t.offset),t.offset+=e.auxiliaryInfo.enc.byteLength)}))}},e._getEncLen=function(e){var t=this._getSencLen(e);return t?t+this._getSaizLen(e)+this._getSaioLen():0},e._getSaizLen=function(e){return 17+e.samples.length},e._getSencLen=function(e){var t=e.samples.reduce((function(e,t){return e+(t.auxiliaryInfo?t.auxiliaryInfo.enc.byteLength:0)}),0);return t?16+t:0},e._getSaioLen=function(){return 20},e._mediaSegmentHead=function(t,i,n,r,a,s){s&&(t.data.set(s),t.offset=s.byteLength),e._writeMoof(t,i,n,r),e._writeBoxHead(t,e.types.mdat,a)},e._getMediaSegmentData=function(t,i,n){var r=e._getMoofLen(t);return{data:new Uint8Array(r+i+(n?n.byteLength:0)),offset:0}},e._writeMvhd=function(e,t,i){i*=t;var n=Math.floor(i/(E+1)),r=Math.floor(i%(E+1)),a=I;a[28]=t>>24&255,a[29]=t>>16&255,a[30]=t>>8&255,a[31]=255&t,a[32]=n>>24,a[33]=n>>16&255,a[34]=n>>8&255,a[35]=255&n,a[36]=r>>24,a[37]=r>>16&255,a[38]=r>>8&255,a[39]=255&r,e.data.set(a,e.offset),e.offset+=I.byteLength},e._writeTkhd=function(e,t){var i=t.id,n=t.duration*t.timescale,r=Math.floor(n/(E+1)),a=Math.floor(n%(E+1)),s=0,o=0;t.hasOwnProperty("width")&&(s=t.width),t.hasOwnProperty("height")&&(o=t.height);var c=w;c[28]=i>>24&255,c[29]=i>>16&255,c[30]=i>>8&255,c[31]=255&i,c[36]=r>>24,c[37]=r>>16&255,c[38]=r>>8&255,c[39]=255&r,c[40]=a>>24,c[41]=a>>16&255,c[42]=a>>8&255,c[43]=255&a,90===t.rotation?U.forEach((function(e,t){return c[60+t]=e})):180===t.rotation?F.forEach((function(e,t){return c[60+t]=e})):270===t.rotation&&B.forEach((function(e,t){return c[60+t]=e})),c[96]=s>>8&255,c[97]=255&s,c[100]=o>>8&255,c[101]=255&o,e.data.set(c,e.offset),e.offset+=w.byteLength},e._getTrakLen=function(t){return 8+w.byteLength+e._getMdiaLen(t)},e._writeTrak=function(t,i){var n=e._getTrakLen(i);this._writeBoxHead(t,e.types.trak,n),this._writeTkhd(t,i),this._writeMdia(t,i)},e._getMdiaLen=function(t){return 8+O.byteLength+b[t.type].byteLength+e._getMinfLen(t)},e._writeMdia=function(t,i){var n=e._getMdiaLen(i);this._writeBoxHead(t,e.types.mdia,n),this._writeMdhd(t,i.timescale,i.duration),t.data.set(b[i.type],t.offset),t.offset+=b[i.type].byteLength,this._writeMinf(t,i)},e._writeMdhd=function(e,t,i){i*=t;var n=Math.floor(i/(E+1)),r=Math.floor(i%(E+1)),a=O;a[28]=t>>24&255,a[29]=t>>16&255,a[30]=t>>8&255,a[31]=255&t,a[32]=n>>24,a[33]=n>>16&255,a[34]=n>>8&255,a[35]=255&n,a[36]=r>>24,a[37]=r>>16&255,a[38]=r>>8&255,a[39]=255&r,e.data.set(a,e.offset),e.offset+=a.byteLength},e._getMinfLen=function(t){return t.type===d.l.AUDIO?8+D.byteLength+L.byteLength+e._getStblLen(t):8+C.byteLength+L.byteLength+e._getStblLen(t)},e._writeMinf=function(t,i){if(this._writeBoxHead(t,e.types.minf,e._getMinfLen(i)),i.type===d.l.AUDIO)return t.data.set(D,t.offset),t.offset+=D.byteLength,t.data.set(L,t.offset),t.offset+=L.byteLength,void this._writeStbl(t,i);t.data.set(C,t.offset),t.offset+=C.byteLength,t.data.set(L,t.offset),t.offset+=L.byteLength,this._writeStbl(t,i)},e._getStblLen=function(e){return 8+this._getStsdLen(e)+T.byteLength+S.byteLength+x.byteLength+R.byteLength},e._writeStbl=function(t,i){var n=this._getStblLen(i);this._writeBoxHead(t,e.types.stbl,n),this._writeStsd(t,i),t.data.set(T,t.offset),t.offset+=T.byteLength,t.data.set(S,t.offset),t.offset+=S.byteLength,t.data.set(x,t.offset),t.offset+=x.byteLength,t.data.set(R,t.offset),t.offset+=R.byteLength},e._getStsdLen=function(t){return t.stsd?t.stsd.byteLength+8:t.type===d.l.AUDIO?e._getAudioStsdLen(t):e._getVideoStsdLen(t)},e._writeStsd=function(t,i){if(i.stsd)return this._writeBoxHead(t,e.types.stsd,i.stsd.byteLength+8),t.data.set(i.stsd,t.offset),void(t.offset+=i.stsd.byteLength);i.type!==d.l.AUDIO?e._writeVideoStsd(t,i):this._writeAudioStsd(t,i)},e._getDecConfLen=function(e){return e.decConf?8+e.decConf.byteLength:0},e._getVideoStsdLen=function(t){return V.byteLength+e._getDecConfLen(t)},e._writeVideoStsd=function(t,i){var n=this._getDecConfLen(i),r=this._getVideoStsdLen(i),a=V,s=r-16,o=e.types.avc1,c=e.types.avcC;0===i.codec.indexOf("hev1")?(o=e.types.hev1,c=e.types.hvcC):0===i.codec.indexOf("av01")&&(o=e.types.av01,c=e.types.av1C);var _=i.width,d=i.height;a[0]=r>>24&255,a[1]=r>>16&255,a[2]=r>>8&255,a[3]=255&r,this._writeBoxHeadAt(a,o,s,16),a[48]=_>>8&255,a[49]=255&_,a[50]=d>>8&255,a[51]=255&d,t.data.set(a,t.offset),t.offset+=a.byteLength,this._writeBoxHead(t,c,n),i.decConf&&(t.data.set(i.decConf,t.offset),t.offset+=i.decConf.byteLength)},e._getMp4aEsdsLen=function(e){return 33+e.config.length+4},e._getMp4aStsdLen=function(t){return 52+e._getMp4aEsdsLen(t)},e._writeMp4aStsd=function(t,i){var n=i.config.length,r=e._getMp4aEsdsLen(i),a=e._getMp4aStsdLen(i),s=a-16,o=N;o[0]=a>>24&255,o[1]=a>>16&255,o[2]=a>>8&255,o[3]=255&a,o[16]=s>>24&255,o[17]=s>>16&255,o[18]=s>>8&255,o[19]=255&s,o[41]=i.channelCount,o[48]=i.samplerate>>8&255,o[49]=255&i.samplerate,o[52]=r>>24&255,o[53]=r>>16&255,o[54]=r>>8&255,o[55]=255&r,o[65]=23+n,o[70]=15+n,t.data.set(o,t.offset),t.offset+=o.byteLength;var c=[n].concat(i.config).concat([6,1,2]);t.data.set(c,t.offset),t.offset+=c.length},e._writeOpusStsd=function(e,t){var i=M;i[41]=i[61]=t.channelCount,i[64]=t.samplerate>>24&255,i[65]=t.samplerate>>16&255,i[48]=i[66]=t.samplerate>>8&255,i[49]=i[67]=255&t.samplerate,e.data.set(i,e.offset),e.offset+=i.byteLength},e._writeMp3Stsd=function(e,t){var i=P;i[41]=t.channelCount,i[48]=t.samplerate>>8&255,i[49]=255&t.samplerate,e.data.set(i,e.offset),e.offset+=i.byteLength},e._getAudioStsdLen=function(t){return"mp3"===t.codec?P.length:"opus"===t.codec?M.length:e._getMp4aStsdLen(t)},e._writeAudioStsd=function(t,i){"mp3"===i.codec?e._writeMp3Stsd(t,i):"opus"===i.codec?e._writeOpusStsd(t,i):e._writeMp4aStsd(t,i)},e._getMvexLen=function(e){return 8+e.length*k.byteLength},e._writeMvex=function(t,i){var n=e._getMvexLen(i);this._writeBoxHead(t,e.types.mvex,n),i.forEach((function(i){e._writeTrex(t,i)}))},e._writeTrex=function(e,t){var i=t.id,n=k;n[12]=i>>24,n[13]=i>>16&255,n[14]=i>>8&255,n[15]=255&i,e.data.set(n,e.offset),e.offset+=n.byteLength},e._writeMoof=function(t,i,n,r){var a=r.mp4Samples.length,s=t.offset,o=e._getMoofLen(r),c=o-24,_=12+a,d=20+16*a,u=o+8,l=r.id,h=r.mp4Samples||[],f=Math.floor(n/(E+1)),p=Math.floor(n%(E+1));e._writeBoxHead(t,e.types.moof,o),e._writeBoxHead(t,e.types.mfhd,16),t.data[t.offset+4]=i>>24,t.data[t.offset+5]=i>>16&255,t.data[t.offset+6]=i>>8&255,t.data[t.offset+7]=255&i,t.offset+=8,e._writeBoxHead(t,e.types.traf,c),e._writeBoxHead(t,e.types.tfhd,20),t.data[t.offset+1]=2,t.data[t.offset+3]=2,t.data[t.offset+4]=l>>24,t.data[t.offset+5]=l>>16&255,t.data[t.offset+6]=l>>8&255,t.data[t.offset+7]=255&l,t.data[t.offset+11]=r.sampleDescIndex||1,t.offset+=12,e._writeBoxHead(t,e.types.tfdt,20),t.data[t.offset]=1,t.data[t.offset+4]=f>>24,t.data[t.offset+5]=f>>16&255,t.data[t.offset+6]=f>>8&255,t.data[t.offset+7]=255&f,t.data[t.offset+8]=p>>24,t.data[t.offset+9]=p>>16&255,t.data[t.offset+10]=p>>8&255,t.data[t.offset+11]=255&p,t.offset+=12,e._writeBoxHead(t,e.types.sdtp,_),t.offset+=4,h.forEach((function(e,i){var n=e.flags;t.data[t.offset+i]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy})),t.offset+=a,e._writeBoxHead(t,e.types.trun,d),t.data[t.offset+2]=15,t.data[t.offset+3]=1,t.data[t.offset+4]=a>>>24&255,t.data[t.offset+5]=a>>>16&255,t.data[t.offset+6]=a>>>8&255,t.data[t.offset+7]=255&a,t.data[t.offset+8]=u>>>24&255,t.data[t.offset+9]=u>>>16&255,t.data[t.offset+10]=u>>>8&255,t.data[t.offset+11]=255&u,t.offset+=12,h.forEach((function(e,i){t.data.set([e.duration>>>24&255,e.duration>>>16&255,e.duration>>>8&255,255&e.duration,e.len>>>24&255,e.len>>>16&255,e.len>>>8&255,255&e.len,e.flags.isLeading<<2|e.flags.dependsOn,e.flags.isDependedOn<<6|e.flags.hasRedundancy<<4|e.flags.isNonSync,61440&e.flags.degradPrio,15&e.flags.degradPrio,e.cts>>>24&255,e.cts>>>16&255,e.cts>>>8&255,255&e.cts],t.offset+16*i)})),t.offset+=16*a,this._getEncLen(r)&&this._writeEnc(t,r,s)},e._writeBoxHead=function(t,i,n){e._writeBoxHeadAt(t.data,i,n,t.offset),t.offset+=8},e._writeBoxHeadAt=function(e,t,i,n){e[n]=i>>24&255,e[n+1]=i>>16&255,e[n+2]=i>>8&255,e[n+3]=255&i,e.set(t,n+4)},e}();H.types={avc1:[97,118,99,49],avcC:[97,118,99,67],btrt:[98,116,114,116],dinf:[100,105,110,102],dref:[100,114,101,102],esds:[101,115,100,115],ftyp:[102,116,121,112],hdlr:[104,100,108,114],mdat:[109,100,97,116],mdhd:[109,100,104,100],mdia:[109,100,105,97],mfhd:[109,102,104,100],minf:[109,105,110,102],moof:[109,111,111,102],moov:[109,111,111,118],mp4a:[109,112,52,97],mvex:[109,118,101,120],mvhd:[109,118,104,100],pasp:[112,97,115,112],sdtp:[115,100,116,112],stbl:[115,116,98,108],stco:[115,116,99,111],stsc:[115,116,115,99],stsd:[115,116,115,100],stsz:[115,116,115,122],stts:[115,116,116,115],tfdt:[116,102,100,116],tfhd:[116,102,104,100],traf:[116,114,97,102],trak:[116,114,97,107],trun:[116,114,117,110],trex:[116,114,101,120],tkhd:[116,107,104,100],vmhd:[118,109,104,100],smhd:[115,109,104,100],hvcC:[104,118,99,67],pssh:[112,115,115,104],saiz:[115,97,105,122],saio:[115,97,105,111],senc:[115,101,110,99],av1C:[97,118,49,67],hev1:[104,101,118,49],av01:[97,118,48,49]};var j=H,W="remuxer",z=function(){function e(e,t,i,n){var r=this;void 0===n&&(n=""),this._eventEmitter=void 0,this._config=void 0,this._typeSupported=void 0,this._isSafari=void 0,this._forceFirstIDR=void 0,this._videoTimeReferenceInfo=void 0,this._rawVideoTimeOffset=0,this._ISGenerated=!1,this._videoTime=void 0,this._lastVideoCodec="",this._transmuxData=void 0,this._nextAudioPts=void 0,this._nextAvcDts=void 0,this._initPTS=void 0,this._initDTS=void 0,this._initSegment={},this._pssh=void 0,this._videoTrack=void 0,this._onError=function(e){r._eventEmitter.emit(c.a.ERROR,e)},this._eventEmitter=e,this._config=t,this._typeSupported=i;var a=navigator.userAgent;this._isSafari=!(!(n&&n.indexOf("Apple")>-1&&a)||a.match("CriOS")),this._ISGenerated=!1,this._resetVideoTime(),this._videoTimeReferenceInfo={},this._forceFirstIDR=!(!l.a.chrome||!(l.a.version.major<50||50===l.a.version.major&&l.a.version.build<2661))}var t=e.prototype;return t.destroy=function(){},t.resetTimeStamp=function(e){this._initPTS=this._initDTS=e,this._resetVideoTime()},t.resetInitSegment=function(e){this._ISGenerated=!1,this._initSegment={},this._transmuxData=e,this._rawVideoTimeOffset=0,this._pssh=void 0,this._lastVideoCodec="",this._clearVideoTimeReference()},t.getLastPTS=function(){return{video:this._videoTime.vLastPTS,audio:this._videoTime.aLastPTS}},t.flush=function(e){var t;void 0===e&&(e=!0);var i=this._videoTimeReferenceInfo;if(i.sample&&(i.track.samples=[i.sample],delete i.sample,i.sequenceNumber+=1,t=this._remuxVideo(i.track,i.timeOffset,!0,i.accurateTimeOffset)),this._clearVideoTimeReference(),t&&e){var n=[t];this._eventEmitter.emit(c.a.PARSING_DATA,{segments:n,extra:this._transmuxData})}return t},t._clearVideoTimeReference=function(){this._videoTimeReferenceInfo={}},t.remux=function(e,t,i,n,r,a,s){var o,l,f,p,m=this;if(void 0===a&&(a=!1),s&&(this._pssh=s),this._videoTrack=t,this._config.ensureAudio&&e.active&&_.a.ensureAudioFrame(e,t,null==(p=this._transmuxData)?void 0:p.audioCodec,a),t.active)if(!this._ISGenerated&&t.outputRaw&&(l=this._getRawVideoInfo(t)),t.outputRaw&&t.samples.length){if(o=t.samples,t.samples=[],this._config.ensureVideo&&e.samples.length&&e.samplerate){var v=this._fillVideoByAudio(t,e);v&&(t=v,f=!0,h.b.i(W,"fill black video frame by video"))}}else if(!t.outputRaw&&a&&0===t.samples.length&&e.samples.length&&e.samplerate){if(this._ISGenerated&&(e.samples[e.samples.length-1].pts-e.samples[0].pts)/e.inputTimescale<1)return;var g=this._fillVideoByAudio(t,e);g&&(t=g,f=!0,h.b.i(W,"fill black video frame by audio"))}if(this._lastVideoCodec=t.codec,this._ISGenerated||this._generateIS(e,t,i,l,f),!n&&t.samples.length&&(t.samples[0].pts=t.samples[0].dts),this._ISGenerated){var y,E,b=i,A=i;if(e.samples.length&&t.samples.length)if(!n&&r){if(e.samples[0].pts-t.samples[0].pts<0){var T=t.samples[0];T.pts=e.samples[0].pts,T.dts=T.pts-T.cts}}else{var S=(e.samples[0].pts-t.samples[0].pts)/t.inputTimescale;b+=Math.max(0,S),A+=Math.max(0,-S)}y=this._remuxAudio(e,b,n,r),!(E=this._remuxVideo(t,A,n,r,a))&&a&&this._videoTimeReferenceInfo.sample&&(E=this.flush(!1)),f&&(this._ISGenerated=!1),E&&!y&&e.codec&&e.codecType===d.b.aac&&(y=this._remuxEmptyAudio(e,b,n,E));var R=[];y&&(R.push(y),o&&(this._rawVideoTimeOffset=y.startDTS-y.streamDTS)),E&&R.push(E),R.length&&this._eventEmitter.emit(c.a.PARSING_DATA,{segments:R,extra:this._transmuxData}),o&&(Math.abs(this._rawVideoTimeOffset)>.001&&o.forEach((function(e){var i=e.pts-e.dts,n=e.streamDTS+m._rawVideoTimeOffset*t.inputTimescale;n>=0?(e.dts=n,e.pts=i+e.dts):(e.dts=0,e.pts=Math.max(0,i+n))})),this._eventEmitter.emit(c.a.RAW_DATA,{type:u.c.videoFrame,samples:o,extra:this._transmuxData}))}},t._getRawVideoInfo=function(e){if(e.codec)return{container:"video/mp4",codec:e.codec,codecType:e.codecType||d.b.unknown,metadata:{width:e.width,height:e.height,rotation:e.rotation,fps:e.fps,profile:e.profile,level:e.level,chromaFormat:e.chromaFormat,bitDepth:e.bitDepth,colorInfo:e.colorInfo,videoBitrate:e.bitrate,videoMaxBitrate:e.maxBitrate}}},t._generateIS=function(e,t,i,n,r){var a,s,_=this._eventEmitter,u=e.samples,l=t.samples,f=this._typeSupported,p={},m={tracks:p,base:{}},v=void 0===this._initPTS,g="audio/mp4";if(r&&(m.base.isFillVideo=!0),v&&(a=s=1/0),e.config&&u.length&&(e.timescale=e.samplerate,h.b.v(W,"audio sampling rate : "+e.samplerate),e.codecType===d.b.mp3?f.mpeg?(g="audio/mpeg",e.codec=""):f.mp3&&(e.codec="mp3"):e.codecType===d.b.opus&&(e.codec="opus"),this._initSegment.audio=e.codecType===d.b.mp3&&f.mpeg?new Uint8Array:j.moov([e],this._pssh),p.audio={container:g,codec:e.codec,codecType:e.codecType||d.b.unknown,metadata:{channel:e.channelCount,audioSampleRate:e.samplerate,audioBitrate:e.bitrate,audioMaxBitrate:e.maxBitrate}},v&&(a=s=u[0].pts-e.inputTimescale*i)),t.codec&&l.length){var y=t.inputTimescale;t.timescale=y,t.duration<=0&&(h.b.i(W,"videoTrack.duration === 0"),t.duration=1),t.outputRaw||(this._initSegment.video=j.moov([t],this._pssh)),p.video={container:"video/mp4",codec:t.codec,codecType:t.codecType||d.b.unknown,metadata:{width:t.width,height:t.height,rotation:t.rotation,fps:t.fps,profile:t.profile,level:t.level,chromaFormat:t.chromaFormat,bitDepth:t.bitDepth,colorInfo:t.colorInfo,videoBitrate:t.bitrate,videoMaxBitrate:t.maxBitrate}},v&&(a=Math.min("number"==typeof a?a:1/0,l[0].pts-y*i),s=Math.min("number"==typeof s?s:1/0,l[0].dts-y*i),_.emit(c.a.INIT_PTS_FOUND,{initPTS:a,timescale:y}))}n&&(p.rawVideo=n),Object.keys(p).length?(_.emit(c.a.PARSING_INIT_SEGMENT,m),this._ISGenerated=!0,v&&(this._initPTS=a,this._initDTS=s,h.b.i(W,"init pts:"+a+" dts:"+s))):this._onError({type:o.b.MUX_ERROR,details:o.a.PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},t._remuxVideo=function(e,t,i,n,r){if(void 0===n&&(n=!1),void 0===r&&(r=!1),e.samples.length){var a,s,o=e.timescale,c=e.samples,_=[],u=this._initPTS,l=this._videoTime,f=[],p=0,m=0,v=0,g=c.length;if(void 0!==u){var y=this._nextAvcDts,E=this._isSafari;if(0!==g&&0!==e.timescale&&(E&&(i=i||!!(c.length&&y&&(n&&Math.abs(t-y/o)<.1||Math.abs(c[0].pts-y-u)<o/5))),i||(y=t*o,this._resetVideoTime()),void 0!==y)){c.forEach((function(e){e.pts=G(e.pts-u,y),e.dts=G(e.dts-u,y)})),c.sort((function(e,t){var i=e.dts-t.dts,n=e.pts-t.pts;return i||n}));var b=c.reduce((function(e,t){return Math.max(Math.min(e,t.pts-t.dts),-18e3)}),0);if(b<0){h.b.i(W,"PTS < DTS detected in video samples, shifting DTS by "+Math.round(b/90)+" ms to overcome this issue");for(var A=0;A<c.length;A++)c[A].dts+=b}var T=this._videoTimeReferenceInfo;T.sample&&(g++,c.unshift(T.sample),T.sample=void 0),!this._config.gopRemux&&i&&c.length>1&&!r&&(T.timeOffset=t,T.accurateTimeOffset=n,T.track=e,T.sample=c.pop(),g--);var S=c[0];v=Math.max(S.dts,0),m=Math.max(S.pts,0);var R=Math.round((v-y)/90);i&&R&&(R>1?h.b.v(W,"AVC:"+R+" ms hole between fragments detected,filling it"):R<-1&&h.b.v(W,"AVC:"+-R+" ms overlapping between fragments detected"),m=Math.max(m-(v-y),y),v=y,c[0].dts=v,c[0].pts=m,h.b.v(W,"Video/PTS/DTS adjusted: "+Math.round(m/90)+"/"+Math.round(v/90)+",delta:"+R+" ms")),S=c[c.length-1],s=Math.max(S.dts,0),a=Math.max(S.pts,0,s),E&&(p=Math.round((s-v)/(c.length-1)));for(var x=0;x<g;x++){var L=c[x];L.dts=E?v+x*p:Math.max(L.dts,v),L.pts=Math.max(L.pts,L.dts)}for(var C=function(t){var n,r=c[t],a=void 0;if(E)a=Math.max(0,p*(r.pts-r.dts)/p);else{if(t<g-1)p=c[t+1].dts-r.dts;else{var s=0;s=T.sample?T.sample.dts-r.dts:p||l.sampleDuration||e.sampleDuration||r.dts-c[t>0?t-1:t].dts,s=90*Math.floor(s/90),p=s}a=r.pts-r.dts}if(p<0||isNaN(p)||!isFinite(p)){var d=0;i&&c.length<2&&(d=90*R),p=Math.max((e.sampleDuration||l.sampleDuration)-d,90);var u=c[t+1];if(u){var h=u.pts-u.dts;u.dts=r.dts+p,u.pts=u.dts+h}}var m=0===e.codec.indexOf("av01")?0:4;n=r.units.reduce((function(e,t){return t.data.byteLength+m+e}),0),_.push({len:n,units:r.units,duration:p,cts:a,streamDTS:r.streamDTS,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:r.key?2:1,isNonSync:r.key?0:1},auxiliaryInfo:r.auxiliaryInfo}),r.extra&&(r.extra.ptsMs=S.pts/o*1e3,f.push(r.extra))},D=0;D<g;D++)C(D);if(this._nextAvcDts=s+p,_.length&&this._forceFirstIDR){var I=_[0].flags;I.dependsOn=2,I.isNonSync=0}e.mp4Samples=_;var w={payload:j.videoMediaSegment(e.sequenceNumber++,v,e,this._getMoovByType(d.l.VIDEO)),startPTS:m/o,endPTS:(a+p)/o,startDTS:v/o,endDTS:this._nextAvcDts/o,type:d.l.VIDEO,streamDTS:_[0].streamDTS/o,samplesExtra:f,fillDuration:e.fillDuration/o};return this._videoTime.vLastPTS=w.endPTS,e.fillDuration=0,0===l.nbSamples&&(l.firstDTS=v),l.nbSamples+=g,l.sampleDuration=Math.round((this._nextAvcDts-l.firstDTS)/l.nbSamples),this._videoTrack&&(this._videoTrack.samples=[],this._videoTrack.mp4Samples=[]),w}}}},t._remuxAudio=function(e,t,i,n){if(void 0===n&&(n=!1),e.samples.length){var r,a,s,o=e.inputTimescale,c=e.timescale,_=o/c,u=e.codecType===d.b.aac?1024:1152,l=u*_,p=this._initPTS,m=[],v=[],g=e.codecType===d.b.mp3&&this._typeSupported.mpeg,y=0,E=e.samples,b=this._nextAudioPts,A=!1;if(void 0!==p&&(i=i||!!(E.length&&b&&(n&&Math.abs(t-b/o)<.1||Math.abs(E[0].pts-b-p)<20*l)),E.forEach((function(e){e.pts=e.dts=G(e.pts-p,t*o)})),0!==(E=E.filter((function(e){return e.pts>=0}))).length&&(i&&void 0!==b||(b=n?t*o:E[0].pts,A=!0),void 0!==b))){if(e.codecType===d.b.aac)for(var T=this._config.maxAudioFramesDrift,S=0,R=b;S<E.length;){var x=E[S],L=x.pts-R;if(L<=-T*l)E.splice(S,1);else if(L>=T*l&&L<100*o&&R){var C=Math.round(L/l);h.b.i(W,"Injecting "+C+" audio frame @ "+(R/o).toFixed(3)+"s due to "+Math.round(1e3*L/o)+" ms gap.");for(var D=0;D<C;D++){var I=Math.max(R,0);(a=f.a.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(h.b.v(W,"Unable to get silent frame for given audio codec; duplicating last frame instead."),a=x.unit.subarray()),E.splice(S,0,{unit:a,pts:I,dts:I,streamDTS:x.streamDTS-(C-D)*l}),R+=l,S++}x.pts=x.dts=R,R+=x.duration||l,S++}else x.pts=x.dts=R,R+=x.duration||l,S++}for(var w=E.length,k=0,O=E.length;k<O;k++){var N=E[k],P=N.unit,M=N.duration?Math.round(N.duration/_):u,V=N.pts;if(void 0!==s&&r)r.duration=Math.round((V-s)/_);else{var F=Math.round(V-b),U=0;if(i&&e.codecType===d.b.aac&&F){if(F>0&&F<100*o)U=Math.round((V-b)/l),h.b.v(W,F+" ms hole between AAC samples detected,filling it");else if(F<-.012*o){h.b.v(W,"drop overlapping AAC sample, expected/parsed/delta:"+(b/o).toFixed(3)+"s/"+(V/o).toFixed(3)+"s/"+-F/o*1e3+"ms");continue}V=b}y=V;for(var B=0;B<U;B++){var H=u;(a=f.a.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(h.b.v(W,"Unable to get silent frame for given audio codec; duplicating this frame instead."),a=P.subarray(),N.duration&&(H=M)),r={len:a.byteLength,cts:0,duration:H,unit:a,streamDTS:Math.round(N.streamDTS-(U-B)*H),flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1,isNonSync:0},auxiliaryInfo:N.auxiliaryInfo},m.push(r)}}r={len:P.byteLength,cts:0,duration:M,unit:P,streamDTS:N.streamDTS,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1,isNonSync:0}},m.push(r),N.extra&&(N.extra.ptsMs=V/o*1e3,v.push(N.extra)),s=V}if(w=m.length,r){if(w&&"number"==typeof s){var z;r&&0===r.duration&&(r.duration=u),this._nextAudioPts=b=s+_*r.duration,e.mp4Samples=m,z=g?j.audioRawMpeg(e):j.audioMediaSegment(e.sequenceNumber++,y/_,e,this._getMoovByType(d.l.AUDIO)),e.samples=[],e.mp4Samples=[];var K=y/o,Y=b/o,X={payload:z,startPTS:K,endPTS:Y,startDTS:K,endDTS:Y,type:d.l.AUDIO,streamDTS:m[0].streamDTS/o,samplesExtra:v,fillDuration:e.fillDuration/o};return g&&(X.updateTimestampOffset=!0),this._videoTime.aLastPTS=X.endPTS,e.fillDuration=0,X}A&&delete this._nextAudioPts,e.samples=[],e.mp4Samples=[]}}}},t._remuxEmptyAudio=function(e,t,i,n){if(void 0!==this._initDTS){var r=e.inputTimescale,a=r/(e.samplerate?e.samplerate:r),s=this._nextAudioPts,o=(void 0!==s?s:n.startDTS*r)+this._initDTS,c=n.endDTS*r+this._initDTS,_=1024*a,d=Math.ceil((c-o)/_),u=f.a.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(!(d<=0)){if(h.b.i(W,"remux empty Audio",d),u){for(var l=[],p=0;p<d;p++){var m=o+p*_;l.push({unit:u,pts:m,dts:m,streamDTS:n.streamDTS*r+p*_})}return e.samples=l,this._remuxAudio(e,t,i)}h.b.d(W,"Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")}}},t._resetVideoTime=function(){this._videoTime?(this._videoTime.nbSamples=0,this._videoTime.firstDTS=0,this._videoTime.sampleDuration=3e3):this._videoTime={nbSamples:0,firstDTS:0,sampleDuration:3e3,vLastPTS:0,aLastPTS:0}},t._getMoovByType=function(e){var t;return this._initSegment&&this._initSegment[e]&&(t=this._initSegment[e],delete this._initSegment[e]),t},t._fillVideoByAudio=function(e,t){this._videoTimeReferenceInfo.sample&&this.flush();var i=r()({},e);i.samples=[],i.codecType=d.b.h264;var n=y.getFillTrackBySamples(i,t.samples);return n&&(this._ISGenerated=i.codec===this._lastVideoCodec),n},s()(e,[{key:"ISGenerated",get:function(){return this._ISGenerated}}]),e}();function G(e,t){var i;if(void 0===t)return e;for(i=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=i;return e}t.b=z},function(e,t,i){var n,r;i.d(t,"a",(function(){return n})),(r=n||(n={})).INIT="init",r.FLUSH="flush",r.LOAD_END="loadEnd",r.DESTROY="destroy",r.PUSH="push"},function(e,t,i){var n,r,a,s,o;n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,a=/(?:\/|^)\.(?=\/)/g,s=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(e,t,i){if(i=i||{},e=e.trim(),!(t=t.trim())){if(!i.alwaysNormalize)return e;var n=o.parseURL(e);if(!n)throw new Error("Error trying to parse base URL.");return n.path=o.normalizePath(n.path),o.buildURLFromParts(n)}var a=o.parseURL(t);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return i.alwaysNormalize?(a.path=o.normalizePath(a.path),o.buildURLFromParts(a)):t;var s=o.parseURL(e);if(!s)throw new Error("Error trying to parse base URL.");if(!s.netLoc&&s.path&&"/"!==s.path[0]){var c=r.exec(s.path);s.netLoc=c[1],s.path=c[2]}s.netLoc&&!s.path&&(s.path="/");var _={scheme:s.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(_.netLoc=s.netLoc,"/"!==a.path[0]))if(a.path){var d=s.path,u=d.substring(0,d.lastIndexOf("/")+1)+a.path;_.path=o.normalizePath(u)}else _.path=s.path,a.params||(_.params=s.params,a.query||(_.query=s.query));return null===_.path&&(_.path=i.alwaysNormalize?o.normalizePath(a.path):a.path),o.buildURLFromParts(_)},parseURL:function(e){var t=n.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(a,"");e.length!==(e=e.replace(s,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},e.exports=o},function(e,t,i){var n=i(18),r=i(24),a=function(){function e(){this._lastEndTime=-1}var t=e.prototype;return t.reset=function(){this._lastEndTime=-1},t.update=function(e,t){if(t.samples.length){var i=t.samples.reduce((function(e,i,n){return t.samples[e].pts>i.pts?e:n}),0),a=t.samples[0].dts,s=t.samples[0].streamDTS,o=t.samples[i],c=o.pts+(o.duration||0),_=n.b(e.samplerate),d=c;e.samples.length&&(d=Math.min(e.samples[0].dts,c)),-1===this._lastEndTime?this._lastEndTime=a:(s=this._lastEndTime-a+s,a=this._lastEndTime);var u=Math.max(0,Math.ceil((d-a)/_));u>0&&(this._lastEndTime=r.a.fillAACFrameByCount(e,a,u,s))}},e}();t.a=a},function(e,t,i){function n(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=t,i.i=function(e){return e},i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/",i.oe=function(e){throw console.error(e),e};var n=i(i.s=ENTRY_MODULE);return n.default||n}function r(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function a(e,t,n){var a={};a[n]=[];var s=t.toString(),o=s.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!o)return a;for(var c,_=o[1],d=new RegExp("(\\\\n|\\W)"+r(_)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");c=d.exec(s);)"dll-reference"!==c[3]&&a[n].push(c[3]);for(d=new RegExp("\\("+r(_)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");c=d.exec(s);)e[c[2]]||(a[n].push(c[1]),e[c[2]]=i(c[1]).m),a[c[2]]=a[c[2]]||[],a[c[2]].push(c[4]);for(var u,l=Object.keys(a),h=0;h<l.length;h++)for(var f=0;f<a[l[h]].length;f++)u=a[l[h]][f],isNaN(1*u)||(a[l[h]][f]=1*a[l[h]][f]);return a}function s(e){return Object.keys(e).reduce((function(t,i){return t||e[i].length>0}),!1)}e.exports=function(e,t){t=t||{};var r={main:i.m},o=t.all?{main:Object.keys(r.main)}:function(e,t){for(var i={main:[t]},n={main:[]},r={main:{}};s(i);)for(var o=Object.keys(i),c=0;c<o.length;c++){var _=o[c],d=i[_].pop();if(r[_]=r[_]||{},!r[_][d]&&e[_][d]){r[_][d]=!0,n[_]=n[_]||[],n[_].push(d);for(var u=a(e,e[_][d],_),l=Object.keys(u),h=0;h<l.length;h++)i[l[h]]=i[l[h]]||[],i[l[h]]=i[l[h]].concat(u[l[h]])}}return n}(r,e),c="";Object.keys(o).filter((function(e){return"main"!==e})).forEach((function(e){for(var t=0;o[e][t];)t++;o[e].push(t),r[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",c=c+"var "+e+" = ("+n.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+o[e].map((function(t){return JSON.stringify(t)+": "+r[e][t].toString()})).join(",")+"});\n"})),c=c+"new (("+n.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+o.main.map((function(e){return JSON.stringify(e)+": "+r.main[e].toString()})).join(",")+"}))(self);";var _=new window.Blob([c],{type:"text/javascript"});if(t.bare)return _;var d=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(_),u=new window.Worker(d);return u.objectURL=d,u}},function(e,t){e.exports=function(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e},e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,i){function n(e,t){var i=[];return e.samples.forEach((function(t){var n=e.inputTimescale;i.push({index:0,dts:t.dts/n,pts:t.pts/n,duration:(t.duration||0)/n})})),i.sort((function(e,t){return e.pts-t.pts})),i.forEach((function(e,i){e.index=t+i})),i}i.d(t,"a",(function(){return n}))},function(e,t,i){var n=i(5),r=i.n(n),a=i(12),s=i.n(a),o=i(1),c=i(21),_=i(2),d=i(22),u=i(36),l="canvas-output-vpp",h=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this)._vppList=[],t._originSizeCanvas=void 0,t._originSizeGL=null,t._video=void 0,t._webGLFrameSink=void 0,t._inputRendererType=o.o.video,t._draw=function(){t._vppList.forEach((function(e){return e.vpp.draw()}))},t}s()(t,e);var i=t.prototype;return i.reset=function(){e.prototype.reset.call(this),this._destroyOriginSizeCanvas(),this._webGLFrameSink=void 0,this._inputRendererType=o.o.video},i.updateFormatSize=function(e,t,i){var n=!1,r=i%180==90||i%180==-90,a=r?t:e,s=r?e:t;return a===this._fSize.w&&s===this._fSize.h||(n=!0,this._fSize.w=a,this._fSize.h=s,this._calculateUpperSize(),this._originSizeCanvas&&(_.b.i(l,"updateFormatSize. w:"+e+" h:"+t+" rotation:"+i),this._originSizeCanvas.width=e,this._originSizeCanvas.height=t,this._originSizeGL&&(this._originSizeGL.canvas.width=e,this._originSizeGL.canvas.height=t)),this._calculateDisplaySize()),n},i.setVideo=function(e){_.b.i(l,"setVideo",e),this._video=e,this._applayVPP()},i.setWebGLFrameSink=function(e){_.b.i(l,"setWebGLFrameSink"),this._webGLFrameSink=e,this._applayVPP(),e.afterDraw(this._draw)},i.updateRendererType=function(e){_.b.i(l,"updateRendererType: "+e);var t=this.rendererType;return e!==o.o.canvas&&!this.hasVPP||this._canvas||this._createOutputCanvas(),this._inputRendererType=e,this._applayVPP(),t!==this.rendererType},i.bindVPP=function(e){_.b.i(l,"bind vpp");for(var t=this.rendererType,i=0;i<this._vppList.length;i++)if(this._vppList[i].vpp===e)return _.b.i(l,"vpp has been bound."),!1;return this._vppList.push({vpp:e,originSize:e.originalSizeInput}),this._canvas||this._createOutputCanvas(),this._applayVPP(),t!==this.rendererType},i.unbindVPP=function(e){_.b.i(l,"unbind vpp");var t=this.rendererType;if(!this.hasVPP)return!1;if(e){for(var i=0;i<this._vppList.length;i++)if(e===this._vppList[i].vpp){var n=this._vppList.splice(i,1);n.length&&(n[0].vpp.detachSource(),n[0].vpp.detachOutputCanvas());break}}else this._vppList.forEach((function(e){e.vpp.detachSource(),e.vpp.detachOutputCanvas()})),this._vppList.splice(0);return this.hasVPP?this._applayVPP():(_.b.i(l,"unbind all vpp"),this._inputRendererType===o.o.video&&this._canvas&&this._destroyCanvas(),this._inputRendererType===o.o.canvas&&this._webGLFrameSink&&(this.webgl&&this._webGLFrameSink.setWebGLCtx(this.webgl,c.b.normal),this._webGLFrameSink.drawToCanvas(),this._webGLFrameSink.reDraw())),t!==this.rendererType},i.destroy=function(){e.prototype.destroy.call(this),this._destroyOriginSizeCanvas()},i._calculateUpperSize=function(){e.prototype._calculateUpperSize.call(this),this._draw()},i._applayVPP=function(){var e=this;if(this._canvas&&this.hasVPP){var t,i=this.webgl;if(this._inputRendererType===o.o.canvas){if(!this._webGLFrameSink)return;t=this._canvas}else this._inputRendererType===o.o.video&&(t=this._video);if(t&&i){if(this._inputRendererType===o.o.canvas)if(this._vppList[0].originSize){var n,r;this._originSizeGL||this._createOriginSizeCanvas(),this._originSizeGL&&(_.b.i(l,"webgl set origin size",this._originSizeGL),null==(n=this._webGLFrameSink)||n.setWebGLCtx(this._originSizeGL,c.b.fill),null==(r=this._webGLFrameSink)||r.drawToCanvas()),t=this._originSizeCanvas}else{var a,s;null==(a=this._webGLFrameSink)||a.setWebGLCtx(i,c.b.normal),null==(s=this._webGLFrameSink)||s.drawToFBO()}_.b.i(l,"apply vpp",t,i,JSON.stringify(this._fSize)),this._vppList.forEach((function(n,r){t&&(n.vpp.attachOutputCanvas(i),n.vpp.attachSource(t),r<e._vppList.length-1&&(t=n.vpp.drawToFBO())),n.vpp.draw()}))}}},i._createOriginSizeCanvas=function(){this._originSizeCanvas=this._createCanvas(this._fSize),!this._originSizeGL&&this._originSizeCanvas&&(this._originSizeGL=Object(d.b)(this._originSizeCanvas))},i._destroyOriginSizeCanvas=function(){if(_.b.i(l,"destroy origin size canvas"),this._originSizeGL){_.b.i(l,"origin size lose ctx");var e=this._originSizeGL.getExtension("WEBGL_lose_context");e&&e.loseContext(),this._originSizeGL=null}this._originSizeCanvas&&(this._originSizeCanvas=void 0)},r()(t,[{key:"rendererType",get:function(){return this._inputRendererType===o.o.video?this.hasVPP?o.o.canvas:o.o.video:o.o.canvas}},{key:"output",get:function(){return this.rendererType===o.o.video?this._video:this._canvas}},{key:"hasVPP",get:function(){return this._vppList.length>0}}]),t}(u.a);t.a=h},function(e,t,i){t.a={search:function(e,t){for(var i=0,n=e.length-1,r=null,a=null;i<=n;){var s=t(a=e[r=(i+n)/2|0]);if(s>0)i=r+1;else{if(!(s<0))return a;n=r-1}}return null},searchIndex:function(e,t){for(var i=0,n=e.length-1,r=null;i<=n;){var a=t(e[r=(i+n)/2|0]);if(a>0)i=r+1;else{if(!(a<0))return r;n=r-1}}return-1}}},function(e,t,i){var n=function(){function e(){}return e.getSilentFrame=function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},e}();t.a=n},function(e,t,i){function n(e){for(var t=[],i=0,n=e.byteLength;i<n;){if(e[i]<128)t.push(e[i]);else if(e[i]<192);else if(e[i]<224){if(i<n-1&&e[i+1]>>6==2){t.push((31&e[i])<<6|63&e[i+1]),i+=2;continue}}else if(e[i]<240){if(i<n-2&&e[i+1]>>6==2&&e[i+2]>>6==2){t.push((15&e[i])<<12|(63&e[i+1])<<6|63&e[i+2]),i+=3;continue}}else if(e[i]<248&&i<n-3&&e[i+1]>>6==2&&e[i+2]>>6==2&&e[i+3]>>6==2){t.push((7&e[i])<<18|(63&e[i+1])<<12|(63&e[i+2])<<6|63&e[i+3]),i+=4;continue}i++}return(String.fromCodePoint||r).apply(null,t)}function r(){for(var e=[],t=0,i="",n=0,r=arguments.length;n!==r;++n){var a=+arguments[n];if(!(a<1114111&&a>>>0===a))throw RangeError("Invalid code point: "+a);a<=65535?t=e.push(a):(a-=65536,t=e.push(55296+(a>>10),a%1024+56320)),t>=16383&&(i+=String.fromCharCode.apply(null,e),e.length=0)}return i+String.fromCharCode.apply(null,e)}i.d(t,"a",(function(){return n}))},function(e,t,i){var n=i(5),r=i.n(n),a=i(2),s=i(22),o="canvas-output",c=function(){function e(e){this._canvas=void 0,this._gl=null,this._cSize={w:0,h:0},this._fSize={w:0,h:0},this._dSize={w:0,h:0},a.b.i(o,"constructor"),this._canvas=e}var t=e.prototype;return t.reset=function(){a.b.i(o,"reset"),this._destroyCanvas()},t.updateCanvasSize=function(e,t){var i=!1;return e===this._cSize.w&&t===this._cSize.h||(i=!0,this._cSize.w=e,this._cSize.h=t,this._calculateUpperSize()),this._calculateDisplaySize(),i},t.updateFormatSize=function(e,t,i){var n=!1,r=i%180==90||i%180==-90,a=r?t:e,s=r?e:t;return a===this._fSize.w&&s===this._fSize.h||(n=!0,this._fSize.w=a,this._fSize.h=s,this._calculateUpperSize(),this._calculateDisplaySize()),n},t.destroy=function(){a.b.i(o,"destroy"),this._destroyCanvas()},t._calculateUpperSize=function(){if(this._canvas&&this._cSize.h){var e=this._cSize,t=e.w,i=e.h,n=this._fSize,r=n.w,s=n.h;if(s){var c=t/i;c>r/s?i>s&&(t=(i=s)*c):t>r&&(i=(t=r)/c)}this._canvas.width=t,this._canvas.height=i,a.b.i(o,"update canvas size",t,i)}},t._calculateDisplaySize=function(){var e,t,i=(null==(e=this._canvas)?void 0:e.width)||this._cSize.w,n=(null==(t=this._canvas)?void 0:t.height)||this._cSize.h,r=this._fSize,a=r.w/r.h;a>i/n?(this._dSize.w=i,this._dSize.h=Math.round(i/a)):(this._dSize.w=Math.round(n*a),this._dSize.h=n)},t._createCanvas=function(e){a.b.i(o,"create canvas");var t=document.createElement("canvas");return e.w?(t.width=e.w,t.height=e.h):(e.w=t.width,e.h=t.height),t},t._createOutputCanvas=function(){this._canvas||(this._canvas=this._createCanvas(this._cSize))},t._destroyCanvas=function(){if(a.b.i(o,"destroy canvas"),this._gl){var e=this._gl.getExtension("WEBGL_lose_context");e&&e.loseContext()}this._gl=null,this._canvas&&("undefined"!=typeof HTMLCanvasElement&&this._canvas instanceof HTMLCanvasElement&&this._canvas.remove(),this._canvas=void 0)},r()(e,[{key:"canvas",get:function(){return this._canvas}},{key:"webgl",get:function(){return!this._gl&&this._canvas&&(this._gl=Object(s.b)(this._canvas)),this._gl}},{key:"canvasSize",get:function(){return this._cSize}},{key:"formatSize",get:function(){return this._fSize}},{key:"displaySize",get:function(){return this._dSize}}]),e}();t.a=c},function(e,t,i){var n=i(0),r=function(){function e(e){this._module=void 0,this._libde265=void 0,this._waitingData=!1,this._eventEmitter=void 0,this._ctx=void 0,this._more=void 0,this._stridePtr=void 0,this._chromaStridePtr=void 0,this._threads=0,this._eventEmitter=e}var t=e.prototype;return t.init=function(e,t,i){var n=this;this._threads=i;var r=e.js.data,a=e.jsw?e.jsw.data:"",s=new Function(r+" return KwaiDec265;")(),o=a?new Blob([r],{type:"text/javascript"}):"",c=new Blob([a],{type:"text/javascript"});return s({wasmBinary:e.wasm.data,mainScriptUrlOrBlob:o,locateFile:function(e){return-1!==e.indexOf(".worker.js")?URL.createObjectURL(c):""}}).then((function(e){n._module=e,n._stridePtr=n._module._malloc(4),n._chromaStridePtr=n._module._malloc(4),n._cwrapLibde265Fun(),n._initDecoder()}))},t.flush=function(){return this._libde265.de265_flush_data(this._ctx)},t.free=function(){this._libde265.de265_free_decoder(this._ctx),this._ctx=void 0,this._module._free(this._more),this._more=void 0},t.rebuild=function(){this._waitingData=!1,this._libde265.de265_free_decoder(this._ctx),this._module.setValue(this._more,0,"i16"),this._newDecoder()},t.reset=function(){this._libde265.de265_reset(this._ctx),this._waitingData=!1},t.pushData=function(e,t){var i=this._libde265.de265_push_data(this._ctx,e,e.length,t||0,0);this._libde265.de265_isOK(i)&&this._waitingData&&this._decode()},t.pushNalus=function(e,t){var i=this;e.forEach((function(e){i._libde265.de265_push_NAL(i._ctx,e.data,e.data.length,t||0,0),i._libde265.de265_push_end_of_NAL(i._ctx)})),this._waitingData&&this._decode()},t.getPendingNALNumber=function(){return this._libde265.de265_get_number_of_NAL_units_pending(this._ctx)},t.endOfFrame=function(){this._libde265.de265_push_end_of_frame(this._ctx)},t.nextFrame=function(){this._waitingData||this._decode()},t.isWaitingData=function(){return this._waitingData},t._decode=function(){if(this._module){this._module.setValue(this._more,1,"i16");for(var e=0;0!==this._module.getValue(this._more,"i16");){var t=performance.now();if(e=this._libde265.de265_decode(this._ctx,this._more),!this._libde265.de265_isOK(e)){this._module.setValue(this._module,0,"i16");break}this._waitingData=!1;var i=this._libde265.de265_get_next_picture(this._ctx);if(i){this._eventEmitter.emit(n.a.DECODER_FRAME,{frame:this._getImage(i),startTime:t});break}}if(e===this._libde265.DE265_ERROR_WAITING_FOR_INPUT_DATA)this._waitingData=!0}},t._initDecoder=function(){this._more=this._module._malloc(2),this._newDecoder(),this._decode()},t._newDecoder=function(){this._ctx=this._libde265.de265_new_decoder(),this._threads>1&&this._libde265.de265_start_worker_threads(this._ctx,this._threads),this._disableFilters(!0)},t._disableFilters=function(e){this._libde265.de265_set_parameter_bool(this._ctx,this._libde265.DE265_DECODER_PARAM_DISABLE_DEBLOCKING,e),this._libde265.de265_set_parameter_bool(this._ctx,this._libde265.DE265_DECODER_PARAM_DISABLE_SAO,e)},t._getImage=function(e){var t=this._libde265.de265_get_image_width(e,0),i=this._libde265.de265_get_image_height(e,0),n=this._libde265.de265_get_image_width(e,1),r=this._libde265.de265_get_image_height(e,1),a=this._libde265.de265_get_chroma_format(e),s=this._libde265.de265_get_bits_per_pixel(e,0),o=this._libde265.de265_get_bits_per_pixel(e,1),c=this._libde265.de265_get_image_plane(e,0,this._stridePtr),_=this._libde265.de265_get_image_plane(e,1,this._chromaStridePtr),d=this._libde265.de265_get_image_plane(e,2),u=this._module.getValue(this._stridePtr,"i32"),l=this._module.getValue(this._chromaStridePtr,"i32"),h=this._module.HEAPU8.subarray(c,c+u*i),f=this._module.HEAPU8.subarray(_,_+l*r),p=this._module.HEAPU8.subarray(d,d+l*r);return{format:{width:t,height:i,chroma:a,chromaWidth:n,chromaHeight:r,cropLeft:0,cropTop:0,cropWidth:t,cropHeight:i,displayWidth:0,displayHeight:0,pts:this._libde265.de265_get_image_PTS(e,0)},y:{bytes:h,stride:u,bits:s},u:{bytes:f,stride:l,bits:o},v:{bytes:p,stride:l,bits:o}}},t._cwrapLibde265Fun=function(){this._libde265={DE265_OK:0,DE265_ERROR_NO_SUCH_FILE:1,DE265_ERROR_EOF:3,DE265_ERROR_COEFFICIENT_OUT_OF_IMAGE_BOUNDS:4,DE265_ERROR_CHECKSUM_MISMATCH:5,DE265_ERROR_CTB_OUTSIDE_IMAGE_AREA:6,DE265_ERROR_OUT_OF_MEMORY:7,DE265_ERROR_CODED_PARAMETER_OUT_OF_RANGE:8,DE265_ERROR_IMAGE_BUFFER_FULL:9,DE265_ERROR_CANNOT_START_THREADPOOL:10,DE265_ERROR_LIBRARY_INITIALIZATION_FAILED:11,DE265_ERROR_LIBRARY_NOT_INITIALIZED:12,DE265_ERROR_WAITING_FOR_INPUT_DATA:13,DE265_ERROR_CANNOT_PROCESS_SEI:14,DE265_ERROR_PARAMETER_PARSING:15,DE265_ERROR_NO_INITIAL_SLICE_HEADER:16,DE265_ERROR_PREMATURE_END_OF_SLICE:17,DE265_ERROR_UNSPECIFIED_DECODING_ERROR:18,DE265_ERROR_MAX_THREAD_CONTEXTS_EXCEEDED:500,DE265_ERROR_MAX_NUMBER_OF_SLICES_EXCEEDED:501,DE265_ERROR_NOT_IMPLEMENTED_YET:502,DE265_WARNING_NO_WPP_CANNOT_USE_MULTITHREADING:1e3,DE265_WARNING_WARNING_BUFFER_FULL:1001,DE265_WARNING_PREMATURE_END_OF_SLICE_SEGMENT:1002,DE265_WARNING_INCORRECT_ENTRY_POINT_OFFSET:1003,DE265_WARNING_CTB_OUTSIDE_IMAGE_AREA:1004,DE265_WARNING_SPS_HEADER_INVALID:1005,DE265_WARNING_PPS_HEADER_INVALID:1006,DE265_WARNING_SLICEHEADER_INVALID:1007,DE265_WARNING_INCORRECT_MOTION_VECTOR_SCALING:1008,DE265_WARNING_NONEXISTING_PPS_REFERENCED:1009,DE265_WARNING_NONEXISTING_SPS_REFERENCED:1010,DE265_WARNING_BOTH_PREDFLAGS_ZERO:1011,DE265_WARNING_NONEXISTING_REFERENCE_PICTURE_ACCESSED:1012,DE265_WARNING_NUMMVP_NOT_EQUAL_TO_NUMMVQ:1013,DE265_WARNING_NUMBER_OF_SHORT_TERM_REF_PIC_SETS_OUT_OF_RANGE:1014,DE265_WARNING_SHORT_TERM_REF_PIC_SET_OUT_OF_RANGE:1015,DE265_WARNING_FAULTY_REFERENCE_PICTURE_LIST:1016,DE265_WARNING_EOSS_BIT_NOT_SET:1017,DE265_WARNING_MAX_NUM_REF_PICS_EXCEEDED:1018,DE265_WARNING_INVALID_CHROMA_FORMAT:1019,DE265_WARNING_SLICE_SEGMENT_ADDRESS_INVALID:1020,DE265_WARNING_DEPENDENT_SLICE_WITH_ADDRESS_ZERO:1021,DE265_WARNING_NUMBER_OF_THREADS_LIMITED_TO_MAXIMUM:1022,DE265_NON_EXISTING_LT_REFERENCE_CANDIDATE_IN_SLICE_HEADER:1023,DE265_WARNING_CANNOT_APPLY_SAO_OUT_OF_MEMORY:1024,DE265_WARNING_SPS_MISSING_CANNOT_DECODE_SEI:1025,DE265_WARNING_COLLOCATED_MOTION_VECTOR_OUTSIDE_IMAGE_AREA:1026,de265_start_worker_threads:this._module.cwrap("de265_start_worker_threads","number",["number","number"]),de265_get_version:this._module.cwrap("de265_get_version","string"),de265_get_version_number:this._module.cwrap("de265_get_version_number","number"),de265_get_error_text:this._module.cwrap("de265_get_error_text","string",["number"]),de265_isOK:this._module.cwrap("de265_isOK","number",["number"]),de265_set_verbosity:this._module.cwrap("de265_set_verbosity","number",["number"]),de265_chroma_mono:0,de265_chroma_420:1,de265_chroma_422:2,de265_chroma_444:3,de265_get_image_width:this._module.cwrap("de265_get_image_width","number",["number","number"]),de265_get_image_height:this._module.cwrap("de265_get_image_height","number",["number","number"]),de265_get_chroma_format:this._module.cwrap("de265_get_chroma_format","number",["number"]),de265_get_bits_per_pixel:this._module.cwrap("de265_get_bits_per_pixel","number",["number","number"]),de265_get_image_plane:this._module.cwrap("de265_get_image_plane","number",["number","number","number"]),de265_get_image_plane_user_data:this._module.cwrap("de265_get_image_plane_user_data","number",["number","number"]),de265_get_image_PTS:this._module.cwrap("de265_get_image_PTS","number",["number"]),de265_get_image_user_data:this._module.cwrap("de265_get_image_user_data","number",["number"]),de265_set_image_user_data:this._module.cwrap("de265_set_image_user_data","number",["number","number"]),de265_new_decoder:this._module.cwrap("de265_new_decoder","number"),de265_free_decoder:this._module.cwrap("de265_free_decoder","number",["number"]),de265_push_data:this._module.cwrap("de265_push_data","number",["number","array","number","number","number"]),de265_push_end_of_NAL:this._module.cwrap("de265_push_end_of_NAL","number",["number"]),de265_push_end_of_frame:this._module.cwrap("de265_push_end_of_frame","number",["number"]),de265_push_NAL:this._module.cwrap("de265_push_NAL","number",["number","array","number","number","number"]),de265_flush_data:this._module.cwrap("de265_flush_data","number",["number"]),de265_get_number_of_input_bytes_pending:this._module.cwrap("de265_get_number_of_input_bytes_pending","number",["number"]),de265_get_number_of_NAL_units_pending:this._module.cwrap("de265_get_number_of_NAL_units_pending","number",["number"]),de265_decode:this._module.cwrap("de265_decode","number",["number","number"]),de265_reset:this._module.cwrap("de265_reset","number",["number"]),de265_peek_next_picture:this._module.cwrap("de265_peek_next_picture","number",["number"]),de265_get_next_picture:this._module.cwrap("de265_get_next_picture","number",["number"]),de265_release_next_picture:this._module.cwrap("de265_release_next_picture","number",["number"]),de265_get_warning:this._module.cwrap("de265_get_warning","number",["number"]),de265_get_highest_TID:this._module.cwrap("de265_get_highest_TID","number",["number"]),de265_get_current_TID:this._module.cwrap("de265_get_current_TID","number",["number"]),de265_set_limit_TID:this._module.cwrap("de265_set_limit_TID","number",["number","number"]),de265_set_framerate_ratio:this._module.cwrap("de265_set_framerate_ratio","number",["number","number"]),de265_change_framerate:this._module.cwrap("de265_change_framerate","number",["number","number"]),DE265_DECODER_PARAM_BOOL_SEI_CHECK_HASH:0,DE265_DECODER_PARAM_DUMP_SPS_HEADERS:1,DE265_DECODER_PARAM_DUMP_VPS_HEADERS:2,DE265_DECODER_PARAM_DUMP_PPS_HEADERS:3,DE265_DECODER_PARAM_DUMP_SLICE_HEADERS:4,DE265_DECODER_PARAM_ACCELERATION_CODE:5,DE265_DECODER_PARAM_SUPPRESS_FAULTY_PICTURES:6,DE265_DECODER_PARAM_DISABLE_DEBLOCKING:7,DE265_DECODER_PARAM_DISABLE_SAO:8,de265_acceleration_SCALAR:0,de265_acceleration_MMX:10,de265_acceleration_SSE:20,de265_acceleration_SSE2:30,de265_acceleration_SSE4:40,de265_acceleration_AVX:50,de265_acceleration_AVX2:60,de265_acceleration_ARM:70,de265_acceleration_NEON:80,de265_acceleration_AUTO:1e4,de265_set_parameter_bool:this._module.cwrap("de265_set_parameter_bool","number",["number","number","number"]),de265_set_parameter_int:this._module.cwrap("de265_set_parameter_int","number",["number","number","number"]),module:this._module}},e}();t.a=r},function(e,t,i){var n=function(){function e(){}return e.getPosByTime=function(e,t){if(e){if(e[0]&&t<=e[0].time)return e[0];if(e[e.length-1]&&t>=e[e.length-1].time)return e[e.length-1];for(var i=0,n=e.length-1,r=0,a=0;i<=n;)if(t>(a=e[1+(r=(i+n)/2|0)]?e[r+1].time:Number.MAX_SAFE_INTEGER))i=r+1;else{if(!(t<e[r].time))return t===a?e[r+1]:e[r];n=r-1}return e[0]}},e}();t.a=n},function(e,t,i){var n=i(3),r=i(0),a=i(2);function s(e,t,i){return Uint8Array.prototype.slice?e.slice(t,i):new Uint8Array(Array.prototype.slice.call(e,t,i))}var o=function(){function e(e,t){this._subtle=void 0,this._aesIV=void 0,this._subtle=e,this._aesIV=t}return e.prototype.decrypt=function(e,t){return this._subtle.decrypt({name:"AES-CBC",iv:this._aesIV},t,e)},e}(),c=function(){function e(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var t=e.prototype;return t.uint8ArrayToUint32Array_=function(e){for(var t=new DataView(e),i=new Uint32Array(4),n=0;n<4;n++)i[n]=t.getUint32(4*n);return i},t.initTable=function(){var e=this.sBox,t=this.invSBox,i=this.subMix,n=i[0],r=i[1],a=i[2],s=i[3],o=this.invSubMix,c=o[0],_=o[1],d=o[2],u=o[3],l=new Uint32Array(256),h=0,f=0,p=0;for(p=0;p<256;p++)l[p]=p<128?p<<1:p<<1^283;for(p=0;p<256;p++){var m=f^f<<1^f<<2^f<<3^f<<4;m=m>>>8^255&m^99,e[h]=m,t[m]=h;var v=l[h],g=l[v],y=l[g],E=257*l[m]^16843008*m;n[h]=E<<24|E>>>8,r[h]=E<<16|E>>>16,a[h]=E<<8|E>>>24,s[h]=E,E=16843009*y^65537*g^257*v^16843008*h,c[m]=E<<24|E>>>8,_[m]=E<<16|E>>>16,d[m]=E<<8|E>>>24,u[m]=E,h?(h=v^l[l[l[y^v]]],f^=l[l[f]]):h=f=1}},t.expandKey=function(e){for(var t=this.uint8ArrayToUint32Array_(e),i=!0,n=0;n<t.length&&i;)i=t[n]===this.key[n],n++;if(!i){this.key=t;var r=this.keySize=t.length;if(4!==r&&6!==r&&8!==r)throw new Error("Invalid aes key size="+r);var a,s,o=this.ksRows=4*(r+6+1),c=this.keySchedule=new Uint32Array(o),_=this.invKeySchedule=new Uint32Array(o),d=this.sBox,u=this.rcon,l=this.invSubMix,h=l[0],f=l[1],p=l[2],m=l[3],v=0,g=0;for(a=0;a<o;a++)a<r?v=c[a]=t[a]:(g=v,a%r==0?(g=d[(g=g<<8|g>>>24)>>>24]<<24|d[g>>>16&255]<<16|d[g>>>8&255]<<8|d[255&g],g^=u[a/r|0]<<24):r>6&&a%r==4&&(g=d[g>>>24]<<24|d[g>>>16&255]<<16|d[g>>>8&255]<<8|d[255&g]),c[a]=v=(c[a-r]^g)>>>0);for(s=0;s<o;s++)a=o-s,g=3&s?c[a]:c[a-4],_[s]=s<4||a<=4?g:h[d[g>>>24]]^f[d[g>>>16&255]]^p[d[g>>>8&255]]^m[d[255&g]],_[s]=_[s]>>>0}},t.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},t.decrypt=function(e,t,i){for(var n,r,a,s,o,c,_,d,u,l,h,f,p,m,v=this.keySize+6,g=this.invKeySchedule,y=this.invSBox,E=this.invSubMix,b=E[0],A=E[1],T=E[2],S=E[3],R=this.uint8ArrayToUint32Array_(i),x=R[0],L=R[1],C=R[2],D=R[3],I=new Int32Array(e),w=new Int32Array(I.length),k=this.networkToHostOrderSwap;t<I.length;){for(u=k(I[t]),l=k(I[t+1]),h=k(I[t+2]),f=k(I[t+3]),o=u^g[0],c=f^g[1],_=h^g[2],d=l^g[3],p=4,m=1;m<v;m++)n=b[o>>>24]^A[c>>16&255]^T[_>>8&255]^S[255&d]^g[p],r=b[c>>>24]^A[_>>16&255]^T[d>>8&255]^S[255&o]^g[p+1],a=b[_>>>24]^A[d>>16&255]^T[o>>8&255]^S[255&c]^g[p+2],s=b[d>>>24]^A[o>>16&255]^T[c>>8&255]^S[255&_]^g[p+3],o=n,c=r,_=a,d=s,p+=4;n=y[o>>>24]<<24^y[c>>16&255]<<16^y[_>>8&255]<<8^y[255&d]^g[p],r=y[c>>>24]<<24^y[_>>16&255]<<16^y[d>>8&255]<<8^y[255&o]^g[p+1],a=y[_>>>24]<<24^y[d>>16&255]<<16^y[o>>8&255]<<8^y[255&c]^g[p+2],s=y[d>>>24]<<24^y[o>>16&255]<<16^y[c>>8&255]<<8^y[255&_]^g[p+3],p+=3,w[t]=k(n^x),w[t+1]=k(s^L),w[t+2]=k(a^C),w[t+3]=k(r^D),x=u,L=l,C=h,D=f,t+=4}return w.buffer},e}(),_=function(){function e(e,t){this._subtle=void 0,this._key=void 0,this._subtle=e,this._key=t}return e.prototype.expandKey=function(){return this._subtle.importKey("raw",this._key,{name:"AES-CBC",length:128},!1,["encrypt","decrypt"])},e}(),d=function(){function e(e,t){var i=(void 0===t?{}:t).removePKCS7Padding,n=void 0===i||i;if(this._logEnabled=!0,this._config=void 0,this._removePKCS7Padding=void 0,this._subtle=null,this._softwareDecrypter=null,this._key=null,this._fastAesKey=null,this._remainderData=null,this._currentIV=null,this._currentResult=null,this._config=e,this._removePKCS7Padding=n,n)try{var r=self.crypto;r&&(this._subtle=r.subtle||r.webkitSubtle)}catch(e){}null===this._subtle&&(this._config.enableSoftwareAES=!0)}var t=e.prototype;return t.isSync=function(){return this._config.enableSoftwareAES},t.flush=function(){var e=this._currentResult;if(e){var t,i,n,r=new Uint8Array(e);return this.reset(),this._removePKCS7Padding?(n=(i=(t=r).byteLength)&&new DataView(t.buffer).getUint8(i-1))?s(t,0,i-n):t:r}this.reset()},t.reset=function(){this._currentResult=null,this._currentIV=null,this._remainderData=null,this._softwareDecrypter&&(this._softwareDecrypter=null)},t.decrypt=function(e,t,i,n){if(this._config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(e),t,i);var r=this.flush();r&&n(r.buffer)}else this.webCryptoDecrypt(new Uint8Array(e),t,i).then(n)},t.softwareDecrypt=function(e,t,i){var n,r,a,o=this._currentIV,_=this._currentResult,d=this._remainderData;this.logOnce("JS AES decrypt"),d&&(n=d,r=e,(a=new Uint8Array(n.length+r.length)).set(n),a.set(r,n.length),e=a,this._remainderData=null);var u=this.getValidChunk(e);if(!u.length)return null;o&&(i=o);var l=this._softwareDecrypter;l||(l=this._softwareDecrypter=new c),l.expandKey(t);var h=_;return this._currentResult=l.decrypt(u.buffer,0,i),this._currentIV=s(u,-16).buffer,h||null},t.webCryptoDecrypt=function(e,t,i){var n=this,r=this._subtle;return this._key===t&&this._fastAesKey||(this._key=t,this._fastAesKey=new _(r,t)),this._fastAesKey.expandKey().then((function(t){return r?new o(r,i).decrypt(e.buffer,t):Promise.reject(new Error("web crypto not initialized"))})).catch((function(r){return n.onWebCryptoError(r,e,t,i)}))},t.onWebCryptoError=function(e,t,i,n){return a.b.w("decrypter","[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",e),this._config.enableSoftwareAES=!0,this._logEnabled=!0,this.softwareDecrypt(t,i,n)},t.getValidChunk=function(e){var t=e,i=e.length-e.length%16;return i!==e.length&&(t=s(e,0,i),this._remainderData=s(e,i)),t},t.logOnce=function(e){this._logEnabled&&(a.b.i("decrypter","[decrypter.ts]: "+e),this._logEnabled=!1)},e}(),u=i(5),l=i.n(u),h=i(11),f=i(1),p=i(10),m=function(){function e(){}return e.parse=function(t,i){void 0===i&&(i=!0);var n={},r=new DataView(t.buffer,t.byteOffset).getUint32(0)!==(i?525030175:2113995134),a=6,s=new Uint8Array(1024);s.set(t.slice(0,6),0);for(var o=t.byteLength,c=[t[o-2],t[o-1]],_=6;_<o;){var d=t[_];0===c[0]&&0===c[1]&&3===d||(s[a++]=d),c[0]=c[1],c[1]=d,++_}for(var u=6,l=new DataView(s.buffer);u<a;){var h=u,f=l.getUint16(h,r);h+=2;var p=l.getUint16(h,r);h+=2;var m=l.getUint16(h,r);if(h+=2,e._readElem(l,n,h,m,f,p,r),h+=m,u+=p,!p)break}return n},e._readElem=function(t,i,n,r,a,s,o){var c=e._readString(t,n,r);switch(n+=r,a){case 1:break;case 2:i[c]=e._readString(t,n,s-4);break;case 3:i[c]=t.getUint32(n,o);break;case 4:var _=t.getUint32(n+4,o),d=t.getUint32(n,o);i[c]=Math.pow(2,32)*_+d;break;case 5:i[c]=t.getFloat32(n,o);break;case 6:i[c]=t.getFloat64(n,o)}},e._readString=function(e,t,i){for(var n="",r=t;r<t+i;r++)n+=String.fromCharCode(e.getUint8(r));return n},e}(),v=i(4),g=i(18),y=i(24),E=null,b=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],A=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],T=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],S=[0,1,1,4];function R(e,t,i,n,r){if(!(i+24>t.length)){var a=function(e,t){var i=e[t+1]>>3&3,n=e[t+1]>>1&3,r=e[t+2]>>4&15,a=e[t+2]>>2&3;if(1!==i&&0!==r&&15!==r&&3!==a){var s=e[t+2]>>1&1,o=e[t+3]>>6,c=1e3*b[14*(3===i?3-n:3===n?3:4)+r-1],_=A[3*(3===i?0:2===i?1:2)+a],d=3===o?1:2,u=T[i][n],l=S[n],h=8*u*l,f=Math.floor(u*c/_+s)*l;if(null===E){var p=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);E=p?parseInt(p[1]):0}return!!E&&E<=87&&2===n&&c>=224e3&&0===o&&(e[t+3]=128|e[t+3]),{sampleRate:_,channelCount:d,frameLength:f,samplesPerFrame:h}}}(t,i);if(a&&i+a.frameLength<=t.length){var s=n+r*(a.samplesPerFrame*h.d/a.sampleRate),o={unit:t.subarray(i,i+a.frameLength),pts:s,dts:s,streamDTS:0};return e.config=[],e.channelCount=a.channelCount,e.samplerate=a.sampleRate,e.samples.push(o),{sample:o,length:a.frameLength,missing:0}}}}function x(e,t){return t+1<e.length&&function(e,t){return 255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1])}(e,t)}var L,C,D=i(28),I=i(17),w=i(35),k=function(){function e(){}return e.parseMetadata=function(t){var i={};try{var n=e.parseScript(t,0),r=e.parseScript(t,n.size);i[n.data]=r.data}catch(e){a.b.e("AMF",e.toString())}return i},e.parseObject=function(t,i){var n=e.parseString(t,i),r=e.parseScript(t,i+n.size),a=r.objectEnd;return{data:{name:n.data,value:r.data},size:r.size,objectEnd:a}},e.parseVariable=function(t,i){return e.parseObject(t,i)},e.parseLongString=function(e,t){var i=new DataView(e,t).getUint32(0);return{data:i>0?Object(w.a)(new Uint8Array(e,t+4,i)):"",size:4+i}},e.parseDate=function(e,t){var i=new DataView(e,t),n=i.getFloat64(0),r=i.getInt16(8);return{data:new Date(n+=60*r*1e3),size:10}},e.parseString=function(e,t){var i=new DataView(e,t).getUint16(0);return{data:i>0?Object(w.a)(new Uint8Array(e,t+2,i)):"",size:2+i}},e.parseScript=function(t,i){var n=t.byteLength,r=i,s=t,o=new DataView(s,0),c=null,_=o.getUint8(r);r+=1;var d=!1;switch(_){case 0:c=o.getFloat64(r),r+=8;break;case 1:c=!!o.getUint8(r),r+=1;break;case 2:var u=e.parseString(s,r);c=u.data,r+=u.size;break;case 3:for(c={},o.getUint32(n-4);r<n-4;){var l=e.parseObject(s,r);if(l.objectEnd)break;c[l.data.name]=l.data.value,r=l.size}r<=n-3&&9==(16777215&o.getUint32(r-1))&&(r+=3);break;case 8:for(c={},r+=4,o.getUint32(n-4);r<n-8;){var h=e.parseVariable(s,r);if(h.objectEnd)break;c[h.data.name]=h.data.value,r=h.size}r<=n-3&&9==(16777215&o.getUint32(r-1))&&(r+=3);break;case 9:c=void 0,r=1,d=!0;break;case 10:c=[];var f=o.getUint32(r);r+=4;for(var p=0;p<f;p++){var m=e.parseScript(s,r);c.push(m.data),r=m.size}break;case 11:var v=e.parseDate(s,r+1);c=v.data,r+=v.size;break;case 12:var g=e.parseString(s,r+1);c=g.data,r+=g.size;break;default:r=n,a.b.v("AMF","AMF","Unsupported AMF value type "+_)}return{data:c,size:r,objectEnd:d}},e}(),O=i(15),N=i(20),P=function(){function e(e){this._eventEmitter=void 0,this._cache=void 0,this._tag=void 0,this._result={tags:[]},this._parseLen=0,this._parseFunc=void 0,this._hasVideo=void 0,this._hasAudio=void 0,this._eventEmitter=e,this._cache=new N.a,this._parseLen=O.a,this._parseFunc=this._parseFlvHead}var t=e.prototype;return t.reset=function(){this._parseLen=O.a,this._parseFunc=this._parseFlvHead,this._cache.clear(),this._tag=void 0,this._result={tags:[]},this._hasAudio=void 0,this._hasVideo=void 0},t.append=function(e){for(this._result={tags:[]},this._cache.put(e);this._cache.unreadLen>=this._parseLen;)this._parseFunc();return this._result},t._parseFlvHead=function(){var e=this._cache.get(O.a);if(e){if(70!==e[0]||76!==e[1]||86!==e[2]||1!==e[3]){var t={type:n.b.MUX_ERROR,details:n.a.PARSING_ERROR,fatal:!0,reason:"Flv: wrong head"};this._eventEmitter.emit(r.a.ERROR,t)}this._hasAudio=!!((4&e[4])>>>2),this._hasVideo=!!(1&e[4]),a.b.i("flv-tag-dump","head audio: "+this._hasAudio+" video: "+this._hasVideo),this._result.head=e,this._parseLen=O.b,this._parseFunc=this._parseFlvTagHead}},t._parseFlvTagHead=function(){this._tag=new O.e;var e=this._cache.get(O.b);e&&(this._tag.tagType=e[0],this._tag.dataSize=((255&e[1])<<16)+((255&e[2])<<8)+(255&e[3]),this._tag.timestamp=((255&e[7])<<24)+((255&e[4])<<16)+((255&e[5])<<8)+(255&e[6]),this._parseFunc=this._parseFlvTag,this._parseLen=this._tag.dataSize+O.c)},t._parseFlvTag=function(){var e=this._tag;e&&(e.tagType!==O.f.SCRIPT&&e.tagType!==O.f.AUDIO&&e.tagType!==O.f.VIDEO||(e.body=this._cache.get(e.dataSize),this._cache.skip(4),this._result.tags.push(e),this._tag=void 0),this._parseFunc=this._parseFlvTagHead,this._parseLen=O.b)},l()(e,[{key:"trackInfo",get:function(){return"boolean"==typeof this._hasVideo&&"boolean"==typeof this._hasAudio?{hasVideo:this._hasVideo,hasAudio:this._hasAudio}:void 0}}]),e}();(C=L||(L={}))[C.H264_NAL_UNSPECIFIED=0]="H264_NAL_UNSPECIFIED",C[C.H264_NAL_SLICE=1]="H264_NAL_SLICE",C[C.H264_NAL_DPA=2]="H264_NAL_DPA",C[C.H264_NAL_DPB=3]="H264_NAL_DPB",C[C.H264_NAL_DPC=4]="H264_NAL_DPC",C[C.H264_NAL_IDR_SLICE=5]="H264_NAL_IDR_SLICE",C[C.H264_NAL_SEI=6]="H264_NAL_SEI",C[C.H264_NAL_SPS=7]="H264_NAL_SPS",C[C.H264_NAL_PPS=8]="H264_NAL_PPS",C[C.H264_NAL_AUD=9]="H264_NAL_AUD",C[C.H264_NAL_END_SEQUENCE=10]="H264_NAL_END_SEQUENCE",C[C.H264_NAL_END_STREAM=11]="H264_NAL_END_STREAM",C[C.H264_NAL_FILLER_DATA=12]="H264_NAL_FILLER_DATA",C[C.H264_NAL_SPS_EXT=13]="H264_NAL_SPS_EXT",C[C.H264_NAL_PREFIX=14]="H264_NAL_PREFIX",C[C.H264_NAL_SUB_SPS=15]="H264_NAL_SUB_SPS",C[C.H264_NAL_DPS=16]="H264_NAL_DPS",C[C.H264_NAL_RESERVED17=17]="H264_NAL_RESERVED17",C[C.H264_NAL_RESERVED18=18]="H264_NAL_RESERVED18",C[C.H264_NAL_AUXILIARY_SLICE=19]="H264_NAL_AUXILIARY_SLICE",C[C.H264_NAL_EXTEN_SLICE=20]="H264_NAL_EXTEN_SLICE",C[C.H264_NAL_DEPTH_EXTEN_SLICE=21]="H264_NAL_DEPTH_EXTEN_SLICE",C[C.H264_NAL_RESERVED22=22]="H264_NAL_RESERVED22",C[C.H264_NAL_RESERVED23=23]="H264_NAL_RESERVED23",C[C.H264_NAL_UNSPECIFIED24=24]="H264_NAL_UNSPECIFIED24",C[C.H264_NAL_UNSPECIFIED25=25]="H264_NAL_UNSPECIFIED25",C[C.H264_NAL_UNSPECIFIED26=26]="H264_NAL_UNSPECIFIED26",C[C.H264_NAL_UNSPECIFIED27=27]="H264_NAL_UNSPECIFIED27",C[C.H264_NAL_UNSPECIFIED28=28]="H264_NAL_UNSPECIFIED28",C[C.H264_NAL_UNSPECIFIED29=29]="H264_NAL_UNSPECIFIED29",C[C.H264_NAL_UNSPECIFIED30=30]="H264_NAL_UNSPECIFIED30",C[C.NAL_FF_IGNORE=267448321]="NAL_FF_IGNORE",C[C.PRIV_NAL_MAGIC_H264=31]="PRIV_NAL_MAGIC_H264";var M,V,F=i(6),U=i(30),B=i.n(U);function H(e){return{data:e,byteIndex:0,bitIndex:0}}function j(e,t){if(Y(e)>t){var i=t%8;e.byteIndex=e.byteIndex+Math.floor(t/8)+Math.floor((e.bitIndex+i)/8),e.bitIndex=(e.bitIndex+i)%8}else e.byteIndex=e.data.byteLength-1,e.bitIndex=7}function W(e,t){if(t>32)throw new Error("len must be less 32");var i=e.data[e.byteIndex],n=Math.min(8-e.bitIndex,t),r=t-n;e.bitIndex+=n;var a=i>>8-e.bitIndex&Math.pow(2,n)-1;return 8===e.bitIndex&&(e.bitIndex=0,e.byteIndex++),r?a<<r|W(e,r):a}function z(e){return W(e,X(e)+1)-1}function G(e){var t=z(e);return Math.pow(-1,t+1)*Math.ceil(t/2)}function K(e){for(var t=0,i=0;i<8;i++){var n=W(e,8);if(t|=(127&n)<<7*i,!(128&n))break}return t}function Y(e){return 8*(e.data.byteLength-e.byteIndex)-e.bitIndex}function X(e){for(var t=Y(e),i=0;i<t;i++)if(1===W(e,1))return 0===e.bitIndex?(e.byteIndex--,e.bitIndex=7):e.bitIndex--,i;return 0}!function(e){e[e.KEY_FRAME=0]="KEY_FRAME",e[e.INTER_FRAME=1]="INTER_FRAME",e[e.INTRA_ONLY_FRAME=2]="INTRA_ONLY_FRAME",e[e.SWITCH_FRAME=3]="SWITCH_FRAME"}(M||(M={})),function(e){e[e.AV1_OBU_SEQUENCE_HEADER=1]="AV1_OBU_SEQUENCE_HEADER",e[e.AV1_OBU_TEMPORAL_DELIMITER=2]="AV1_OBU_TEMPORAL_DELIMITER",e[e.AV1_OBU_FRAME_HEADER=3]="AV1_OBU_FRAME_HEADER",e[e.AV1_OBU_TILE_GROUP=4]="AV1_OBU_TILE_GROUP",e[e.AV1_OBU_METADATA=5]="AV1_OBU_METADATA",e[e.AV1_OBU_FRAME=6]="AV1_OBU_FRAME",e[e.AV1_OBU_REDUNDANT_FRAME_HEADER=7]="AV1_OBU_REDUNDANT_FRAME_HEADER",e[e.AV1_OBU_TILE_LIST=8]="AV1_OBU_TILE_LIST",e[e.AV1_OBU_PADDING=15]="AV1_OBU_PADDING"}(V||(V={}));var q=i(16),Z=function(){function e(){}return e.parse=function(e){var t=H(e),i={seq_profile:W(t,3),seq_level_idx_0:0,seq_tier_0:0,high_bitdepth:0,twelve_bit:0,monochrome:0,chroma_subsampling_x:0,chroma_subsampling_y:0,chroma_sample_position:0,initial_presentation_delay_present:0,profile_string:"",level_string:"",chroma_format_string:"",bit_depth_luma:8,width:0,height:0,codec:"",color_info:{colorRange:q.b.AVCOL_RANGE_MPEG,colourPrimaries:2,transferCharacteristics:0,matrixCoefficients:0},buffer_delay_length_minus_1:0,frame_presentation_time_length_minus_1:0,frame_id_numbers_present_flag:0,reduced_still_picture_header:0,decoder_model_info_present_flag:0,equal_picture_interval:0,delta_frame_id_length_minus_2:0,additional_frame_id_length_minus_1:0,data:e};i.profile_string=function(e){switch(e){case 0:return"Main";case 1:return"High";case 2:return"Professional";default:return"Unknown"}}(i.seq_profile),W(t,1),i.reduced_still_picture_header=W(t,1);var n,r=0,a=0,s=[],o=[0],c=[0],_=[0];if(i.reduced_still_picture_header)s[0]=W(t,5);else{W(t,1)&&(this.timingInfo(t,i),i.decoder_model_info_present_flag=W(t,1),i.decoder_model_info_present_flag&&this.decoderModelInfo(t,i)),r=W(t,1),a=W(t,5);for(var d=0;d<=a;d++)W(t,12),s[d]=W(t,5),s[d]>7?o[d]=W(t,1):o[d]=0,i.decoder_model_info_present_flag?(c[d]=W(t,1),c[d]&&this.operatingParametersInfo(t,i,d)):c[d]=0,r&&(_[d]=W(t,1),_[d]&&W(t,4))}i.seq_level_idx_0=s[0],i.seq_tier_0=o[0],i.level_string=2+((n=s[0])>>2)+"."+(3&n);var u=W(t,4),l=W(t,4),h=W(t,u+1),f=W(t,l+1);i.width=h+1,i.height=f+1,i.frame_id_numbers_present_flag=i.reduced_still_picture_header?0:W(t,1),i.frame_id_numbers_present_flag&&(i.delta_frame_id_length_minus_2=W(t,4),i.additional_frame_id_length_minus_1=W(t,3)),W(t,1),W(t,1),W(t,1);var p,m=0;return i.reduced_still_picture_header||(W(t,1),W(t,1),W(t,1),W(t,1),(m=W(t,1))&&(W(t,1),W(t,1)),(W(t,1)||W(t,1))&&W(t,1)||W(t,1),m&&W(t,3)),W(t,1),W(t,1),W(t,1),this.colorConfig(t,i),W(t,1),i.codec="av01."+i.seq_profile+"."+("0"+i.seq_level_idx_0).slice(-2)+(i.seq_tier_0?"H":"M")+"."+("0"+i.bit_depth_luma).slice(-2),i.chroma_format_string=0===(p=i).chroma_subsampling_x&&0===p.chroma_subsampling_y?"4:4:4":1===p.chroma_subsampling_x&&0===p.chroma_subsampling_y?"4:2:2":1===p.chroma_subsampling_x&&1===p.chroma_subsampling_y?"4:2:0":"Unknown",i},e.timingInfo=function(e,t){var i,n;W(e,32),W(e,32),t.equal_picture_interval=W(e,1),t.equal_picture_interval&&((n=X(i=e))>=32||W(i,n))},e.decoderModelInfo=function(e,t){t.buffer_delay_length_minus_1=W(e,5),t.num_units_in_decoding_tick=W(e,32),t.buffer_removal_time_length_minus_1=W(e,5),t.frame_presentation_time_length_minus_1=W(e,5)},e.operatingParametersInfo=function(e,t,i){var n=t.buffer_delay_length_minus_1+1;t.decoder_buffer_delay||(t.decoder_buffer_delay=[]),t.decoder_buffer_delay[i]=W(e,n),t.encoder_buffer_delay||(t.encoder_buffer_delay=[]),t.encoder_buffer_delay[i]=W(e,n),t.low_delay_mode_flag||(t.low_delay_mode_flag=[]),t.low_delay_mode_flag[i]=W(e,n)},e.colorConfig=function(e,t){t.high_bitdepth=W(e,1),2===t.seq_profile&&t.high_bitdepth?(t.twelve_bit=W(e,1),t.bit_depth_luma=t.twelve_bit?12:10):t.seq_profile<2&&(t.bit_depth_luma=t.high_bitdepth?10:8),1===t.seq_profile?t.monochrome=0:t.monochrome=W(e,1),W(e,1)?(t.color_info.colourPrimaries=W(e,8),t.color_info.transferCharacteristics=W(e,8),t.color_info.matrixCoefficients=W(e,8)):(t.color_info.colourPrimaries=q.a.AVCOL_PRI_UNSPECIFIED,t.color_info.transferCharacteristics=q.d.AVCOL_TRC_UNSPECIFIED,t.color_info.matrixCoefficients=q.c.AVCOL_SPC_UNSPECIFIED),t.chroma_subsampling_x=1,t.chroma_subsampling_y=1,t.monochrome?t.color_info.colorRange=W(e,1)+1:(t.color_info.colourPrimaries===q.a.AVCOL_PRI_BT709&&t.color_info.transferCharacteristics===q.d.AVCOL_TRC_IEC61966_2_1&&t.color_info.matrixCoefficients===q.c.AVCOL_SPC_RGB?(t.color_info.colorRange=1,t.chroma_subsampling_x=0,t.chroma_subsampling_y=0):(t.color_info.colorRange=W(e,1)+1,0===t.seq_profile?(t.chroma_subsampling_x=1,t.chroma_subsampling_y=1):1===t.seq_profile?(t.chroma_subsampling_x=0,t.chroma_subsampling_y=0):12===t.bit_depth_luma?(t.chroma_subsampling_x=W(e,1),t.chroma_subsampling_x?t.chroma_subsampling_y=W(e,1):t.chroma_subsampling_y=0):(t.chroma_subsampling_x=1,t.chroma_subsampling_y=0),t.chroma_subsampling_x&&t.chroma_subsampling_y&&W(e,2)),W(e,1))},e}();function Q(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function J(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(i),!0).forEach((function(t){B()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Q(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var $=function(){function e(){}return e.createCtx=function(){return{seenFrameHeader:0,ref:[]}},e.parseOBU=function(e,t){for(var i=[],n=0;n<e.byteLength;){var r,a=e.subarray(n),s=this.parseOBUHeader(a),o=s.obu_extension_flag+1,c=H(a);j(c,8*o),r=s.obu_has_size_field?K(c):a.length-o;var _=c.byteIndex,d=J(J({},s),{},{data:a.subarray(0,_+r)});s.obu_type===V.AV1_OBU_SEQUENCE_HEADER?(d.content=Z.parse(d.data.subarray(_)),t.sh=d.content=Z.parse(d.data.subarray(_))):s.obu_type===V.AV1_OBU_FRAME_HEADER?(t.seenFrameHeader=0,this.frameHeaderOBU(d.data.subarray(_),t)):s.obu_type===V.AV1_OBU_REDUNDANT_FRAME_HEADER?t.seenFrameHeader=1:s.obu_type===V.AV1_OBU_TEMPORAL_DELIMITER?t.seenFrameHeader=0:s.obu_type===V.AV1_OBU_FRAME&&(t.seenFrameHeader=0,d.content=this.frameOBU(d.data.subarray(_),t)),i.push(d),n+=_+r}return i},e.parseOBUHeader=function(e){var t={obu_forbidden_bit:e[0]>>7,obu_type:e[0]>>3&15,obu_extension_flag:e[0]>>2&1,obu_has_size_field:e[0]>>1&1};return t.obu_extension_flag&&(t.temporal_id=e[1]>>5,t.spatial_id=e[1]>>3&3),t},e.frameHeaderOBU=function(e,t){var i=H(e);t.seenFrameHeader?t.frame={keyframe:!1,show_existing_frame:0}:(t.seenFrameHeader=1,t.frame={keyframe:!1,show_existing_frame:0},this.uncompressedHeader(i,t),t.frame.show_existing_frame?t.seenFrameHeader=0:t.seenFrameHeader=1)},e.frameOBU=function(e,t){return this.frameHeaderOBU(e,t),t.frame},e.uncompressedHeader=function(e,t){var i=t.sh;if(i){var n=M.INTER_FRAME;if(i.reduced_still_picture_header)n=M.KEY_FRAME;else{if(1==W(e,1))return void W(e,3);n=W(e,2)}t.frame&&(t.frame.keyframe=n===M.KEY_FRAME)}},e.temporalPointInfo=function(e,t){W(e,t.frame_presentation_time_length_minus_1+1)},e}();function ee(e){switch(e){case 1:return"4:2:0";case 2:return"4:2:2";case 3:return"4:4:4";default:return"Unknown"}}function te(e){for(var t,i=e.byteLength,n=[],r=1,a=null;r<i-2;)0===e[r]&&0===e[r+1]&&3===e[r+2]?(n.push(r+2),r+=2):r++;if(0===n.length)return e;t=i-n.length,a=new Uint8Array(t);var s=0;for(r=0;r<t;s++,r++)s===n[0]&&(s++,n.shift()),a[r]=e[s];return a}var ie,ne=function(){function e(){}return e.parse=function(e){var t=H(te(e));W(t,8);var i={pps_id:0,sps_id:0,cabac:0,pic_order_present:0,slice_group_count:0,mb_slice_group_map_type:0,ref_count:[],weighted_pred:0,weighted_bipred_idc:0,chroma_qp_index_offset:[],deblocking_filter_parameters_present:0,constrained_intra_pred:0,redundant_pic_cnt_present:0,transform_8x8_mode:0,data:new Uint8Array(e)};return i.pps_id=z(t),i.sps_id=z(t),i.cabac=W(t,1),i.pic_order_present=W(t,1),i.slice_group_count=z(t)+1,i.slice_group_count>1&&z(t),i.ref_count[0]=z(t)+1,i.ref_count[1]=z(t)+1,i.weighted_pred=W(t,1),i.weighted_bipred_idc=W(t,2),G(t),G(t),i.chroma_qp_index_offset[0]=G(t),i.deblocking_filter_parameters_present=W(t,1),i.constrained_intra_pred=W(t,1),i.redundant_pic_cnt_present=W(t,1),i.transform_8x8_mode=0,i},e}(),re=function(){function e(){}return e.parse=function(t){var i=H(te(t));j(i,8);var n=W(i,8);j(i,8);var r=W(i,8),a=z(i),s=function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}(n),o=(r/10).toFixed(1),c=1,_=8,d=8;if((100===n||110===n||122===n||244===n||44===n||83===n||86===n||118===n||128===n||138===n||144===n)&&(3===(c=z(i))&&W(i,1),_=z(i)+8,d=z(i)+8,W(i,1),W(i,1)))for(var u=3!==c?8:12,l=0;l<u;l++)W(i,1)&&(l<6?e._skipScalingList(i,16):e._skipScalingList(i,64));var h=z(i)+4,f=z(i),p=0,m=0,v=0,g=0,y=0,E=[];if(0===f)p=z(i)+4;else if(1===f){m=W(i,1),g=G(i),y=G(i),v=z(i);for(var b=0;b<v;b++)E[b]=G(i)}var A=Math.max(2,z(i));W(i,1);var T=z(i)+1,S=z(i)+1,R=W(i,1);0===R&&W(i,1),W(i,1);var x=0,L=0,C=0,D=0;W(i,1)&&(x=z(i),L=z(i),C=z(i),D=z(i));var I=1,w=1,k=0,O=!0,N=0,P=0,M=q.b.AVCOL_RANGE_MPEG,V=2,F=0,U=0;if(W(i,1)){if(W(i,1)){var B=W(i,8);B>0&&B<16?(I=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][B-1],w=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][B-1]):255===B&&(I=W(i,8)<<8|W(i,8),w=W(i,8)<<8|W(i,8))}if(W(i,1)&&W(i,1),W(i,1)&&(W(i,3),M=W(i,1)?q.b.AVCOL_RANGE_JPEG:q.b.AVCOL_RANGE_MPEG,W(i,1)&&(V=W(i,8),F=W(i,8),U=W(i,8))),W(i,1)&&(z(i),z(i)),W(i,1)){var K=W(i,32),Y=W(i,32);O=!!W(i,1),k=(N=Y)/(P=2*K)}}var X=1;1===I&&1===w||(X=I/w);var Z=0,Q=0;0===c?(Z=1,Q=2-R):(Z=3===c?1:2,Q=(1===c?2:1)*(2-R));var J=16*T,$=16*S*(2-R);J-=(x+L)*Z,$-=(C+D)*Q;for(var ie=Math.ceil(J*X),ne=t.subarray(1,4),re="avc1.",ae=0;ae<3;ae++){var se=ne[ae].toString(16);se.length<2&&(se="0"+se),re+=se}return{sps_id:a,profile_string:s,level_string:o,bit_depth_luma:_,bit_depth_chroma:d,chroma_format_idc:c,chroma_format_string:ee(c),frame_rate:{fixed:O,fps:k,fps_den:P,fps_num:N},sar_ratio:{width:I,height:w},codec_size:{width:J,height:$},present_size:{width:ie,height:$},color_info:{colorRange:M,colourPrimaries:V,transferCharacteristics:F,matrixCoefficients:U},codec:re,pic_order_cnt_type:f,log2_max_frame_num:h,log2_max_poc_lsb:p,frame_mbs_only_flag:R,delta_pic_order_always_zero_flag:m,num_ref_frames_in_pic_order_cnt_cycle:v,offset_for_ref_frame:E,offset_for_non_ref_pic:g,offset_for_top_to_bottom_field:y,ref_frame_count:A,data:new Uint8Array(t)}},e._skipScalingList=function(e,t){for(var i=8,n=8,r=0;r<t;r++)0!==n&&(n=(i+G(e)+256)%256),i=0===n?i:n},e}(),ae={1:"Main",2:"Main 10",3:"Main Still Picture",4:"Rext"},se={30:"1",60:"2",63:"2.1",90:"3",93:"3.1",120:"4",123:"4.1",150:"5",153:"5.1",156:"5.2",180:"6",183:"6.1",186:"6.2",255:"8.5"},oe=function(){function e(){}return e.parse=function(e){var t=H(te(e));j(t,16);var i={pps_id:z(t),sps_id:z(t),dependent_slice_segments_enabled_flag:W(t,1),output_flag_present_flag:W(t,1),num_extra_slice_header_bits:W(t,3),sign_data_hiding_enabled_flag:W(t,1),cabac_init_present_flag:W(t,1),num_ref_idx_l0_default_active:z(t)+1,num_ref_idx_l1_default_active:z(t)+1,init_qp_minus26:z(t),constrained_intra_pred_flag:W(t,1),transform_skip_enabled_flag:W(t,1),tiles_enabled_flag:0,entropy_coding_sync_enabled_flag:0,data:new Uint8Array(e)};return W(t,1)&&z(t),G(t),G(t),j(t,4),i.tiles_enabled_flag=W(t,1),i.entropy_coding_sync_enabled_flag=W(t,1),i},e}(),ce=function(){function e(){}return e.parsePTL=function(e,t,i){if(!this._decodeProfileTierLevel(e,t.general_ptl)||Y(e)<8+16*(i-1>0?1:0))return!1;var n;t.general_ptl.level_idc=W(e,8),t.general_ptl.level_string=(n=t.general_ptl.level_idc,se[n]),t.sub_layer_profile_present_flag=[],t.sub_layer_level_present_flag=[];for(var r=0;r<i-1;r++)t.sub_layer_profile_present_flag[r]=W(e,1),t.sub_layer_level_present_flag[r]=W(e,1);if(i-1>0)for(var a=i-1;a<8;a++)W(e,2);for(var s=0;s<i-1;s++){if(t.sub_layer_ptl[s]=this.getPTLCommon(),t.sub_layer_profile_present_flag[s]&&this._decodeProfileTierLevel(e,t.sub_layer_ptl[s]))return!1;if(t.sub_layer_level_present_flag[s]){if(Y(e)<8)return!1;t.sub_layer_ptl[s].level_idc=W(e,8)}}return!0},e.getPTL=function(){return{general_ptl:e.getPTLCommon(),sub_layer_ptl:[],sub_layer_profile_present_flag:[],sub_layer_level_present_flag:[]}},e.getPTLCommon=function(){return{profile_space:0,tier_flag:0,profile_idc:0,profile_compatibility:0,profile_compatibility_flag:[],constraint_indicator:[],level_idc:0,profile_string:"",level_string:""}},e._decodeProfileTierLevel=function(e,t){if(Y(e)<88)return!1;t.profile_space=W(e,2),t.tier_flag=W(e,1),t.profile_idc=W(e,5),t.profile_compatibility_flag=[];for(var i=0;i<32;i++)t.profile_compatibility_flag[i]=W(e,1),t.profile_compatibility=(t.profile_compatibility_flag[i]<<31-i)+t.profile_compatibility,0==t.profile_idc&&i>0&&t.profile_compatibility_flag[i]&&(t.profile_idc=i);for(var n=0;n<6;n++)t.constraint_indicator.push(W(e,8));var r;return t.profile_string=(r=t.profile_idc,ae[r]),!0},e}(),_e=[1,2,2,1],de=[1,2,1,1],ue=function(){function e(){}return e.parse=function(e,t){void 0===t&&(t=f.b.hevc);var i=H(te(e)),n=ce.getPTL();j(i,16);var r=W(i,4),a=W(i,3),s=a+1;j(i,1);var o={vps_id:r,sps_id:0,chroma_format_idc:0,chroma_format_string:"",profile_string:"",level_string:"",bit_depth_luma:0,bit_depth_chroma:0,fps:0,width:0,height:0,conformance_window_flag:0,codec:"",color_info:{colorRange:q.b.AVCOL_RANGE_MPEG,colourPrimaries:2,transferCharacteristics:0,matrixCoefficients:0},min_spatial_segmentation_idc:0,log2_max_poc_lsb:0,separate_colour_plane_flag:0,log2_min_cb_size:0,log2_diff_max_min_coding_block_size:0,log2_min_tb_size:0,log2_max_trafo_size:0,log2_ctb_size:0,ctb_width:0,ctb_height:0,temporal_layer:[],ptl:n,data:new Uint8Array(e)};if(!ce.parsePTL(i,n,s))return o;if(o.sps_id=z(i),o.sps_id>=16)return o;var c=z(i);if(3==c&&W(i,1)&&(c=0),o.width=z(i),o.height=z(i),o.conformance_window_flag=W(i,1),o.conformance_window_flag){var _=de[c],d=_e[c];o.conf_win_left_offset=z(i),o.conf_win_right_offset=z(i),o.conf_win_top_offset=z(i),o.conf_win_bottom_offset=z(i),o.width=o.width-(o.conf_win_left_offset+o.conf_win_right_offset)*d,o.height=o.height-(o.conf_win_top_offset+o.conf_win_bottom_offset)*_}o.bit_depth_luma=z(i)+8,o.bit_depth_chroma=z(i)+8,o.log2_max_poc_lsb=z(i)+4;for(var u=W(i,1)?0:a;u<=a;u++)o.temporal_layer.push({max_dec_pic_buffering:z(i)+1}),z(i),z(i);o.log2_min_cb_size=z(i)+3,o.log2_diff_max_min_coding_block_size=z(i),t!==f.b.kvc4&&t!==f.b.kvc5||z(i),t!==f.b.kvc3&&t!==f.b.kvc4&&t!==f.b.kvc5||z(i)&&(z(i),z(i)),o.log2_min_tb_size=z(i)+2;var l=z(i);o.log2_max_trafo_size=l+o.log2_min_tb_size,z(i),z(i),W(i,1)&&W(i,1)&&this.skipScalingListData(i),W(i,1),W(i,1),W(i,1)&&(W(i,4),W(i,4),z(i),z(i),W(i,1));var h=z(i);if(h>64)return o;for(var p=[],m=0;m<h;m++)if(this.parseRps(i,m,h,p)<0)return o;if(W(i,1)){var v=z(i);if(v>31)return o;for(u=0;u<v;u++)W(i,Math.min(o.log2_max_poc_lsb,16)),W(i,1)}return W(i,1),W(i,1),W(i,1)&&this.hvccParseVui(i,o,a),o.log2_ctb_size=o.log2_min_cb_size+o.log2_diff_max_min_coding_block_size,o.ctb_width=o.width+(1<<o.log2_ctb_size)-1>>o.log2_ctb_size,o.ctb_height=o.height+(1<<o.log2_ctb_size)-1>>o.log2_ctb_size,o.chroma_format_idc=c,o.chroma_format_string=3===c?"4:4:4":"4:2:0",o.profile_string=n.general_ptl.profile_string,o.level_string=n.general_ptl.level_string,o.codec=this.getCodec(n.general_ptl,t),o},e.getCodec=function(e,t){void 0===t&&(t=f.b.hevc);for(var i=e.profile_compatibility.toString(16);i.length>1;){var n=i.length-1;if("0"!==i.charAt(n))break;i=i.slice(0,n)}for(var r="",a=!1,s=5;s>=0;s--)(e.constraint_indicator[s]||a)&&(r="."+e.constraint_indicator[s].toString(16)+r,a=!0);return(t===f.b.hevc?"hev1":t)+"."+["","A","B","C"][e.profile_space]+e.profile_idc+"."+i+"."+(0===e.tier_flag?"L":"H")+e.level_idc+r},e.getGeneralPTL=function(){return{profile_space:0,tier_flag:0,profile_idc:0,profile_compatibility:0,profile_compatibility_flag:[],constraint_indicator:[],level_idc:0,profile_string:"",level_string:""}},e.skipScalingListData=function(e){var t,i,n,r;for(t=0;t<4;t++)for(i=0;i<(3==t?2:6);i++)if(W(e,1))for(r=Math.min(64,1<<4+(t<<1)),t>1&&G(e),n=0;n<r;n++)G(e);else z(e)},e.parseRps=function(e,t,i,n){var r;if(t&&W(e,1)){if(t>=i)return-1;for(W(e,1),z(e),n[t]=0,r=0;r<=n[t-1];r++){var a=0,s=W(e,1);s||(a=W(e,1)),(s||a)&&n[t]++}}else{var o=z(e),c=z(e);if(2*(c+o)>Y(e))return-1;for(n[t]=o+c,r=0;r<o;r++)z(e),W(e,1);for(r=0;r<c;r++)z(e),W(e,1)}return 0},e.hvccParseVui=function(e,t,i){var n;W(e,1)&&255===W(e,8)&&W(e,32),W(e,1)&&W(e,1),W(e,1)&&(W(e,3),W(e,1),W(e,1)&&(t.color_info.colourPrimaries=W(e,8),t.color_info.transferCharacteristics=W(e,8),t.color_info.matrixCoefficients=W(e,8))),W(e,1)&&(z(e),z(e)),W(e,3),W(e,1)&&(z(e),z(e),z(e),z(e)),W(e,1)&&(this.parseTimingInfo(e,t),W(e,1)&&this.skipHrdParameters(e,1,i)),W(e,1)&&(W(e,3),n=z(e),t.min_spatial_segmentation_idc=Math.min(t.min_spatial_segmentation_idc,n),z(e),z(e),z(e),z(e))},e.parseTimingInfo=function(e,t){var i=W(e,32),n=W(e,32);t.fps=n/i||0,W(e,1)&&z(e)},e.skipHrdParameters=function(e,t,i){var n,r=0,a=0,s=0;for(t&&(a=W(e,1),s=W(e,1),(a||s)&&((r=W(e,1))&&W(e,19),W(e,8),r&&W(e,4),W(e,15))),n=0;n<=i;n++){var o=0,c=0,_=0;if(W(e,1)||(_=W(e,1)),_?z(e):c=W(e,1),!c&&(o=z(e))>31)return-1;a&&this._skipSubLayerHrdParameters(e,o,r),s&&this._skipSubLayerHrdParameters(e,o,r)}return 0},e._skipSubLayerHrdParameters=function(e,t,i){var n;for(n=0;n<=t;n++)z(e),z(e),i&&(z(e),z(e)),W(e,1)},e}(),le=function(){function e(){}return e.parse=function(e){var t=H(te(e));j(t,16);var i={vps_id:W(t,4),fps:0,ptl:ce.getPTL(),data:new Uint8Array(e)};if(i.vps_id>=16)return a.b.i("vps-parser","VPS id out of range:",i.vps_id),i;if(3!==W(t,2))return a.b.i("vps-parser","vps_reserved_three_2bits is not three"),i;j(t,6);var n=W(t,3);if(j(t,1),65535!=W(t,16))return a.b.i("vps-parser","vps_reserved_ffff_16bits is not 0xffff\n"),i;if(n>7)return a.b.i("vps-parser","vps_max_sub_layers out of range: ",n),i;if(!ce.parsePTL(t,i.ptl,n))return i;for(var r=W(t,1)?0:n-1;r<n;r++)z(t),z(t),z(t);var s=W(t,6),o=z(t)+1;if(o<1||o>1024||(o-1)*(s+1)>Y(t))return a.b.i("vps-parser","too many layer_id_included_flags"),i;for(r=1;r<o;r++)for(var c=0;c<=s;c++)W(t,1);if(W(t,1)){var _=W(t,32),d=W(t,32);i.fps=d/_||0}return i},e}(),he=function(){function e(){}return e.parseAV1C=function(e,t){var i,n=null==(i=$.parseOBU(e.subarray(4),t)[0])?void 0:i.content;if(n)return{marker:e[0]>>7&1,version:127&e[0],seq_profile:e[1]>>5&7,seq_level_idx_0:31&e[1],seq_tier_0:e[2]>>7&1,high_bitdepth:e[2]>>6&1,twelve_bit:e[2]>>5&1,monochrome:e[2]>>4&1,chroma_subsampling_x:e[2]>>3&1,chroma_subsampling_y:e[2]>>2&1,chroma_sample_position:3&e[2],initial_presentation_delay_present:e[3]>>4&1,sh:n}},e.parseAVCC=function(e){var t=e[0],i=e[1],n=e[2],r=e[3];if(1===t&&0!==i){var s=1+(3&e[4]);if(3===s||4===s){var o=31&e[5];if(0!==o){o>1&&a.b.w("video-config","H264 SPS count: "+o);for(var c,_,d=6,u=[],l=[],h=0;h<o;h++){var f=Object(v.d)(e,d);if(d+=2,0!==f){var p=e.subarray(d,d+f);d+=f,u[(c=re.parse(p)).sps_id]=c}}var m=e[d];if(0!==m){m>1&&a.b.w("video-config","H264 PPS count: "+m),d++;for(var g=0;g<m;g++){var y=Object(v.d)(e,d);d+=2;var E=e.subarray(d,d+y);l[(_=ne.parse(E)).pps_id]=_,0!==y&&(d+=y)}return{version:t,avcProfile:i,profileCompatibility:n,avcLevel:r,naluLengthSize:s,paramSets:{spsList:u,ppsList:l,sps:c,pps:_}}}a.b.e("video-config","Invalid H264 PPS count: "+m)}else a.b.e("video-config","Invalid H264 SPS count: "+o)}else a.b.e("video-config","MP4: Strange NaluLengthSizeMinusOne: "+(s-1))}else a.b.e("video-config","Invalid AVCDecoderConfigurationRecord")},e.parseHVCC=function(e,t){void 0===t&&(t=f.b.hevc);var i=22,n=e[i];i++;for(var r,s,o,c=[],_=[],d=[],u=0;u<n;u++){var l=63&e[i];i+=1;var h=Object(v.d)(e,i);i+=2;for(var p=0;p<h;p++){var m=Object(v.d)(e,i);if(i+=2,0!==m){var g=e.subarray(i,i+m);l===F.a.HEVC_NAL_VPS?(a.b.v("video-config","VPS lengh "+m),d[(o=le.parse(g)).vps_id]=o):l===F.a.HEVC_NAL_SPS?(a.b.v("video-config","SPS lengh "+m),c[(r=ue.parse(g,t)).sps_id]=r):l===F.a.HEVC_NAL_PPS&&(a.b.v("video-config","PPS lengh "+m),_[(s=oe.parse(g)).pps_id]=s),i+=m}}}return{paramSets:{vpsList:d,spsList:c,ppsList:_,sps:r,pps:s}}},e.generateAV1C=function(e){var t=new Uint8Array(5+e.data.length);return t[0]=129,t[1]=(e.seq_profile<<5)+(31&e.seq_level_idx_0),t[2]=(e.seq_tier_0<<7)+(e.high_bitdepth<<6)+(e.twelve_bit<<5)+(e.monochrome<<4)+(e.chroma_subsampling_x<<3)+(e.chroma_subsampling_y<<2)+(3&e.chroma_sample_position),t[3]=0,t[4]=8,t.set(e.data,5),t},e.generateAVCC=function(e){if(e.sps&&e.pps&&e.spsList.length&&e.ppsList.length){var t=e.spsList.filter((function(e){return!!e})),i=e.ppsList.filter((function(e){return!!e})),n=t.reduce((function(e,t){return e+t.data.byteLength}),0),r=i.reduce((function(e,t){return e+t.data.byteLength}),0),a=new Uint8Array(7+n+r+2*t.length+2*i.length);a.set([1,e.sps.data[1],e.sps.data[2],e.sps.data[3],255,224|t.length],0);var s=6;return t.forEach((function(e){a[s]=e.data.byteLength>>8&255,a[s+1]=255&e.data.byteLength,a.set(e.data,s+2),s+=2+e.data.byteLength})),a[s]=i.length,s++,i.forEach((function(e){a[s]=e.data.byteLength>>8&255,a[s+1]=255&e.data.byteLength,a.set(e.data,s+2),s+=2+e.data.byteLength})),a}},e.generateHVCC=function(e){if(e.sps&&e.pps&&e.spsList.length&&e.ppsList.length&&e.vpsList.length){var t=e.spsList.filter((function(e){return!!e})),i=e.ppsList.filter((function(e){return!!e})),n=e.vpsList.filter((function(e){return!!e})),r=t.reduce((function(e,t){return e+t.data.byteLength}),0)+i.reduce((function(e,t){return e+t.data.byteLength}),0)+n.reduce((function(e,t){return e+t.data.byteLength}),0)+2*(t.length+i.length+n.length),a=e.sps.ptl,s=new Uint8Array(32+r),o=new DataView(s.buffer,0);s[0]=1,s[1]=(192&a.general_ptl.profile_space)+((1&a.general_ptl.tier_flag)<<5)+a.general_ptl.profile_idc&31,o.setUint32(2,a.general_ptl.profile_compatibility);for(var c=0;c<6;c++)o.setUint8(c+6,a.general_ptl.constraint_indicator[c]||0);o.setUint8(12,a.general_ptl.level_idc);var _=1;e.pps.entropy_coding_sync_enabled_flag&&e.pps.tiles_enabled_flag?_=0:e.pps.entropy_coding_sync_enabled_flag?_=3:e.pps.tiles_enabled_flag&&(_=2),s[13]=240+(3840&e.sps.min_spatial_segmentation_idc),s[14]=255&e.sps.min_spatial_segmentation_idc,s[15]=252+(3&_),s[16]=252+(3&e.sps.chroma_format_idc),s[17]=248+(e.sps.bit_depth_luma-8&7),s[18]=248+(e.sps.bit_depth_chroma-8&7),s[21]=3,s[22]=3;var d=23;return[{nalus:n,type:F.a.HEVC_NAL_VPS},{nalus:t,type:F.a.HEVC_NAL_SPS},{nalus:i,type:F.a.HEVC_NAL_PPS}].forEach((function(e){s[d]=e.type,d++,o.setUint16(d,e.nalus.length),d+=2,e.nalus.forEach((function(e){o.setUint16(d,e.data.byteLength),d+=2,s.set(e.data,d),d+=e.data.byteLength}))})),s}},e.hevDecoderConfigToSample=function(t,i){return{units:e.hevDecoderConfigToNalu(t),dts:0,cts:0,pts:0,streamDTS:i,key:!1}},e.hevDecoderConfigToNalu=function(e){var t=[];return e.vpsList.forEach((function(e){e&&t.push({type:F.a.HEVC_NAL_VPS,data:e.data})})),e.spsList.forEach((function(e){e&&t.push({type:F.a.HEVC_NAL_SPS,data:e.data})})),e.ppsList.forEach((function(e){e&&t.push({type:F.a.HEVC_NAL_PPS,data:e.data})})),t},e.avcDecoderConfigToNalu=function(e){var t=[];return e.spsList.forEach((function(e){e&&t.push({type:L.H264_NAL_SPS,data:e.data})})),e.ppsList.forEach((function(e){e&&t.push({type:L.H264_NAL_PPS,data:e.data})})),t},e.getDPB264=function(e){return e.sps?Math.min(Math.max(e.sps.ref_frame_count,2),16):16},e.getDPBHEVC=function(e){if(!e.sps)return 16;var t=e.sps.temporal_layer.reduce((function(e,t){return Math.max(t.max_dec_pic_buffering,e)}),2);return Math.min(t,16)},e.getDPBLenAV1=function(e){return 8},e}(),fe=function(){function e(){}return e.updateAV1Track=function(e,t,i){t&&(e.width=t.width,e.height=t.height,e.codec=t.codec,e.profile=t.profile_string,e.level=t.level_string,e.chromaFormat=t.chroma_format_string,e.bitDepth=t.bit_depth_luma,e.colorInfo=t.color_info,e.decConf=i||he.generateAV1C(t))},e.onAV1Detected=function(e,t,i){return a.b.i("video-track-helper","detected av1: "+i.av1),i.av1?(e.outputRaw=!i.av1,e.active=!0):(a.b.i("video-track-helper","AV1 found, disabled."),e.active=!1),e.active},e.updateAVCTrack=function(e,t,i){if(t.sps){var n=t.sps;e.width=n.codec_size.width,e.height=n.codec_size.height,e.pixelRatio=[n.sar_ratio.width,n.sar_ratio.height],n.frame_rate.fixed&&0!==n.frame_rate.fps&&(e.fps=n.frame_rate.fps),e.codec=n.codec,e.profile=n.profile_string,e.level=n.level_string,e.chromaFormat=n.chroma_format_string,e.bitDepth=n.bit_depth_luma,e.colorInfo=n.color_info,e.fps&&(e.sampleDuration=Math.floor(e.timescale/e.fps)),e.decConf=i||he.generateAVCC(t)}},e.updateHEVCTrack=function(e,t,i){if(t.sps){var n=t.sps,r=t.vps;e.width=n.width,e.height=n.height,e.codec=n.codec,e.profile=n.profile_string||(null==r?void 0:r.ptl.general_ptl.profile_string)||"",e.level=n.level_string||(null==r?void 0:r.ptl.general_ptl.level_string)||"",e.chromaFormat=n.chroma_format_string,e.bitDepth=n.bit_depth_luma,e.fps=n.fps||(null==r?void 0:r.fps)||0,e.colorInfo=n.color_info,e.decConf=i||he.generateHVCC(t)}},e.onHEVCDetected=function(e,t,i){return a.b.i("video-track-helper","detected hevc: "+i.hevc+" wasm: "+t.wasmDecoderEnabled),t.wasmDecoderEnabled||i.hevc?(e.outputRaw=!i.hevc||t.preferDecoder===f.c.wasm,e.active=!0):(a.b.i("video-track-helper","HEVC found, disabled. wasmDec:"+t.wasmDecoderEnabled),e.active=!1),e.active},e.onKVCDetected=function(e,t,i){return a.b.i("video-track-helper","detected kvc wasm: "+t.wasmDecoderEnabled),e.active=t.wasmDecoderEnabled,e.outputRaw=e.active,e.active||a.b.i("video-track-helper","KVC found, disabled. wasmDec:"+t.wasmDecoderEnabled),e.active},e}(),pe=function(){function e(e,t,i,n){var a=this;this._eventEmitter=void 0,this._remuxer=void 0,this._config=void 0,this._duration=1/0,this._naluLengthSize=4,this._videoTrack=void 0,this._audioTrack=void 0,this._slientAudio=void 0,this._remuxStat=void 0,this._firstRemux=!0,this._aLastDTS=void 0,this._vLastDTS=void 0,this._typeSupported=void 0,this._transmuxData=void 0,this._tagDump=void 0,this._gopRemux=!1,this._timeExceptionInfo=void 0,this._firstVideoTag=!1,this._av1Ctx=void 0,this._onError=function(e){a._eventEmitter.emit(r.a.ERROR,e)},this._eventEmitter=e,this._remuxer=t,this._config=i,this._typeSupported=n,this._gopRemux=!!this._config.gopRemux,this._videoTrack=Object(I.b)(1/0),this._audioTrack=Object(I.a)(1/0),this._tagDump=new P(this._eventEmitter)}e.probe=function(e){return e.byteLength>=3&&70===e[0]&&76===e[1]&&86===e[2]};var t=e.prototype;return t.append=function(e,t,i,n,a){var s=this;if(void 0===a&&(a=!1),!e.byteLength&&a)return this._gopRemux?this._onGOPEnd():this._remux(a),this._tagDump.reset(),void this._eventEmitter.emit(r.a.PARSED_DATA,{extra:this._transmuxData});var o=this._tagDump.append(e),c=this._tagDump.trackInfo;void 0===this._videoTrack.active&&c&&(this._videoTrack.active=c.hasVideo,this._audioTrack.active=c.hasAudio,this._videoTrack.active||(this._gopRemux=!1));var _=o.tags;this._remuxStat||(this._remuxStat={timeOffset:t,contiguous:i,accurateTimeOffset:n}),_.length&&(_.forEach((function(e){e.tagType===O.f.VIDEO&&s._videoTrack.active&&(s._firstVideoTag||(s._audioTrack.samples.length&&s._discontinuity(),s._firstVideoTag=!0),s._parseVideoData(e)),e.tagType===O.f.AUDIO&&s._audioTrack.active&&s._parseAudioData(e),e.tagType===O.f.SCRIPT&&s._parseScriptTag(e)})),this._gopRemux||this._remux(!(!a||!this._videoTrack.samples.length&&!this._audioTrack.samples.length)),a&&((this._videoTrack.samples.length||this._audioTrack.samples.length)&&this._remux(!0),this._tagDump.reset(),this._eventEmitter.emit(r.a.PARSED_DATA,{extra:this._transmuxData})))},t.destroy=function(){},t.flush=function(){this._remux(!0),this._remuxStat=void 0},t.resetInitSegment=function(e){this._transmuxData=e,this._firstRemux=!0,this._videoTrack.samples=[],this._audioTrack.samples=[],this._aLastDTS=this._vLastDTS=void 0,this._remuxStat=void 0,this._duration=e.duration,this._timeExceptionInfo=void 0,"boolean"==typeof e.hasAudio&&"boolean"==typeof e.hasVideo&&(a.b.i("flv-demuxer","reset init audio: "+e.hasAudio+" video: "+e.hasVideo),this._audioTrack.active=e.hasAudio,this._videoTrack.active=e.hasVideo,this._videoTrack.active||(this._gopRemux=!1)),this._tagDump.reset(),this._slientAudio&&this._slientAudio.reset()},t.resetTimeStamp=function(){},t._discontinuity=function(){a.b.i("flv-demuxer","discontinuity"),this._remux(!0),this._remuxer.ISGenerated&&this._transmuxData&&this._remuxer.resetInitSegment(this._transmuxData),this._slientAudio&&this._slientAudio.reset()},t._isTimeException=function(e,t,i){return i<t||i-t>=h.g},t._checkTimestamp=function(e,t,i){this._isTimeException(e,t,i)&&(this._gopRemux=!0,this._timeExceptionInfo?this._timeExceptionInfo.list.push({aDTS:this._aLastDTS,vDTS:this._vLastDTS}):(this._timeExceptionInfo={list:[{aDTS:this._aLastDTS,vDTS:this._vLastDTS}]},(this._videoTrack.active&&"number"==typeof this._vLastDTS||this._audioTrack.active&&"number"==typeof this._aLastDTS)&&this._remux(!0)))},t._onGOPEnd=function(){this._gopRemux&&(a.b.v("flv-demuxer","gop end"),this._timeExceptionInfo&&this._videoTrack.active&&this._videoTrack.samples.length?(this._fixTime(),this._timeExceptionInfo=void 0,this._gopRemux=!!this._config.gopRemux):this._remux(!0))},t._resetTrackSamples=function(e){var t=e.samples;if(t.length>1)for(var i=e.sampleDuration||1,n=t[t.length-1],r=t.length-2;r>=0;r--){var a=t[r].pts-t[r].dts;t[r].dts=n.dts-i,t[r].pts=t[r].dts+a,n=t[r]}},t._fixTime=function(){this._timeExceptionInfo&&(this._videoTrack.samples,this._timeExceptionInfo.list.length>1&&(this._resetTrackSamples(this._videoTrack),this._resetTrackSamples(this._audioTrack)));var e=this._remuxer.getLastPTS(),t=[e.video,e.audio].reduce((function(e,t){return t&&(t<e||!e)?t:e}),0);a.b.i("flv-demuxer","fix offset",t),this._remuxStat={accurateTimeOffset:!0,contiguous:!1,timeOffset:t},this._transmuxData&&this._remuxer.resetInitSegment(this._transmuxData),this._remuxer.resetTimeStamp(),this._audioTrack.samples.length&&(this._aLastDTS=1e3*this._audioTrack.samples[this._audioTrack.samples.length-1].dts/this._audioTrack.inputTimescale),this._videoTrack.samples.length&&(this._vLastDTS=1e3*this._videoTrack.samples[this._videoTrack.samples.length-1].dts/this._videoTrack.inputTimescale),this._remux(!0)},t._parseScriptTag=function(e){if(e.body){var t=k.parseMetadata(e.body.buffer);if(t.hasOwnProperty("onMetaData")){var i=t.onMetaData;if("number"==typeof i.duration&&(this._duration=this._duration||i.duration),"number"==typeof i.framerate&&(this._videoTrack.fps=this._videoTrack.fps||i.framerate),"number"==typeof i.videodatarate&&(this._videoTrack.bitrate=i.videodatarate),"number"==typeof i.audiodatarate&&(this._audioTrack.bitrate=i.audiodatarate),i.keyframes&&i.keyframes.filepositions&&Array.isArray(i.keyframes.filepositions)&&i.keyframes.times&&Array.isArray(i.keyframes.times)&&i.keyframes.filepositions.length===i.keyframes.times.length){var n=[];i.keyframes.times.forEach((function(e,t){n.push({time:e,position:i.keyframes.filepositions[t]})})),i.keyframes=n}a.b.i("flv-demuxer","Parsed onMetaData"),this._eventEmitter.emit(r.a.METADATA,i)}}},t._parseVideoData=function(e){if(e.body){var t=e.body[0];e.frameType=(240&t)>>>4;var i=15&t;if(7===i||12===i||13===i){e.codecId=i;var a=e.body[1];if(e.cts=((255&e.body[2])<<16)+((255&e.body[3])<<8)+(255&e.body[4]),8388608&e.cts&&(e.cts=e.cts+1-16777215),e.cts<0&&(e.cts=0),0===a)7===i?(this._videoTrack.outputRaw&&(this._discontinuity(),this._videoTrack.outputRaw=!1),this._parseAVCDecoderConfigurationRecord(e)):12===i?(fe.onHEVCDetected(this._videoTrack,this._config,this._typeSupported),this._parseHEVCDecoderConfigurationRecord(e)):13===i&&(fe.onAV1Detected(this._videoTrack,this._config,this._typeSupported),this._parseAV1DecoderConfigurationRecord(e));else if(1===a){if(!this._videoTrack.codec)return;var s=this._parseAVCVideoData(e)||{};1===e.frameType&&(s.timestamp=e.timestamp,s.ptsOrignMs=e.timestamp+e.cts,this._eventEmitter.emit(r.a.PRIV_NAL,s))}else if(2!==a)return void this._onError({type:n.b.MUX_ERROR,details:n.a.PARSING_ERROR,fatal:!0,reason:"Flv: Invalid video packet type "+a})}else this._onError({type:n.b.MUX_ERROR,details:n.a.PARSING_ERROR,fatal:!0,reason:"Flv: Unsupported codec in video frame: "+i})}},t._parseHEVCDecoderConfigurationRecord=function(e){if(e.body){var t,i=this._videoTrack,a=e.body.subarray(O.d,e.body.byteLength),s=he.parseHVCC(a);if(s&&s.paramSets.spsList.length){if(i.decConf&&!Object(v.b)(i.decConf,a)&&this._discontinuity(),i.codecType!==f.b.hevc&&(i.codecType=f.b.hevc,this._eventEmitter.emit(r.a.VIDEO_CODEC_DETECTED,{codecType:f.b.hevc,enabled:i.active,decoder:this._videoTrack.outputRaw?f.c.wasm:f.c.buildin,bitDepth:i.bitDepth,timeOffset:(null==(t=this._remuxStat)?void 0:t.timeOffset)||0})),fe.updateHEVCTrack(i,s.paramSets),i.duration=this._duration,this._videoTrack.outputRaw){var o=he.hevDecoderConfigToSample(s.paramSets,e.timestamp);this._eventEmitter.emit(r.a.RAW_DATA,{type:p.c.decoderConfig,samples:[o],extra:this._transmuxData})}}else this._onError({type:n.b.MUX_ERROR,details:n.a.PARSING_ERROR,fatal:!0,reason:"Invalid HEVCDecoderConfigurationRecord"})}},t._parseAV1DecoderConfigurationRecord=function(e){if(e.body){var t=this._videoTrack,i=e.body.subarray(O.d,e.body.byteLength);this._av1Ctx=$.createCtx();var a,s=he.parseAV1C(i,this._av1Ctx);if(s)t.decConf&&!Object(v.b)(t.decConf,i)&&this._discontinuity(),t.codecType!==f.b.av1&&(t.codecType=f.b.av1,this._eventEmitter.emit(r.a.VIDEO_CODEC_DETECTED,{enabled:!0,decoder:f.c.buildin,codecType:f.b.av1,timeOffset:(null==(a=this._remuxStat)?void 0:a.timeOffset)||0})),fe.updateAV1Track(t,s.sh,i),t.duration=this._duration;else this._onError({type:n.b.MUX_ERROR,details:n.a.PARSING_ERROR,fatal:!0,reason:"Invalid AV1DecoderConfigurationRecord"})}},t._parseAVCDecoderConfigurationRecord=function(e){if(e.body){var t,i=e.body.subarray(O.d,e.body.byteLength),a=this._videoTrack,s=he.parseAVCC(e.body.subarray(O.d,e.body.byteLength));if(s&&s.paramSets.spsList.length)a.decConf&&!Object(v.b)(a.decConf,i)&&this._discontinuity(),a.codecType!==f.b.h264&&(a.codecType=f.b.h264,this._eventEmitter.emit(r.a.VIDEO_CODEC_DETECTED,{enabled:!0,decoder:f.c.buildin,codecType:f.b.h264,timeOffset:(null==(t=this._remuxStat)?void 0:t.timeOffset)||0})),fe.updateAVCTrack(a,s.paramSets,i),a.duration=this._duration;else this._onError({type:n.b.MUX_ERROR,details:n.a.PARSING_ERROR,fatal:!0,reason:"Invalid AVCDecoderConfigurationRecord"})}},t._parseAVCVideoData=function(e){if(e.body){var t,i=this._videoTrack,n=e.body.buffer,s=e.body.byteLength-O.d,o=new DataView(n,O.d,s),c=[],_=0,d=this._naluLengthSize,u=e.timestamp,l=u+e.cts,h=1===e.frameType;if(h&&this._onGOPEnd(),"number"==typeof this._vLastDTS&&this._checkTimestamp(f.l.VIDEO,this._vLastDTS,u),13===e.codecId)this._av1Ctx||(this._av1Ctx=$.createCtx()),$.parseOBU(e.body.subarray(O.d),this._av1Ctx).forEach((function(e){c.push({type:0,data:e.data})}));else for(;_<s;){if(_+4>=s){a.b.v("flv-demuxer","Malformed Nalu near timestamp "+u+", offset = "+_+", dataSize = "+s);break}var p=o.getUint32(_);if(3===d&&(p>>>=8),p>s-d)return void a.b.v("flv-demuxer","Malformed Nalus near timestamp "+u+", NaluSize > DataSize!");var v=new Uint8Array(n,O.d+_+4,d+p-4),g=0;if(7===e.codecId){if((g=31&o.getUint8(_+d))===L.H264_NAL_IDR_SLICE)h=!0;else if(g===L.PRIV_NAL_MAGIC_H264)try{t=m.parse(v,!0)}catch(e){a.b.w("flv-demuxer","PrivNal parse error "+e)}}else if(12===e.codecId)if((g=(126&o.getUint8(_+d))>>1)===F.a.HEVC_NAL_IDR_W_RADL||g===F.a.HEVC_NAL_IDR_N_LP||g===F.a.HEVC_NAL_CRA_NUT)h=!0;else if(g===F.a.PRIV_NAL_MAGIC_HEVC)try{t=m.parse(v,!1)}catch(e){a.b.w("flv-demuxer","PrivNal parse error "+e)}var y={type:g,data:v};c.push(y),v.byteLength,_+=d+p}if(c.length){var E={units:c,dts:this._toTrackTime(u,i),cts:this._toTrackTime(e.cts,i),pts:this._toTrackTime(l,i),streamDTS:this._toTrackTime(e.timestamp,i),key:h,extra:{ptsMs:0,dtsOrignMs:u,ptsOrignMs:u+e.cts,parseMs:performance?performance.now():0}};E.key&&this._eventEmitter.emit(r.a.KEY_FRAME),i.samples.push(E)}return this._vLastDTS=u,t}},t._parseAudioData=function(e){if(e.body)if(e.body.byteLength<=1)a.b.v("flv-demuxer","Flv: Invalid audio packet, missing SoundData payload!");else{var t=this._audioTrack,i=e.body[0]>>4;if(10===i)t.codecType=f.b.aac;else{if(2!==i&&14!==i)return a.b.w("flv-demuxer","audio unsupported codec "+i),void(t.active=!1);t.codecType=f.b.mp3}if(t.codecType===f.b.aac){var n=e.body[1];if(0===n){var r;if(e.body.byteLength<4)return;var s=e.body.subarray(2,4);return(g.f(t,s)||!t.configParsed)&&t.codec&&t.samples.length&&this._discontinuity(),g.c(t,this._eventEmitter,s,p.a.ASC,null==(r=this._transmuxData)?void 0:r.audioCodec),void(t.duration=this._duration)}if(1!==n||!t.samplerate)return void a.b.v("flv-demuxer","Flv: Unsupported AAC data type "+n)}var o=t.codecType===f.b.aac?2:1,c=e.timestamp;t.sampleDuration&&"number"==typeof this._aLastDTS&&this._videoTrack.active&&this._checkTimestamp(f.l.AUDIO,this._aLastDTS,e.timestamp);var _,d=this._toTrackTime(e.timestamp,t);if(t.codecType===f.b.aac)_={unit:e.body.subarray(2),dts:d,pts:d,streamDTS:d},t.samples.push(_);else if(t.codecType===f.b.mp3){var u;_=null==(u=R(t,e.body,o,d,0))?void 0:u.sample}_&&(_.extra={ptsMs:0,dtsOrignMs:c,ptsOrignMs:c,parseMs:self.performance?performance.now():0},_.streamDTS=d),this._aLastDTS=c,t.samples.length&&_&&(_.dts-t.samples[0].dts)/t.inputTimescale>60&&(a.b.i("flv-demuxer","audio demux sec > 60. remux now"),this._remux(!0))}},t._remux=function(e){void 0===e&&(e=!1);var t,i=this._audioTrack,s=this._videoTrack;s.outputRaw&&!i.active&&(this._slientAudio||(y.a.initAudioForFillSilent(i,null==(t=this._transmuxData)?void 0:t.audioCodec),this._slientAudio=new D.a),this._slientAudio.update(i,s));if(0!==i.samples.length||0!==s.samples.length)if(e||!(this._audioTrack.active&&0===i.samples.length||s.active&&s.samples.length<2)){var o=!0,c=0,_=!1;this._remuxStat&&(o=this._remuxStat.contiguous,c=this._remuxStat.timeOffset,_=this._remuxStat.accurateTimeOffset),this._firstRemux&&(this._firstRemux=!1,this._eventEmitter.emit(r.a.MEDIA_DEMUX,{type:p.b.FLV}));try{this._remuxer.remux(i,s,c,o,_,e),this._remuxStat=void 0}catch(e){a.b.e("flv-demuxer",e),this._onError({type:n.b.MUX_ERROR,details:n.a.REMUX_ERROR,fatal:!0,reason:e.message})}}else(i.configParsed&&this._getTrackDuration(i)>30||s.codec&&this._getTrackDuration(s)>30)&&this._remux(!0);else e&&this._remuxer.flush()},t._getTrackDuration=function(e){return e.samples.length?(e.samples[e.samples.length-1].pts-e.samples[0].pts)/e.inputTimescale:0},t._toTrackTime=function(e,t){return e/h.e*t.inputTimescale},l()(e,null,[{key:"probeSize",get:function(){return 188}}]),e}(),me=i(25),ve=i(31),ge=function(){function e(e,t,i,n){var a=this;this._eventEmitter=void 0,this._remuxer=void 0,this._config=void 0,this._typeSupported=void 0,this._cache=void 0,this._videoTrack=void 0,this._audioTrack=void 0,this._parseLen=0,this._parseFunc=void 0,this._pts=0,this._firstRemux=!0,this._remuxStat=void 0,this._vFrameIdx=0,this._timescale=0,this._av1Ctx=void 0,this._onError=function(e){a._eventEmitter.emit(r.a.ERROR,e)},this._eventEmitter=e,this._remuxer=t,this._config=i,this._typeSupported=n,this._cache=new N.a,this._parseFunc=this._parseStart,this._parseLen=8}e.probe=function(e){return e.length>4&&68===e[0]&&75===e[1]&&73===e[2]&&70===e[3]};var t=e.prototype;return t.resetInitSegment=function(e,t){this._initTrack(e.duration),this._pts=0,this._firstRemux=!0,this._remuxStat=void 0,this._parseFunc=this._parseStart,this._parseLen=8,this._cache.clear()},t.resetTimeStamp=function(e){},t.append=function(e,t,i,n,r){for(this._remuxStat||(this._remuxStat={timeOffset:t,contiguous:i,accurateTimeOffset:n}),this._cache.put(e);this._cache.unreadLen>=this._parseLen;)this._parseFunc();this._remux(r)},t.flush=function(){this._remux(!0),this._remuxStat=void 0},t.destroy=function(){this._cache.clear()},t._initTrack=function(e){this._videoTrack=Object(I.b)(e),this._videoTrack.active=!0,this._audioTrack=Object(I.a)(e),this._audioTrack.active=!1},t._parseStart=function(){if(!(this._cache.unreadLen<8)){var t=this._cache.get(8);if(t)if(e.probe(t)){var i=Object(v.d)(t,6,!0);this._parseLen=i-8,this._parseFunc=this._parseHead}else this._onError({type:n.b.MUX_ERROR,details:n.a.REMUX_ERROR,fatal:!0,reason:"ivf start code error"})}},t._parseHead=function(){if(!(this._cache.unreadLen<this._parseLen)){var e=this._cache.get(this._parseLen),t=this._videoTrack;if(e&&t){var i=Object(v.a)(e,0,4);if("AV01"===i){t.codecType=f.b.av1,t.width=Object(v.d)(e,4,!0),t.height=Object(v.d)(e,6,!0);var s=Object(v.f)(e,8,!0),o=Object(v.f)(e,12,!0),c=Object(v.f)(e,16,!0);this._timescale=o/s,t.duration=c*this._timescale,a.b.i("ivf-demuxer","head. w: "+t.width+", h:"+t.height+", den:"+s+", num:"+o+", duration:"+t.duration),s&&o||this._onError({type:n.b.MUX_ERROR,details:n.a.REMUX_ERROR,fatal:!0,reason:"ivf head den: "+s+", num: "+o});var _={duration:t.duration,keyframes:[{time:0,position:this._parseLen}]};this._eventEmitter.emit(r.a.METADATA,_),this._parseFunc=this._parseFrameHead,this._parseLen=12}else this._onError({type:n.b.MUX_ERROR,details:n.a.UNSUPPORTED,fatal:!0,reason:"ivf "+i+" unsupported"})}}},t._parseFrameHead=function(){if(!(this._cache.unreadLen<this._parseLen)){var e=this._cache.get(this._parseLen);if(e){var t=Object(v.f)(e,0,!0);this._pts=Object(v.g)(e,4,!0)*this._timescale*h.d,this._parseFunc=this._parseFrame,this._parseLen=t}}},t._parseFrame=function(){var e=this;if(!(this._cache.unreadLen<this._parseLen)){var t=this._cache.get(this._parseLen),i=this._videoTrack;if(t&&i){var n=[],a=!1;if(this._av1Ctx||(this._av1Ctx=$.createCtx()),$.parseOBU(t,this._av1Ctx).forEach((function(t){var r;t.obu_type===V.AV1_OBU_SEQUENCE_HEADER&&e._av1Ctx&&e._av1Ctx.sh&&(fe.onAV1Detected(i,e._config,e._typeSupported),fe.updateAV1Track(i,e._av1Ctx.sh)),a=a||!(null==(r=t.content)||!r.keyframe),n.push({type:0,data:t.data})})),n.length){var s={units:n,dts:this._pts,cts:0,pts:this._pts,streamDTS:this._pts,key:a};s.key&&this._eventEmitter.emit(r.a.KEY_FRAME),i.samples.push(s)}this._parseFunc=this._parseFrameHead,this._parseLen=12}}},t._remux=function(e){void 0===e&&(e=!1);var t=this._audioTrack,i=this._videoTrack;if(i&&t)if(0!==t.samples.length||0!==i.samples.length){if(e||!(t.active&&0===t.samples.length||i.active&&i.samples.length<2)){this._firstRemux&&(this._eventEmitter.emit(r.a.KEY_FRAME_INDEXS,{keyframes:[{time:0,position:0}]}),this._firstRemux=!1,this._eventEmitter.emit(r.a.MEDIA_DEMUX,{type:p.b.IVF}));var s=Object(ve.a)(i,this._vFrameIdx);this._vFrameIdx+=s.length,this._eventEmitter.emit(r.a.VIDEO_FRAME_INFO,{videoFramesInfo:s});var o=!0,c=0,_=!1;this._remuxStat&&(o=this._remuxStat.contiguous,c=this._remuxStat.timeOffset,_=this._remuxStat.accurateTimeOffset);try{this._remuxer.remux(t,i,c,o,_,e),this._remuxStat=void 0}catch(e){a.b.e("ivf-demuxer",e),this._onError({type:n.b.MUX_ERROR,details:n.a.REMUX_ERROR,fatal:!0,reason:e.message})}}}else e&&this._remuxer.flush()},t._checkFps=function(e){(!e.fps||e.fps>h.f)&&(e.fps=h.b)},l()(e,null,[{key:"probeSize",get:function(){return 8}}]),e}(),ye=i(9),Ee=i(7),be=i.n(Ee),Ae=i(38),Te=function(){function e(){}return e.parseOneDescriptor=function(t){var i,n,r=0;for(i=t.data[t.pos],n=t.data[t.pos+1],t.pos+=2;128&n;)r=(127&n)<<7,n=t.data[t.pos],t.pos++;r+=127&n;var a=t.data.subarray(t.pos,t.pos+r);return 3===i?e._parseESDesc(t):4===i?e._parseDecoderConfigDescriptor(t):(t.pos+=r,{tag:i,data:a})},e.getAudioConfig=function(t){if(5===t.tag)return t.data;if(t.descs&&t.descs.length)for(var i=0;i<t.descs.length;i++){var n=e.getAudioConfig(t.descs[i]);if(n)return n}},e.getObjectTypeIndication=function(e){if(e.descs&&e.descs.length)for(var t=0;t<e.descs.length;t++)if(4===e.descs[t].tag)return e.descs[t].oti;return-1},e._parseESDesc=function(t){var i=Object(v.d)(t.data,t.pos);t.pos+=2;var n=t.data[t.pos];t.pos++;var r=0;128&n&&(r=Object(v.d)(t.data,t.pos),t.pos+=2);var a="";if(64&n){var s=t.data[t.pos];a=Object(v.a)(t.data,t.pos+1,s),t.pos+=s+1}var o=0;32&n&&(o=Object(v.d)(t.data,t.pos),t.pos+=2);var c={tag:3,data:t.data,id:i,dependsOnESID:r,url:a,ocrESID:o};return t.pos<t.data.byteLength&&(c.descs=e._parseRemainingDescriptors(t)),c},e._parseDecoderConfigDescriptor=function(t){var i={tag:4,data:t.data,oti:t.data[t.pos],streamType:t.data[t.pos+1],bufferSize:Object(v.e)(t.data,t.pos+2),maxBitrate:Object(v.f)(t.data,t.pos+5),avgBitrate:Object(v.f)(t.data,t.pos+9)};return t.pos+=13,t.data.byteLength>13&&(i.descs=e._parseRemainingDescriptors(t)),i},e._parseRemainingDescriptors=function(t){for(var i=[];t.pos<t.data.byteLength;){var n=e.parseOneDescriptor(t);i.push(n)}return i},e}();function Se(e){return e/65536}function Re(){for(var e=0,t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];for(var r=i.length,a=0;a<r;a++){if(i[a]===1/0||i[a]===-1/0)return 1/0;e+=i[a]*i[a]}return Math.sqrt(e)}!function(e){e[e.SIZE=0]="SIZE",e[e.NAME=1]="NAME",e[e.BIG_SIZE=2]="BIG_SIZE",e[e.DATA=3]="DATA"}(ie||(ie={}));var xe,Le,Ce,De,Ie=function(){function e(){}return e.findBox=function(t,i){var n,r,a,s,o=[];if(!i.length)return o;for(var c=0;0<t.byteLength;)n=Object(v.f)(t,0),r=Object(v.a)(t.subarray(4,8),4),c=8,1===n&&(n=Object(v.g)(t,8),c=16),s=0+n,r===i[0]&&(1===i.length?o.push(t.subarray(0+c,s)):(a=e.findBox(t.subarray(0+c,s),i.slice(1))).length&&(o=o.concat(a)));return o},e.readBoxes=function(e){for(var t=0,i=ie.SIZE,n={size:0,headSize:8,name:""},r=[];t<e.byteLength;)switch(i){case ie.SIZE:n.size=Object(v.f)(e,t),t+=4,i=ie.NAME;break;case ie.NAME:n.name=Object(v.a)(e,t,4),t+=4,i=1===n.size?ie.BIG_SIZE:ie.DATA;break;case ie.BIG_SIZE:n.size=Object(v.g)(e,t),n.headSize=16,t+=8,i=ie.DATA;break;case ie.DATA:n.data=e.subarray(t,t+n.size-n.headSize),t+=n.data.byteLength,i=ie.SIZE,r.push(n),n={size:0,headSize:8,name:""}}return r},e.readBox=function(e,t){void 0===t&&(t=0);for(var i=t,n=ie.SIZE,r={size:0,headSize:8,name:""};i<e.byteLength&&!r.data;)switch(n){case ie.SIZE:r.size=Object(v.f)(e,i),i+=4,n=ie.NAME;break;case ie.NAME:r.name=Object(v.a)(e,i,4),i+=4,n=1===r.size?ie.BIG_SIZE:ie.DATA;break;case ie.BIG_SIZE:r.size=Object(v.g)(e,i),r.headSize=16,i+=8,n=ie.DATA;break;case ie.DATA:if(!(e.byteLength-i>=r.size-r.headSize)){i=e.byteLength;break}r.data=e.subarray(i,i+r.size-r.headSize),i+=r.data.byteLength,n=ie.SIZE}if(r.size)return r},e.ftyp=function(e){var t=e.data;if(t)return{major_brand:Object(v.a)(t,0,4),minor_version:Object(v.f)(t,4),compatible_brands:Object(v.a)(t,8,t.byteLength-8)}},e.moov=function(t){var i={trak:[],mvex:[],pssh:[]};return t.data&&e.readBoxes(t.data).forEach((function(t){t.data&&("mvhd"===t.name?i.mvhd=e._mvhd(t.data):"trak"===t.name?i.trak.push(e._trak(t.data)):"mvex"===t.name?i.mvex.push(e._mvex(t.data)):"pssh"===t.name&&i.pssh.push(t))})),i},e.moof=function(t){var i={};return t.data&&e.readBoxes(t.data).forEach((function(t){if(t.data&&"traf"===t.name){var n=e._traf(t.data);i.traf?i.traf.push(n):i.traf=[n]}})),i},e.esds=function(e){if(e.data)return Te.parseOneDescriptor({data:e.data,pos:4})},e.sidx=function(e){var t=e.data;if(t){var i={referenceID:0,timescale:0,earliestPresentationTime:0,firstOffset:0,referenceCount:0,references:[]},n=t[0],r=4;i.referenceID=Object(v.c)(t,r),i.timescale=Object(v.f)(t,r+4),r+=8,0===n?(i.earliestPresentationTime=Object(v.f)(t,r),i.firstOffset=Object(v.f)(t,r+4),r+=8):(i.earliestPresentationTime=Object(v.g)(t,r),i.firstOffset=Object(v.g)(t,r+8),r+=16),i.referenceCount=Object(v.d)(t,r+2),r+=4;for(var a=0;a<i.referenceCount;a++){t[r];var s=2147483647&Object(v.f)(t,r);r+=4;var o=Object(v.f)(t,r);r+=4,i.references.push({size:s,duration:o/i.timescale}),r+=4}return i}},e.btrt=function(e){var t=e.data;if(t)return{bufferSizeDB:Object(v.f)(t,0),maxBitrate:Object(v.f)(t,4),avgBitrate:Object(v.f)(t,8)}},e._traf=function(t){var i={};return e.readBoxes(t).forEach((function(t){if(t.data)if("tfhd"===t.name)i.tfhd=e._tfhd(t.data);else if("tfdt"===t.name)i.tfdt=e._tfdt(t.data);else if("trun"===t.name){var n=e._trun(t.data);i.trun?i.trun.push(n):i.trun=[n]}else"saiz"===t.name?i.saiz=e._saiz(t.data):"saio"===t.name?i.saio=e._saio(t.data):"senc"===t.name&&(i.senc=e._senc(t.data))})),i},e._tfhd=function(e){var t={trackID:Object(v.f)(e,4),baseDataOffset:0,sampleDescriptionIndex:0,defaultSampleDuration:0,defaultSampleSize:0,defaultSampleFlags:0},i=Object(v.e)(e,1),n=8;return n<e.byteLength-8&&1&i?(t.baseDataOffset=Object(v.g)(e,n),n+=8):t.baseDataOffset=0,n<e.byteLength-4&&2&i?(t.sampleDescriptionIndex=Object(v.f)(e,n),n+=4):t.sampleDescriptionIndex=0,n<e.byteLength-4&&8&i?(t.defaultSampleDuration=Object(v.f)(e,n),n+=4):t.defaultSampleDuration=0,n<e.byteLength-4&&16&i?(t.defaultSampleSize=Object(v.f)(e,n),n+=4):t.defaultSampleSize=0,n<e.byteLength-4&&32&i?(t.defaultSampleFlags=Object(v.f)(e,n),n+=4):t.defaultSampleFlags=0,t},e._tfdt=function(e){return{baseMediaDecodeTime:1===e[0]?Object(v.g)(e,4):Object(v.f)(e,4)}},e._trun=function(e){var t=e[0],i=Object(v.e)(e,1),n={sampleCount:0,dataOffset:0,firstSampleFlags:0,sampleDuration:[],sampleSize:[],sampleFlags:[],sampleCompositionTimeOffset:[]},r=4;if(n.sampleCount=Object(v.f)(e,r),(r+=4)<e.byteLength-4&&1&i?(n.dataOffset=Object(v.c)(e,r),r+=4):n.dataOffset=0,r<e.byteLength-4&&4&i?(n.firstSampleFlags=Object(v.f)(e,r),r+=4):n.firstSampleFlags=0,r<=e.byteLength-4)for(var a=0;a<n.sampleCount;a++)256&i&&(n.sampleDuration[a]=Object(v.f)(e,r),r+=4),512&i&&(n.sampleSize[a]=Object(v.f)(e,r),r+=4),1024&i&&(n.sampleFlags[a]=Object(v.f)(e,r),r+=4),2048&i&&(n.sampleCompositionTimeOffset[a]=0===t?Object(v.f)(e,r):Object(v.c)(e,r),r+=4);return n},e._saiz=function(e){var t=e[0],i=Object(v.e)(e,1),n={defaultSampleInfoSize:0,sampleCount:0,sampleInfoSize:[]};if(0===t){var r=4;if(1&i&&(r+=8),n.defaultSampleInfoSize=e[r],n.sampleCount=Object(v.f)(e,r+1),r+=5,0===n.defaultSampleInfoSize)for(var a=0;a<n.sampleCount;a++)n.sampleInfoSize[a]=e[r],r++}return n},e._saio=function(e){var t=e[0],i={entryCount:0,offset:[]},n=4;1&Object(v.e)(e,1)&&(n+=8),i.entryCount=Object(v.f)(e,n),n+=4;for(var r=0;r<i.entryCount;r++)0===t?(i.offset[r]=Object(v.f)(e,n),n+=4):(i.offset[r]=Object(v.g)(e,n),n+=8);return i},e._senc=function(e,t){void 0===t&&(t=0),e[0];var i={sampleCount:0,useSubSampleEnc:!!(2&Object(v.e)(e,1)),encItemData:[]},n=4;return i.sampleCount=Object(v.f)(e,n),n+=4,t&&(i.iv=e.subarray(n,8*t),n+=t),i.encData=e.subarray(n),i},e._mvhd=function(e){var t=e[0],i=0,n=0;return 1===t?(i=Object(v.f)(e,20),n=Object(v.g)(e,24)):0===t&&(i=Object(v.f)(e,12),n=Object(v.f)(e,16)),{timescale:i,duration:n}},e._mvex=function(t){var i={};return e.readBoxes(t).forEach((function(t){t.data&&("mehd"===t.name?i.mehd=e._mehd(t.data):"trex"===t.name&&(i.trex=e._trex(t.data)))})),i},e._mehd=function(e){return{fragmentDuration:1===e[0]?Object(v.g)(e,4):Object(v.f)(e,4)}},e._trex=function(e){return{trackID:Object(v.f)(e,4),sampleDescriptionIndex:Object(v.f)(e,8),defaultSampleDuration:Object(v.f)(e,12),defaultSampleSize:Object(v.f)(e,16),defaultSampleFlags:Object(v.f)(e,20)}},e._trak=function(t){var i={};return e.readBoxes(t).forEach((function(t){t.data&&("tkhd"===t.name?i.tkhd=e._tkhd(t.data):"tref"===t.name?i.tref=e._tref(t.data):"mdia"===t.name&&(i.mdia=e._mdia(t.data)))})),i},e._tkhd=function(e){var t=0,i=0,n=4;1===e[0]?(t=Object(v.f)(e,n+16),i=Object(v.g)(e,n+24),n+=32):(t=Object(v.f)(e,n+8),i=Object(v.f)(e,n+16),n+=20),n+=16;for(var r=[],a=0;a<9;a++)r.push(Object(v.c)(e,n)),n+=4;return{width:Object(v.f)(e,n)>>16,height:Object(v.f)(e,n+4)>>16,trackId:t,duration:i,matrix:r}},e._tref=function(e){return{referenceType:Object(v.a)(e,4,4),trackId:Object(v.f)(e,8)}},e._mdia=function(t){var i={};return e.readBoxes(t).forEach((function(t){t.data&&("minf"===t.name?i.minf=e._minf(t.data):"hdlr"===t.name?i.hdlr=e._hdlr(t.data):"mdhd"===t.name&&(i.mdhd=e._mdhd(t.data)))})),i},e._hdlr=function(e){var t={};return 0===e[0]&&(t.type=Object(v.a)(e,8,4)),t},e._minf=function(t){var i={};return e.readBoxes(t).forEach((function(t){t.data&&("dinf"===t.name?e._dinf(t.data):"stbl"===t.name&&(i.stbl=e._stbl(t.data)))})),i},e._dinf=function(t){e.readBoxes(t).forEach((function(t){t.data&&"dref"===t.name&&e._dref(t.data)}))},e._dref=function(e){e[0];for(var t=Object(v.f)(e,4),i=0;i<t&&8<e.byteLength;i++);},e._stbl=function(t){var i={};return e.readBoxes(t).forEach((function(t){t.data&&("stsd"===t.name?i.stsd=e._stsd(t.data):"stts"===t.name?i.stts=e._stts(t.data):"stsc"===t.name?i.stsc=e._stsc(t.data):"stco"===t.name?i.stco=e._stco(t.data):"co64"===t.name?i.stco=e._co64(t.data):"stsz"===t.name?i.stsz=e._stsz(t.data):"stz2"===t.name?i.stsz=e._stz2(t.data):"stss"===t.name?i.stss=e._stss(t.data):"ctts"===t.name?i.ctts=e._ctts(t.data):"sgpd"===t.name?i.sgpd=e._sgpd(t.data):"stdp"===t.name?i.stdp=e._stdp(t.data):"sdtp"===t.name?i.sdtp=e._sdtp(t.data):"sbgp"===t.name?i.sbgp=e._sbgp(t.data):"subs"===t.name?i.subs=e._subs(t.data):"saiz"===t.name?i.saiz=e._saiz(t.data):"saio"===t.name?i.saio=e._saio(t.data):"senc"===t.name&&(i.senc=e._senc(t.data)))})),i},e._subs=function(e){var t=e[0],i={entries:[]},n=4,r=Object(v.f)(e,n);n+=4;for(var a=0;a<r;a++){var s={sampleDelta:Object(v.f)(e,n),subSamples:[]};i.entries.push(s);var o=Object(v.d)(e,n+4);n+=6;for(var c=0;c<o;c++){1===t?(Object(v.f)(e,n),n+=4):(Object(v.d)(e,n),n+=2);var _={priority:e[n],discardable:e[n+1],codecSpecificParameters:Object(v.f)(e,n+2)};s.subSamples.push(_),n+=6}}return i},e._sbgp=function(e){var t=e[0],i=4,n={groupingType:Object(v.a)(e,i,4),entries:[]};i+=4,1===t&&(Object(v.f)(e,i),i+=4);var r=Object(v.f)(e,i);i+=4;for(var a=0;a<r;a++)n.entries.push({sampleCount:Object(v.c)(e,i),groupDescriptionIndex:Object(v.c)(e,i+4)}),i+=8;return n},e._sdtp=function(e){for(var t={entries:[]},i=4;i<e.byteLength;)t.entries.push({sampleDependsOn:e[i]>>4&3,sampleIsDependedOn:e[i]>>2&3,sampleHasRedundancy:3&e[i]}),i++;return t},e._stdp=function(e){for(var t={priority:[]},i=4;i<e.length;)t.priority.push(Object(v.d)(e,i)),i+=2;return t},e._sgpd=function(e){var t=e[0],i={type:Object(v.a)(e,4,4),entries:[]},n=0,r=8;1===t&&(n=Object(v.f)(e,r),r+=4),2===t&&(Object(v.f)(e,r),r+=4);var a=Object(v.f)(e,r);r+=4;for(var s=0;s<a;s++){var o=0;1===t&&0===n?(o=Object(v.f)(e,r),r+=4):o=n;var c={descriptionLength:o,data:e.subarray(r,r+o)};r+=o,i.entries.push(c)}return i},e._stsd=function(t){return t[0],Object(v.f)(t,4),{sampleEntrys:e.readBoxes(t.subarray(8,t.byteLength)),boxData:t}},e._stts=function(e){for(var t=Object(v.f)(e,4),i=8,n=[],r=0;r<t;r++)n.push({sampleCount:Object(v.f)(e,i),sampleDelta:Object(v.f)(e,i+4)}),i+=8;return{timeToSample:n}},e._stsc=function(e){e[0];for(var t=Object(v.f)(e,4),i=8,n=[],r=0;r<t;r++)n.push({firstChunk:Object(v.f)(e,i),samplesPerChunk:Object(v.f)(e,i+4),sampleDescriptionIndex:Object(v.f)(e,i+8)}),i+=12;return{sampleToChunkBox:n}},e._stco=function(e){for(var t=Object(v.f)(e,4),i=8,n=[],r=0;r<t;r++)n.push(Object(v.f)(e,i)),i+=4;return{chunkOffset:n}},e._co64=function(e){for(var t=Object(v.f)(e,4),i=8,n=[],r=0;r<t;r++)n.push(Object(v.g)(e,i)),i+=8;return{chunkOffset:n}},e._stsz=function(e){var t=Object(v.f)(e,4),i=Object(v.f)(e,8),n=12;if(0===t){t=[];for(var r=0;r<i;r++)t.push(Object(v.f)(e,n)),n+=4}return{sampleCount:i,SampleSize:t}},e._stz2=function(e){for(var t=e[7],i=[],n=Object(v.f)(e,8),r=12,a=0;a<n;a++)4===t?(i.push(e[r]>>4),++a<n&&i.push(15&e[r]),r+=1):8===t?(i.push(e[r]),r+=1):16===t&&(i.push(Object(v.d)(e,r)),r+=2);return{sampleCount:n,SampleSize:i}},e._stss=function(e){for(var t=Object(v.f)(e,4),i=8,n=[],r=0;r<t;r++)n.push(Object(v.f)(e,i)),i+=4;return{sampleNumber:n}},e._ctts=function(e){for(var t=e[0],i=Object(v.f)(e,4),n=8,r=[],a=0;a<i;a++)r.push({sampleCount:Object(v.f)(e,n),sampleOffset:0===t?Object(v.f)(e,n+4):Object(v.c)(e,n+4)}),n+=8;return{compositionOffset:r}},e._mdhd=function(e){var t=0,i=0;return 1===e[0]?(t=Object(v.f)(e,20),i=Object(v.g)(e,24)):(t=Object(v.f)(e,12),i=Object(v.f)(e,16)),{timescale:t,duration:i}},e}(),we=[64,102,103,104,105,107],ke=[64,102,103,104],Oe=function(){function e(e,t,i,n){var a=this;this._eventEmitter=void 0,this._remuxer=void 0,this._config=void 0,this._duration=1/0,this._naluLengthSize=4,this._videoTrack=void 0,this._audioTrack=void 0,this._slientAudio=void 0,this._remuxStat=void 0,this._firstRemux=!0,this._typeSupported=void 0,this._transmuxData=void 0,this._gopRemux=!1,this._cache=void 0,this._ftyp=void 0,this._moov=void 0,this._vSampleIndex=0,this._aSampleIndex=0,this._offset=0,this._vSampleInfoList=void 0,this._aSampleInfoList=void 0,this._nextSampleInfo=void 0,this._readingBox=void 0,this._isFMP4=!1,this._readingBoxWaiting=8,this._fragmentEndOffset=0,this._readSamples=!0,this._pssh=void 0,this._vLastDTS=0,this._aLastDTS=0,this._av1Ctx=void 0,this._onError=function(e){a._eventEmitter.emit(r.a.ERROR,e)},this._eventEmitter=e,this._remuxer=t,this._config=i,this._typeSupported=n,this._gopRemux=!!this._config.gopRemux,this._videoTrack=Object(I.b)(1/0),this._audioTrack=Object(I.a)(1/0),this._cache=new N.a}e.probe=function(e){var t=Object(v.a)(e,4,4);return!("styp"!==t&&"ftyp"!==t)};var t=e.prototype;return t.append=function(e,t,i,s,o){if(void 0===o&&(o=!1),this._readSamples){this._cache.put(e),this._remuxStat||(this._remuxStat={timeOffset:t,contiguous:i,accurateTimeOffset:s}),this._isFMP4&&this._isCurretFragmentEnd()&&this._nextFragment();do{if(this._readBox(),!this._moov||!this._readSamples)return;for(i||(this._isFMP4||this._seek(t),i=!0);this._cache.unreadLen&&this._hasMoreSamples();){if(!this._nextSampleInfo){var c=this._getNextSampleInfo();if("notReady"===c)return void a.b.i("mp4-demuxer","sample not ready");this._nextSampleInfo=c}if(!this._nextSampleInfo)return void this._onError({type:n.b.MUX_ERROR,details:n.a.REMUX_ERROR,fatal:!0,reason:"can not find next sample"});if(this._offset){var _=this._nextSampleInfo.start-this._offset;if(this._cache.unreadLen<_)return;this._cache.skip(this._nextSampleInfo.start-this._offset)}if(this._offset=this._nextSampleInfo.start,!(this._nextSampleInfo&&this._nextSampleInfo.end-this._nextSampleInfo.start<=this._cache.unreadLen))break;var d=this._cache.get(this._nextSampleInfo.end-this._nextSampleInfo.start);if(!d)return;this._offset+=d.byteLength,this._nextSampleInfo.type===f.l.VIDEO?(this._videoTrack.active&&this._parseVideoSample(this._nextSampleInfo,d),this._vSampleIndex++):(this._audioTrack.active&&this._parseAudioSample(this._nextSampleInfo,d),this._aSampleIndex++),this._nextSampleInfo=void 0}this._isCurretFragmentEnd()&&this._nextFragment()}while(this._isFMP4&&this._readNextBox());this._remux(o&&!this._hasMoreSamples()),o&&this._eventEmitter.emit(r.a.PARSED_DATA,{extra:this._transmuxData})}},t._readBox=function(){for(;this._readNextBox();){if(!this._readingBox){var e=this._cache.get(8);if(!e)return;var t=Object(v.f)(e);this._readingBox={size:t,name:Object(v.a)(e,4,4),headSize:t>1?8:16},this._offset+=8}if(1===this._readingBox.size){if(!(this._cache.unreadLen>=8))return void(this._readingBoxWaiting=8);var i=this._cache.get(8);if(!i)return;var n=Object(v.g)(i);this._readingBox.size=n,this._offset+=8}var a=this._readingBox.size-this._readingBox.headSize;if("mdat"===this._readingBox.name){if(!this._moov)return this._readingBox=void 0,this._readSamples=!1,void this._eventEmitter.emit(r.a.MP4_NOT_FASTSTART,{pos:this._offset+a});if(this._isFMP4){this._updateSampleListDataOffset(this._offset),this._readingBoxWaiting=0,this._fragmentEndOffset=this._offset+a;break}if(!this._isFMP4){this._readingBox=void 0,this._readingBoxWaiting=0;break}}if(this._cache.unreadLen>=a){var s=this._cache.get(a);if(this._readingBox.data=s,this._offset+=a,"moov"===this._readingBox.name){if(this._parseMOOV(this._readingBox),this._vSampleInfoList&&this._vSampleInfoList.samples.length||this._aSampleInfoList&&this._aSampleInfoList.samples.length){this._readingBoxWaiting=0,this._readingBox=void 0;break}this._readingBox=void 0}else"moof"===this._readingBox.name?(this._isFMP4=!0,this._parseMOOF(this._readingBox,this._offset),this._readingBox=void 0):"sidx"===this._readingBox.name?(this._parseSIDX(this._readingBox,this._offset),this._readingBox=void 0):"ftyp"===this._readingBox.name?(this._ftyp=Ie.ftyp(this._readingBox),this._readingBox=void 0):this._readingBox=void 0}else this._readingBoxWaiting=a}},t._updateSampleListDataOffset=function(e){var t,i,n=this._aSampleIndex,r=this._vSampleIndex,a=null==(t=this._aSampleInfoList)?void 0:t.samples,s=null==(i=this._vSampleInfoList)?void 0:i.samples,o=a&&a[n],c=s&&s[r];if(o&&c)for(var _=e,d=a[n],u=s[r];d||u;){var l=d?d.noOffset?d.start+_:d.start:Number.MAX_SAFE_INTEGER,h=u?u.noOffset?u.start+_:u.start:Number.MAX_SAFE_INTEGER,f=void 0;if(l===h?d&&d.noOffset?(f=u,r++):(f=d,n++):l<h?(f=d,n++):(f=u,r++),f){if(f.noOffset){f.noOffset=void 0;var p=f.end-f.start;f.start=Math.min(l,h),f.end=f.start+p}_=f.end}d=a[n],u=s[r]}else if(o||c){var m=o?a:s;if(!m)return;for(var v=m.length-1;v>=0;v--)if(m[v]&&m[v].noOffset){m[v].noOffset=void 0,m[v].start+=e,m[v].end+=e;break}}},t._readNextBox=function(){return!!(this._readingBoxWaiting&&this._cache.unreadLen>=this._readingBoxWaiting)},t._isCurretFragmentEnd=function(){return!!(this._isFMP4&&this._fragmentEndOffset&&!this._hasMoreSamples()&&this._fragmentEndOffset<=this._offset+this._cache.unreadLen)},t._nextFragment=function(){this._isCurretFragmentEnd()&&(this._cache.skip(this._fragmentEndOffset-this._offset),this._offset=this._fragmentEndOffset,this._readingBox=void 0,this._readingBoxWaiting=8,this._fragmentEndOffset=0)},t.destroy=function(){},t.flush=function(){this._remux(!0),this._remuxStat=void 0},t.resetInitSegment=function(e,t){this._transmuxData=e,this._readSamples=!0,this._firstRemux=!0,this._videoTrack.samples=[],this._audioTrack.samples=[],this._aLastDTS=this._vLastDTS=0,this._remuxStat=void 0,"boolean"==typeof e.hasAudio&&"boolean"==typeof e.hasVideo&&(this._audioTrack.active=e.hasAudio,this._videoTrack.active=e.hasVideo,this._videoTrack.active||(this._gopRemux=!1)),this._cache.clear(),t&&this._cache.put(t),this._vSampleIndex=0,this._aSampleIndex=0,this._offset=0,this._nextSampleInfo=void 0,this._slientAudio&&this._slientAudio.reset(),this._isFMP4&&(this._vSampleInfoList&&(this._vSampleInfoList.samples=[],this._vSampleInfoList.endPTS=0),this._aSampleInfoList&&(this._aSampleInfoList.samples=[],this._aSampleInfoList.endPTS=0),this._readingBoxWaiting=8,this._readingBox=void 0),a.b.i("mp4-demuxer","reset init")},t.resetTimeStamp=function(){},t._parseVideoSample=function(e,t){var i=0,n=[],a=!1,s=this._videoTrack;if(s.codecType===f.b.av1)this._av1Ctx||(this._av1Ctx=$.createCtx()),$.parseOBU(t,this._av1Ctx).forEach((function(e){var t;a=a||!(null==(t=e.content)||!t.keyframe),n.push({type:0,data:e.data})}));else for(;i<t.byteLength;){var o=Object(v.f)(t,i);i+=4;var c=t.subarray(i,i+o);3===this._naluLengthSize&&(o>>>=8);var _=0;s.codecType===f.b.h264?(_=31&c[0])===L.H264_NAL_IDR_SLICE?a=!0:L.PRIV_NAL_MAGIC_H264:s.codecType!==f.b.hevc&&s.codecType!==f.b.kvc3&&s.codecType!==f.b.kvc4&&s.codecType!==f.b.kvc5||((_=(126&c[0])>>1)===F.a.HEVC_NAL_IDR_W_RADL||_===F.a.HEVC_NAL_IDR_N_LP?a=!0:F.a.PRIV_NAL_MAGIC_HEVC),n.push({type:_,data:c}),i+=o}if(n.length){var d={units:n,dts:e.dts,cts:e.cts,pts:e.pts,streamDTS:e.dts,key:a,duration:e.duration};d.key&&this._eventEmitter.emit(r.a.KEY_FRAME),e.auxiliaryInfo&&(d.auxiliaryInfo=e.auxiliaryInfo),0!==e.index||this._remuxStat&&0!==this._remuxStat.timeOffset||(d.dts=d.pts=d.cts=d.streamDTS=0),s.samples.push(d)}},t._parseAudioSample=function(e,t){var i,n,r=this._audioTrack;r.codecType===f.b.aac&&(t.length<=2||r.asc&&r.asc===Object(v.d)(t))||(r.codecType===f.b.mp3?i=null==(n=R(r,t,0,e.dts,0))?void 0:n.sample:(i={unit:t,dts:e.dts,pts:e.dts,duration:e.duration||e.duration||r.sampleDuration,streamDTS:e.dts},e.auxiliaryInfo&&(i.auxiliaryInfo=e.auxiliaryInfo),r.samples.push(i)))},t._hasMoreSamples=function(){return!!(this._aSampleInfoList&&this._aSampleIndex<this._aSampleInfoList.samples.length||this._vSampleInfoList&&this._vSampleIndex<this._vSampleInfoList.samples.length)},t._getNextSampleInfo=function(){var e=this._aSampleInfoList?this._aSampleInfoList.samples[this._aSampleIndex]:void 0,t=this._vSampleInfoList?this._vSampleInfoList.samples[this._vSampleIndex]:void 0,i=e?e.start-this._offset:-1,n=t?t.start-this._offset:-1;return n>=0&&(n<i||n>i&&i<0)?t:i>=0&&(i<n||i>n&&n<0)?e:this._isFMP4&&(i<n&&null!=e&&e.noOffset||i>n&&null!=t&&t.noOffset)?"notReady":void 0},t._remux=function(e){void 0===e&&(e=!1);var t,i=this._audioTrack,s=this._videoTrack;s.outputRaw&&!i.active&&(this._slientAudio||(y.a.initAudioForFillSilent(i,null==(t=this._transmuxData)?void 0:t.audioCodec),this._slientAudio=new D.a),this._slientAudio.update(i,s));if(0!==i.samples.length||0!==s.samples.length){if(e||!(i.active&&0===i.samples.length||s.active&&s.samples.length<2)){var o=!0,c=0,_=!1;this._remuxStat&&(o=this._remuxStat.contiguous,c=this._remuxStat.timeOffset,_=this._remuxStat.accurateTimeOffset),this._firstRemux&&(this._firstRemux=!1,this._eventEmitter.emit(r.a.MEDIA_DEMUX,{type:this._isFMP4?p.b.FMP4:p.b.MP4}));try{this._remuxer.remux(i,s,c,o,_,e,this._pssh),this._remuxStat=void 0}catch(e){a.b.e("mp4-demuxer",e),this._onError({type:n.b.MUX_ERROR,details:n.a.REMUX_ERROR,fatal:!0,reason:e.message})}}}else e&&this._remuxer.flush()},t._getTrexByID=function(e){if(this._moov)for(var t=0;t<this._moov.mvex.length;t++){var i;if((null==(i=this._moov.mvex[t].trex)?void 0:i.trackID)===e)return this._moov.mvex[t].trex}},t._getTrakByID=function(e){if(this._moov)for(var t=0;t<this._moov.trak.length;t++){var i;if((null==(i=this._moov.trak[t].tkhd)?void 0:i.trackId)===e)return this._moov.trak[t]}},t._parseMOOF=function(e,t){var i,n=this;null==(i=Ie.moof(e).traf)||i.forEach((function(i){var r=i.tfdt,a=i.tfhd,s=i.trun;if(a&&s){var o,c=n._getTrexByID(a.trackID),_=(null==r?void 0:r.baseMediaDecodeTime)||0,d=0,u=a.defaultSampleSize||(null==c?void 0:c.defaultSampleSize)||0,l=u,h=a.defaultSampleDuration||(null==c?void 0:c.defaultSampleDuration)||0,p=a.trackID||0;p===n._videoTrack.id&&(o=n._videoTrack),p===n._audioTrack.id&&(o=n._audioTrack);var m=n._getTrakByID(p);if(m&&o){var v,y,E;if(o.sampleDescIndex=a.sampleDescriptionIndex,o.type===f.l.VIDEO&&n._vSampleInfoList?E=n._vSampleInfoList:o.type===f.l.AUDIO&&n._aSampleInfoList&&(E=n._aSampleInfoList),!E)return;var b=E.samples.length,A=(null==(v=m.mdia)||null==(y=v.mdhd)?void 0:y.timescale)||0,T=A?o.inputTimescale/A:1;_*=T,h*=T,"video"===o.type&&n._vLastDTS>_?_=n._vLastDTS:"audio"===o.type&&n._aLastDTS>_&&(_=n._aLastDTS);var S=0;s.forEach((function(n){if(o&&E)for(var r=!a.baseDataOffset&&!n.dataOffset,s=r?0:(a.baseDataOffset||0)+(n.dataOffset||0)+t-e.size,p=(a.defaultSampleFlags||(null==c?void 0:c.defaultSampleFlags)||(null==n||n.firstSampleFlags),0);p<(n.sampleCount||0);p++){h=(n.sampleDuration[p]||0)*T||h,d=(n.sampleCompositionTimeOffset[p]||0)*T,l=n.sampleSize[p]||u,h||o.type!==f.l.AUDIO||(h=g.b(o.samplerate));var m={type:o.type,index:b,gopID:0,dts:_,cts:d,pts:_+d,duration:h,start:s,end:s+l,noOffset:r};if(i.senc)if(o.useSubSampleEnc=i.senc.useSubSampleEnc,i.senc.encItemData[p])m.auxiliaryInfo={enc:i.senc.encItemData[p]};else if(i.saiz&&i.senc.encData){var v=i.saiz.sampleInfoSize[p]||i.saiz.defaultSampleInfoSize;m.auxiliaryInfo={enc:i.senc.encData.subarray(S,S+v)},S+=v}s+=l,_+=h,n.sampleFlags[p]||a.defaultSampleFlags||0,b++,E.samples.push(m),E.endPTS=_+d}})),"video"===o.type?n._vLastDTS=_:"audio"===o.type&&(n._aLastDTS=_)}}}))},t._parseSIDX=function(e,t){var i=Ie.sidx(e),n=this._vSampleInfoList;if(i&&n){n.keyframes=[];var a=0,s=t;i.references.forEach((function(e){n.keyframes.push({time:a,position:s}),a+=e.duration,s+=e.size})),this._eventEmitter.emit(r.a.KEY_FRAME_INDEXS,{keyframes:n.keyframes})}},t._parseMOOV=function(e){var t=this;a.b.i("mp4-demuxer","parse moov"),this._moov=Ie.moov(e);var i={};if(this._ftyp&&be()(i,this._ftyp),this._moov.mvhd){var n=this._moov.mvhd.timescale;i.duration=this._moov.mvhd.duration/n,this._duration=i.duration,this._duration||this._moov.mvex.forEach((function(e){e.mehd&&(i.duration=t._duration=e.mehd.fragmentDuration/n)}))}if(this._pssh=[],this._moov.pssh.forEach((function(e){e.data&&t._pssh&&t._pssh.push(e.data)})),this._moov.trak.forEach((function(e){var i,n,r;if(e.mdia&&e.mdia.minf&&e.mdia.minf.stbl&&e.mdia.hdlr&&e.mdia.mdhd&&e.tkhd)if("vide"===e.mdia.hdlr.type)void 0===t._videoTrack.active&&(t._videoTrack.active=!0),t._vSampleInfoList=t._parseSTBL(t._videoTrack,e.mdia.minf.stbl,e.mdia.mdhd),t._videoTrack.rotation=function(e){var t,i,n=((i=[])[0]=Re(Se((t=e)[0]),Se(t[3])),i[1]=Re(Se(t[1]),Se(t[4])),-(0==i[0]||0==i[1]?NaN:-180*Math.atan2(Se(t[1])/i[1],Se(t[0])/i[0])/Math.PI));return n-=360*Math.floor(n/360+.0025),(n%=360)<0&&(n+=360),n}(e.tkhd.matrix),t._videoTrack.id=e.tkhd.trackId,null!=(i=t._pssh)&&i.length&&(t._videoTrack.stsd=null==(n=e.mdia.minf.stbl.stsd)?void 0:n.boxData),t._videoTrack.bitrate||(t._videoTrack.bitrate=8*((null==(r=t._vSampleInfoList)?void 0:r.size)||0)/1e3/(e.mdia.mdhd.duration/e.mdia.mdhd.timescale));else if("soun"===e.mdia.hdlr.type){var a,s,o;void 0===t._audioTrack.active&&(t._audioTrack.active=!0),t._audioTrack.id=e.tkhd.trackId,t._aSampleInfoList=t._parseSTBL(t._audioTrack,e.mdia.minf.stbl,e.mdia.mdhd),null!=(a=t._pssh)&&a.length&&(t._audioTrack.stsd=null==(s=e.mdia.minf.stbl.stsd)?void 0:s.boxData),t._audioTrack.bitrate||(t._audioTrack.bitrate=8*((null==(o=t._aSampleInfoList)?void 0:o.size)||0)/1e3/(e.mdia.mdhd.duration/e.mdia.mdhd.timescale))}})),this._vSampleInfoList&&this._vSampleInfoList.description.length&&this._parseVideoDescription(this._vSampleInfoList.description),this._aSampleInfoList&&this._aSampleInfoList.description.length&&this._parseAudioDescription(this._aSampleInfoList.description),this._vSampleInfoList){this._vSampleInfoList.keyframes&&(i.keyframes=this._vSampleInfoList.keyframes,this._aSampleInfoList&&this._aSampleInfoList.samples.length&&this._vSampleInfoList.keyframes.length&&this._aSampleInfoList.samples[0].start<this._vSampleInfoList.keyframes[0].position&&(i.keyframes[0]=be()({},i.keyframes[0]),i.keyframes[0].position=this._aSampleInfoList.samples[0].start));var s=[],o=this._videoTrack.inputTimescale;this._vSampleInfoList.samples.forEach((function(e){s.push({index:0,dts:e.dts/o,pts:e.pts/o,duration:e.duration/o})})),s.sort((function(e,t){return e.pts-t.pts})),s.forEach((function(e,t){e.index=t})),i.videoFramesInfo=s}else if(this._aSampleInfoList){var c,_=0,d=this._audioTrack.inputTimescale;i.keyframes=[{time:0,position:null==(c=this._aSampleInfoList.samples[0])?void 0:c.start}],this._aSampleInfoList.samples.forEach((function(e){e.dts-_>10*d&&(i.keyframes.push({time:e.dts/d,position:e.start}),_=e.dts)}))}a.b.i("mp4-demuxer","Parsed onMetaData"),this._eventEmitter.emit(r.a.METADATA,i)},t._seek=function(e){var t,i;if(a.b.i("mp4-demuxer","seek:"+e),0===e||this._isFMP4)return this._vSampleIndex=0,void(this._aSampleIndex=0);var n=null==(t=this._vSampleInfoList)?void 0:t.samples,r=null==(i=this._aSampleInfoList)?void 0:i.samples;if(n&&this._vSampleInfoList){var s=Ae.a.getPosByTime(this._vSampleInfoList.keyframes,e);s&&(this._vSampleIndex=this._findSampleIndexByPos(n,s.position))}r&&(this._vSampleInfoList?n&&(this._aSampleIndex=this._findSampleIndexByPos(r,n[this._vSampleIndex].end),a.b.i("mp4-demuxer","seek audio by video pos: "+e+" a: "+this._aSampleIndex+" v: "+this._vSampleIndex)):(this._aSampleIndex=this._findSampleIndexByTime(r,e*this._videoTrack.inputTimescale),a.b.i("mp4-demuxer","seek audio by time: "+e+" a: "+this._aSampleIndex+" v: "+this._vSampleIndex)))},t._findSampleIndexByPos=function(e,t){if(e[0]&&t<e[0].start)return 0;if(e[e.length-1]&&t>=e[e.length-1].end)return e.length-1;for(var i,n=0,r=e.length-1,a=0,s=0;n<=r;){if(t>=((i=(s=(a=(n+r)/2|0)-1)>=0?e[s]:void 0)?i.end:e[a].start)&&t<e[a].end)return a;if(t===e[a].end)return a+1;t>e[a].end?n=a+1:r=a-1}return 0},t._findSampleIndexByTime=function(e,t){if(e[0]&&t<e[0].dts)return 0;if(e[e.length-1]&&t>=e[e.length-1].dts)return e.length-1;for(var i=0,n=e.length-1,r=0,a=0,s=0;i<=n;)if(t>(s=e[a=1+(r=(i+n)/2|0)]?e[a].dts:Number.MAX_SAFE_INTEGER))i=a;else{if(!(t<e[r].dts))return t===s?a:r;n=r-1}return 0},t._parseVideoDescription=function(e){var t=this;a.b.i("mp4-demuxer","parse video desc: "+e[0].name);var i=!1;e.forEach((function(n){"avc1"!==n.name&&"hev1"!==n.name&&"hvc1"!==n.name&&"kvc3"!==n.name&&"kvc4"!==n.name&&"kvc5"!==n.name&&"av01"!==n.name&&"encv"!==n.name||(t._parseVideoSampleEntry(e[0]),i=!0)})),i||(a.b.i("mp4-demuxer","video codec unsupported"),this._videoTrack.active=!1)},t._parseAudioDescription=function(e){var t=this;a.b.i("mp4-demuxer","parse audio desc: "+e[0].name);var i=!1;e.forEach((function(e){("mp4a"===e.name||"enca"===e.name||"Opus"===e.name&&t._typeSupported.opus)&&(t._parseAudioSampleEntry(e),i=!0)})),i||(a.b.i("mp4-demuxer","audio codec unsupported"),this._audioTrack.active=!1)},t._parseAudioSampleEntry=function(e){var t=this;if(e.data&&e.data){var i=8,n=Object(v.d)(e.data,i);i+=n>=2?56:1===n?36:20,Ie.readBoxes(e.data.subarray(i,e.data.byteLength)).forEach((function(e){if("esds"===e.name)t._readEsds(e);else if("wave"===e.name&&e.data)Ie.readBoxes(e.data).forEach((function(e){"esds"===e.name&&t._readEsds(e)}));else if("btrt"===e.name){var i=Ie.btrt(e);i&&(t._audioTrack.maxBitrate=i.maxBitrate/1e3,t._audioTrack.bitrate=i.avgBitrate/1e3)}else"dOps"===e.name&&e.data&&(t._audioTrack.sampleDuration=t._aSampleInfoList&&t._aSampleInfoList.samples.length?Math.round(t._duration*t._audioTrack.inputTimescale/t._aSampleInfoList.samples.length):3003,t._audioTrack.codecType=f.b.opus,t._audioTrack.codec="opus",t._audioTrack.channelCount=e.data[1],t._audioTrack.samplerate=Object(v.f)(e.data,4))}))}},t._readEsds=function(e){if("esds"===e.name){var t=this._audioTrack,i=Ie.esds(e);if(i){var n=Te.getObjectTypeIndication(i);if(-1===we.indexOf(n))return void(t.active=!1);if(-1!==ke.indexOf(n)){var r=Te.getAudioConfig(i);r&&g.c(t,this._eventEmitter,r,p.a.ASC),t.codecType=f.b.aac}else t.codecType=f.b.mp3;t.sampleDuration=this._aSampleInfoList&&this._aSampleInfoList.samples.length?Math.round(this._duration*t.inputTimescale/this._aSampleInfoList.samples.length):3003}}},t._parseVideoSampleEntry=function(e){var t=this;if(e.data){var i=this._videoTrack;Ie.readBoxes(e.data.subarray(78,e.data.byteLength)).forEach((function(n){var a;if("avcC"===n.name)i.codecType=f.b.h264,t._parseAvcC(i,n),t._checkFps(i),t._eventEmitter.emit(r.a.VIDEO_CODEC_DETECTED,{enabled:!0,decoder:f.c.buildin,codecType:f.b.h264,timeOffset:(null==(a=t._remuxStat)?void 0:a.timeOffset)||0});else if("hvcC"===n.name)i.codecType!==f.b.hevc&&i.codecType!==f.b.kvc3&&i.codecType!==f.b.kvc4&&i.codecType!==f.b.kvc5&&("kvc3"===e.name?i.codecType=f.b.kvc3:"kvc4"===e.name?i.codecType=f.b.kvc4:"kvc5"===e.name?i.codecType=f.b.kvc5:i.codecType=f.b.hevc,i.codecType===f.b.hevc?fe.onHEVCDetected(i,t._config,t._typeSupported):fe.onKVCDetected(i,t._config,t._typeSupported)),t._parseHvcC(i,n),t._checkFps(i);else if("av1C"===n.name)i.codecType=f.b.av1,fe.onAV1Detected(i,t._config,t._typeSupported),t._parseAv1C(i,n),t._checkFps(i);else if("btrt"===n.name){var s=Ie.btrt(n);s&&(i.maxBitrate=s.maxBitrate/1e3,i.bitrate=s.avgBitrate/1e3)}}))}},t._parseAv1C=function(e,t){if(t.data){this._av1Ctx=$.createCtx();var i=he.parseAV1C(t.data,this._av1Ctx);i?(fe.updateAV1Track(e,i.sh,t.data),e.sampleDuration=this._vSampleInfoList&&this._vSampleInfoList.samples.length?Math.round(this._duration*e.inputTimescale/this._vSampleInfoList.samples.length):3003,e.duration=this._duration):this._onError({type:n.b.MUX_ERROR,details:n.a.PARSING_ERROR,fatal:!0,reason:"Invalid AV1DecoderConfigurationRecord"})}},t._parseAvcC=function(e,t){if(t.data){var i=he.parseAVCC(t.data);i?(fe.updateAVCTrack(e,i.paramSets,t.data),e.sampleDuration=this._vSampleInfoList&&this._vSampleInfoList.samples.length?Math.round(this._duration*e.inputTimescale/this._vSampleInfoList.samples.length):3003,e.duration=this._duration):this._onError({type:n.b.MUX_ERROR,details:n.a.PARSING_ERROR,fatal:!0,reason:"Invalid AVCDecoderConfigurationRecord"})}},t._parseHvcC=function(e,t){var i;if(a.b.i("mp4-demuxer","parse hvcc"),t.data){var s=he.parseHVCC(t.data,e.codecType);if(s&&s.paramSets.spsList.length){if(fe.updateHEVCTrack(e,s.paramSets),e.sampleDuration=this._vSampleInfoList&&this._vSampleInfoList.samples.length?Math.round(this._duration*e.inputTimescale/this._vSampleInfoList.samples.length):3003,e.duration=this._duration,this._eventEmitter.emit(r.a.VIDEO_CODEC_DETECTED,{codecType:e.codecType,enabled:e.active,decoder:this._videoTrack.outputRaw?f.c.wasm:f.c.buildin,bitDepth:e.bitDepth,timeOffset:(null==(i=this._remuxStat)?void 0:i.timeOffset)||0}),this._videoTrack.outputRaw){var o=he.hevDecoderConfigToSample(s.paramSets,0);this._eventEmitter.emit(r.a.RAW_DATA,{type:p.c.decoderConfig,samples:[o],extra:this._transmuxData})}}else this._onError({type:n.b.MUX_ERROR,details:n.a.PARSING_ERROR,fatal:!0,reason:"Invalid HEVCDecoderConfigurationRecord"})}},t._parseSTBL=function(e,t,i){a.b.i("mp4-demuxer","parse stbl");var n={description:t.stsd?t.stsd.sampleEntrys:[],samples:[],keyframes:[],endPTS:0,size:0};if(t.stco&&t.stsc&&t.stsz&&t.stsz.sampleCount){var r,s=0,o=0,c=t.stco.chunkOffset[s],_=t.stsc.sampleToChunkBox[o],d=_.samplesPerChunk,u=t.stsc.sampleToChunkBox[o].firstChunk,l=0,h=0,p=void 0,m=0,v=0;t.stts&&(p=t.stts.timeToSample[h],m=t.stts.timeToSample[h].sampleCount);var g=0,y=void 0,E=0,b=0;t.ctts&&(y=t.ctts.compositionOffset[g],E=t.ctts.compositionOffset[g].sampleCount);var A=0,T=0;t.stss&&(T=t.stss.sampleNumber[A]);for(var S=0;S<t.stsz.sampleCount;S++)if(S>=d&&s<t.stco.chunkOffset.length&&(l=0,u++,s++,c=t.stco.chunkOffset[s],t.stsc.sampleToChunkBox[o+1]&&u>=t.stsc.sampleToChunkBox[o+1].firstChunk&&(o++,_=t.stsc.sampleToChunkBox[o]),d+=_.samplesPerChunk),t.stts&&S>=m&&h<t.stts.timeToSample.length&&(h++,m+=(p=t.stts.timeToSample[h]).sampleCount),t.ctts&&S>=E&&g<t.ctts.compositionOffset.length&&(g++,E+=(y=t.ctts.compositionOffset[g]).sampleCount),t.stss&&S>=T-1&&T&&(A++,T=t.stss.sampleNumber[A],r={time:0,position:0}),_&&c){var R="number"==typeof t.stsz.SampleSize?t.stsz.SampleSize:t.stsz.SampleSize[S],x=e.inputTimescale/i.timescale;b=y&&y.sampleOffset>=0?y.sampleOffset*x:0;var L=p?Math.max(90,p.sampleDelta*x):30,C=v+b,D={type:e.type,index:S,gopID:n.keyframes.length,dts:v,cts:b,pts:C,duration:L,start:c+l,end:c+l+R};C>n.endPTS&&(n.endPTS=C),n.samples.push(D),n.size+=R,r&&(r.time=n.keyframes.length?Math.round((v+b)/e.inputTimescale*1e3)/1e3:0,r.position=D.start,n.keyframes.push(r),r=void 0),v+=L,l+=R,!t.stss&&0===n.keyframes.length&&n.samples.length&&n.keyframes.push({time:0,position:n.samples[0].start})}return e.type===f.l.VIDEO&&n.samples.length&&i.timescale&&(n.fps=n.samples.length/(i.duration/i.timescale)),n}return n},t._checkFps=function(e){var t,i;null!=(t=this._vSampleInfoList)&&t.fps&&Object(ye.a)(null==(i=this._vSampleInfoList)?void 0:i.fps)&&this._vSampleInfoList.fps>0&&(e.fps=this._vSampleInfoList.fps)},l()(e,null,[{key:"probeSize",get:function(){return 8}}]),e}();!function(e){e[e.AV_PICTURE_STRUCTURE_UNKNOWN=0]="AV_PICTURE_STRUCTURE_UNKNOWN",e[e.AV_PICTURE_STRUCTURE_TOP_FIELD=1]="AV_PICTURE_STRUCTURE_TOP_FIELD",e[e.AV_PICTURE_STRUCTURE_BOTTOM_FIELD=2]="AV_PICTURE_STRUCTURE_BOTTOM_FIELD",e[e.AV_PICTURE_STRUCTURE_FRAME=3]="AV_PICTURE_STRUCTURE_FRAME"}(xe||(xe={})),function(e){e[e.MMCO_END=0]="MMCO_END",e[e.MMCO_SHORT2UNUSED=1]="MMCO_SHORT2UNUSED",e[e.MMCO_LONG2UNUSED=2]="MMCO_LONG2UNUSED",e[e.MMCO_SHORT2LONG=3]="MMCO_SHORT2LONG",e[e.MMCO_SET_MAX_LONG=4]="MMCO_SET_MAX_LONG",e[e.MMCO_RESET=5]="MMCO_RESET",e[e.MMCO_LONG=6]="MMCO_LONG"}(Le||(Le={})),function(e){e[e.AV_PICTURE_TYPE_NONE=0]="AV_PICTURE_TYPE_NONE",e[e.AV_PICTURE_TYPE_I=1]="AV_PICTURE_TYPE_I",e[e.AV_PICTURE_TYPE_P=2]="AV_PICTURE_TYPE_P",e[e.AV_PICTURE_TYPE_B=3]="AV_PICTURE_TYPE_B",e[e.AV_PICTURE_TYPE_S=4]="AV_PICTURE_TYPE_S",e[e.AV_PICTURE_TYPE_SI=5]="AV_PICTURE_TYPE_SI",e[e.AV_PICTURE_TYPE_SP=6]="AV_PICTURE_TYPE_SP",e[e.AV_PICTURE_TYPE_BI=7]="AV_PICTURE_TYPE_BI"}(Ce||(Ce={})),function(e){e[e.HEVC_SLICE_B=0]="HEVC_SLICE_B",e[e.HEVC_SLICE_P=1]="HEVC_SLICE_P",e[e.HEVC_SLICE_I=2]="HEVC_SLICE_I"}(De||(De={}));var Ne,Pe=[Ce.AV_PICTURE_TYPE_P,Ce.AV_PICTURE_TYPE_B,Ce.AV_PICTURE_TYPE_I,Ce.AV_PICTURE_TYPE_SP,Ce.AV_PICTURE_TYPE_SI],Me=function(){function e(e,t,i,n){var a=this;this._eventEmitter=void 0,this._remuxer=void 0,this._config=void 0,this._duration=1/0,this._typeSupported=void 0,this._cache=void 0,this._slientAudio=void 0,this._transmuxData=void 0,this._firstRemux=!0,this._remuxStat=void 0,this._videoTrack=void 0,this._audioTrack=void 0,this._psUpdated=!1,this._vSample=void 0,this._vSampleIndex=0,this._vSampleIndexOnGOPStart=0,this._lastPTS=0,this._frameDuration=h.d/h.b,this._codecParserContext=void 0,this._onError=function(e){a._eventEmitter.emit(r.a.ERROR,e)},this._eventEmitter=e,this._remuxer=t,this._config=i,this._typeSupported=n,this._cache=new N.a,this._initTrack(1/0),this._newSample(),this._slientAudio=new D.a}e.probe=function(e){return e.length>4&&0===e[0]&&0===e[1]&&0===e[2]&&1===e[3]};var t=e.prototype;return t.resetInitSegment=function(e){this._initTrack(e.duration),this._transmuxData=e,this._firstRemux=!0,this._remuxStat=void 0,this._psUpdated=!1,this._vSample=void 0,this._vSampleIndex=0,this._vSampleIndexOnGOPStart=0,this._newSample(),this._cache.clear(),this._slientAudio&&this._slientAudio.reset(),a.b.i("raw-demuxer","reset init")},t.resetTimeStamp=function(e){},t.append=function(e,t,i,n,a){var s=this._findStartCode(e);if(this._remuxStat||(this._remuxStat={timeOffset:t,contiguous:i,accurateTimeOffset:n}),s&&s.length){var o=-this._cache.unreadLen;this._cache.put(e);for(var c=0,_=0;_<s.length;_++){if(c=s[_].pos-o-s[_].state){var d=this._cache.get(c);this._cache.skip(s[_].state),d&&(d=3===s[_].state&&0===d[d.length-1]?d.subarray(0,d.length-1):d,this._parseNalu(d))}else this._cache.skip(s[_].state);o=s[_].pos}}else this._cache.put(e);if(a){var u,l=this._cache.get(this._cache.unreadLen);l&&(this._parseNalu(l),this._vSample&&this._videoTrack&&this._nextSample(),this.flush());var f={duration:(this._lastPTS+this._frameDuration)/((null==(u=this._videoTrack)?void 0:u.inputTimescale)||h.d)};this._eventEmitter.emit(r.a.METADATA,f)}},t.flush=function(){this._remux(!0),this._remuxStat=void 0},t.destroy=function(){},t._initTrack=function(e){var t;this._videoTrack=Object(I.b)(e),this._videoTrack.naluState=0,this._videoTrack.active=!0,this._audioTrack=Object(I.a)(e),y.a.initAudioForFillSilent(this._audioTrack,null==(t=this._transmuxData)?void 0:t.audioCodec)},t._findStartCode=function(e){var t=this._videoTrack;if(t){for(var i=e.byteLength,n=[],r=0,s=t.naluState;r<i;)i-r>3&&0===s?(1===e[r+2]?0===e[r+1]&&0===e[r]&&n.push({pos:r+3,state:3}):0===e[r+2]&&(s=1,0===e[r+1]&&(s=2,0===e[r]&&(s=3))),r+=3):(s<2?0===e[r]?s++:s=0:3===s||2===s?1===e[r]?(n.push({pos:r+1,state:s+1}),s=0):e[r]>1&&(s=0):a.b.w("raw-demuxer","error state",s),r++);return t.naluState=s,n}},t._remux=function(e){void 0===e&&(e=!1),this._nextSample();var t=this._audioTrack,i=this._videoTrack;if(i&&t)if(this._slientAudio.update(t,i),0!==t.samples.length||0!==i.samples.length){if(e||!(t.active&&0===t.samples.length||i.active&&i.samples.length<2)){this._firstRemux&&(this._eventEmitter.emit(r.a.KEY_FRAME_INDEXS,{keyframes:[{time:0,position:0}]}),this._firstRemux=!1,this._eventEmitter.emit(r.a.MEDIA_DEMUX,{type:p.b.RAW}));var s=Object(ve.a)(i,this._vSampleIndexOnGOPStart);this._eventEmitter.emit(r.a.VIDEO_FRAME_INFO,{videoFramesInfo:s});var o=!0,c=0,_=!1;this._remuxStat&&(o=this._remuxStat.contiguous,c=this._remuxStat.timeOffset,_=this._remuxStat.accurateTimeOffset);try{this._remuxer.remux(t,i,c,o,_,e),this._remuxStat=void 0}catch(e){a.b.e("raw-demuxer",e),this._onError({type:n.b.MUX_ERROR,details:n.a.REMUX_ERROR,fatal:!0,reason:e.message})}}}else e&&this._remuxer.flush()},t._parseNalu=function(e){var t=this._videoTrack;if(t){if(!t.codecType||t.codecType===f.b.unknown){var i=31&e[0],a=(126&e[0])>>1;if(i>=L.H264_NAL_SPS&&i<=L.H264_NAL_AUD)t.codecType=f.b.h264,this._codecParserContext={pict_type:Ce.AV_PICTURE_TYPE_NONE,picture_structure:xe.AV_PICTURE_STRUCTURE_UNKNOWN,key_frame:0,priv_data:{picture_structure:xe.AV_PICTURE_STRUCTURE_UNKNOWN,poc:{poc_lsb:0,poc_msb:0,delta_poc_bottom:0,delta_poc:[],frame_num:0,prev_poc_msb:0,prev_poc_lsb:0,frame_num_offset:0,prev_frame_num_offset:0,prev_frame_num:0},ps:{spsList:[],ppsList:[]}}},this._eventEmitter.emit(r.a.VIDEO_CODEC_DETECTED,{enabled:!0,decoder:f.c.buildin,codecType:f.b.h264});else{if(!(a>=F.a.HEVC_NAL_VPS&&a<=F.a.HEVC_NAL_AUD))return void this._onError({type:n.b.MUX_ERROR,details:n.a.REMUX_ERROR,fatal:!0,reason:"unsupport codec"});var s,o,c;this._codecParserContext={pict_type:Ce.AV_PICTURE_TYPE_NONE,picture_structure:xe.AV_PICTURE_STRUCTURE_UNKNOWN,key_frame:0,priv_data:{ps:{spsList:[],ppsList:[],vpsList:[]},poc:0,pocTid0:0,max_dec_pic_buffering:0}},".kvc3"===(null==(s=this._transmuxData)?void 0:s.suffix)?t.codecType=f.b.kvc3:".kvc4"===(null==(o=this._transmuxData)?void 0:o.suffix)?t.codecType=f.b.kvc4:".kvc5"===(null==(c=this._transmuxData)?void 0:c.suffix)?t.codecType=f.b.kvc5:t.codecType=f.b.hevc}}t.codecType===f.b.h264?this._parseH264Nalu(e):t.codecType!==f.b.hevc&&t.codecType!==f.b.kvc3&&t.codecType!==f.b.kvc4&&t.codecType!==f.b.kvc5||this._parseHEVCNalu(e)}},t._parseH264Nalu=function(e){var t=this._codecParserContext,i=this._videoTrack;if(t&&i){var n=t.priv_data,a=[0,0],s=0;t.pict_type=Ce.AV_PICTURE_TYPE_I,t.key_frame=0,t.picture_structure=xe.AV_PICTURE_STRUCTURE_UNKNOWN;var o={ref_idc:e[0]>>5&3,type:31&e[0],nuh_layer_id:0,temporal_id:0,data:e};switch(o.type){case L.H264_NAL_IDR_SLICE:i.decConf&&this._remux(),this._vSampleIndexOnGOPStart=this._vSampleIndex,t.key_frame=1,n.poc.prev_frame_num=0,n.poc.prev_frame_num_offset=0,n.poc.prev_poc_msb=n.poc.prev_poc_lsb=0;case L.H264_NAL_SLICE:var c=H(te(e.subarray(1,e.byteLength)));o.gbCtx=c,z(c);var _=z(c);t.pict_type=Pe[_%5];var d=z(c),u=n.ps.ppsList[d],l=n.ps.spsList[u.sps_id];n.ps.sps=l,n.ps.pps=u,n.ps.sps.ref_frame_count<=1&&n.ps.pps.ref_count[0]<=1&&t.pict_type===Ce.AV_PICTURE_TYPE_I&&(t.key_frame=1),n.poc.frame_num=W(c,l.log2_max_frame_num),l.frame_mbs_only_flag?n.picture_structure=xe.AV_PICTURE_STRUCTURE_FRAME:W(c,1)?n.picture_structure=xe.AV_PICTURE_STRUCTURE_TOP_FIELD+W(c,1):n.picture_structure=xe.AV_PICTURE_STRUCTURE_FRAME,o.type===L.H264_NAL_IDR_SLICE&&z(c),0===l.pic_order_cnt_type&&(n.poc.poc_lsb=W(c,l.log2_max_poc_lsb),1==u.pic_order_present&&n.picture_structure==xe.AV_PICTURE_STRUCTURE_FRAME&&(n.poc.delta_poc_bottom=G(c))),1!=l.pic_order_cnt_type||l.delta_pic_order_always_zero_flag||(n.poc.delta_poc[0]=G(c),1==u.pic_order_present&&n.picture_structure===xe.AV_PICTURE_STRUCTURE_FRAME&&(n.poc.delta_poc[1]=G(c))),a[0]=a[1]=Number.MAX_SAFE_INTEGER;var h=this.ff_h264_init_poc(a,l,n.poc,n.picture_structure,o.ref_idc);if(o.ref_idc&&o.type!==L.H264_NAL_IDR_SLICE&&(s=this.scan_mmco_reset(t,c))<0)return;if(n.poc.prev_frame_num=s?0:n.poc.frame_num,n.poc.prev_frame_num_offset=s?0:n.poc.frame_num_offset,0!==o.ref_idc&&(s?(n.poc.prev_poc_msb=0,n.poc.prev_poc_lsb=n.picture_structure===xe.AV_PICTURE_STRUCTURE_BOTTOM_FIELD?0:a[0]):(n.poc.prev_poc_msb=n.poc.poc_msb,n.poc.prev_poc_lsb=n.poc.poc_lsb)),!i.decConf){var f;this._psUpdated&&this._remuxer.ISGenerated&&this._transmuxData&&this._remuxer.resetInitSegment(this._transmuxData),fe.updateAVCTrack(i,n.ps),this._checkFps(i);var p=he.avcDecoderConfigToNalu(n.ps);this._vSample&&(f=this._vSample.units).push.apply(f,p),i.fps&&(this._frameDuration=i.inputTimescale/i.fps)}this._vSample&&(-1!==this._vSample.poc&&Math.floor(h/2)!==Math.floor(this._vSample.poc/2)&&this._nextSample(),this._vSample.units.push({type:o.type,data:o.data}),-1===this._vSample.poc&&(this._vSample.pts=this._vSampleIndex?(h/2+this._vSampleIndexOnGOPStart+l.ref_frame_count)*this._frameDuration:0,this._vSample.cts=this._vSample.pts-this._vSample.dts,this._vSample.pts>this._lastPTS&&(this._lastPTS=this._vSample.pts),this._vSample.key=!!t.key_frame,this._vSample.poc=h,this._vSample.key&&this._eventEmitter.emit(r.a.KEY_FRAME)));break;case L.H264_NAL_AUD:break;case L.H264_NAL_SPS:var m=re.parse(e);m&&(n.ps.sps&&!Object(v.b)(n.ps.sps.data,m.data)&&(this._psUpdated=!0),n.ps.spsList[m.sps_id]=m),i.decConf&&this._remux(),i.decConf=void 0;break;case L.H264_NAL_PPS:var g=ne.parse(e);g&&(n.ps.pps&&!Object(v.b)(n.ps.pps.data,g.data)&&(this._psUpdated=!0),n.ps.ppsList[g.pps_id]=g),i.decConf&&this._remux(),i.decConf=void 0}}},t._parseHEVCNalu=function(e){var t=this._codecParserContext,i=this._videoTrack;if(t&&i){var a,s=t.priv_data;t.pict_type=Ce.AV_PICTURE_TYPE_I,t.key_frame=0,t.picture_structure=xe.AV_PICTURE_STRUCTURE_UNKNOWN;var o={type:(126&e[0])>>1,nuh_layer_id:(1&e[0])<<5&e[1]>>3&31,temporal_id:(7&e[1])-1,ref_idc:0,data:e};if(!(o.nuh_layer_id>0))switch(o.type){case F.a.HEVC_NAL_TRAIL_N:case F.a.HEVC_NAL_TRAIL_R:case F.a.HEVC_NAL_TSA_N:case F.a.HEVC_NAL_TSA_R:case F.a.HEVC_NAL_STSA_N:case F.a.HEVC_NAL_STSA_R:case F.a.HEVC_NAL_BLA_W_LP:case F.a.HEVC_NAL_BLA_W_RADL:case F.a.HEVC_NAL_BLA_N_LP:case F.a.HEVC_NAL_IDR_W_RADL:case F.a.HEVC_NAL_IDR_N_LP:case F.a.HEVC_NAL_CRA_NUT:case F.a.HEVC_NAL_RADL_N:case F.a.HEVC_NAL_RADL_R:case F.a.HEVC_NAL_RASL_N:case F.a.HEVC_NAL_RASL_R:if(!i.decConf&&(this._psUpdated&&this._remuxer.ISGenerated&&this._transmuxData&&this._remuxer.resetInitSegment(this._transmuxData),fe.updateHEVCTrack(i,s.ps),i.decConf&&(this._checkFps(i),this._eventEmitter.emit(r.a.VIDEO_CODEC_DETECTED,{codecType:i.codecType,enabled:i.active,decoder:i.outputRaw?f.c.wasm:f.c.buildin,bitDepth:i.bitDepth}),i.fps&&(this._frameDuration=i.inputTimescale/i.fps),i.outputRaw))){var c=he.hevDecoderConfigToSample(s.ps,this._vSample?this._vSample.dts:0);this._eventEmitter.emit(r.a.RAW_DATA,{type:p.c.decoderConfig,samples:[c],extra:this._transmuxData})}if(o.gbCtx=H(te(o.data.subarray(2,o.data.byteLength))),a=this.hevc_parse_slice_header(t,o))return a;break;case F.a.HEVC_NAL_AUD:break;case F.a.HEVC_NAL_SPS:var _=ue.parse(e,i.codecType);if(_&&(s.ps.sps&&!Object(v.b)(s.ps.sps.data,_.data)&&(this._psUpdated=!0),s.ps.spsList[_.sps_id]=_,s.max_dec_pic_buffering=_.temporal_layer.reduce((function(e,t){return Math.max(e,t.max_dec_pic_buffering)}),0)),!(i.codecType===f.b.hevc?fe.onHEVCDetected(i,this._config,this._typeSupported):fe.onKVCDetected(i,this._config,this._typeSupported)))return void this._onError({type:n.b.MUX_ERROR,details:n.a.REMUX_ERROR,fatal:!0,reason:"unsupport codec hevc"});i.decConf&&this._remux(),i.decConf=void 0;break;case F.a.HEVC_NAL_PPS:var d=oe.parse(e);d&&(s.ps.pps&&!Object(v.b)(s.ps.pps.data,d.data)&&(this._psUpdated=!0),s.ps.ppsList[d.pps_id]=d),i.decConf&&this._remux(),i.decConf=void 0;break;case F.a.HEVC_NAL_VPS:var u=le.parse(e);u&&(s.ps.vps&&!Object(v.b)(s.ps.vps.data,u.data)&&(this._psUpdated=!0),s.ps.vpsList[u.vps_id]=u),i.decConf&&this._remux(),i.decConf=void 0}}},t._nextSample=function(){this._videoTrack&&this._vSample&&this._vSample.units.length&&-1!==this._vSample.pts&&(this._videoTrack.samples.push(this._vSample),this._vSampleIndex++,this._vSample=void 0),this._vSample||this._newSample()},t._newSample=function(){var e=this._vSampleIndex*this._frameDuration;this._vSample={poc:-1,key:!1,pts:-1,dts:e,cts:0,units:[],streamDTS:e,duration:this._frameDuration}},t.hevc_parse_slice_header=function(e,t){var i,n,s,o,c=e.priv_data,_=c.ps,d=t.gbCtx;if(!d)return-1;n=W(d,1),(o=t).type>=16&&o.type<=23&&(e.key_frame=1,j(d,1));var u=z(d);if(_.pps=_.ppsList[u],_.sps=_.spsList[_.pps.sps_id],_.vps=_.vpsList[_.sps.vps_id],n)s=0;else{s=_.pps.dependent_slice_segments_enabled_flag?W(d,1):0;var l=W(d,Math.ceil(Math.log2(_.sps.ctb_width*_.sps.ctb_height)));if(l>=_.sps.ctb_width*_.sps.ctb_height)return a.b.i("raw-demuxer","Invalid slice segment address: "+l+"."),-1}if(s)return 0;for(i=0;i<_.pps.num_extra_slice_header_bits;i++)j(d,1);var h=z(d);if(h!==De.HEVC_SLICE_I&&h!==De.HEVC_SLICE_P&&h!==De.HEVC_SLICE_B)return a.b.i("raw-demuxer","Unknown slice type: %d.\n",h),-1;e.pict_type=h===De.HEVC_SLICE_B?Ce.AV_PICTURE_TYPE_B:h===De.HEVC_SLICE_P?Ce.AV_PICTURE_TYPE_P:Ce.AV_PICTURE_TYPE_I,_.pps.output_flag_present_flag&&j(d,1),_.sps.separate_colour_plane_flag&&j(d,2);var f=function(e){return e.type===F.a.HEVC_NAL_IDR_W_RADL||e.type===F.a.HEVC_NAL_IDR_N_LP}(t);if(f)c.poc=0,this._remux(),this._vSampleIndexOnGOPStart=this._vSampleIndex;else{var p=W(d,_.sps.log2_max_poc_lsb);c.poc=this.ff_hevc_compute_poc(_.sps,c.pocTid0,p,t.type)}return 0===t.temporal_id&&t.type!==F.a.HEVC_NAL_TRAIL_N&&t.type!==F.a.HEVC_NAL_TSA_N&&t.type!==F.a.HEVC_NAL_STSA_N&&t.type!==F.a.HEVC_NAL_RADL_N&&t.type!==F.a.HEVC_NAL_RASL_N&&t.type!==F.a.HEVC_NAL_RADL_R&&t.type!==F.a.HEVC_NAL_RASL_R&&(c.pocTid0=c.poc),this._vSample&&(-1!==this._vSample.poc&&c.poc!==this._vSample.poc&&this._nextSample(),this._vSample.units.push({type:t.type,data:t.data}),-1===this._vSample.pts&&(this._vSample.pts=this._vSampleIndex?(c.poc+this._vSampleIndexOnGOPStart+c.max_dec_pic_buffering)*this._frameDuration:0,this._vSample.cts=this._vSample.pts-this._vSample.dts,this._vSample.pts>this._lastPTS&&(this._lastPTS=this._vSample.pts),this._vSample.key=f,this._vSample.poc=c.poc,this._vSample.key&&this._eventEmitter.emit(r.a.KEY_FRAME))),1},t.ff_hevc_compute_poc=function(e,t,i,n){var r,a=1<<e.log2_max_poc_lsb,s=t%a,o=t-s;return r=i<s&&s-i>=a/2?o+a:i>s&&i-s>a/2?o-a:o,n!==F.a.HEVC_NAL_BLA_W_LP&&n!==F.a.HEVC_NAL_BLA_W_RADL&&n!==F.a.HEVC_NAL_BLA_N_LP||(r=0),r+i},t.ff_h264_init_poc=function(e,t,i,n,r){var a=1<<t.log2_max_frame_num,s=[];if(i.frame_num_offset=i.prev_frame_num_offset,i.frame_num<i.prev_frame_num&&(i.frame_num_offset+=a),0===t.pic_order_cnt_type){var o=1<<t.log2_max_poc_lsb;i.prev_poc_lsb<0&&(i.prev_poc_lsb=i.poc_lsb),i.poc_lsb<i.prev_poc_lsb&&i.prev_poc_lsb-i.poc_lsb>=o/2?i.poc_msb=i.prev_poc_msb+o:i.poc_lsb>i.prev_poc_lsb&&i.prev_poc_lsb-i.poc_lsb<-o/2?i.poc_msb=i.prev_poc_msb-o:i.poc_msb=i.prev_poc_msb,s[0]=s[1]=i.poc_msb+i.poc_lsb,n===xe.AV_PICTURE_STRUCTURE_FRAME&&(s[1]+=i.delta_poc_bottom)}else if(1===t.pic_order_cnt_type){var c,_,d,u;for(c=0!==t.num_ref_frames_in_pic_order_cnt_cycle?i.frame_num_offset+i.frame_num:0,0===r&&c>0&&c--,_=0,u=0;u<t.num_ref_frames_in_pic_order_cnt_cycle;u++)_+=t.offset_for_ref_frame[u];if(c>0){var l=(c-1)/t.num_ref_frames_in_pic_order_cnt_cycle,h=(c-1)%t.num_ref_frames_in_pic_order_cnt_cycle;for(d=l*_,u=0;u<=h;u++)d+=t.offset_for_ref_frame[u]}else d=0;0==r&&(d+=t.offset_for_non_ref_pic),s[0]=d+i.delta_poc[0],s[1]=s[0]+t.offset_for_top_to_bottom_field,n===xe.AV_PICTURE_STRUCTURE_FRAME&&(s[1]+=i.delta_poc[1])}else{var f=2*(i.frame_num_offset+i.frame_num);r||f--,s[0]=f,s[1]=f}return n!==xe.AV_PICTURE_STRUCTURE_BOTTOM_FIELD&&(e[0]=s[0]),n!==xe.AV_PICTURE_STRUCTURE_TOP_FIELD&&(e[1]=s[1]),Math.min(e[0],e[1])},t.scan_mmco_reset=function(e,t){var i=e.priv_data;if(!i.ps.pps)return-1;var n=3&e.pict_type,r=0,s=[];i.ps.pps.redundant_pic_cnt_present&&z(t),n===Ce.AV_PICTURE_TYPE_B&&W(t,1);var o={list_count:r};if(this.ff_h264_parse_ref_count(o,s,t,i.ps.pps,n,i.picture_structure)<0)return-2;if(r=o.list_count,n!==Ce.AV_PICTURE_TYPE_I)for(var c=0;c<r;c++)if(W(t,1))for(var _=0;;_++){var d=z(t);if(!(d<3)){if(d>3)return a.b.i("raw-demuxer","illegal reordering_of_pic_nums_idc %d\n",d),-3;break}if(z(t),_>=s[c])return a.b.i("raw-demuxer","reference count %d overflow\n",_),-4}if((i.ps.pps.weighted_pred&&n===Ce.AV_PICTURE_TYPE_P||1===i.ps.pps.weighted_bipred_idc&&n==Ce.AV_PICTURE_TYPE_B)&&i.ps.sps&&this.ff_h264_pred_weight_table(t,i.ps.sps,s,n,{use_weight:0,use_weight_chroma:0,luma_log2_weight_denom:0,chroma_log2_weight_denom:0,luma_weight_flag:[],chroma_weight_flag:[]},i.picture_structure),W(t,1))for(var u=0;u<66;u++){var l=z(t);if(l>Le.MMCO_LONG)return a.b.i("raw-demuxer","illegal memory management control operation "+l),-5;if(l===Le.MMCO_END)return 0;if(l===Le.MMCO_RESET)return 1;l!==Le.MMCO_SHORT2UNUSED&&l!==Le.MMCO_SHORT2LONG||z(t),l!==Le.MMCO_SHORT2LONG&&l!==Le.MMCO_LONG2UNUSED&&l!==Le.MMCO_LONG&&l!==Le.MMCO_SET_MAX_LONG||z(t)}return 0},t.ff_h264_parse_ref_count=function(e,t,i,n,r,s){var o;if(t[0]=n.ref_count[0],t[1]=n.ref_count[1],r!==Ce.AV_PICTURE_TYPE_I){var c=[];if(c[0]=c[1]=s===xe.AV_PICTURE_STRUCTURE_FRAME?15:31,W(i,1)&&(t[0]=z(i)+1,r===Ce.AV_PICTURE_TYPE_B?t[1]=z(i)+1:t[1]=1),o=r===Ce.AV_PICTURE_TYPE_B?2:1,t[0]-1>c[0]||2==o&&t[1]-1>c[1])return a.b.i("raw-demuxer","reference overflow %u > %u or %u > %u\n",t[0]-1,c[0],t[1]-1,c[1]),t[0]=t[1]=0,e.list_count=0,t[0]=0,t[1]=0,-1;t[1]-1>c[1]&&(a.b.i("raw-demuxer","reference overflow %u > %u \n",t[1]-1,c[1]),t[1]=0)}else o=0,t[0]=t[1]=0;return e.list_count=o,0},t.ff_h264_pred_weight_table=function(e,t,i,n,r,s){var o,c;for(r.use_weight=0,r.use_weight_chroma=0,r.luma_log2_weight_denom=z(e),r.luma_log2_weight_denom>7&&(a.b.i("raw-demuxer","luma_log2_weight_denom %d is out of range\n",r.luma_log2_weight_denom),r.luma_log2_weight_denom=0),r.luma_log2_weight_denom,t.chroma_format_idc&&(r.chroma_log2_weight_denom=z(e),r.chroma_log2_weight_denom>7&&(a.b.i("raw-demuxer","chroma_log2_weight_denom %d is out of range\n",r.chroma_log2_weight_denom),r.chroma_log2_weight_denom=0),r.chroma_log2_weight_denom),o=0;o<2;o++){for(r.luma_weight_flag[o]=0,r.chroma_weight_flag[o]=0,c=0;c<i[o];c++)if(W(e,1)&&(G(e),G(e)),t.chroma_format_idc&&W(e,1))for(var _=0;_<2;_++)G(e),G(e);if(n!==Ce.AV_PICTURE_TYPE_B)break}return r.use_weight=r.use_weight||r.use_weight_chroma,0},t._checkFps=function(e){(!e.fps||e.fps>h.f)&&(e.fps=h.b)},l()(e,null,[{key:"probeSize",get:function(){return 4}}]),e}(),Ve=function(){function e(e,t){this._decrypter=void 0,this._decryptdata=void 0,this._decryptdata=t,this._decrypter=new d(e,{removePKCS7Padding:!1})}var t=e.prototype;return t.decryptAacSamples=function(e,t,i){for(;;t++){if(t>=e.length)return void i();if(!(e[t].unit.length<32)){var n=this._decrypter.isSync();if(this._decryptAacSample(e,t,i,n),!n)return}}},t.decryptAvcSamples=function(e,t,i,n){for(;;t++,i=0){if(t>=e.length)return void n();for(var r=e[t].units;!(i>=r.length);i++){var a=r[i];if(!(a.length<=48||1!==a.type&&5!==a.type)){var s=this._decrypter.isSync();if(this._decryptAvcSample(e,t,i,n,a,s),!s)return}}}},t._decryptBuffer=function(e,t){this._decryptdata.key&&this._decrypter.decrypt(e,this._decryptdata.key.buffer,this._decryptdata.iv.buffer,t)},t._decryptAacSample=function(e,t,i,n){var r=e[t].unit,a=r.subarray(16,r.length-r.length%16),s=a.buffer.slice(a.byteOffset,a.byteOffset+a.length),o=this;this._decryptBuffer(s,(function(a){a=new Uint8Array(a),r.set(a,16),n||o.decryptAacSamples(e,t+1,i)}))},t._getAvcEncryptedData=function(e){for(var t=16*Math.floor((e.length-48)/160)+16,i=new Uint8Array(t),n=0,r=32;r<=e.length-16;r+=160,n+=16)i.set(e.subarray(r,r+16),n);return i},t._getAvcDecryptedUnit=function(e,t){for(var i=new Uint8Array(t),n=0,r=32;r<=e.length-16;r+=160,n+=16)e.set(i.subarray(n,n+16),r);return e},t._decryptAvcSample=function(e,t,i,n,r,a){var s=te(r.data),o=this._getAvcEncryptedData(s),c=this;this._decryptBuffer(o.buffer,(function(o){r.data=c._getAvcDecryptedUnit(s,o),a||c.decryptAvcSamples(e,t,i+1,n)}))},e}();!function(e){e[e.registration=5]="registration",e[e.av1=95]="av1",e[e.opus=127]="opus"}(Ne||(Ne={}));var Fe={5:function(e,t){be()(e,{descriptor_name:"registration",format_identifier:Object(v.a)(t,0,4)})}};function Ue(e,t){var i={descriptor_tag:e[t],descriptor_length:e[t+1]},n=Fe[i.descriptor_tag];return n&&n(i,e.subarray(t+2,t+2+i.descriptor_length)),i}var Be=[f.b.hevc,f.b.kvc3,f.b.kvc4,f.b.kvc5],He=function(){function e(e,t,i,s){var o=this;this._eventEmitter=void 0,this._config=void 0,this._typeSupported=void 0,this._remuxer=void 0,this._sampleAes=void 0,this._remuxStat=void 0,this._firstRemux=!0,this._pmtParsed=!1,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._duration=0,this._vLastDts=0,this._aLastDts=0,this._aacOverFlow=null,this._aacLastPTS=null,this._videoSample=null,this._contiguous=!1,this._timeOffset=0,this._accurateTimeOffset=!1,this._transmuxData=void 0,this._audioNonMonotonous=0,this._qos={aacOverhead:0,unknownTSPacketCount:0},this._hevcParamSets={spsList:[],ppsList:[],vpsList:[]},this._avcParamSets={spsList:[],ppsList:[]},this._av1sh=void 0,this._psUpdated=!1,this._remuxOnFlush=!1,this._av1Ctx=void 0,this._parsePMT=function(e,t,i,n){var r,s,c={audio:-1,video:-1,id3:-1,aCodecType:f.b.unknown,codecType:f.b.h264};for(r=t+3+((15&e[t+1])<<8|e[t+2])-4,t+=12+((15&e[t+10])<<8|e[t+11]);t<r;){switch(s=(31&e[t+1])<<8|e[t+2],e[t]){case 207:if(!n){a.b.v("unkown stream type:"+e[t]);break}case 15:-1===c.audio&&(c.audio=s),c.aCodecType=f.b.aac;break;case 21:-1===c.id3&&(c.id3=s);break;case 219:if(!n){a.b.v("unkown stream type:"+e[t]);break}case 27:-1===c.video&&(c.video=s);break;case 3:case 4:i.mpeg||i.mp3?-1===c.audio&&(c.audio=s):a.b.i("ts-demuxer","MPEG audio found, not supported in this browser for now"),c.aCodecType=f.b.mp3;break;case 6:case 196:var _=4095&Object(v.d)(e,t+3);if(_){var d=!1,u=!1,l=!1,h=!1;o._readDescriptors(e,t+5,_).forEach((function(e){if(e.descriptor_tag===Ne.av1)d=!0;else if(e.descriptor_tag===Ne.opus);else if(e.descriptor_tag===Ne.registration){var t=e.format_identifier;"AV01"===t&&(d=!0),"KVC3"===t&&(u=!0),"KVC4"===t&&(l=!0),"KVC5"===t&&(h=!0)}})),d&&(i.av1?-1===c.video&&-1===c.video&&(c.video=s):a.b.i("ts-demuxer","AV1 video found, not supported in this browser for now"),c.codecType=f.b.av1),u&&(c.codecType=f.b.kvc3,-1===c.video&&(c.video=s)),l&&(c.codecType=f.b.kvc4,-1===c.video&&(c.video=s)),h&&(c.codecType=f.b.kvc5,-1===c.video&&(c.video=s))}break;case 36:c.codecType=f.b.hevc,-1===c.video&&(c.video=s);break;default:a.b.v("unkown stream type:"+e[t])}t+=5+((15&e[t+3])<<8|e[t+4])}return c},this._pushAccesUnit=function(e,t){if(e.units.length&&e.frame){var i=t.samples,n=i.length;(!o._config.forceKeyFrameOnDiscontinuity||!0===e.key||t.decConf&&(n||o._contiguous))&&(o._config.gopRemux&&e.key&&i&&i.length>1&&o._remuxStat&&(o._remuxStat,o._remux()),e.id=o._videoTrack.samples.length,o._videoTrack.samples.push(e),e.key&&o._eventEmitter.emit(r.a.KEY_FRAME))}},this._createVSample=function(e,t,i){return i===o._vLastDts&&(i+=1,t+=1),o._vLastDts=i,{key:e,pts:t,dts:i,cts:t-i,units:[],streamDTS:i}},this._parseVideoPES=function(e,t){if(e.data){var i,n=o._videoTrack,r=o._videoSample;n.codecType===f.b.av1?(o._av1Ctx||(o._av1Ctx=$.createCtx()),i=$.parseOBU(e.data,o._av1Ctx)):i=o._readVideoNALu(e.data),e.data=null,r&&r.frame&&i.length&&!n.audFound&&(o._pushAccesUnit(r,n),r=o._videoSample=o._createVSample(!1,e.pts,e.dts)),o._isHevcSimilar(n.codecType)?r=o._parseHEVCNalu(i,e.pts,e.dts):n.codecType===f.b.h264?r=o._parseAVCNalu(i,e.pts,e.dts):n.codecType===f.b.av1&&(r||(r=o._videoSample=o._createVSample(!1,e.pts,e.dts)),i.forEach((function(e){var t;if(e.obu_type===V.AV1_OBU_SEQUENCE_HEADER){var i=e.content;i&&o._av1sh&&!Object(v.b)(o._av1sh.data,i.data)&&n.decConf&&(o._remuxByStat(!0),o._remuxer.ISGenerated&&o._transmuxData&&o._remuxer.resetInitSegment(o._transmuxData)),o._av1sh=i,fe.updateAV1Track(n,i)}r.frame=r.frame||e.obu_type===V.AV1_OBU_FRAME||e.obu_type===V.AV1_OBU_FRAME_HEADER,r.key=r.key||!(null==(t=e.content)||!t.keyframe),r.units.push({type:0,data:e.data})}))),t&&r&&(o._pushAccesUnit(r,n),o._videoSample=null)}},this._parseMPEGPES=function(e){if(e.data){var t=e.data,i=o._audioTrack,n=t.length,r=0,s=0,c=e.pts;if(void 0!==c)for(;s<n;)if(x(t,s)){var _=R(i,t,s,c,r);if(!_)break;s+=_.length,r++}else s++;else a.b.w("[tsdemuxer]: MPEG PES unknown PTS")}},this._parseAACPES=function(e){var t;if(e.data){var i,r,s,c,_,d,u=o._audioTrack,l=o._aacLastPTS,h=e.data,f=e.pts,m=o._aacOverFlow,v=null;if(o._aLastDts=e.dts,m){var y=new Uint8Array(m.byteLength+h.byteLength);y.set(m,0),y.set(h,m.byteLength),h=y}for(s=0,c=h.length;s<c-1&&!g.e(h,s);s++);if(s&&(s<c-1?(_="AAC PES did not start with ADTS header,offset:"+s,d=!1):(_="no ADTS header found in AAC PES",d=!0),a.b.w("parsing error:"+_),o._onError({type:n.b.MUX_ERROR,details:n.a.PARSING_ERROR,fatal:d,reason:_}),d))return;var E=h.subarray(s+2,s+4);if((g.f(u,E)||!u.configParsed)&&o._remuxer.ISGenerated&&o._transmuxData&&o._remuxer.resetInitSegment(o._transmuxData),g.c(u,o._eventEmitter,E,p.a.ADTS,null==(t=o._transmuxData)?void 0:t.audioCodec),r=0,i=g.b(u.samplerate),l&&(o._audioNonMonotonous||(o._audioNonMonotonous=f<l?1:0),o._audioNonMonotonous||m)){var b=l+i;Math.abs(b-f)>1&&(a.b.v("AAC: align PTS for overlapping frames by "+Math.round((b-f)/90)),f=b)}for(;s<c;)if(g.e(h,s)&&s+5<c){var A=g.a(u,h,s,f,r);if(!A){s++;break}s+=A.length,v=A.sample.pts,A.sample.streamDTS=e.pts,r++}else s++;r>1&&(o._qos.aacOverhead=1),m=s<c?h.subarray(s,c):null,o._aacOverFlow=m,o._aacLastPTS=v}},this._onError=function(e){o._eventEmitter.emit(r.a.ERROR,e)},this._isHevcSimilar=function(e){return!!e&&Be.indexOf(e)>=0},this._eventEmitter=e,this._config=i,this._typeSupported=s,this._remuxer=t,this._sampleAes=null,this._remuxStat=null}var t=e.prototype;return t.setDecryptData=function(e){e&&e.key&&"SAMPLE-AES"===e.method?this._sampleAes=new Ve(this._config,e):this._sampleAes=null},e.probe=function(t){var i=e.syncOffset(t);return!(i<0||(i&&a.b.w("MPEG2-TS detected but first sync word found @ offset "+i+", junk ahead ?"),0))},e.syncOffset=function(e){for(var t=Math.min(1e3,e.length-564),i=0;i<t;){if(71===e[i]&&71===e[i+188]&&71===e[i+376])return i;i++}return-1},e.createTrack=function(e,t){if(e===f.l.AUDIO)return Object(I.a)(t);var i=Object(I.b)(t);return i.audFound=!1,i.naluState=0,i},t.resetInitSegment=function(t){this._pmtParsed=!1,this._pmtId=-1,this._videoTrack=e.createTrack(f.l.VIDEO,t.duration),this._audioTrack=e.createTrack(f.l.AUDIO,t.duration),this._aacOverFlow=null,this._aacLastPTS=null,this._videoSample=null,this._duration=t.duration,this._vLastDts=0,this._aLastDts=0,this._audioNonMonotonous=0,this._qos.aacOverhead=0,this._remuxStat=null,this._transmuxData=t,this._firstRemux=!0},t.resetTimeStamp=function(){},t.append=function(e,t,i,a,s){void 0===s&&(s=!1),this._contiguous=i,this._timeOffset=t,this._accurateTimeOffset=a,null===this._remuxStat&&(this._remuxStat={timeOffset:t,contiguous:i,accurateTimeOffset:a}),this._remuxStat;var o,c,_,d,u,l=this._videoTrack,h=this._audioTrack,p=this._parsePAT,m=this._parsePMT,v=this._parsePES,g=this._parseVideoPES,y=this._parseAACPES,E=this._parseMPEGPES,b=e.length;this._pmtParsed;var A=l.pid,T=h.pid,S=this._pmtId,R=l.pesData,x=h.pesData;if(!e.byteLength&&s)return this._remux(!0),void this._onParsed();for(b-=(b+0)%188,o=0;o<b;o+=188)if(71===e[o]){if(c=!!(64&e[o+1]),_=((31&e[o+1])<<8)+e[o+2],(48&e[o+3])>>4>1){if((d=o+5+e[o+4])===o+188)continue}else d=o+4;switch(_){case A:c&&(R&&(u=v(R,!0))&&void 0!==u.pts&&g(u,!1),R={data:[],size:0}),R&&(R.data.push(e.subarray(d,o+188)),R.size+=o+188-d);break;case T:c&&(x&&(u=v(x))&&void 0!==u.pts&&(h.codecType===f.b.aac?y(u):E(u)),x={data:[],size:0}),x&&(x.data.push(e.subarray(d,o+188)),x.size+=o+188-d);break;case 0:c&&(d+=e[d]+1),S=this._pmtId=p(e,d);break;case S:c&&(d+=e[d]+1);var L=m(e,d,this._typeSupported,null!==this._sampleAes);if(L.video<0&&L.audio<0)return void this._onError({type:n.b.MUX_ERROR,details:n.a.PARSING_ERROR,fatal:!0,reason:"no track found"});if(!this._pmtParsed){var C={};this._duration&&(C.duration=this._duration),this._eventEmitter.emit(r.a.METADATA,C)}if(L.video>0){var D="boolean"!=typeof l.active||l.active;if(!this._isHevcSimilar(l.codecType)&&this._isHevcSimilar(L.codecType))D=L.codecType===f.b.hevc?fe.onHEVCDetected(l,this._config,this._typeSupported):fe.onKVCDetected(l,this._config,this._typeSupported);else if(l.codecType!==f.b.h264&&L.codecType===f.b.h264||l.codecType!==f.b.av1&&L.codecType===f.b.av1){var I;this._videoTrack.outputRaw&&(this._remux(!0),this._remuxer.ISGenerated&&this._transmuxData&&this._remuxer.resetInitSegment(this._transmuxData),this._videoTrack.outputRaw=!1),this._eventEmitter.emit(r.a.VIDEO_CODEC_DETECTED,{enabled:!0,decoder:f.c.buildin,codecType:f.b.h264,timeOffset:(null==(I=this._remuxStat)?void 0:I.timeOffset)||0})}l.pid=A=D?L.video:-1,l.active=D,l.codecType=L.codecType}(T=L.audio)>0&&(h.pid=T,h.active=!0,h.codecType=L.aCodecType),this._pmtParsed=!0;break;case 17:case 8191:break;default:this._qos.unknownTSPacketCount++}}else this._onError({type:n.b.MUX_ERROR,details:n.a.PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});R&&(u=v(R,s))&&void 0!==u.pts?(g(u,s),l.pesData=void 0):(this._videoSample&&s&&(this._pushAccesUnit(this._videoSample,l),this._videoSample=null),l.pesData=R),x&&(u=v(x))&&void 0!==u.pts?(h.codecType===f.b.aac?y(u):E(u),h.pesData=void 0):(x&&x.size,h.pesData=x),(T>0&&0===h.samples.length||A>0&&0===l.samples.length||A<=0&&T<=0)&&!s||(!s&&this._config.gopRemux||this._remux(s),s&&this._onParsed())},t._onParsed=function(){var e=be()({extra:this._transmuxData,audioNonMonotonous:this._audioNonMonotonous},this._qos);this._eventEmitter.emit(r.a.PARSED_DATA,e)},t.flush=function(){var e,t=this._videoTrack,i=this._audioTrack,n=t.pesData,r=i.pesData,a=this._parsePES,s=this._parseVideoPES,o=this._parseAACPES,c=this._parseMPEGPES;if(n&&(e=a(n,!0))&&void 0!==e.pts&&s(e,!0),t.pesData=void 0,r&&(e=a(r))&&void 0!==e.pts&&(i.codecType===f.b.aac?o(e):c(e)),i.pesData=void 0,i.pid&&0===i.samples.length&&t.pid&&0===t.samples.length)this._remuxer.flush();else{var _=this._remuxStat;_&&(_={timeOffset:this._timeOffset,contiguous:!0,accurateTimeOffset:this._accurateTimeOffset}),this._remux(!0),this._videoSample=null,this._remuxStat=null}},t._remuxByStat=function(e){void 0===e&&(e=!1),this._remuxStat&&this._remux(e)},t._remux=function(e){void 0===e&&(e=!1);var t=this._audioTrack,i=this._videoTrack;if(e){if(0==i.samples.length&&0===t.samples.length)return}else if(i.active&&i.samples.length<2||t.active&&0===t.samples.length)return;if(!this._remuxOnFlush||e){var n=!0,a=0,s=!1;this._remuxStat&&(n=this._remuxStat.contiguous,a=this._remuxStat.timeOffset,s=this._remuxStat.accurateTimeOffset),this._firstRemux&&(this._firstRemux=!1,this._eventEmitter.emit(r.a.MEDIA_DEMUX,{type:p.b.TS})),this._sampleAes?this._decryptAndRemux(t,i,a,n,s,e):this._remuxer.remux(t,i,a,n,s,e),this._remuxStat=null}},t._decryptAndRemux=function(e,t,i,n,r,a){if(void 0===a&&(a=!1),e.samples&&this._sampleAes){var s=this;this._sampleAes.decryptAacSamples(e.samples,0,(function(){s._decryptAndRemuxAvc(e,t,i,n,r,a)}))}else this._decryptAndRemuxAvc(e,t,i,n,r,a)},t._decryptAndRemuxAvc=function(e,t,i,n,r,a){if(void 0===a&&(a=!1),t.samples&&this._sampleAes){var s=this;this._sampleAes.decryptAvcSamples(t.samples,0,0,(function(){s._remuxer.remux(e,t,i,n,r,a)}))}else this._remuxer.remux(e,t,i,n,r,a)},t.destroy=function(){this._duration=0},t._parsePAT=function(e,t){return(31&e[t+10])<<8|e[t+11]},t._readDescriptors=function(e,t,i){for(var n=i?t+i:e.byteLength,r=[];n-t>2;){var a=Ue(e,t);r.push(a),t+=2+a.descriptor_length}return r},t._checkRegistrationDescriptors=function(e,t,i){var n=e[t];return t+=2,5===n&&e.length>=t+4?Object(v.a)(e,t,4):""},t._parsePES=function(e,t){void 0===t&&(t=!1);var i,n,r,s,o,c,_=e.data,d=0,u=0,l=0;if(!e||0===e.size)return null;for(;_[0].length<19&&_.length>1;){var f=new Uint8Array(_[0].length+_[1].length);f.set(_[0]),f.set(_[1],_[0].length),_[0]=f,_.splice(1,1)}if(1===((i=_[0])[0]<<16)+(i[1]<<8)+i[2]){if((r=(i[4]<<8)+i[5])&&r>e.size-6)return null;if(0===r&&!t)return null;192&(n=i[7])&&((u=536870912*(14&i[9])+4194304*(255&i[10])+16384*(254&i[11])+128*(255&i[12])+(254&i[13])/2)>4294967295&&(u-=8589934592),64&n?((l=536870912*(14&i[14])+4194304*(255&i[15])+16384*(254&i[16])+128*(255&i[17])+(254&i[18])/2)>4294967295&&(l-=8589934592),u-l>60*h.h&&(a.b.w(Math.round((u-l)/h.h)+"s delta between PTS and DTS, align them"),u=l)):l=u),c=(s=i[8])+9,e.size-=c,o=new Uint8Array(e.size);for(var p=0,m=_.length;p<m;p++){var v=(i=_[p]).byteLength;if(c){if(c>v){c-=v;continue}i=i.subarray(c),v-=c,c=0}o.set(i,d),d+=v}return r&&(r-=s+3),{data:o,pts:u,dts:l,len:r}}return null},t._parseHEVCNalu=function(e,t,i){var n,r=this,a=this._videoTrack,s=this._hevcParamSets,o=this._videoSample;return e.forEach((function(e){var c;switch(e.type){case F.a.HEVC_NAL_IDR_W_RADL:case F.a.HEVC_NAL_IDR_N_LP:case F.a.HEVC_NAL_CRA_NUT:r._checkParamSets(),n=!0,o||(o=r._videoSample=r._createVSample(!1,t,i)),o.key=!0,o.frame=!0;break;case F.a.HEVC_NAL_AUD:n=!1,a.audFound=!0,o&&r._pushAccesUnit(o,a),o=r._videoSample=r._createVSample(!1,t,i);break;case F.a.HEVC_NAL_SPS:n=!0;var _=ue.parse(e.data,a.codecType);s.sps&&!Object(v.b)(s.sps.data,_.data)&&(r._psUpdated=!0),s.spsList[_.sps_id]=_,s.sps=_;break;case F.a.HEVC_NAL_PPS:n=!0;var d=oe.parse(e.data);s.pps&&!Object(v.b)(s.pps.data,d.data)&&(r._psUpdated=!0),s.ppsList[d.pps_id]=d,s.pps=d;break;case F.a.HEVC_NAL_VPS:n=!0;var u=le.parse(e.data);s.vps&&!Object(v.b)(s.vps.data,u.data)&&(r._psUpdated=!0),s.vpsList[u.vps_id]=u,s.vps=u;break;default:if(r._checkParamSets(),n=!0,void 0===e.type){n=!1;break}o||(o=r._videoSample=r._createVSample(!0,t,i)),o.frame=!0}o&&n&&(null==(c=o.units)||c.push(e))})),o},t._parseAVCNalu=function(e,t,i){var n,r=this,a=this._videoTrack,s=this._avcParamSets,o=this._videoSample,c=!1;e.forEach((function(e){var _;switch(e.type){case L.H264_NAL_SLICE:r._checkParamSets(),n=!0,o||(o=r._videoSample=r._createVSample(!0,t,i)),o.frame=!0;var d=e.data;if(c&&d.length>4){var u=H(d);j(u,8),z(u);var l=z(u);2!==l&&4!==l&&7!==l&&9!==l||(o.key=!0)}break;case L.H264_NAL_IDR_SLICE:r._checkParamSets(),n=!0,o||(o=r._videoSample=r._createVSample(!0,t,i)),o.key=!0,o.frame=!0;break;case L.H264_NAL_SEI:n=!0;break;case L.H264_NAL_SPS:n=!0,c=!0;var h=re.parse(e.data);s.sps&&!Object(v.b)(s.sps.data,h.data)&&(r._psUpdated=!0),s.spsList[h.sps_id]=h,s.sps=h;break;case L.H264_NAL_PPS:n=!0;var f=ne.parse(e.data);s.pps&&!Object(v.b)(s.pps.data,f.data)&&(r._psUpdated=!0),s.ppsList[f.pps_id]=f,s.pps=f;break;case L.H264_NAL_AUD:n=!1,a.audFound=!0,o&&r._pushAccesUnit(o,a),o=r._videoSample=r._createVSample(!1,t,i);break;case L.H264_NAL_FILLER_DATA:default:n=!1}o&&n&&(null==(_=o.units)||_.push(e))}))},t._checkParamSets=function(){var e,t=this._videoTrack;t.decConf&&this._psUpdated&&(this._remuxByStat(!0),this._remuxer.ISGenerated&&this._transmuxData&&this._remuxer.resetInitSegment(this._transmuxData));var i=!1;t.decConf&&!this._psUpdated||(t.codecType===f.b.h264?this._avcParamSets.spsList.length&&this._avcParamSets.ppsList.length&&(fe.updateAVCTrack(t,this._avcParamSets),i=!0):this._hevcParamSets.spsList.length&&this._hevcParamSets.ppsList.length&&this._hevcParamSets.vpsList.length&&(fe.updateHEVCTrack(t,this._hevcParamSets),i=!0)),i&&this._eventEmitter.emit(r.a.VIDEO_CODEC_DETECTED,{enabled:t.active,decoder:t.outputRaw?f.c.wasm:f.c.buildin,codecType:t.codecType,bitDepth:t.bitDepth,timeOffset:(null==(e=this._remuxStat)?void 0:e.timeOffset)||0}),this._psUpdated=!1},t._getLastNalUnit=function(){var e,t=this._videoSample;if(!t||0===t.units.length){var i=this._videoTrack.samples;t=i[i.length-1]}if(t){var n=t.units;e=n[n.length-1]}return e},t._readVideoNALu=function(e){var t,i,n,r,a=this._videoTrack,s=e.byteLength,o=s,c=[],_=0,d=0,u=a.naluState||0,l=-1,h=u;if(-1===u)l=0,r=this._isHevcSimilar(a.codecType)?(126&e[0])>>1:31&e[0],u=0,_=1;else if(u>0)for(;d<4;d++){var f=e[d];if(0!==f){if(1===f&&u>=2){l=d+1,r=this._isHevcSimilar(a.codecType)?(126&e[l])>>1:31&e[l],u=0;var p=this._getLastNalUnit();p&&h&&d<=4-h&&p.state&&(p.data=p.data.subarray(0,p.data.byteLength-h));break}d<s&&(u=0);break}u++,_=d+1}for(;_<o;)if(1===(t=e[_+2]))if(0===e[_]&&0===e[_+1]){if(u=_>0&&0===e[_-1]?3:2,_+=3,l>=0)n={data:e.subarray(l,_-u-1),type:r},c.push(n);else{var m=this._getLastNalUnit();if(m&&(i=_-u-1)>0){var v=new Uint8Array(m.data.byteLength+i);v.set(m.data,0),v.set(e.subarray(0,i),m.data.byteLength),m.data=v}}_<s?(l=_,r=this._isHevcSimilar(a.codecType)?(126&e[_])>>1:31&e[_],u=0):u=-1}else _+=3;else 0===t?_++:_+=3;for(var g=s-1;g>s-4&&g>=d&&0===e[g];g--)u++;if(l>=0&&u>=0&&l<s&&(n={data:e.subarray(l,s),type:r,state:u},c.push(n)),0===c.length){var y=this._getLastNalUnit();if(y){var E=new Uint8Array(y.data.byteLength+e.byteLength);E.set(y.data,0),E.set(e,y.data.byteLength),y.data=E}}return a.naluState=u,c},l()(e,[{key:"minChunkSize",get:function(){return 188}},{key:"encryptedChunkSize",get:function(){return 752}}],[{key:"probeSize",get:function(){return 752}}]),e}(),je=function(){function e(e,t,i,n){this._eventEmitter=void 0,this._config=void 0,this._vendor=void 0,this._typeSupported=void 0,this._decrypter=void 0,this._nextIV=null,this._cache=new N.a,this._probe=void 0,this._muxConfig=[],this._demuxer=void 0,this._remuxer=void 0,this._stat=void 0,this._minChunkSize=0,this._eventEmitter=e,this._typeSupported=t,this._config=i,this._vendor=n,pe&&this._muxConfig.push({Demux:pe,Remux:me.b,type:p.b.FLV}),He&&this._muxConfig.push({Demux:He,Remux:me.b,type:p.b.TS}),Oe&&this._muxConfig.push({Demux:Oe,Remux:me.b,type:p.b.MP4}),Me&&this._muxConfig.push({Demux:Me,Remux:me.b,type:p.b.RAW}),ge&&this._muxConfig.push({Demux:ge,Remux:me.b,type:p.b.IVF}),this._minChunkSize=this._muxConfig.reduce((function(e,t){return Math.max(t.Demux.probeSize,e)}),0)}var t=e.prototype;return t.push=function(e,t,i,n,r,a,s,o,c,_){var u=this,l=e;if((s||a)&&this._cache.clear(),_.progress&&this._minChunkSize)if(this._cache.put(e),c)l=this._cache.get(this._cache.unreadLen);else{var h=Math.floor(this._cache.unreadLen/this._minChunkSize)*this._minChunkSize;if(!(h>=this._minChunkSize))return void(this._stat||(this._stat={contiguous:r,trackSwitch:a,discontinuity:s,accurateTimeOffset:o}));l=this._cache.get(h)}else this._cache.unreadLen&&(this._cache.put(e),l=this._cache.get(this._cache.unreadLen));if(l)if(e=l,this._stat&&(r=this._stat.contiguous,a=this._stat.trackSwitch,s=this._stat.discontinuity,o=this._stat.accurateTimeOffset,this._stat=void 0),e.byteLength>0&&t&&t.key&&"AES-128"===t.method){var f=this._decrypter;!f&&He&&d&&(f=this._decrypter=new d(this._config,{removePKCS7Padding:c})),s&&(this._nextIV=null);var p=this._nextIV?this._nextIV:t.iv;if(!f)return;f.decrypt(e,t.key.buffer,p.buffer,(function(d){c?u._nextIV=null:(u._nextIV=new Uint8Array(16),u._nextIV.set(e.subarray(e.byteLength-16),0)),u._pushDecrypted(new Uint8Array(d),t,i,n,r,a,s,o,c,_)}))}else t&&c&&(this._nextIV=null),this._pushDecrypted(e,t,i,n,r,a,s,o,c,_)},t.flush=function(){this._demuxer&&this._demuxer.flush(),this._cache.clear()},t.end=function(){this._eventEmitter.emit(r.a.LOAD_END)},t._probeData=function(e,t,i,a){if(!this._demuxer||t&&this._probe&&!this._probe(e)){for(var s=this._eventEmitter,o=this._typeSupported,c=this._config,_=0,d=this._muxConfig.length;_<d;_++){var u=this._muxConfig[_],l=u.Demux.probe;if(l(e)){this._remuxer=new u.Remux(s,c,o,this._vendor),this._demuxer=new u.Demux(s,this._remuxer,c,o),this._eventEmitter.emit(r.a.DEMUXER_DETECTED,{type:u.type}),this._probe=l;break}}if(!this._demuxer)return void this._eventEmitter.emit(r.a.ERROR,{type:n.b.MUX_ERROR,details:n.a.DEMUX_NOT_FOUND,fatal:!0,reason:"no demux matching with content found"})}},t._pushDecrypted=function(e,t,i,n,r,a,s,o,c,_){this._demuxer||this._probeData(e,!0,i,_);var d=this._demuxer,u=this._remuxer;u&&d&&(this._minChunkSize=t?d.encryptedChunkSize||16:d.minChunkSize||0,(a||s)&&(d.resetInitSegment(_,i),u.resetInitSegment(_)),s&&(d.resetTimeStamp(),u.resetTimeStamp()),t&&d.hasOwnProperty("setDecryptData")&&d.setDecryptData(t),d.append(e,n,r,o,c))},e}();t.a=je},function(e,t,i){var n,r,a=i(36),s=i(32),o=i(3),c=i(0),_=i(1),d=i(2),u=i(22),l=i(5),h=i.n(l),f=i(16),p=i(21),m=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),v=new Float32Array([1.164,1.164,1.164,0,-.392,2.017,1.596,-.813,0]),g=new Float32Array([1,1,1,0,-.343,1.765,1.4,-.711,0]),y=new Float32Array([1,1,1,-.011864761000000005,-.302259224,1.801888929,1.197778023,-.6617980229999999,.008744828]),E=new Float32Array([1.164,1.164,1.164,-.013561232000000003,-.345441461,2.059156233,1.365248481,-.756825597,.010008336]),b=new Float32Array([1.164,1.164,1.164,0,-.213,2.112,1.793,-.533,0]),A=new Float32Array([1,1,1,0,-.187,1.856,1.575,-.468,0]),T=new Float32Array([1.164,1.164,1.164,0,-.187,2.141,1.678,-.6504,0]),S=new Float32Array([1,-0,0,0,1,0,0,0,1]),R=new Float32Array([0,-1,0,1,0,0,0,0,1]),x=new Float32Array([-1,0,0,0,-1,0,0,0,1]),L=new Float32Array([0,1,0,-1,0,0,0,0,1]),C="webgl-frame",D=function(){function e(e){this._gl=void 0,this._textures={},this._framebuffers={},this._program=null,this._buf=null,this._positionLocation=0,this._lumaPositionBuffer=null,this._lumaPositionLocation=0,this._chromaPositionBuffer=null,this._chromaPositionLocation=0,this._colorCovYoffset=null,this._texsizeLocation=null,this._colorCovLocation=null,this._colorTrcLocation=null,this._bitsPerPixelLocation=null,this._matrixLocation=null,this._vertexShader=null,this._fragmentShader=null,this._frameInfo={rotation:0},this._outputFBO=null,this._output=null,this._pictMode=p.b.normal,this._afterDrawCB=void 0,d.b.i(C,"constructor"),this._gl=e}e.getRotMatrix=function(e){switch(e){case 90:return R;case 180:return x;case 270:return L}return S},e._texParam=function(e,t){e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR)};var t=e.prototype;return t.destroy=function(){d.b.i(C,"destroy");var e=this._gl;if(e){this._clearWebGL(),d.b.i(C,"destroy. lose ctx");var t=e.getExtension("WEBGL_lose_context");t&&t.loseContext()}this._frameInfo.buffer=void 0,this._frameInfo.colorInfo=void 0,this._afterDrawCB=void 0},t.setWebGLCtx=function(e,t){void 0===t&&(t=p.b.normal),d.b.i(C,"set webgl",e,e!==this._gl),this._pictMode=t,e!==this._gl&&(this._clearWebGL(),this._gl=e)},t.drawToFBO=function(){var t=this._gl;if(d.b.i(C,"draw to fbo",!!t),t)return this._output||(this._output=t.createTexture(),e._texParam(t,this._output),this._outputFBO=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this._outputFBO),t.texImage2D(t.TEXTURE_2D,0,t.LUMINANCE,t.canvas.width,t.canvas.height,0,t.LUMINANCE,t.UNSIGNED_BYTE,null),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this._output,0)),{texture:this._output,framebuffer:this._outputFBO}},t.drawToCanvas=function(){d.b.i(C,"draw to canvas");var e=this._gl;e&&(this._outputFBO&&e.deleteFramebuffer(this._outputFBO),this._output&&e.deleteTexture(this._output),this._outputFBO=null,this._output=null)},t.afterDraw=function(e){this._afterDrawCB=e},t._createOrReuseTexture=function(e){if(this._textures[e])return this._textures[e];var t=this._gl;if(!t)return null;var i=t.createTexture();return i?(this._textures[e]=i,i):null},t._uploadTexture=function(t,i,n,r,a){var s=this._gl;if(s){var o=this._createOrReuseTexture(t);s.activeTexture(s.TEXTURE0),e._texParam(s,o),s.texImage2D(s.TEXTURE_2D,0,r>8?s.LUMINANCE_ALPHA:s.LUMINANCE,i,n,0,r>8?s.LUMINANCE_ALPHA:s.LUMINANCE,s.UNSIGNED_BYTE,a)}},t._init=function(){d.b.i(C,"init");var e=this._gl;e&&(this._program=this._initProgram("\n    precision lowp float;\n\n    attribute vec2 aPosition;\n    attribute vec2 aLumaPosition;\n    attribute vec2 aChromaPosition;\n    varying vec2 vLumaPosition;\n    varying vec2 vChromaPosition;\n    uniform mat3 uMatrix;\n    void main() {\n        gl_Position = vec4((uMatrix * vec3(aPosition, 1)).xy, 0, 1);\n        vLumaPosition = aLumaPosition;\n        vChromaPosition = aChromaPosition;\n    }\n    ","\n    #define EOTF_C1 .8359375\n    #define EOTF_C2 18.8515625\n    #define EOTF_C3 18.6875\n    #define EOTF_HLG_GAMMA 0.2\n    #define _EOTF_HLG_A 0.17883277\n    #define _EOTF_HLG_B 0.28466892\n    #define _EOTF_HLG_C 0.55991073\n    #define MAIN_A 2.51\n    #define MAIN_B 0.03\n    #define MAIN_C 1.23\n    #define MAIN_D 0.59\n    #define MAIN_E 0.14\n    #define MAIN_ADAPTED_LUM 0.001\n\n    precision lowp float;\n\n    const vec3 eotf_m1 = vec3(1.0 / .1593017578125);\n    const vec3 eotf_m2 = vec3(1.0 / 78.84375);\n    const vec3 tonemapping_hlg_m1 = vec3(1.0 / 1.3);\n    const vec3 main_m1 = vec3(0.555555555556);\n    const vec3 main_m2 = vec3(2.0);\n    \n    // bt2020 to bt709\n    const mat3 mat_xyz_to_rgbp3 = mat3(\n        1.66049100210843, -0.124550474521591, -0.0181507633549054, \n        -0.587641138788548, 1.13289989712596, -0.100578898008008, \n        -0.0728498633198855, -0.00834942260436943, 1.11872966136291\n    );\n\n    float _eotf_hlg(float x) {\n        if (x < 0.5) {\n            return pow(x / 0.5, 2.0) / 12.0;\n        } else {\n            return (exp((x - _EOTF_HLG_C) / _EOTF_HLG_A) + _EOTF_HLG_B) / 12.0;\n        }\n    }\n\n    vec3 eotf_hlg(vec3 i) {\n        vec3 res;\n        float Y = 0.2627 * res.x + 0.6780 * res.y + 0.0593 * res.z;\n        res = pow(Y, EOTF_HLG_GAMMA) * res;\n        res.x = _eotf_hlg(i.x);\n        res.y = _eotf_hlg(i.y);\n        res.z = _eotf_hlg(i.z);\n        return res;\n    }\n\n    vec3 eotf(vec3 i) {\n        i = max(i, 1e-10);\n        vec3 input_m2 = pow(i, eotf_m2);\n        return pow((input_m2 - EOTF_C1) / (EOTF_C2 - EOTF_C3 * input_m2), eotf_m1) * 10000.0;\n    }\n\n    vec3 tonemapping_hlg(vec3 i) {\n        vec3 res = pow(i, tonemapping_hlg_m1);\n        return res;\n    }\n\n    float _trc_gamma(float i) {\n        if (i < 0.018) {\n            return 4.5 * i;\n        } else {\n            return 1.099 * pow(i, 0.45);\n        }\n    }\n\n    vec3 trc_gamma(vec3 i) {\n        vec3 res;\n        res.x = _trc_gamma(i.x);\n        res.y = _trc_gamma(i.y);\n        res.z = _trc_gamma(i.z);\n        return res;\n    }\n\n    // vec3 rgb_gamma(vec3 i) {\n    //     vec3 l = 4.5 * i;\n    //     vec3 g = 1.099 * pow(i, vec3(0.45)) - 0.099;\n    //     if(i.x > 0.018 && i.y > 0.018 && i.z > 0.018) {\n    //         return l;\n    //     } else {\n    //         return g;\n    //     }\n    // }\n\n    // vec3 rgb_inverse_gamma(vec3 i) {\n    //     vec3 l = i / 4.5;\n    //     vec3 g = pow((i + 0.099) / 1.099, vec3(1.0 / 0.45, 1.0 / 0.45, 1.0 / 0.45));\n    //     if(i.x > 0.018 * 4.5 && i.y > 0.018 * 4.5 && i.z > 0.018 * 4.5) {\n    //         return l;\n    //     } else {\n    //         return g;\n    //     }\n    // }\n\n    // vec3 inverse_eotf(vec3 i) {\n    //     float c1 = .8359375;\n    //     float c2 = 18.8515625;\n    //     float c3 = 18.6875;\n    //     vec3 m1 = vec3(.1593017578125);\n    //     vec3 m2 = vec3(78.84375);\n\n    //     i = max(i / 10000.0, 1e-10);\n    //     return pow(max(pow(i, m1) * c2 + c1, vec3(0.0)) / (1.0 + c3 * pow(i, m1)), m2);\n    // }\n\n    // float _inverse_trc(float x) {\n    //     return pow(x, 1.5);\n    // }\n\n    // vec3 inverse_trc(vec3 i) {\n    //     vec3 res;\n    //     res.x = _inverse_trc(i.x);\n    //     res.y = _inverse_trc(i.y);\n    //     res.z = _inverse_trc(i.z);\n    //     return res;\n    // }\n\n    uniform sampler2D uTextureY;\n    uniform sampler2D uTextureCb;\n    uniform sampler2D uTextureCr;\n    uniform float uColorCovYOffset;\n    uniform mat3 uColorConversion;\n    uniform int uColorTrc;\n    uniform int uBitsPerPixel;\n    varying vec2 vLumaPosition;\n    varying vec2 vChromaPosition;\n\n    void main() {\n        vec3 yuv;\n        if (uBitsPerPixel > 8) {\n            float normalized = pow(2.0, float(uBitsPerPixel - 8));\n            yuv.x = (texture2D(uTextureY, vLumaPosition).r + texture2D(uTextureY, vLumaPosition).a * 256.0) / normalized + uColorCovYOffset;\n            yuv.y = (texture2D(uTextureCb, vChromaPosition).r + texture2D(uTextureCb, vChromaPosition).a * 256.0) / normalized - 0.5;\n            yuv.z = (texture2D(uTextureCr, vChromaPosition).r + texture2D(uTextureCr, vChromaPosition).a * 256.0) / normalized - 0.5;\n            vec3 rgb = uColorConversion * yuv;\n\n            vec3 rgb_lum;\n            if (uColorTrc == 16) { // HDR10 or HDR10+\n                // EOTF\n                rgb_lum = eotf(rgb);\n\n                //tone mapping\n                vec3 tmp = rgb_lum * MAIN_ADAPTED_LUM;\n                rgb_lum = tmp * (tmp * MAIN_A + MAIN_B) / (tmp * (tmp * MAIN_C + MAIN_D) + MAIN_E) / 1.3;\n                rgb_lum = pow(rgb_lum, main_m1) * pow(main_m2, rgb_lum) / 2.0; //g=1.8\n\n                //\n                float gray = (rgb_lum.x + rgb_lum.y + rgb_lum.z) / 2.0;\n                rgb_lum = rgb_lum + (rgb_lum * 1.5 - gray) * 0.12;\n            } else { // HLG\n                rgb_lum = eotf_hlg(rgb);\n                rgb_lum = tonemapping_hlg(rgb_lum);\n            }\n            vec3 rgbp3 = trc_gamma(mat_xyz_to_rgbp3 * rgb_lum);\n            gl_FragColor = vec4(rgbp3, 1.0);\n        } else {\n            yuv.x = texture2D(uTextureY, vLumaPosition).x + uColorCovYOffset;\n            yuv.y = texture2D(uTextureCb, vChromaPosition).x - 0.5;\n            yuv.z = texture2D(uTextureCr, vChromaPosition).x - 0.5;\n            gl_FragColor = vec4(clamp(uColorConversion * yuv, 0.0, 1.0), 1.0);\n        }\n    }"),this._program&&(this._buf=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this._buf),e.bufferData(e.ARRAY_BUFFER,m,e.STATIC_DRAW),this._positionLocation=e.getAttribLocation(this._program,"aPosition"),this._lumaPositionBuffer=e.createBuffer(),this._lumaPositionLocation=e.getAttribLocation(this._program,"aLumaPosition"),this._chromaPositionBuffer=e.createBuffer(),this._chromaPositionLocation=e.getAttribLocation(this._program,"aChromaPosition"),this._colorCovYoffset=e.getUniformLocation(this._program,"uColorCovYOffset"),this._colorCovLocation=e.getUniformLocation(this._program,"uColorConversion"),this._colorTrcLocation=e.getUniformLocation(this._program,"uColorTrc"),this._bitsPerPixelLocation=e.getUniformLocation(this._program,"uBitsPerPixel"),this._texsizeLocation=e.getUniformLocation(this._program,"textureSize"),this._matrixLocation=e.getUniformLocation(this._program,"uMatrix"),e.pixelStorei(e.UNPACK_ALIGNMENT,1)))},t._attachTexture=function(e,t,i){var n=this._gl;n&&this._program&&(n.activeTexture(t),n.bindTexture(n.TEXTURE_2D,this._textures[e]),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.uniform1i(n.getUniformLocation(this._program,e),i))},t._initProgram=function(e,t){var i=this._gl;if(i){d.b.i(C,"init program",i);var n=this._compileShader(i.VERTEX_SHADER,e),r=this._compileShader(i.FRAGMENT_SHADER,t);this._vertexShader=n,this._fragmentShader=r;var a=i.createProgram();if(a&&n&&r){if(i.attachShader(a,n),i.attachShader(a,r),i.linkProgram(a),!i.getProgramParameter(a,i.LINK_STATUS)){var s=i.getProgramInfoLog(a);throw i.deleteProgram(a),new Error("GL program linking failed: "+s)}return a}}return null},t._compileShader=function(e,t){var i=this._gl;if(i){var n=i.createShader(e);if(n){if(i.shaderSource(n,t),i.compileShader(n),!i.getShaderParameter(n,i.COMPILE_STATUS)){var r=i.getShaderInfoLog(n);throw i.deleteShader(n),new Error("GL shader compilation for "+e+" failed: "+r)}return n}}return null},t.drawFrame=function(t,i,n){void 0===n&&(n=0);var r=this._gl;if(r){var a=t.format,s=t.y.bits>8?2:1,o=!this._program||this._checkFormatUpdated(t.format);this._frameInfo.buffer=t,this._frameInfo.colorInfo=i,this._frameInfo.rotation=n,o&&this.clear(),this._program||this._init(),o&&(this._setupTexturePosition(this._lumaPositionBuffer,this._lumaPositionLocation,t.y.stride/s,t.format),this._setupTexturePosition(this._chromaPositionBuffer,this._chromaPositionLocation,t.u.stride*a.width/a.chromaWidth/s,t.format)),this._uploadTexture("uTextureY",t.y.stride/s,t.format.height,t.y.bits,t.y.bytes),this._uploadTexture("uTextureCb",t.u.stride/s,t.format.chromaHeight,t.u.bits,t.u.bytes),this._uploadTexture("uTextureCr",t.v.stride/s,t.format.chromaHeight,t.v.bits,t.v.bytes),r.useProgram(this._program),this._pictMode===p.b.normal?r.viewport((r.canvas.width-a.displayWidth)/2,(r.canvas.height-a.displayHeight)/2,a.displayWidth,a.displayHeight):r.viewport(0,0,r.canvas.width,r.canvas.height),this._attachTexture("uTextureY",r.TEXTURE0,0),this._attachTexture("uTextureCb",r.TEXTURE1,1),this._attachTexture("uTextureCr",r.TEXTURE2,2),this._output&&(r.activeTexture(r.TEXTURE3),r.bindTexture(r.TEXTURE_2D,this._output),r.bindFramebuffer(r.FRAMEBUFFER,this._outputFBO),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.canvas.width,r.canvas.height,0,r.RGBA,r.UNSIGNED_BYTE,null));var c,_=-16/255;i?(c=i.matrixCoefficients===f.c.AVCOL_SPC_BT2020_CL||i.matrixCoefficients===f.c.AVCOL_SPC_BT2020_NCL?T:i.matrixCoefficients===f.c.AVCOL_SPC_BT709?i.colorRange===f.b.AVCOL_RANGE_MPEG?b:A:i.colourPrimaries===f.a.AVCOL_PRI_BT470BG?i.colorRange===f.b.AVCOL_RANGE_MPEG?E:y:i.colorRange===f.b.AVCOL_RANGE_MPEG?v:g,i.colorRange===f.b.AVCOL_RANGE_JPEG&&(_=0),r.uniform1i(this._colorTrcLocation,i.transferCharacteristics)):c=v,r.uniform1i(this._bitsPerPixelLocation,t.y.bits),r.uniformMatrix3fv(this._matrixLocation,!1,e.getRotMatrix(n)),r.uniform1f(this._colorCovYoffset,_),r.uniformMatrix3fv(this._colorCovLocation,!1,c);var d=new Float32Array([a.width,a.height]);r.uniform2fv(this._texsizeLocation,d),r.bindBuffer(r.ARRAY_BUFFER,this._buf),r.enableVertexAttribArray(this._positionLocation),r.vertexAttribPointer(this._positionLocation,2,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,this._lumaPositionBuffer),r.enableVertexAttribArray(this._lumaPositionLocation),r.vertexAttribPointer(this._lumaPositionLocation,2,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,this._chromaPositionBuffer),r.enableVertexAttribArray(this._chromaPositionLocation),r.vertexAttribPointer(this._chromaPositionLocation,2,r.FLOAT,!1,0,0),r.drawArrays(r.TRIANGLES,0,m.length/2),this._output&&(r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.activeTexture(r.TEXTURE0)),r.finish(),this._afterDrawCB&&this._afterDrawCB()}},t.reDraw=function(){this._frameInfo.buffer&&this.drawFrame(this._frameInfo.buffer,this._frameInfo.colorInfo,this._frameInfo.rotation)},t._setupTexturePosition=function(e,t,i,n){var r=this._gl;if(r){var a=n.cropLeft/i,s=(n.cropLeft+n.cropWidth)/i,o=(n.cropTop+n.cropHeight)/n.height,c=n.cropTop/n.height,_=new Float32Array([a,o,s,o,a,c,a,c,s,o,s,c]);r.bindBuffer(r.ARRAY_BUFFER,e),r.bufferData(r.ARRAY_BUFFER,_,r.STATIC_DRAW)}},t.clear=function(){var e=this._gl;e&&(e.viewport(0,0,e.canvas.width,e.canvas.height),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT))},t._checkFormatUpdated=function(e){var t,i=null==(t=this._frameInfo.buffer)?void 0:t.format;return!(i&&e.width===i.width&&e.height===i.height&&e.chromaWidth===i.chromaWidth&&e.chromaHeight===i.chromaHeight)},t._clearWebGL=function(){var e=this;d.b.i(C,"clear WebGL");var t=this._gl;t&&(t.disableVertexAttribArray(this._positionLocation),t.disableVertexAttribArray(this._lumaPositionLocation),t.disableVertexAttribArray(this._chromaPositionLocation),this._buf&&t.deleteBuffer(this._buf),this._lumaPositionBuffer&&t.deleteBuffer(this._lumaPositionBuffer),this._chromaPositionBuffer&&t.deleteBuffer(this._chromaPositionBuffer),Object.keys(this._textures).forEach((function(t){e._gl&&e._textures[t]&&e._gl.deleteTexture(e._textures[t]),delete e._textures[t]})),Object.keys(this._framebuffers).forEach((function(t){e._gl&&e._framebuffers[t]&&e._gl.deleteFramebuffer(e._framebuffers[t]),delete e._framebuffers[t]})),this._program&&t.deleteProgram(this._program),this._vertexShader&&t.deleteShader(this._vertexShader),this._fragmentShader&&t.deleteShader(this._fragmentShader),this._program=null)},h()(e,[{key:"outputTexture",get:function(){return this._output?{texture:this._output,framebuffer:this._outputFBO}:void 0}}]),e}(),I=i(33);(r=n||(n={}))[r.OK=0]="OK",r[r.REORDER=1]="REORDER";var w=function(){function e(){this._cache=[],this._totalSize=0,this._index=-1,this._lastDuration=1e3/24,this._maxCacheSize=52428800}var t=e.prototype;return t.init=function(e){e&&e>52428800&&(this._maxCacheSize=e)},t.reset=function(){d.b.i("yuv-cache","reset"),this._cache=[],this._totalSize=0,this._index=-1},t.next=function(){return this.getFrameByIndex(this._index+1)},t.prev=function(){return this.getFrameByIndex(this._index-1)},t.push=function(e,t){void 0===t&&(t=!1);var i=n.OK,r=e.y.bytes.byteLength+e.u.bytes.byteLength+e.v.bytes.byteLength,a=this._cache[this._cache.length-1],s=a?e.format.pts-a.pts:this._lastDuration;if(this._cache.push({pts:e.format.pts,endPTS:e.format.pts+s,size:r,yuv:e}),t&&(e.y.bytes=new Uint8Array(e.y.bytes),e.u.bytes=new Uint8Array(e.u.bytes),e.v.bytes=new Uint8Array(e.v.bytes)),a)if((s<=0||s>=1e3)&&d.b.i("yuv-cache","yuv cache pts diff: "+s+", "+a.pts+"/"+e.format.pts),s<0){this._cache.sort((function(e,t){return e.pts-t.pts}));for(var o=0;o<this._cache.length-1;o++)this._cache[o].endPTS=this._cache[o+1].pts;var c=this._cache[this._cache.length-1];this._lastDuration=c.pts-a.pts,c.endPTS=c.pts+this._lastDuration,i=n.REORDER}else a.endPTS=e.format.pts,this._lastDuration=s;return this._totalSize+=r,this._checkTotalSize(),i},t.decDropFrameInfo=function(e){d.b.i("yuv-cache","dec drop: "+e.count+" "+e.pts+" ~ "+e.endPTS);var t=this._cache[this._cache.length-1];t&&(t.endPTS=e.pts,this._lastDuration=e.pts-t.pts,(this._lastDuration<=0||this._lastDuration>=1e3)&&d.b.i("yuv-cache","yuv drop frame pts diff: "+this._lastDuration)),this._cache.push({pts:e.pts,endPTS:e.endPTS,size:0})},t.ptsToIndex=function(e){return this._cache.length&&e<=this._cache[this._cache.length-1].endPTS?I.a.searchIndex(this._cache,(function(t){return e<t.pts?-1:e>t.endPTS?1:0})):-1},t.getFrameByIndex=function(e){if(e>=0&&e<this._cache.length)return this._index=e,this._cache[e]},t.getLessPtsIdxThen=function(e){var t=this._cache[e];if(t&&e>0&&e<this._cache.length)for(var i=e-1;i>=0;i--)if(this._cache[i].pts<t.pts)return i;return-1},t.flush=function(e){if(d.b.i("yuv-cache","flush"),e>=0&&this.reset(),this._cache.length&&e<=this._cache[this._cache.length-1].endPTS){var t=Math.max(0,I.a.searchIndex(this._cache,(function(t){return e<t.pts?-1:e>t.pts?1:0})));this._cache=this._cache.slice(0,t),t<this._index&&(this._index=t)}},t.hasDropedAfterIdx=function(e){if(e>=this._cache.length)return!1;for(var t=Math.max(0,e);t<this._cache.length;t++)if(!this._cache[t].yuv)return!0;return!1},t._checkTotalSize=function(){for(;this._totalSize>=this._maxCacheSize&&this._index>0;){var e=this._cache.shift();e&&e.yuv&&(this._totalSize-=e.size),this._index--}},h()(e,[{key:"current",get:function(){return this.getFrameByIndex(this._index)}},{key:"index",get:function(){return this._index},set:function(e){e>=0&&e<this._cache.length&&(this._index=e)}},{key:"cache",get:function(){return this._cache}},{key:"remaining",get:function(){return this._cache.length-1-this._index}}]),e}(),k=function(){function e(e){this._config=void 0,this._eventEmitter=void 0,this._yuvCache=new w,this._yuv=void 0,this._decBlockPolicy=_.m.NONE,this._waitingVideoSync=!0,this._nextDraw=void 0,this._mediaInfo=void 0,this._clock=0,this._yuvBufferLenOnWaiting=3,this._output=_.o.canvas,this._endOfData=!1,this._loop=void 0,this._maxFrameBufLen=10,this._cOutput=void 0,this._eventEmitter=e}var t=e.prototype;return t.init=function(e,t,i){this._config=t,i instanceof s.a?this._cOutput=i:this._cOutput=new a.a(i),this._decBlockPolicy=this._config.videoDecBlockPolicy,this._yuvCache.init(t.videoFrameBufferSize);try{var n=Object(u.a)();this._cOutput.webgl&&n.webGL&&(this._yuv=new D(this._cOutput.webgl),this._cOutput instanceof s.a&&this._cOutput.setWebGLFrameSink(this._yuv))}catch(e){console.error(e)}this._yuv?this._startLoop():this._eventEmitter.emit(c.a.ERROR,{type:o.b.DECODER_ERROR,details:o.a.DECODER_WEBGL_ERROR,fatal:!0,reason:"render initialization error"})},t.append=function(e){var t;this._yuvCache.push(e)===n.REORDER&&(d.b.i("canvas-renderer","yuv cache reorder."),this._yuvCache.ptsToIndex(this._clock),this._nextDraw=this._yuvCache.current,null!=(t=this._nextDraw)&&t.yuv&&this._draw(this._nextDraw.yuv)),this._checkWaitingReady()},t._checkWaitingReady=function(){this._waitingVideoSync&&(this._yuvCache.remaining>=this._yuvBufferLenOnWaiting||this._dataEnded())&&this._onWaitingReady()},t.updateState=function(e,t,i,n,r,a){if(this._clock=1e3*e,this._output!==r&&this._yuv&&this._yuv.clear(),this._output=r,this._maxFrameBufLen=a,r!==_.o.video&&this._cOutput&&this._cOutput.updateCanvasSize(t,i)){var s=this._yuvCache.current;s&&s.yuv&&this._draw(s.yuv)}},t.updateMediaInfo=function(e){this._mediaInfo=e},t.step=function(e){if(!this._waitingVideoSync)if(e===_.j.NEXT){var t,i=this._nextDraw?this._nextDraw.pts:-1;i>=0&&null!=(t=this._nextDraw)&&t.yuv&&(this._clock=i,this._eventEmitter.emit(c.a.STEP,{type:e,time:i}))}else if(e===_.j.PREV){var n=this._nextDraw?this._yuvCache.index-1:this._yuvCache.index;if(n>0){var r=this._yuvCache.getLessPtsIdxThen(n);if(r>=0){if(n-r>1&&d.b.i("canvas-renderer","step prev skip "+(n-r-1)),this._nextDraw=this._yuvCache.getFrameByIndex(r),this._nextDraw&&this._nextDraw.yuv)return this._clock=this._nextDraw.yuv.format.pts,void this._eventEmitter.emit(c.a.STEP,{type:e,time:this._nextDraw.yuv.format.pts})}else this._yuvCache.reset()}this._eventEmitter.emit(c.a.STEP,{type:e,time:-1})}},t.seek=function(e){d.b.i("canvas-renderer","seek: "+e);var t=this._yuvCache.ptsToIndex(1e3*e);if(-1!==t){if(!this._yuvCache.hasDropedAfterIdx(t))return this._yuvCache.index=t,this._nextDraw=this._yuvCache.current,d.b.i("canvas-renderer","seek hit yuv cache"),this._clock=1e3*e,this._updateRenderer(),void this._eventEmitter.emit(c.a.RENDERER_SEEK,{hitCache:!0,time:e,type:"renderer"});d.b.i("canvas-renderer","yuv cache has dropped."),this._yuvCache.reset()}d.b.i("canvas-renderer","seek miss yuv cache"),this._eventEmitter.emit(c.a.RENDERER_SEEK,{hitCache:!1,time:e,type:"renderer"})},t.endOfData=function(){d.b.i("canvas-renderer","end of data"),this._endOfData=!0,this._checkWaitingReady()},t.decDropFrameInfo=function(e){d.b.i("canvas-renderer","dec drop frame info"),this._yuvCache.decDropFrameInfo(e)},t.reset=function(e,t){void 0===t&&(t=!1),d.b.i("canvas-renderer","reset",e),this._yuvCache.reset(),t||(this._clock=-1),this._waitingVideoSync=!0,this._nextDraw=void 0,this._endOfData=!1,this._eventEmitter.emit(c.a.RENDERER_BUF_UPDATE,{needMore:!0,yuvBufLen:0})},t.flush=function(e){void 0===e&&(e=0),this._yuvCache.flush(e),this._nextDraw=void 0,this._eventEmitter.emit(c.a.RENDERER_BUF_UPDATE,{needMore:!0,yuvBufLen:0})},t.destroy=function(){this._yuv&&this._yuv.destroy(),this._yuvCache.reset(),this._stopLoop(),!this._cOutput||this._cOutput instanceof s.a||this._cOutput.destroy(),this._cOutput=void 0},t._dataEnded=function(){return this._endOfData},t._updateRenderer=function(){var e,t;if(this._cOutput&&-1!==this._clock){var i=this._yuvCache.remaining;for(!this._nextDraw||null!=(e=this._nextDraw)&&e.yuv||d.b.i("canvas-renderer","skip empty frame"),this._nextDraw&&null!=(t=this._nextDraw)&&t.yuv||(this._nextDraw=this._yuvCache.next());this._nextDraw&&this._clock>=0;){var n=this._clock-this._nextDraw.pts,r=this._clock-this._nextDraw.endPTS;if(this._waitingVideoSync&&r>200)d.b.v("canvas-renderer","skip draw",this._clock,this._nextDraw.endPTS,r),this._nextDraw=this._yuvCache.next();else{if(this._checkWaitingReady(),this._waitingVideoSync||!(n>=-1))break;if(r<=200){d.b.v("canvas-renderer","draw",this._nextDraw.pts,n,r),this._nextDraw.yuv&&this._draw(this._nextDraw.yuv),this._nextDraw=this._yuvCache.next();break}this._decBlockPolicy===_.m.NONE?(this._nextDraw.yuv&&this._draw(this._nextDraw.yuv),this._nextDraw=this._yuvCache.next()):(d.b.v("canvas-renderer","skip b",this._nextDraw.pts,n,r),this._nextDraw=this._yuvCache.next(),this._nextDraw||this._onWaiting())}}i!=this._yuvCache.remaining&&this._eventEmitter.emit(c.a.RENDERER_BUF_UPDATE,{needMore:this._yuvCache.remaining<this._yuvBufferLenOnWaiting,yuvBufLen:this._yuvCache.remaining})}},t._draw=function(e){var t;if(this._cOutput){var i,n=e.format,r=(null==(t=this._mediaInfo)?void 0:t.rotation)||0;this._cOutput.updateFormatSize(n.width,n.height,r),n.displayWidth=this._cOutput.displaySize.w,n.displayHeight=this._cOutput.displaySize.h,this._yuv&&this._yuv.drawFrame(e,null==(i=this._mediaInfo)?void 0:i.colorInfo,r),this._eventEmitter.emit(c.a.RENDERER_DRAW,{yuvBufLen:this._yuvCache.remaining})}},t._startLoop=function(){var e=this;this._loop||(this._loop=setInterval((function(){e._updateRenderer()}),0))},t._stopLoop=function(){this._loop&&(clearInterval(this._loop),this._loop=void 0)},t._onWaiting=function(){var e=this._maxFrameBufLen||10;d.b.i("canvas-renderer","waiting. frame buf: "+e),this._yuvBufferLenOnWaiting!==e&&(this._yuvBufferLenOnWaiting=e),this._waitingVideoSync=!0,this._eventEmitter.emit(c.a.DECODER_WAITING)},t._onWaitingReady=function(){d.b.i("canvas-renderer","waiting ready. frame buf: "+this._yuvCache.remaining+", data ended: "+this._dataEnded()),this._waitingVideoSync=!1,this._eventEmitter.emit(c.a.DEC_VIDEO_READY)},e}();t.a=k},function(e,t,i){var n,r,a=i(11),s=i(3),o=i(0),c=i(6),_=i(1),d=i(10),u=i(2),l=i(37);(r=n||(n={}))[r.KS265_PIXFMT_YUV_420P=0]="KS265_PIXFMT_YUV_420P",r[r.KS265_PIXFMT_YUV_420SP=1]="KS265_PIXFMT_YUV_420SP",r[r.KS265_PIXFMT_YUV_420SP_VU=2]="KS265_PIXFMT_YUV_420SP_VU";var h,f={nWidth:720,nHeight:1280,nCodedWidth:720,nCodedHeight:1280,nLumaBitDepth:10,nChromaBitDepth:10,nChromaFormatIdc:0,profile:1,level:150,has_b_frames:1,pts:0,bIllegalStream:0,poc:0},p=[0,0,0,1],m=function(){function e(e){this._eventEmitter=void 0,this._module=void 0,this._libks265=void 0,this._ctx=0,this._needNextFrame=!1,this._pendingNum=0,this._isDataEnded=!1,this._config={pAuth:0,threads:1,nal_mode:0,pic_out_pos:0,bEnableOutputRecToFile:0,strRecYuvFileName:0,logLevel:0,outputPixfmt:n.KS265_PIXFMT_YUV_420P,b_use_pthread:0},this._configPtr=0,this._framePtr=0,this._eventEmitter=e}var t=e.prototype;return t.init=function(e,t,i){var n=this,r=e.js.data,a=e.jsw?e.jsw.data:"",s=new Function(r+" return KW265;")(),o=a?new Blob([r],{type:"text/javascript"}):"",c=new Blob([a],{type:"text/javascript"});return s({wasmBinary:e.wasm.data,mainScriptUrlOrBlob:o,locateFile:function(e){return-1!==e.indexOf(".worker.js")?URL.createObjectURL(c):""}}).then((function(e){n._module=e,n._cwrapLibKS265Fun(),i>1?(n._config.b_use_pthread=1,n._config.threads=i,n._config.nal_mode=0):n._config.nal_mode=0,n._newDecoder()}))},t.pushNalus=function(e,t,i){void 0===i&&(i=!1),this._updateKS265FrameInfo(this._module,this._framePtr+24,f),this._module.setValue(this._framePtr,0,"i32"),this._pendingNum++;var n=e.reduce((function(e,t){return e+t.data.byteLength}),0)+p.length*e.length,r=new Uint8Array(n),a=0;e.forEach((function(e){r.set(p,a),r.set(e.data,a+p.length),a+=p.length+e.data.byteLength}));var s=performance.now();this._libks265.KS265DecodeFrame(this._ctx,r,n,Math.round(t)||0),this._tryGetFrame(s),this._isDataEnded=i},t.getPendingNALNumber=function(){return this._pendingNum},t.endOfFrame=function(){},t.nextFrame=function(){this._pendingNum&&this._tryGetFrame(),this._needNextFrame=!0},t.free=function(){this._libks265.KS265DecoderDestroy(this._ctx),this._configPtr&&this._module._free(this._configPtr),this._framePtr&&this._module._free(this._framePtr),this._configPtr=this._framePtr=0},t.rebuild=function(){u.b.i("ks265-wrapper","rebuild"),this.free(),this._pendingNum=0,this._needNextFrame=!1,this._isDataEnded=!1,this._newDecoder()},t.flush=function(){},t.reset=function(){},t.isWaitingData=function(){return this._needNextFrame},t._tryGetFrame=function(e){if(e=e||performance.now(),this._isDataEnded&&this._libks265.KS265DecodeFlush(this._ctx,0),!(this._libks265.KS265DecoderGetDecodedFrame(this._ctx,this._framePtr)<0)){var t=this._readKS265Frame(this._module,this._framePtr);t.bValid&&(this._eventEmitter.emit(o.a.DECODER_FRAME,{frame:this._getImage(t),startTime:e}),this._isDataEnded||this._libks265.KS265DecoderReturnDecodedFrame(this._ctx,this._framePtr),this._needNextFrame=!1,this._pendingNum--)}},t._newDecoder=function(){this._configPtr=this._mallocKS265DecConfig(this._module,this._config),this._framePtr=this._mallocKS265Frame(this._module,f),this._ctx=this._libks265.KS265DecoderCreate(this._configPtr),this._libks265.KS265DecodeFlush(this._ctx,1)},t._getImage=function(e){return{format:{width:e.frameinfo.nWidth,height:e.frameinfo.nHeight,chroma:1,chromaWidth:e.frameinfo.nWidth/2,chromaHeight:e.frameinfo.nHeight/2,cropLeft:0,cropTop:0,cropWidth:e.frameinfo.nWidth,cropHeight:e.frameinfo.nHeight,displayWidth:0,displayHeight:0,pts:e.frameinfo.pts},y:{bytes:this._module.HEAPU8.subarray(e.pData[0],e.pData[0]+e.iStride[0]*e.frameinfo.nHeight),stride:e.iStride[0],bits:8},u:{bytes:this._module.HEAPU8.subarray(e.pData[1],e.pData[1]+e.iStride[1]*e.frameinfo.nHeight/2),stride:e.iStride[1],bits:8},v:{bytes:this._module.HEAPU8.subarray(e.pData[2],e.pData[2]+e.iStride[2]*e.frameinfo.nHeight/2),stride:e.iStride[2],bits:8}}},t._mallocKS265DecConfig=function(e,t){var i=e._malloc(36);return e.setValue(i,t.pAuth,"i32"),e.setValue(i+4,t.threads,"i32"),e.setValue(i+8,t.nal_mode,"i32"),e.setValue(i+12,t.pic_out_pos,"i32"),e.setValue(i+16,t.bEnableOutputRecToFile,"i32"),e.setValue(i+20,t.strRecYuvFileName,"i32"),e.setValue(i+24,t.logLevel,"i32"),e.setValue(i+28,t.outputPixfmt,"i32"),e.setValue(i+32,t.b_use_pthread,"i32"),i},t._readKS265FrameInfo=function(e,t){return{nWidth:e.getValue(t,"i32"),nHeight:e.getValue(t+4,"i32"),nCodedWidth:e.getValue(t+8,"i32"),nCodedHeight:e.getValue(t+12,"i32"),nLumaBitDepth:e.getValue(t+16,"i32"),nChromaBitDepth:e.getValue(t+20,"i32"),nChromaFormatIdc:e.getValue(t+24,"i32"),profile:e.getValue(t+28,"i32"),level:e.getValue(t+32,"i32"),has_b_frames:e.getValue(t+36,"i32"),pts:e.getValue(t+40,"i32"),bIllegalStream:e.getValue(t+48,"i32"),poc:e.getValue(t+52,"i32")}},t._updateKS265FrameInfo=function(e,t,i){e.setValue(t,i.nWidth,"i32"),e.setValue(t+4,i.nHeight,"i32"),e.setValue(t+8,i.nCodedWidth,"i32"),e.setValue(t+12,i.nCodedHeight,"i32"),e.setValue(t+16,i.nChromaFormatIdc,"i32"),e.setValue(t+20,i.profile,"i32"),e.setValue(t+24,i.level,"i32"),e.setValue(t+28,i.has_b_frames,"i32"),e.setValue(t+32,i.pts,"i64")},t._mallocKS265Frame=function(e,t){return e._malloc(80)},t._readKS265Frame=function(e,t){return{bValid:e.getValue(t,"i32"),pData:[e.getValue(t+4,"i32"),e.getValue(t+8,"i32"),e.getValue(t+12,"i32")],iStride:[e.getValue(t+16,"i16"),e.getValue(t+18,"i16"),e.getValue(t+20,"i16")],frameinfo:this._readKS265FrameInfo(e,t+24)}},t._cwrapLibKS265Fun=function(){this._libks265={KS265DecoderCreate:this._module.cwrap("KS265DecoderCreate","number",["number"]),KS265DecoderDestroy:this._module.cwrap("KS265DecoderDestroy","number",["number"]),KS265DecoderSetDecConfig:this._module.cwrap("KS265DecoderSetDecConfig","number",["number","number"]),KS265DecodeFrameHeader:this._module.cwrap("KS265DecodeFrameHeader","number",["number","array","number"]),KS265DecodeFrame:this._module.cwrap("KS265DecodeFrame","number",["number","array","number","number"]),KS265DecodeFlush:this._module.cwrap("KS265DecodeFlush","number",["number","number"]),KS265DecoderGetDecodedFrame:this._module.cwrap("KS265DecoderGetDecodedFrame","number",["number","number"]),KS265DecoderReturnDecodedFrame:this._module.cwrap("KS265DecoderReturnDecodedFrame","number",["number","number"]),KS265DumpVUIParameters:this._module.cwrap("KS265DumpVUIParameters","number",["number","number","number"]),module:this._module}},e}();!function(e){e[e.KVC_PIXFMT_YUV_420P=0]="KVC_PIXFMT_YUV_420P",e[e.KVC_PIXFMT_YUV_420SP=1]="KVC_PIXFMT_YUV_420SP",e[e.KVC_PIXFMT_YUV_420SP_VU=2]="KVC_PIXFMT_YUV_420SP_VU"}(h||(h={}));var v={width:720,height:1280,codedWidth:720,codedHeight:1280,chromaFormat:0,profile:1,level:150,hasBFrames:1,pts:0},g=[0,0,0,1],y=function(){function e(e){this._eventEmitter=void 0,this._module=void 0,this._libkvc=void 0,this._ctx=0,this._needNextFrame=!1,this._pendingNum=0,this._isDataEnded=!1,this._config={threads:1,queueDecode:0,picOutPos:0,outputPixfmt:h.KVC_PIXFMT_YUV_420P,b_use_pthread:0},this._configPtr=0,this._framePtr=0,this._eventEmitter=e}var t=e.prototype;return t.init=function(e,t,i){var n=this,r=e.js.data,a=e.jsw?e.jsw.data:"",s=new Function(r+" return KVCDecoder;")(),o=a?new Blob([r],{type:"text/javascript"}):"",c=new Blob([a],{type:"text/javascript"});return s({wasmBinary:e.wasm.data,mainScriptUrlOrBlob:o,locateFile:function(e){return-1!==e.indexOf(".worker.js")?URL.createObjectURL(c):""}}).then((function(e){n._module=e,n._cwrapLibKVCFun(),i>1?(n._config.b_use_pthread=1,n._config.threads=i,n._config.queueDecode=0):n._config.queueDecode=0,n._newDecoder()}))},t.pushNalus=function(e,t,i){void 0===i&&(i=!1),this._updateKVCFrameInfo(this._module,this._framePtr+24,v),this._module.setValue(this._framePtr,0,"i32"),this._pendingNum++;var n=e.reduce((function(e,t){return e+t.data.byteLength}),0)+g.length*e.length,r=new Uint8Array(n),a=0;e.forEach((function(e){r.set(g,a),r.set(e.data,a+g.length),a+=g.length+e.data.byteLength}));var s=performance.now();this._libkvc.KVCDecodeFrame(this._ctx,r,n,Math.round(t)||0),this._tryGetFrame(s),this._isDataEnded=i},t.getPendingNALNumber=function(){return this._pendingNum},t.endOfFrame=function(){},t.nextFrame=function(){this._pendingNum&&this._tryGetFrame(),this._needNextFrame=!0},t.free=function(){this._libkvc.KVCDecoderDestroy(this._ctx),this._ctx=0,this._configPtr&&this._module._free(this._configPtr),this._framePtr&&this._module._free(this._framePtr),this._configPtr=this._framePtr=0},t.rebuild=function(){this._pendingNum=0,this._needNextFrame=!1,this._isDataEnded=!1,u.b.i("kvc-wrapper","rebuild"),this.free(),this._newDecoder()},t.flush=function(){},t.reset=function(){},t.isWaitingData=function(){return this._needNextFrame},t._tryGetFrame=function(e){if(e=e||performance.now(),this._isDataEnded&&this._libkvc.KVCDecodeFlush(this._ctx,0),!(this._libkvc.KVCDecoderGetDecodedFrame(this._ctx,this._framePtr)<0)){var t=this._readKVCFrame(this._module,this._framePtr);t.valid&&(this._eventEmitter.emit(o.a.DECODER_FRAME,{frame:this._getImage(t),startTime:e}),this._isDataEnded||this._libkvc.KVCDecoderReturnDecodedFrame(this._ctx,this._framePtr),this._needNextFrame=!1,this._pendingNum--)}},t._newDecoder=function(){this._configPtr=this._mallocKVCDecConfig(this._module,this._config),this._framePtr=this._mallocKVCFrame(this._module,v),this._ctx=this._libkvc.KVCDecoderCreate(this._configPtr),this._libkvc.KVCDecodeFlush(this._ctx,1)},t._getImage=function(e){return{format:{width:e.info.width,height:e.info.height,chroma:1,chromaWidth:e.info.width/2,chromaHeight:e.info.height/2,cropLeft:0,cropTop:0,cropWidth:e.info.width,cropHeight:e.info.height,displayWidth:0,displayHeight:0,pts:e.info.pts},y:{bytes:this._module.HEAPU8.subarray(e.data[0],e.data[0]+e.stride[0]*e.info.height),stride:e.stride[0],bits:8},u:{bytes:this._module.HEAPU8.subarray(e.data[1],e.data[1]+e.stride[1]*e.info.height/2),stride:e.stride[1],bits:8},v:{bytes:this._module.HEAPU8.subarray(e.data[2],e.data[2]+e.stride[2]*e.info.height/2),stride:e.stride[2],bits:8}}},t._mallocKVCDecConfig=function(e,t){var i=e._malloc(20);return e.setValue(i,t.threads,"i32"),e.setValue(i+4,t.queueDecode,"i32"),e.setValue(i+8,t.picOutPos,"i32"),e.setValue(i+12,t.outputPixfmt,"i32"),e.setValue(i+16,t.b_use_pthread,"i32"),i},t._mallocKVCFrameInfo=function(e){return e._malloc(40)},t._readKVCFrameInfo=function(e,t){return{width:e.getValue(t,"i32"),height:e.getValue(t+4,"i32"),codedWidth:e.getValue(t+8,"i32"),codedHeight:e.getValue(t+12,"i32"),chromaFormat:e.getValue(t+16,"i32"),profile:e.getValue(t+20,"i32"),level:e.getValue(t+24,"i32"),hasBFrames:e.getValue(t+28,"i32"),pts:e.getValue(t+32,"i64")}},t._updateKVCFrameInfo=function(e,t,i){e.setValue(t,i.width,"i32"),e.setValue(t+4,i.height,"i32"),e.setValue(t+8,i.codedWidth,"i32"),e.setValue(t+12,i.codedHeight,"i32"),e.setValue(t+16,i.chromaFormat,"i32"),e.setValue(t+20,i.profile,"i32"),e.setValue(t+24,i.level,"i32"),e.setValue(t+28,i.hasBFrames,"i32"),e.setValue(t+32,i.pts,"i64")},t._mallocKVCFrame=function(e,t){return e._malloc(64)},t._readKVCFrame=function(e,t){return{valid:e.getValue(t,"i32"),data:[e.getValue(t+4,"i32"),e.getValue(t+8,"i32"),e.getValue(t+12,"i32")],stride:[e.getValue(t+16,"i16"),e.getValue(t+18,"i16"),e.getValue(t+20,"i16")],info:this._readKVCFrameInfo(e,t+24)}},t._cwrapLibKVCFun=function(){this._libkvc={KVCDecoderCreate:this._module.cwrap("KVCDecoderCreate","number",["number"]),KVCDecoderDestroy:this._module.cwrap("KVCDecoderDestroy","number",["number"]),KVCDecoderSetDecConfig:this._module.cwrap("KVCDecoderSetDecConfig","number",["number","number"]),KVCDecodeFrameHeader:this._module.cwrap("KVCDecodeFrameHeader","number",["number","array","number"]),KVCDecodeFrame:this._module.cwrap("KVCDecodeFrame","number",["number","array","number","number"]),KVCDecodeFlush:this._module.cwrap("KVCDecodeFlush","number",["number","number"]),KVCDecoderGetDecodedFrame:this._module.cwrap("KVCDecoderGetDecodedFrame","number",["number","number"]),KVCDecoderReturnDecodedFrame:this._module.cwrap("KVCDecoderReturnDecodedFrame","number",["number","number"]),KVCDecoderGetVersion:this._module.cwrap("KVCDecoderGetVersion","number"),KVC19DumpVUIParameters:this._module.cwrap("KVCDumpVUIParameters","number",["number","number","number"]),module:this._module}},e}(),E=1e3/a.f,b=[c.a.HEVC_NAL_TRAIL_N,c.a.HEVC_NAL_TSA_N,c.a.HEVC_NAL_STSA_N,c.a.HEVC_NAL_RADL_N,c.a.HEVC_NAL_RASL_N],A=[c.a.HEVC_NAL_IDR_W_RADL,c.a.HEVC_NAL_IDR_N_LP,c.a.HEVC_NAL_CRA_NUT],T=function(){function e(e){var t=this;this._decoder=void 0,this._eventEmitter=void 0,this._clock=-1,this._frameBufLen=0,this._maxFrameBufLen=16,this._vLastPTS=0,this._vLastDTS=0,this._dataCache=[],this._gopId=0,this._frameDuration=33,this._droppedFrames=0,this._decodedFrames=0,this._loop=void 0,this._decodeTimes=[],this._avgDecodeDuration=0,this._mediaInfo=void 0,this._hasOverriddenFPS=!1,this._output=_.o.canvas,this._decConfigData=void 0,this._seeking=!1,this._seekingTime=0,this._decId=1,this._defaultDropPolicy=_.n.AUTO,this._dropPolicy=_.n.AUTO,this._lastDataCachePTS=-1,this._endOfData=!1,this._expiredDataSync=!1,this._lastPushPTS=0,this._appendDecActive=!1,this._decBufInfo=[],this._onSeeked=function(e){t._eventEmitter.emit(o.a.DECODER_SEEK,{hitCache:e}),e?t._seeking=!1:t._expiredDataSync=!0},this._onSeekAbort=function(){t._seeking=!1,t._eventEmitter.emit(o.a.DECODER_SEEK_ABORT)},this._onFrame=function(e){for(t._vLastPTS=e.frame.format.pts;t._decBufInfo.length&&e.frame.format.pts+1>=t._decBufInfo[0].pts;)t._decBufInfo.shift();if(t._decodeTimes.length>10&&t._decodeTimes.shift(),e.startTime){var i=performance.now()-e.startTime;t._decodeTimes.push(i),t._avgDecodeDuration=t._decodeTimes.reduce((function(e,t){return e+t}),0)/t._decodeTimes.length,t._vLastPTS+=i,t._decodedFrames++;var n=e.frame;t._preprocessYUV(n),t._eventEmitter.emit(o.a.DECODER_IMG,{droped:t._droppedFrames,decoded:t._decodedFrames,decId:t._decId,frame:n});var r=t._seekingTime;t._endOfData&&(r=t._lastDataCachePTS>=0?Math.min(t._lastDataCachePTS,r):r),t._seeking&&e.frame.format.pts+1>=r&&t._onSeeked(!0)}},this._eventEmitter=e,this._eventEmitter.on(o.a.DECODER_FRAME,this._onFrame)}var t=e.prototype;return t.init=function(e,t,i,n,r,a,c){var d=this;this._decId=e,this._dropPolicy=i.videoDropFramePolicy,this._defaultDropPolicy=i.videoDropFramePolicy,this._decoder=a===_.b.kvc3||a===_.b.kvc4||a===_.b.kvc5?new y(this._eventEmitter):c===_.p.kw265?new m(this._eventEmitter):new l.a(this._eventEmitter);try{this._decoder.init(t,n,r).then((function(){d._decoder&&(d._appendDecActive=!0,d._decoder.nextFrame(),d._startLoop(),d._eventEmitter.emit(o.a.DEC_INIT_COMPLETE,{simd:n,threads:r,decoderType:c}))})).catch((function(e){d._eventEmitter.emit(o.a.ERROR,{type:s.b.DECODER_ERROR,details:s.a.DECODER_INIT_ERROR,fatal:!0,reason:e})}))}catch(e){this._eventEmitter.emit(o.a.ERROR,{type:s.b.DECODER_ERROR,details:s.a.DECODER_INIT_ERROR,fatal:!0,reason:e.message})}},t.expiredDataSync=function(){this._expiredDataSync=!1},t.appendData=function(e){var t=this;this._expiredDataSync||(this._endOfData&&u.b.i("v-decoder-inline","end of data false on append"),this._endOfData=!1,e.type!==d.c.decoderConfig?(e.samples.forEach((function(i){var n=t._isIDR(i);if(n||-1!==t._lastDataCachePTS){var r;if(n)t._decConfigData&&(r=i.units).unshift.apply(r,t._decConfigData.units),t._gopId++;var s={key:n,gopId:t._gopId,type:e.type||d.c.videoFrame,data:i,dts:i.dts/90,pts:i.pts/90};s.pts>t._lastDataCachePTS&&(t._lastDataCachePTS=s.pts);var o=t._dataCache.length?t._dataCache[t._dataCache.length-1].dts:t._vLastDTS;s.discontinuity=!!(s.type===d.c.videoFrame&&o&&Math.abs(s.dts-o)>a.g),t._dataCache.push(s)}})),!this._hasOverriddenFPS&&this._dataCache.length>10&&(this._frameDuration=Math.max(E,(this._dataCache[this._dataCache.length-1].dts-this._dataCache[0].dts)/(this._dataCache.length-1)))):this._decConfigData=e.samples[0])},t.endOfData=function(){u.b.i("v-decoder-inline","end of data"),this._endOfData=!0},t.updateState=function(e,t,i,n,r,a){this._output=t,this._appendDecActive=i,this._frameBufLen=n,this._maxFrameBufLen=a,this._dropPolicy=r>=1.5?_.n.ALL_NON_REF:this._defaultDropPolicy,this._seeking&&Math.abs(e-this._seekingTime/1e3)>.1&&this._onSeekAbort(),t!==_.o.video&&(this._clock=1e3*e)},t.updateMediaInfo=function(e){var t;this._mediaInfo=e,this._mediaInfo.rotation=((null==(t=this._mediaInfo)?void 0:t.rotation)||0)%360,this._mediaInfo.rotation<0&&(this._mediaInfo.rotation+=360),this._updateFPS()},t.destroy=function(){this._eventEmitter.off(o.a.DECODER_FRAME,this._onFrame),this._appendDecActive=!1,this._stopLoop()},t.flush=function(e){if(u.b.i("v-decoder-inline","flush",e),this._dataCache.length&&e>this._dataCache[0].pts){for(var t=0;t<this._dataCache.length&&!(this._dataCache[t].key&&this._dataCache[t].pts>e);t++);this._dataCache=this._dataCache.slice(0,t)}else e>this._lastPushPTS&&this._decoder&&this._decoder.rebuild()},t.reset=function(e,t){void 0===t&&(t=!1),u.b.i("v-decoder-inline","reset",e),this._decoder&&this._decoder.rebuild(),this._decId=e,this._dataCache=[],this._lastDataCachePTS=-1,this._vLastPTS=0,this._vLastDTS=0,this._clock=-1,this._frameBufLen=0,this._endOfData=!1,this._expiredDataSync=!1,this._lastPushPTS=0,this._appendDecActive=!0,this._decBufInfo=[],this._updateFPS(),t||(this._seeking=!1,this._seekingTime=0)},t.seek=function(e){var t,i;u.b.i("v-decoder-inline","decoder seek: "+e),e*=1e3,this._clock=this._seekingTime=e,this._seeking=!0;var n=this._vLastPTS||(null==(t=this._decBufInfo[0])?void 0:t.pts)||0,r=this._decBufInfo.length?this._decBufInfo[this._decBufInfo.length-1].pts+this._frameDuration:this._vLastPTS||(null==(i=this._dataCache[0])?void 0:i.pts)||0;if(this._decBufInfo.length&&e>=n&&e<=r)u.b.i("v-decoder-inline","decoder seek hit dec cache");else if(this._dataCache.length&&r<=e&&this._lastDataCachePTS>=e){for(var a=this._dataCache[0].gopId,s=a,c=0,_=0,d=0;d<this._dataCache.length&&(this._dataCache[d].gopId===a&&_++,this._dataCache[d].gopId!==s&&(s=this._dataCache[d].gopId,c=d),!(this._dataCache[d].pts>=e));d++);s===a||_<=3&&s-a==1?u.b.i("v-decoder-inline","decoder seek hit data cache. continue decode"):(u.b.i("v-decoder-inline","decoder seek hit data cache. switch gop"),this._eventEmitter.emit(o.a.RENDERER_BUF_EXPIRED),this._dataCache.splice(0,c),this._decoder&&this._decoder.rebuild(),this._vLastPTS=0,this._vLastDTS=0,this._lastPushPTS=0)}else u.b.i("v-decoder-inline","decoder seek miss cache."),this._dataCache=[],this._onSeeked(!1)},t._dataEnded=function(){return!(!this._endOfData||this._dataCache.length||!this._decoder||this._decoder.isWaitingData()||this._decoder.getPendingNALNumber())},t._preprocessYUV=function(e){this._preprocessYUVPlane(e.y,e.format.width,e.format.height),this._preprocessYUVPlane(e.u,e.format.chromaWidth,e.format.chromaHeight),this._preprocessYUVPlane(e.v,e.format.chromaWidth,e.format.chromaHeight)},t._preprocessYUVPlane=function(e,t,i){var n=e.bits>8?2:1;if(e.stride/n>t){for(var r=new Uint8Array(t*i*n),a=0;a<i;a++)r.set(e.bytes.subarray(e.stride*a,e.stride*a+t*n),a*t*n);e.stride=t*n,e.bytes=r}else e.bytes=new Uint8Array(e.bytes)},t._pushDataToDecoder=function(e){this._decoder&&e&&(this._decBufInfo.push({pts:e.pts,dts:e.dts,gopId:e.gopId}),this._decBufInfo.sort((function(e,t){return e.pts-t.pts})),this._decoder.pushNalus(e.data.units,e.pts,this._endOfData&&!this._dataCache.length),e.pts>this._lastPushPTS&&(this._lastPushPTS=e.pts),e.type===d.c.videoFrame&&(this._vLastDTS=e.dts,this._dataCache.length||this._decoder.endOfFrame()))},t._resetTime=function(){u.b.i("v-decoder-inline","reset time"),this._decoder&&this._vLastDTS&&this._decoder.reset(),this._vLastPTS=0,this._vLastDTS=0,this._lastPushPTS=0},t._update=function(){if(this._decoder&&-1!==this._clock&&this._output!==_.o.video){var e=this._clock;if(this._vLastPTS&&this._dataCache.length&&this._appendDecActive&&!this._seeking){var t=this._syncIndex(e);t>5&&this._dropFrame(e,this._dataCache[t].gopId)}e+=(this._maxFrameBufLen+16)*this._frameDuration;var i=this._frameBufLen<this._maxFrameBufLen;if(this._appendDecActive&&this._dataCache.length&&(this._vLastPTS<=e||i)){for(var n=this._dataCache[0],r=0;n&&(n.dts<=e||!this._vLastDTS||i)&&!(++r>3);)if(this._dropPolicy===_.n.ALL_NON_REF&&this._isRefFrame(n.data))this._dataCache.shift(),n=this._dataCache[0],this._droppedFrames++;else{var a=this._dataCache.shift();this._pushDataToDecoder(a),n=this._dataCache[0],i=!1}this._endOfData&&!this._dataCache.length&&(this._decoder.flush(),this._eventEmitter.emit(o.a.DECODER_DATA_END))}this._decoder.isWaitingData()&&!this._decoder.getPendingNALNumber()||this._decoder.nextFrame()}},t._syncIndex=function(e){for(var t=0;t<this._dataCache.length;t++)if(this._dataCache[t].type===d.c.videoFrame&&this._dataCache[t].dts>=e)return t;return this._dataCache.length?this._dataCache.length-1:-1},t._dropFrame=function(e,t){for(var i,n=0,r=!1,a=0,s=!1,c=0;a<this._dataCache.length;){var l=this._dataCache[a],h=void 0;if(l.type===d.c.videoFrame)if(l.gopId<t)s=!0,h=this._dataCache.splice(a,1)[0];else{if(l.gopId>t)break;if(!(e>l.dts&&this._dropPolicy!==_.n.MIN))break;this._isRefFrame(l.data)&&(h=this._dataCache.splice(a,1)[0]),a++}else l.gopId<t&&(h=this._dataCache.splice(a,1)[0]);h&&(void 0===i&&(i=h.pts),c=h.pts,n++,h.discontinuity&&(r=!0))}if(this._droppedFrames+=n,s&&this._decoder&&this._decoder.rebuild(),r&&this._resetTime(),n&&void 0!==i){u.b.i("v-decoder-inline","drop frame",n,e,s);var f={pts:i,endPTS:c,count:n};this._eventEmitter.emit(o.a.DECODER_DROP_FRAME,f)}},t._updateFPS=function(){var e=this._mediaInfo;e.fps&&"number"==typeof e.fps&&e.fps>0&&e.fps<a.f?(this._hasOverriddenFPS=!0,this._frameDuration=1e3/e.fps):this._frameDuration=1e3/24},t._isRefFrame=function(e){return e.units.reduce((function(e,t){return-1!==b.indexOf(t.type)&&e}),!0)},t._isIDR=function(e){return e.units.reduce((function(e,t){return-1!==A.indexOf(t.type)||e}),!1)},t._startLoop=function(){var e=this;this._loop||(this._loop=setInterval((function(){e._update()}),0))},t._stopLoop=function(){this._loop&&(clearInterval(this._loop),this._loop=void 0)},e}();t.a=T},function(e,t,i){var n,r,a,s,o,c,_,d,u,l,h,f,p,m,v,g,y,E,b,A,S,R,x,L,C,D,I,w,k,O,N,P,M,V,F,U,B;e.exports=(r="function"==typeof atob,a="function"==typeof btoa,s="function"==typeof T,o="function"==typeof TextDecoder?new TextDecoder:void 0,c="function"==typeof TextEncoder?new TextEncoder:void 0,_=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),n={},_.forEach((function(e,t){return n[e]=t})),d=n,u=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,l=String.fromCharCode.bind(String),h="function"==typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):function(e,t){return void 0===t&&(t=function(e){return e}),new Uint8Array(Array.prototype.slice.call(e,0).map(t))},f=function(e){return e.replace(/=/g,"").replace(/[+\/]/g,(function(e){return"+"==e?"-":"_"}))},p=function(e){return e.replace(/[^A-Za-z0-9\+\/]/g,"")},m=function(e){for(var t,i,n,r,a="",s=e.length%3,o=0;o<e.length;){if((i=e.charCodeAt(o++))>255||(n=e.charCodeAt(o++))>255||(r=e.charCodeAt(o++))>255)throw new TypeError("invalid character found");a+=_[(t=i<<16|n<<8|r)>>18&63]+_[t>>12&63]+_[t>>6&63]+_[63&t]}return s?a.slice(0,s-3)+"===".substring(s):a},g=s?function(e){return T.from(e).toString("base64")}:function(e){for(var t=[],i=0,n=e.length;i<n;i+=4096)t.push(l.apply(null,e.subarray(i,i+4096)));return v(t.join(""))},E=function(e){if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?l(192|t>>>6)+l(128|63&t):l(224|t>>>12&15)+l(128|t>>>6&63)+l(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return l(240|t>>>18&7)+l(128|t>>>12&63)+l(128|t>>>6&63)+l(128|63&t)},b=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,S=s?function(e){return T.from(e,"utf8").toString("base64")}:c?function(e){return g(c.encode(e))}:function(e){return v(A(e))},x=function(e){return R(e,!0)},L=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,C=function(e){switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return l(55296+(t>>>10))+l(56320+(1023&t));case 3:return l((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return l((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},I=function(e){if(e=e.replace(/\s+/g,""),!u.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(3&e.length));for(var t,i,n,r="",a=0;a<e.length;)t=d[e.charAt(a++)]<<18|d[e.charAt(a++)]<<12|(i=d[e.charAt(a++)])<<6|(n=d[e.charAt(a++)]),r+=64===i?l(t>>16&255):64===n?l(t>>16&255,t>>8&255):l(t>>16&255,t>>8&255,255&t);return r},k=s?function(e){return h(T.from(e,"base64"))}:function(e){return h(w(e),(function(e){return e.charCodeAt(0)}))},O=function(e){return k(P(e))},N=s?function(e){return T.from(e,"base64").toString("utf8")}:o?function(e){return o.decode(k(e))}:function(e){return D(w(e))},P=function(e){return p(e.replace(/[-_]/g,(function(e){return"-"==e?"+":"/"})))},V=function(e){return{value:e,enumerable:!1,writable:!0,configurable:!0}},F=function(){var e=function(e,t){return Object.defineProperty(String.prototype,e,V(t))};e("fromBase64",(function(){return M(this)})),e("toBase64",(function(e){return R(this,e)})),e("toBase64URI",(function(){return R(this,!0)})),e("toBase64URL",(function(){return R(this,!0)})),e("toUint8Array",(function(){return O(this)}))},U=function(){var e=function(e,t){return Object.defineProperty(Uint8Array.prototype,e,V(t))};e("toBase64",(function(e){return y(this,e)})),e("toBase64URI",(function(){return y(this,!0)})),e("toBase64URL",(function(){return y(this,!0)}))},B={version:"3.7.2",VERSION:"3.7.2",atob:w=r?function(e){return atob(p(e))}:s?function(e){return T.from(e,"base64").toString("binary")}:I,atobPolyfill:I,btoa:v=a?function(e){return btoa(e)}:s?function(e){return T.from(e,"binary").toString("base64")}:m,btoaPolyfill:m,fromBase64:M=function(e){return N(P(e))},toBase64:R=function(e,t){return void 0===t&&(t=!1),t?f(S(e)):S(e)},encode:R,encodeURI:x,encodeURL:x,utob:A=function(e){return e.replace(b,E)},btou:D=function(e){return e.replace(L,C)},decode:M,isValid:function(e){if("string"!=typeof e)return!1;var t=e.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(t)||!/[^\s0-9a-zA-Z\-_]/.test(t)},fromUint8Array:y=function(e,t){return void 0===t&&(t=!1),t?f(g(e)):g(e)},toUint8Array:O,extendString:F,extendUint8Array:U,extendBuiltins:function(){F(),U()},Base64:{}},Object.keys(B).forEach((function(e){return B.Base64[e]=B[e]})),B)},function(e,t){function i(t,n){return e.exports=i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},e.exports.__esModule=!0,e.exports.default=e.exports,i(t,n)}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},function(e,t,i){i.r(t);var n=i(14),r=i(0),a=i(2),s=i(13),o=i(40);t.default=function(e){var t=new n.EventEmitter,i=new o.a(t);t.on(r.a.STEP,(function(t){e.postMessage({event:r.a.STEP,data:t})})),t.on(r.a.RENDERER_BUF_UPDATE,(function(t){e.postMessage({event:r.a.RENDERER_BUF_UPDATE,data:t})})),t.on(r.a.DEC_VIDEO_READY,(function(t){e.postMessage({event:r.a.DEC_VIDEO_READY})})),t.on(r.a.DECODER_IMG,(function(t){e.postMessage({event:r.a.DECODER_IMG,data:t},[t.frame.y.bytes.buffer,t.frame.u.bytes.buffer,t.frame.v.bytes.buffer])})),t.on(r.a.DECODER_WAITING,(function(t){e.postMessage({event:r.a.DECODER_WAITING,data:t})})),t.on(r.a.RENDERER_SEEK,(function(t){e.postMessage({event:r.a.RENDERER_SEEK,data:t})})),t.on(r.a.RENDERER_DRAW,(function(t){e.postMessage({event:r.a.RENDERER_DRAW,data:t})})),t.on(r.a.ERROR,(function(t){e.postMessage({event:r.a.ERROR,data:t})})),e.addEventListener("message",(function(e){var n=e.data;switch(n.cmd){case s.a.UPDATE_STATE:i.updateState(n.streamTime,n.width,n.height,n.stoped,n.output,n.maxFrameBufLen);break;case s.a.APPEND_DATA:i.append(n.frame);break;case s.a.SEEK:i.seek(n.time);break;case s.a.STEP:i.step(n.type);break;case s.a.INIT_RENDERER:a.b.level(n.config.kwaiKernelLog),i.init(n.id,n.config,n.canvas);break;case s.a.RESET:i.reset(n.decId,n.seeking);break;case s.a.FLUSH:i.flush(n.startTime);break;case s.a.MEDIA_INFO:i.updateMediaInfo(n.mediaInfo);break;case s.a.END_OF_DATA:i.endOfData();break;case s.a.DEC_DROP_FRAME:i.decDropFrameInfo(n.data);break;case s.a.DESTROY:i&&i.destroy(),t&&t.removeAllListeners()}}))}},function(e,t,i){e.exports=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 21!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e}},function(e,t,i){var n=Object.prototype.hasOwnProperty;function r(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function a(e){try{return encodeURIComponent(e)}catch(e){return null}}t.stringify=function(e,t){t=t||"";var i,r,s=[];for(r in"string"!=typeof t&&(t="?"),e)if(n.call(e,r)){if((i=e[r])||null!=i&&!isNaN(i)||(i=""),r=a(r),i=a(i),null===r||null===i)continue;s.push(r+"="+i)}return s.length?t+s.join("&"):""},t.parse=function(e){for(var t,i=/([^=?#&]+)=?([^&]*)/g,n={};t=i.exec(e);){var a=r(t[1]),s=r(t[2]);null===a||null===s||a in n||(n[a]=s)}return n}},function(e,t,i){i.r(t);var n=i(14),r=i(0),a=i(26),s=i(10),o=i(2),c=i(39);t.default=function(e){var t,i=new n.EventEmitter;i.on(r.a.PRIV_NAL,(function(t){return e.postMessage({event:r.a.PRIV_NAL,data:t})})),i.on(r.a.VIDEO_CODEC_DETECTED,(function(t){return e.postMessage({event:r.a.VIDEO_CODEC_DETECTED,data:t})})),i.on(r.a.INIT_PTS_FOUND,(function(t){return e.postMessage({event:r.a.INIT_PTS_FOUND,data:t})})),i.on(r.a.PARSING_INIT_SEGMENT,(function(t){return e.postMessage({event:r.a.PARSING_INIT_SEGMENT,data:t})})),i.on(r.a.PARSED_DATA,(function(t){return e.postMessage({event:r.a.PARSED_DATA,data:t})})),i.on(r.a.LOAD_END,(function(t){return e.postMessage({event:r.a.LOAD_END,data:t})})),i.on(r.a.ERROR,(function(t){return e.postMessage({event:r.a.ERROR,data:t})})),i.on(r.a.DEMUXER_DETECTED,(function(t){return e.postMessage({event:r.a.DEMUXER_DETECTED,data:t})})),i.on(r.a.MEDIA_DEMUX,(function(t){return e.postMessage({event:r.a.MEDIA_DEMUX,data:t})})),i.on(r.a.METADATA,(function(t){return e.postMessage({event:r.a.METADATA,data:t})})),i.on(r.a.KEY_FRAME_INDEXS,(function(t){return e.postMessage({event:r.a.KEY_FRAME_INDEXS,data:t})})),i.on(r.a.KEY_FRAME,(function(){return e.postMessage({event:r.a.KEY_FRAME})})),i.on(r.a.VIDEO_FRAME_INFO,(function(t){return e.postMessage({event:r.a.VIDEO_FRAME_INFO,data:t})})),i.on(r.a.MP4_NOT_FASTSTART,(function(t){return e.postMessage({event:r.a.MP4_NOT_FASTSTART,data:t})})),i.on(r.a.PARSING_DATA,(function(t){var i={event:r.a.PARSING_DATA,data:t},n=[];t.segments.forEach((function(e){n.push(e.payload.buffer)})),e.postMessage(i,n)})),i.on(r.a.RAW_DATA,(function(t){var i={event:r.a.RAW_DATA,data:t};if(t.type===s.c.videoFrame){var n=[];t.samples&&t.samples.forEach((function(e){e.units.forEach((function(t){e.units.length&&-1===n.indexOf(t.data.buffer)&&n.push(t.data.buffer)}))}));try{e.postMessage(i,n)}catch(t){e.postMessage(i)}}else e.postMessage(i)})),e.addEventListener("message",(function(e){var n,r,s,_,d=e.data;switch(d.cmd){case a.a.INIT:o.b.level(d.config.kwaiKernelLog),n=i,r=d.typeSupported,s=d.config,_=d.vendor,t=new c.a(n,r,s,_);break;case a.a.PUSH:t.push(d.data,d.decryptdata,d.initSegment,d.timeOffset,d.contiguous,d.trackSwitch,d.discontinuity,d.accurateTimeOffset,d.fragEnd,d.transmuxData);break;case a.a.FLUSH:t.flush();break;case a.a.LOAD_END:t.end()}}))}},function(e,t,i){i.r(t);var n=i(14),r=i(0),a=i(2),s=i(41),o=i(13);t.default=function(e){var t=new n.EventEmitter,i=new s.a(t);t.on(r.a.DEC_INIT_COMPLETE,(function(t){e.postMessage({event:r.a.DEC_INIT_COMPLETE,data:t})})),t.on(r.a.DECODER_IMG,(function(t){e.postMessage({event:r.a.DECODER_IMG,data:t},[t.frame.y.bytes.buffer,t.frame.u.bytes.buffer,t.frame.v.bytes.buffer])})),t.on(r.a.DECODER_SEEK,(function(t){e.postMessage({event:r.a.DECODER_SEEK,data:t})})),t.on(r.a.DECODER_SEEK_ABORT,(function(t){e.postMessage({event:r.a.DECODER_SEEK_ABORT,data:t})})),t.on(r.a.RENDERER_BUF_EXPIRED,(function(t){e.postMessage({event:r.a.RENDERER_BUF_EXPIRED,data:t})})),t.on(r.a.DECODER_DATA_END,(function(t){e.postMessage({event:r.a.DECODER_DATA_END,data:t})})),t.on(r.a.DECODER_DROP_FRAME,(function(t){e.postMessage({event:r.a.DECODER_DROP_FRAME,data:t})})),t.on(r.a.ERROR,(function(t){e.postMessage({event:r.a.ERROR,data:t})})),e.addEventListener("message",(function(e){var n=e.data;switch(n.cmd){case o.a.APPEND_DATA:i.appendData(n.data);break;case o.a.UPDATE_STATE:i.updateState(n.streamTime,n.output,n.active,n.frameBufLen,n.playbackRate,n.maxFrameBufLen);break;case o.a.INIT_265:a.b.level(n.config.kwaiKernelLog),i.init(n.id,n.lib,n.config,n.simd,n.threads,n.codecType,n.decoderType);break;case o.a.MEDIA_INFO:i.updateMediaInfo(n.mediaInfo);break;case o.a.DESTROY:i&&i.destroy(),t&&t.removeAllListeners();break;case o.a.RESET:i.reset(n.decId,n.seeking);break;case o.a.FLUSH:i.flush(n.startTime);break;case o.a.SEEK:i.seek(n.time);break;case o.a.END_OF_DATA:i.endOfData();break;case o.a.EXPIRED_DATA_SYNC:i.expiredDataSync()}}))}},function(e,t,i){i.r(t),i.d(t,"default",(function(){return Vn})),i.d(t,"createKernel",(function(){return Fn})),i.d(t,"DownloadStatus",(function(){return Le})),i.d(t,"LOG_LEVEL",(function(){return v.a})),i.d(t,"KEvents",(function(){return p.a})),i.d(t,"REPORT_TYPES",(function(){return Hi})),i.d(t,"CodecType",(function(){return R.b})),i.d(t,"Decoder",(function(){return R.c})),i.d(t,"DemuxerType",(function(){return Ht.b})),i.d(t,"HttpRangeType",(function(){return R.d})),i.d(t,"MediaBox",(function(){return R.g})),i.d(t,"VideoDecBlockPolicy",(function(){return R.m})),i.d(t,"VideoDropFramePolicy",(function(){return R.n})),i.d(t,"VideoRendererType",(function(){return R.o})),i.d(t,"WasmDecoder",(function(){return R.p})),i.d(t,"StereoType",(function(){return R.k}));var n=i(7),r=i.n(n),a=i(5),s=i.n(a),o=i(14),c=i(12),_=i.n(c),d=[16,24,32],u=function(){function e(){this._waitingRec=[],this._frameBufLenIdx=0}return e.prototype.onWaiting=function(){this._waitingRec.push(performance.now()),this._waitingRec.length>3&&this._waitingRec.shift(),this._frameBufLenIdx>=d.length-1||this._waitingRec.length>=3&&this._waitingRec[this._waitingRec.length-1]-this._waitingRec[0]<15e3&&this._frameBufLenIdx++},s()(e,[{key:"maxFrameBufLen",get:function(){return d[this._frameBufLenIdx]||d[d.length-1]}}]),e}(),l=i(29),h=i.n(l),f=i(3),p=i(0),m=i(13),v=i(2),g=i(40),y="canvas-renderer-wrapper",E=function(){function e(e,t){var i=this;this._ctx=void 0,this._evt=void 0,this._renderer=void 0,this._rendererW=void 0,this._id=0,this._frameBufLen=0,this._cOutput=void 0,this._onWorkMessage=function(e){var t=e.data;i._onMessage(e.data.event,t.data)},this._onMessage=function(e,t){switch(e){case p.a.RENDERER_DRAW:case p.a.RENDERER_BUF_UPDATE:i._frameBufLen=t.yuvBufLen}i._rendererW&&i._evt.emit(e,t)},this._evt=e,this._ctx=t,this._cOutput=t.cOutput}var t=e.prototype;return t.init=function(e){if(e&&(this._rendererW=h()(44)),this._rendererW?this._rendererW.addEventListener("message",this._onWorkMessage):this._renderer=new g.a(this._evt),v.b.i(y,"init renderer"),this._cOutput.canvas instanceof HTMLCanvasElement)if(this._rendererW){var t=this._cOutput.canvas.transferControlToOffscreen();this._rendererW.postMessage({cmd:m.a.INIT_RENDERER,id:this._id,config:this._ctx.config,canvas:t},[t])}else this._renderer&&this._renderer.init(this._id,this._ctx.config,this._cOutput);else this._evt.emit(p.a.ERROR,{type:f.b.RENDERER_ERROR,details:f.a.DECODER_UNSUPPORTED,fatal:!0,reason:"init error worker:"+!!this._rendererW+" canvas:"+!!this._cOutput.canvas+" decoder:"+!!this._renderer})},t.destroy=function(){v.b.i(y,"destroy"),this._rendererW?(this._rendererW.postMessage({cmd:m.a.DESTROY}),this._rendererW.removeEventListener("message",this._onWorkMessage),this._rendererW.terminate()):this._renderer&&(this._renderer.destroy(),this._renderer=void 0)},t.step=function(e){v.b.i(y,"step: "+e),this._rendererW?this._rendererW.postMessage({cmd:m.a.STEP,type:e}):this._renderer&&this._renderer.step(e)},t.updateMediaInfo=function(e){(this._rendererW||this._renderer)&&(this._rendererW?this._rendererW.postMessage({cmd:m.a.MEDIA_INFO,mediaInfo:e}):this._renderer&&this._renderer.updateMediaInfo(e))},t.seek=function(e){v.b.i(y,"seek: "+e),this._rendererW?this._rendererW.postMessage({cmd:m.a.SEEK,time:e}):this._renderer&&this._renderer.seek(e)},t.reset=function(e){void 0===e&&(e=!1),this._frameBufLen=0,this._rendererW?this._rendererW.postMessage({cmd:m.a.RESET,decId:this._id,seeking:e}):this._renderer&&this._renderer.reset(this._id,e)},t.flush=function(e){this._rendererW?this._rendererW.postMessage({cmd:m.a.FLUSH,startTime:e}):this._renderer&&this._renderer.flush(e)},t.append=function(e){this._rendererW?this._rendererW.postMessage({cmd:m.a.APPEND_DATA,frame:e},[e.y.bytes.buffer,e.u.bytes.buffer,e.v.bytes.buffer]):this._renderer&&this._renderer.append(e)},t.update=function(e,t,i,n,r,a){this._rendererW?this._rendererW.postMessage({cmd:m.a.UPDATE_STATE,streamTime:e,width:t,height:i,stoped:n,output:r,maxFrameBufLen:a}):this._renderer&&this._renderer.updateState(e,t,i,n,r,a)},t.endOfData=function(){this._rendererW?this._rendererW.postMessage({cmd:m.a.END_OF_DATA}):this._renderer&&this._renderer.endOfData()},t.dropFrame=function(e){this._rendererW?this._rendererW.postMessage({cmd:m.a.DEC_DROP_FRAME,data:e}):this._renderer&&this._renderer.decDropFrameInfo(e)},s()(e,[{key:"isUseingWorker",get:function(){return!!this._rendererW}},{key:"id",get:function(){return this._id},set:function(e){this._id=e}},{key:"frameBufLen",get:function(){return this._frameBufLen}}]),e}(),b=function(e){function t(t){var i;return(i=e.call(this)||this)._ctx=void 0,i._evt=void 0,i._mediaInfo=[],i._active=!1,i._waiting=!0,i._seeking=!1,i._ready=!1,i._pausedOnWaiting=void 0,i._size={w:0,h:0},i._r=void 0,i._bufRules=new u,i._loop=function(){i._active&&i._ctx.cOutput.canvas&&(i._updateState(),requestAnimationFrame(i._loop))},i._ctx=t,i._evt=new o.EventEmitter,i._r=new E(i._evt,t),i}_()(t,e);var i=t.prototype;return i.destroy=function(){this._mediaInfo=[],this.stop(),this._r.destroy(),this._evt.removeAllListeners(),this.removeAllListeners()},i.setMediaInfo=function(e){v.b.i("canvas-provider","setMediaInfo"),this._mediaInfo.push(e)},i.start=function(){this._active||(v.b.i("canvas-provider","start loop"),this._active=!0,requestAnimationFrame(this._loop))},i.stop=function(){v.b.i("canvas-provider","stop loop"),this._active=!1},i.step=function(e){this._r.step(e)},i._updateState=function(){},i._checkResize=function(e){var t=!1,i=("undefined"==typeof window?1:window.devicePixelRatio)||1,n=e.clientWidth*i,r=e.clientHeight*i;return this._size.w===n&&this._size.h===r||(this._size.w=n,this._size.h=r,t=!0),t},s()(t,[{key:"canvas",get:function(){return this._ctx.cOutput.canvas}},{key:"waiting",get:function(){return this._waiting}},{key:"pausedOnWaiting",get:function(){return this._pausedOnWaiting},set:function(e){this._pausedOnWaiting=e}}]),t}(o.EventEmitter),A=i(42),T=i(23),S=i.n(T),R=i(1),x=i(8);function L(e,t,i){if(void 0===e[t=t.toLocaleLowerCase()])e[t]=i;else{var n=e[t];Array.isArray(n)?n.push(i):"string"==typeof n&&(e[t]=[n,i])}}function C(e){var t={};return"string"==typeof e?e.trim().split(/[\r\n]+/).forEach((function(e){var i=e.split(": "),n=i.shift(),r=i.join(":");n&&L(t,n,r)})):e&&e.forEach((function(e,i){e.split(",").forEach((function(e){L(t,i,e)}))})),t}function D(e){var t=[];if(e)for(var i in t=[],e)if("kwaisign"===i||0===i.indexOf("x-ks-")){var n=e[i];n&&t.push(i+": "+(Array.isArray(n)?n.join(","):n).slice(0,255))}if(t.length)return t.slice(0,10),t}var I,w,k=function(){function e(){this.tag="fetch",this._context=void 0,this._callbacks=null,this._controller=null,this._reader=null,this._abort=!1}e.isSupported=function(){return"undefined"!=typeof fetch&&"undefined"!=typeof ReadableStream};var t=e.prototype;return t.load=function(e,t){var i=this;this._context=e,this._callbacks=t;var n=new Headers;e.headers&&e.headers.forEach((function(e){n.append(e.header,e.value)})),e.range&&n.append("Range",e.range);var r={method:e.requestMethod?e.requestMethod:"GET",headers:n,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade",signal:this._getAbortSignal()};e.requestBody&&(r.body=e.requestBody),e.credentials&&(r.credentials="include"),fetch(e.url,r).then((function(t){if(e.responseUrl=t.url,e.responseHeader=C(t.headers),i._callbacks&&i._callbacks.onConnect&&i._callbacks.onConnect(e,t.status),t.ok)return i._abort?void(t.body&&t.body.getReader().cancel()):"arraybuffer"===e.responseType?e.progress?void(t.body&&(i._reader=t.body.getReader(),i._pump(i._reader))):void t.arrayBuffer().then((function(t){i._onEnd(e,t)})):void t.text().then((function(t){i._onEnd(e,t)}));var n=new Error(t.status+" "+t.statusText);i._onError(n)})).catch((function(e){"AbortError"!==e.name&&i._onError(e)}))},t.abort=function(){this._controller?this._controller.abort():this._reader&&(this._reader.cancel(),this._reader=null),this._abort=!0},t.destroy=function(){this._callbacks=null,this.abort()},t._onProgress=function(e,t){this._callbacks&&this._callbacks.onProgress&&this._callbacks.onProgress(e,t)},t._onEnd=function(e,t){this._callbacks&&this._callbacks.onEnd&&(this._reader=null,this._controller=null,this._callbacks.onEnd(e,t))},t._onError=function(e){this._callbacks&&this._callbacks.onError&&this._callbacks.onError(e)},t._pump=function(e){var t=this;e.read().then((function(i){if(t._abort)return e.cancel(),null;if(i.done)return t._onEnd(t._context,null),null;var n=i.value.buffer;return t._onProgress(t._context,n),t._pump(e)})).catch((function(e){"AbortError"!==e.name&&t._onError(e)}))},t._getAbortSignal=function(){try{if(AbortController)return this._controller=new AbortController,this._controller.signal}catch(e){return null}return null},e}();(w=I||(I={})).MOZ_CHUNK="moz-chunked-arraybuffer",w.UNKNOW="unknow",w.UNSUPPORT="";var O,N=function(){function e(){var e=this;this.tag="xhr",this._xhr=null,this._context=void 0,this._callbacks=null,this._progress=I.UNKNOW,this._onReadyStateChange=function(t){if(e._xhr){var i=e._xhr;2===i.readyState&&(e._context.responseUrl=i.responseURL,e._context.responseHeader=C(i.getAllResponseHeaders()),e._callbacks&&e._callbacks.onConnect&&e._callbacks.onConnect(e._context,i.status),(i.status<200||i.status>299)&&e._onError(new Error("xhr error")))}},this._onProgress=function(t){if(e._xhr){var i=e._xhr.response;e._callbacks&&e._callbacks.onProgress&&i&&e._callbacks.onProgress(e._context,i)}},this._onLoadEnd=function(t){var i=null,n=e._xhr;!e._progress&&n&&(i=n.response),e._callbacks&&e._callbacks.onEnd(e._context,i)},this._onError=function(t){var i;e._callbacks&&e._callbacks.onError&&e._callbacks.onError(t),null==(i=e._xhr)||i.abort()},this._xhr=null}e.isSupportChunk=function(){if(e.supportChunk!==I.UNKNOW)return e.supportChunk;try{var t=new XMLHttpRequest;if(t.open("GET","https://example.com",!0),t.responseType=I.MOZ_CHUNK,t.responseType===I.MOZ_CHUNK)return e.supportChunk=I.MOZ_CHUNK,e.supportChunk}catch(t){e.supportChunk=I.UNSUPPORT}return I.UNSUPPORT};var t=e.prototype;return t.load=function(t,i){this._callbacks=i,this._context=t,this._progress=I.UNSUPPORT,t.progress&&"arraybuffer"===t.responseType&&(this._progress=e.isSupportChunk());var n=this._xhr=new XMLHttpRequest;n.open(t.requestMethod?t.requestMethod:"GET",this._context.url,!0),this._progress===I.MOZ_CHUNK?(n.responseType=I.MOZ_CHUNK,n.onprogress=this._onProgress,n.onload=this._onLoadEnd):(n.responseType=t.responseType||"arraybuffer",n.onload=this._onLoadEnd),n.onreadystatechange=this._onReadyStateChange,n.onerror=this._onError,n.withCredentials=!!t.credentials,t.range&&n.setRequestHeader("Range",t.range),t.headers&&t.headers.forEach((function(e){n.setRequestHeader(e.header,e.value)})),n.send(t.requestBody)},t.abort=function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},t.destroy=function(){this._callbacks=null,this.abort()},e}();N.supportChunk=I.UNKNOW;var P=0,M=function(){var e=t.prototype;function t(){var e=this;this._context=void 0,this._loader=void 0,this._callbacks=null,this._config=void 0,this._loaderCallback=void 0,this._stats=void 0,this._retryDelay=0,this._loading=!1,this._aborted=!1,this._requestTimeout=void 0,this._transTimer=void 0,this._retryTimeout=void 0,this._rangeStart=void 0,this._progressTime=0,this._loadInternal=function(){e._loading=!0,e._aborted=!1;var t=e._stats;t.code=0,t.tfirst=0,t.loaded=0,e._retryTimeout&&(clearTimeout(e._retryTimeout),e._retryTimeout=null),e._loader=new(e._getInternalLoader(e._context,e._config)),e._loader&&(t.id=e._loader.tag+"-"+P,e._config.connectionTimeout&&(e._requestTimeout=setTimeout(e._onTimeout,e._config.connectionTimeout)),e._httpRange(e._context),t.tsload=Date.now(),t.tstart=performance.now(),e._loader.load(e._context,e._loaderCallback))},this._onConnect=function(t,i){var n=e._stats;e._getContentLen(t,n),e._requestTimeout&&(clearTimeout(e._requestTimeout),e._requestTimeout=null),e._startTransmissionTimer(),n.code=i,n.tfirst=Math.max(n.trequest,performance.now()),e._callbacks&&e._callbacks.onConnect&&e._callbacks.onConnect(t,n)},this._onProgress=function(t,i){var n=e._stats;if(e._progressTime=performance.now(),!t.breakpointContinuation&&n.output>n.loaded){if(n.loaded+i.byteLength-n.output>0){var r=i.slice(n.output-n.loaded);e._callProgress(e._context,r,n)}n.loaded+=i.byteLength}else n.loaded+=i.byteLength,e._callProgress(e._context,i,n)},this._onError=function(t){v.b.i("loader",null==t?void 0:t.message),e._stopTimer(),e._destroyLoader();var i,n=e._stats,r=e._config;e._loading=!1,e._context.breakpointContinuation&&416===n.code?null!=(i=e._callbacks)&&i.onEnd&&e._callbacks.onEnd(e._context,null,n):(n.fatal=!r.maxRetry||n.retry>=r.maxRetry||!r.maxRetry,n.text=t.message||"load error",e._callbacks&&e._callbacks.onError&&e._callbacks.onError(e._context,n),n.fatal||(r.breakpointContinuation&&(v.b.i("loader","breakpointContinuation"),e._stats.output&&e._stats.loaded>0?(e._rangeStart?e._context.rangeStart=e._rangeStart+e._stats.output:e._context.rangeStart=e._stats.output,e._context.breakpointContinuation=!0):(e._context.rangeStart=e._rangeStart,e._context.breakpointContinuation=!1)),n.retry++,e._callbacks&&(e._retryDelay?(e._retryTimeout=setTimeout(e._loadInternal,e._retryDelay),e._retryDelay=2*e._retryDelay):e._loadInternal())))},this._onTimeout=function(){e._loading=!1,e._abortInternal();var t=new Error("timeout");e._onError(t)},P++,this._loader=null,this._config={useFetch:!1,connectionTimeout:0,transmissionTimeout:0,maxRetry:0,retryDelay:0},this._loaderCallback={onConnect:this._onConnect,onProgress:this._onProgress,onEnd:this._onEnd.bind(this),onError:this._onError}}return e._getInternalLoader=function(e,t){if(!e.progress)return N;if(void 0!==O)return O;if(O=null,x.a.msie||x.a.msedge){if(t.useFetch)return k.isSupported()&&(O=k),O;N.isSupportChunk()?O=N:k.isSupported()&&(O=k)}else k.isSupported()?O=k:N.isSupportChunk()&&(O=N);return O},e.load=function(e,t,i){this._init(e,t,i),this._loadInternal()},e.destroy=function(){this._stopTimer(),this._abortInternal(!1),this._destroyLoader(),this._callbacks=null},e.abort=function(){this._stopTimer(),this._abortInternal()},e._init=function(e,t,i){this._context=e,this._rangeStart=e.rangeStart,this._callbacks=t,this._config=i||this._config,this._stats={id:"",trequest:performance.now(),retry:0,loaded:0,code:0,output:0,tfirst:0,tload:0,total:0,tsload:0,tstart:0,fatal:!1,text:""},this._config.retryDelay&&(this._retryDelay=this._config.retryDelay)},e._destroyLoader=function(){this._loader&&(this._loader.destroy(),this._loader=null)},e._abortInternal=function(e){void 0===e&&(e=!0),e&&this._callbacks&&this._callbacks.onAbort&&!this._aborted&&this._loading&&this._callbacks.onAbort(this._context,this._stats),this._aborted=!0,this._loader&&this._loader.abort()},e._stopTimer=function(){this._requestTimeout&&(clearTimeout(this._requestTimeout),this._requestTimeout=null),this._retryTimeout&&(clearTimeout(this._retryTimeout),this._retryTimeout=null),this._stopTransmissionTimer()},e._callProgress=function(e,t,i){this._stats.output+=t.byteLength,this._callbacks&&this._callbacks.onProgress&&this._callbacks.onProgress(e,t,i)},e._onEnd=function(e,t){this._stopTimer();var i=this._stats;this._getContentLen(e,i),i.total=t?i.loaded="string"==typeof t?t.length||0:t.byteLength||0:i.loaded,i.tload=Math.max(i.tfirst,performance.now()),this._loading=!1,i.output=0,this._callbacks&&this._callbacks.onEnd(e,t,i)},e._startTransmissionTimer=function(){var e=this;this._stopTransmissionTimer(),this._progressTime=performance.now();var t=this._config.transmissionTimeout||0;t&&(this._transTimer=setInterval((function(){performance.now()-e._progressTime>t&&e._onTimeout()}),1e3))},e._stopTransmissionTimer=function(){this._transTimer&&(clearInterval(this._transTimer),this._transTimer=null)},e._httpRange=function(e){if(e.rangeEnd||e.rangeStart)if(e.rangeType&&e.rangeType!==R.d.STANDARD&&"string"==typeof e.url){var t=new S.a(e.url,!0);e.rangeEnd?(t.query.start=(e.rangeStart||0).toString(),t.query.end=(e.rangeEnd-1).toString()):e.rangeStart&&(t.query.start=e.rangeStart.toString()),e.url=t.toString()}else e.rangeEnd?e.range="bytes="+(e.rangeStart||0)+"-"+(e.rangeEnd-1):e.rangeStart&&(e.range="bytes="+e.rangeStart+"-")},e._getContentLen=function(e,t){t.contentLength||(t.contentLength=this._getContentLenFromHeader(e))},e._getContentLenFromHeader=function(e){var t=0,i=e.responseHeader;if(i)if(e.range||"number"==typeof e.rangeStart){var n=i["content-range"];n&&(t=parseInt((Array.isArray(n)?n[0]:n).split("/")[1])||0)}else{var r=i["content-length"];r&&(t=parseInt(Array.isArray(r)?r[0]:r)||0)}return t},s()(t,[{key:"context",get:function(){return this._context}},{key:"config",get:function(){return this._config}}]),t}(),V=function(){function e(){this.timeout=6048e5}var t=e.prototype;return t.write=function(t,i){if(e.available)try{localStorage.setItem(t,JSON.stringify({value:i,time:Date.now()}))}catch(e){}},t.read=function(t,i){if(void 0===i&&(i=!0),e.available)try{var n=localStorage.getItem(t);if(n){var r=JSON.parse(n),a=r.value,s=r.time,o=void 0===s?0:s;if(!i)return a;if(Date.now()-o<("number"==typeof i?i:this.timeout))return a}}catch(e){}},s()(e,null,[{key:"available",get:function(){if(void 0===e._available)try{localStorage.setItem("alg","test"),e._available=!0}catch(t){e._available=!1}return e._available}}]),e}();V._available=void 0;var F=V,U=i(37),B="https://s2-10895.kwimgs.com/kos/nlav10895/",H=B+"ks265/libks265dec.wasm",j=B+"ks265/libks265dec.js",W=function(e){function t(t){var i;return(i=e.call(this)||this)._ls=new F,i._decoderType=R.p.kw265,i._config=void 0,i._wasmLoader=void 0,i._jsLoader=void 0,i._jswLoader=void 0,i._loadStartTime=0,i._onLoaderError=function(e,t){i._destroyLoader(),i.emit(p.a.ERROR,{type:f.b.NETWORK_ERROR,details:f.a.DEC_LIB_LOAD_ERROR,fatal:!0,reason:t.text,statusCode:t.code,url:e.url})},i._config=t,i}_()(t,e);var i=t.prototype;return i.load=function(e,t,i,n){v.b.i("dec-lib-loader","load: "+t),this._loadStartTime=performance.now(),this._decoderType=t;var r=j,a="",s=H;t===R.p.kw265?(r=j,s=H,n?(i?(s="https://s2-10895.kwimgs.com/kos/nlav10895/ks265/libks265dec-simd-threads-2.wasm",r="https://s2-10895.kwimgs.com/kos/nlav10895/ks265/libks265dec-simd-threads-2.js"):(s="https://s2-10895.kwimgs.com/kos/nlav10895/ks265/libks265dec-threads-2.wasm",r="https://s2-10895.kwimgs.com/kos/nlav10895/ks265/libks265dec-threads-2.js"),a="https://s2-10895.kwimgs.com/kos/nlav10895/ks265/libks265dec-threads-2.worker.js"):i&&(s="https://s2-10895.kwimgs.com/kos/nlav10895/ks265/libks265dec-simd.wasm")):t===R.p.h265?U.a?(r="https://s2-10895.kwimgs.com/kos/nlav10895/265/kwai-dec265-10.js",s="https://s2-10895.kwimgs.com/kos/nlav10895/265/kwai-dec265-10.wasm",n?(i?(s="https://s2-10895.kwimgs.com/kos/nlav10895/265/kwai-dec265-simd-threads-10.wasm",r="https://s2-10895.kwimgs.com/kos/nlav10895/265/kwai-dec265-simd-threads-10.js"):(s="https://s2-10895.kwimgs.com/kos/nlav10895/265/kwai-dec265-threads-10.wasm",r="https://s2-10895.kwimgs.com/kos/nlav10895/265/kwai-dec265-threads-10.js"),a="https://s2-10895.kwimgs.com/kos/nlav10895/265/kwai-dec265-threads-10.worker.js"):i&&(s="https://s2-10895.kwimgs.com/kos/nlav10895/265/kwai-dec265-simd-10.wasm")):this.emit(p.a.ERROR,{type:f.b.DECODER_ERROR,details:f.a.UNSUPPORTED,fatal:!0,reason:"unsupported. no dec lib: "+t}):t===R.p.kvc3?(r="https://s2-10895.kwimgs.com/kos/nlav10895/kvc/kvc-decoder-1.js",s="https://s2-10895.kwimgs.com/kos/nlav10895/kvc/kvc-decoder-1.wasm",n?(i?(s="https://s2-10895.kwimgs.com/kos/nlav10895/kvc/kvc-decoder-simd-threads-2.wasm",r="https://s2-10895.kwimgs.com/kos/nlav10895/kvc/kvc-decoder-simd-threads-2.js"):(s="https://s2-10895.kwimgs.com/kos/nlav10895/kvc/kvc-decoder-threads-2.wasm",r="https://s2-10895.kwimgs.com/kos/nlav10895/kvc/kvc-decoder-threads-2.js"),a="https://s2-10895.kwimgs.com/kos/nlav10895/kvc/kvc-decoder-threads-2.worker.js"):i&&(s="https://s2-10895.kwimgs.com/kos/nlav10895/kvc/kvc-decoder-simd-1.wasm")):t===R.p.kvc4?(r="https://s2-10895.kwimgs.com/kos/nlav10895/kvc4/kvc-decoder-1.js",s="https://s2-10895.kwimgs.com/kos/nlav10895/kvc4/kvc-decoder-1.wasm",n?(i?(s="https://s2-10895.kwimgs.com/kos/nlav10895/kvc4/kvc-decoder-simd-threads-1.wasm",r="https://s2-10895.kwimgs.com/kos/nlav10895/kvc4/kvc-decoder-simd-threads-1.js"):(s="https://s2-10895.kwimgs.com/kos/nlav10895/kvc4/kvc-decoder-threads-1.wasm",r="https://s2-10895.kwimgs.com/kos/nlav10895/kvc4/kvc-decoder-threads-1.js"),a="https://s2-10895.kwimgs.com/kos/nlav10895/kvc4/kvc-decoder-threads-1.worker.js"):i&&(s="https://s2-10895.kwimgs.com/kos/nlav10895/kvc4/kvc-decoder-simd-1.wasm")):t===R.p.kvc5&&(r="https://s2-10895.kwimgs.com/kos/nlav10895/kvc5/kvc-decoder.js",s="https://s2-10895.kwimgs.com/kos/nlav10895/kvc5/kvc-decoder.wasm",n?(i?(s="https://s2-10895.kwimgs.com/kos/nlav10895/kvc5/kvc-decoder-simd-threads.wasm",r="https://s2-10895.kwimgs.com/kos/nlav10895/kvc5/kvc-decoder-simd-threads.js"):(s="https://s2-10895.kwimgs.com/kos/nlav10895/kvc5/kvc-decoder-threads.wasm",r="https://s2-10895.kwimgs.com/kos/nlav10895/kvc5/kvc-decoder-threads.js"),a="https://s2-10895.kwimgs.com/kos/nlav10895/kvc5/kvc-decoder-threads.worker.js"):i&&(s="https://s2-10895.kwimgs.com/kos/nlav10895/kvc5/kvc-decoder-simd.wasm"));var o={js:{url:r,data:""},wasm:{url:s}};if(a&&(o.jsw={url:a,data:""}),!e&&F.available){var c=this._ls.read(this._key,!1);c&&(c.js&&c.js.url===o.js.url&&(o.js.data=c.js.data),o.jsw&&c.jsw&&c.jsw.url===o.jsw.url&&(o.jsw.data=c.jsw.data),c.wasm&&c.wasm.url===o.wasm.url&&(o.wasm.data=A.Base64.toUint8Array(c.wasm.data)))}this._checkEnd(o,!0)||(o.js.data||this._loadJs(o),o.wasm.data||this._loadWasm(o),o.jsw&&!o.jsw.data&&this._loadJsw(o))},i.destroy=function(){this.removeAllListeners(),this._destroyLoader()},i._destroyLoader=function(){this._destroyWasmLoader(),this._destroyJsLoader(),this._destroyJswLoader()},i._checkEnd=function(e,t){void 0===t&&(t=!1);var i=!!(e.js.data&&e.wasm.data&&(!e.jsw||e.jsw&&e.jsw.data));if(!t&&i&&e.wasm.data){var n={js:r()({},e.js),wasm:{url:e.wasm.url,data:A.Base64.fromUint8Array(e.wasm.data)}};e.jsw&&(n.jsw=r()({},e.jsw)),this._ls.write(this._key,n)}if(i){v.b.i("dec-lib-loader","dec lib loaded",t);var a={lib:e,hitCache:t,duration:performance.now()-this._loadStartTime};this.emit(p.a.DEC_LIB_LOADED,a)}return i},i._loadWasm=function(e){var t=this;this._destroyWasmLoader();var i=this._wasmLoader=new M,n={onError:this._onLoaderError,onEnd:function(i,n){n instanceof ArrayBuffer&&(e.wasm.data=new Uint8Array(n),t._checkEnd(e))}},r={useFetch:!1,connectionTimeout:this._config.decLibConnectionTimeout,maxRetry:this._config.decLibLoadingMaxRetry},a={url:e.wasm.url,responseType:"arraybuffer",progress:!1};i.load(a,n,r)},i._loadJs=function(e){var t=this;this._destroyJsLoader();var i=this._jsLoader=new M,n={onError:this._onLoaderError,onEnd:function(i,n){"string"==typeof n&&(e.js.data=n,t._checkEnd(e))}},r={useFetch:!1,connectionTimeout:this._config.decLibConnectionTimeout,maxRetry:this._config.decLibLoadingMaxRetry},a={url:e.js.url,responseType:"text",progress:!1};i.load(a,n,r)},i._loadJsw=function(e){var t=this;if(this._destroyJswLoader(),e.jsw){var i=this._jsLoader=new M,n={onError:this._onLoaderError,onEnd:function(i,n){"string"==typeof n&&(e.jsw&&(e.jsw.data=n),t._checkEnd(e))}},r={useFetch:!1,connectionTimeout:this._config.decLibConnectionTimeout,maxRetry:this._config.decLibLoadingMaxRetry},a={url:e.jsw.url,responseType:"text",progress:!1};i.load(a,n,r)}},i._destroyWasmLoader=function(){this._wasmLoader&&this._wasmLoader.destroy()},i._destroyJsLoader=function(){this._jsLoader&&this._jsLoader.destroy()},i._destroyJswLoader=function(){this._jswLoader&&this._jswLoader.destroy()},s()(t,[{key:"_key",get:function(){return this._decoderType===R.p.kvc3?"kwai-deckvc-lib":this._decoderType===R.p.h265?"kwai-dec265-lib":this._decoderType===R.p.kvc4?"kwai-deckvc4-lib":this._decoderType===R.p.kvc5?"kwai-deckvc5-lib":"kwai-kw265-lib"}}]),t}(o.EventEmitter);function z(){return"undefined"==typeof navigator?0:navigator.hardwareConcurrency||0}function G(){if("undefined"!=typeof window)return window.MediaSource||window.WebKitMediaSource}function K(){var e,t;if("undefined"!=typeof window)return(null==(e=window)?void 0:e.SourceBuffer)||(null==(t=window)?void 0:t.WebKitSourceBuffer)}var Y,X,q=i(22),Z=i(11);!function(e){e.WIDEVINE="com.widevine.alpha",e.PLAYREADY="com.microsoft.playready",e.FAIRPLAY="com.apple.fairplay"}(Y||(Y={})),function(e){e.WIDEVINE="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"}(X||(X={}));var Q,J="undefined"!=typeof window&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):void 0,$=function(e){function t(t){var i;return(i=e.call(this)||this)._ctx=void 0,i._drmSystemOptions={audioRobustness:"SW_SECURE_CRYPTO",videoRobustness:"SW_SECURE_DECODE"},i._mediaKeysList=[],i._hasSetMediaKeys=!1,i._loader=void 0,i._loaderConfig=void 0,i._mediaKeysPromise=void 0,i._licenseServerUrl="",i._videoCodecs=[],i._onMediaEncrypted=function(e){if(v.b.i("eme",'Media is encrypted using "'+e.initDataType+'" init data type'),!i._mediaKeysPromise&&i._videoCodecs.length&&"cenc"===e.initDataType&&e.initData&&(i._licenseServerUrl=i._licenseServerUrl||i._ctx.config.widevineLicenseUrl,i._attemptKeySystemAccess(Y.WIDEVINE,i._videoCodecs)),!i._mediaKeysPromise)return v.b.e("eme","Fatal: Media is encrypted but no CDM access or no keys have been requested"),void i._onError({type:f.b.KEY_SYSTEM_ERROR,details:f.a.KEY_SYSTEM_NO_KEYS,fatal:!0,reason:"media is encrypted but no CDM access or no keys have been requested"});var t=function(t){i._ctx.video&&(i._attemptSetMediaKeys(t),i._generateRequestWithPreferredKeySession(e.initDataType,e.initData))};i._mediaKeysPromise.then(t).catch(t)},i._onKeySessionMessage=function(e){var t=e.target;i._requestLicense(e.message,t)},i._onLoaderError=function(e,t){t.fatal&&i._onError({type:f.b.NETWORK_ERROR,details:f.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,reason:t.text,statusCode:t.code})},i.isBrowserSupported=function(){return"chrome"===x.a.name&&x.a.version.major>=68||x.a.firefox},i._onError=function(e){i.emit(p.a.ERROR,e)},i._ctx=t,t.video&&t.video.addEventListener("encrypted",i._onMediaEncrypted),i._loaderConfig={useFetch:!1,maxRetry:t.config.keyLoadingMaxRetry,connectionTimeout:t.config.keyConnectionTimeout,transmissionTimeout:t.config.keyTransmissionTimeout,retryDelay:t.config.keyLoadingRetryDelay},i}_()(t,e),t.getSupportedMediaKeySystemConfigurations=function(e,t,i){var n={audioCapabilities:[{contentType:'audio/mp4; codecs="mp4a.40.5"',robustness:i.audioRobustness||""},{contentType:'audio/mp4; codecs="mp4a.40.2"',robustness:i.audioRobustness||""}],videoCapabilities:[]};return t.forEach((function(e){n.videoCapabilities.push({contentType:'video/mp4; codecs="'+e+'"',robustness:i.videoRobustness||""})})),[n]};var i=t.prototype;return i.onManifestParsed=function(e,t){var i=this;if(void 0===t&&(t=!1),this._videoCodecs=e.map((function(e){return e.videoCodec})),t)if(e.reduce((function(e,t){return e&&(t.drmSchemaId===X.WIDEVINE||!t.drmSchemaId)}),!0)&&J&&this.isBrowserSupported()){this._licenseServerUrl=e.reduce((function(e,t){return e||t.drmToken||""}),"");var n=Y.WIDEVINE;v.b.i("eme","on manifest parsed",n,this._videoCodecs),this._attemptKeySystemAccess(Y.WIDEVINE,this._videoCodecs)}else setTimeout((function(){return i._onError({type:f.b.KEY_SYSTEM_ERROR,details:f.a.KEY_SYSTEM_UNSUPPORTED,fatal:!0,reason:"DRM unsupported."})}),0)},i.reset=function(){var e,t=this;return v.b.i("eme","reset"),this._mediaKeysList.map((function(e){if(e.mediaKeysSession)return e.mediaKeysSession.removeEventListener("message",t._onKeySessionMessage),e.mediaKeysSession.close().catch((function(){}))})),this._mediaKeysList=[],this._hasSetMediaKeys=!1,null==(e=this._ctx.video)?void 0:e.setMediaKeys(null)},i.destory=function(){var e=this,t=this._ctx.video;t&&t.removeEventListener("encrypted",this._onMediaEncrypted);var i=this._mediaKeysList;i.length&&Promise.all(i.map((function(t){if(t.mediaKeysSession)return t.mediaKeysSession.removeEventListener("message",e._onKeySessionMessage),t.mediaKeysSession.close().catch((function(){}))}))).then((function(){if(t)return t.setMediaKeys(null)})).catch((function(){})),this.removeAllListeners()},i._attemptSetMediaKeys=function(e){if(!this._ctx.video)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var t=this._mediaKeysList[0];if(!t||!t.mediaKeys)return v.b.e("eme","Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this._onError({type:f.b.KEY_SYSTEM_ERROR,details:f.a.KEY_SYSTEM_NO_KEYS,fatal:!0,reason:"media is encrypted but no CDM access or no keys have been obtained yet"});v.b.i("eme","Setting keys for encrypted media"),this._ctx.video.setMediaKeys(t.mediaKeys),this._hasSetMediaKeys=!0}},i._generateRequestWithPreferredKeySession=function(e,t){var i=this,n=this._mediaKeysList[0];if(!n)return v.b.e("eme","Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this._onError({type:f.b.KEY_SYSTEM_ERROR,details:f.a.KEY_SYSTEM_NO_ACCESS,fatal:!0,reason:"media is encrypted but not any key-system access has been obtained yet"});if(n.mediaKeysSessionInitialized)v.b.i("eme","Key-Session already initialized but requested again");else{var r=n.mediaKeysSession;if(!r)return v.b.e("eme","Fatal: Media is encrypted but no key-session existing"),void this._onError({type:f.b.KEY_SYSTEM_ERROR,details:f.a.KEY_SYSTEM_NO_SESSION,fatal:!0,reason:"media is encrypted but no key-session existing"});if(!t)return v.b.i("eme","Fatal: initData required for generating a key session is null"),void this._onError({type:f.b.KEY_SYSTEM_ERROR,details:f.a.KEY_SYSTEM_NO_INIT_DATA,fatal:!0,reason:"initData required for generating a key session is null"});v.b.i("eme",'Generating key-session request for "'+e+'" init data type'),n.mediaKeysSessionInitialized=!0,r.generateRequest(e,t).then((function(){v.b.d("eme","Key-session generation succeeded")})).catch((function(e){v.b.e("eme","Error generating key-session request:",e),i._onError({type:f.b.KEY_SYSTEM_ERROR,details:f.a.KEY_SYSTEM_NO_SESSION,fatal:!1,reason:"error generating key-session request:"+e})}))}},i._attemptKeySystemAccess=function(e,i){var n=this,r=t.getSupportedMediaKeySystemConfigurations(e,i,this._drmSystemOptions);if(v.b.i("eme","Requesting encrypted media key-system access"),J){var a=J(e,r);this._mediaKeysPromise=a.then((function(t){var i={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:t,mediaKeySystemDomain:e};n._mediaKeysList.push(i);var r=Promise.resolve().then((function(){return t.createMediaKeys()})).then((function(e){return i.mediaKeys=e,n._mediaKeysList.forEach((function(e){e.mediaKeysSession||(e.mediaKeysSession=e.mediaKeys.createSession()).addEventListener("message",n._onKeySessionMessage,!1)})),e}));return r.catch((function(e){v.b.e("eme","Failed to create media-keys:",e)})),r})),a.catch((function(t){v.b.e("eme",'Failed to obtain key-system "'+e+'" access:',t)}))}else v.b.i("eme","no requestMediaKeySystemAccess")},i._getLicenseServerUrl=function(e){switch(e){case Y.WIDEVINE:if(!this._ctx.config.widevineLicenseUrl)break;return this._ctx.config.widevineLicenseUrl;case Y.PLAYREADY:if(!this._ctx.config.playreadyLicenseUrl)break;return this._ctx.config.playreadyLicenseUrl;case Y.FAIRPLAY:if(!this._ctx.config.fairplayLicenseUrl)break;return this._ctx.config.fairplayLicenseUrl}throw new Error('no license server URL configured for key-system "'+e+'"')},i._requestLicense=function(e,t){var i=this,n=this._mediaKeysList[0];if(!n)return v.b.e("eme","Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this._onError({type:f.b.KEY_SYSTEM_ERROR,details:f.a.KEY_SYSTEM_NO_ACCESS,fatal:!0,reason:"media is encrypted but no key-system access has been obtained yet"});this._disposeLoader();var r={onError:this._onLoaderError,onEnd:function(e,n){i._disposeLoader(),n instanceof ArrayBuffer&&t.update(n)}},a=this._loader=new M,s={requestMethod:"POST",requestBody:e,url:this._licenseServerUrl||this._getLicenseServerUrl(n.mediaKeySystemDomain),responseType:"arraybuffer"};a.load(s,r,this._loaderConfig)},i._disposeLoader=function(){this._loader&&this._loader.destroy()},s()(t,[{key:"isActive",get:function(){return!(!this._ctx.video||!this._ctx.video.mediaKeys)}}]),t}(o.EventEmitter),ee=i(9),te=function(e){function t(t,i){var n;return(n=e.call(this)||this)._config=void 0,n._stat=void 0,n.video=void 0,n._sourceBuffer=void 0,n._mediaSource=null,n._mimeCodec=void 0,n._cleanUpTask=void 0,n._appendQueue=void 0,n._hasVideo=void 0,n._hasAudio=void 0,n._endOfData=!1,n._appendEnabled=void 0,n._duration=1/0,n._appendError=0,n._appendBufferError=!1,n._mseDuration=null,n._sbHandler={},n._souceBufferLocked=!1,n._sbAppendStarted=void 0,n._startBufSec=0,n._startBufTimer=void 0,n._lastAppendInfo={},n._changeTypeSupported=wi.isChangeTypeSupported(),n._onSourceOpen=function(){v.b.i("mse","MediaSource onSourceOpen"),n._mediaSource&&(n._mediaSource.removeEventListener("sourceopen",n._onSourceOpen),n._checkSourceBuffer(),n.refresh(),n.emit(p.a.MSE_OPEN))},n._onSourceEnded=function(){v.b.i("mse","MediaSource onSourceEnded")},n._onSourceClose=function(){v.b.i("mse","MediaSource onSourceClose"),n._mediaSource&&(n._mediaSource.removeEventListener("sourceopen",n._onSourceOpen),n._mediaSource.removeEventListener("sourceended",n._onSourceEnded),n._mediaSource.removeEventListener("sourceclose",n._onSourceClose))},n._onSourceBufferUpdateEnd=function(e){n._update(e),n._endOfData&&n._endOfStream(),n._updateDuration(),n.emit(p.a.MSE_UPDATE)},n._onSourceBufferError=function(e){var t=n._getSourceBufferType(e.currentTarget);v.b.i("mse",t+" SourceBuffer Error: ",e),n._onError({type:f.b.MSE_ERROR,details:f.a.SOURCEBUFFER_ERROR,fatal:!0,reason:t+" source buffer error. "+JSON.stringify(n._lastAppendInfo)})},n._startBufEnded=function(){v.b.i("mse","startPlayBufEnd"),n._removeStartBufTimer(),n._startBufSec=0,n.refresh()},n._onError=function(e){n.emit(p.a.ERROR,e)},v.b.i("mse","constructor"),n._config=t,n._stat=i,n._hasVideo=!1,n._hasAudio=!1,n._appendQueue={video:[],audio:[]},n._sourceBuffer={},n._cleanUpTask={video:[],audio:[]},n._mimeCodec={},n._sbAppendStarted={},n._appendEnabled=!0,n}_()(t,e);var i=t.prototype;return i.attach=function(e){var t=this;v.b.i("mse","attach",e),this.video=e;var i=G();if(i){var n=this._mediaSource=new i;this.video.src=URL.createObjectURL(n),this.video.load(),n.addEventListener("sourceopen",this._onSourceOpen),n.addEventListener("sourceended",this._onSourceEnded),n.addEventListener("sourceclose",this._onSourceClose),this._souceBufferLocked=!1}else setTimeout((function(){t._onError({type:f.b.MSE_ERROR,details:f.a.MEDIASOURCE_ERROR,fatal:!0,reason:"MediaSource is not support"})}),0)},i.trackInfo=function(e){v.b.i("mse","track info");var t=e.tracks.audio,i=e.tracks.video;t&&t.container&&(this._mimeCodec.audio=t.container+'; codecs="'+t.codec+'"'),i&&i.codec&&(this._mimeCodec.video=i.container+'; codecs="'+i.codec+'"'),this._hasAudio=!(!this._hasAudio&&!t),this._hasVideo=!(!this._hasVideo&&!i),this._checkSourceBuffer()},i.updateDuration=function(e){v.b.i("mse","update duration: "+e),this._duration=e,this._updateDuration()},i.setStartBufSec=function(e){v.b.i("mse","startPlayBufSec: "+e),this._removeStartBufTimer(),this._startBufSec=e,this._startBufTimer=setTimeout(this._startBufEnded,1e3*e)},i._updateDuration=function(){if("number"==typeof this._duration&&this.video&&this._mediaSource&&this._sourceBuffer&&0!==this.video.readyState&&"open"===this._mediaSource.readyState){for(var e in this._sourceBuffer)if(this._sourceBuffer[e]&&this._sourceBuffer[e].updating)return;var t=this.video.duration;if(null===this._mseDuration&&(this._mseDuration=this._mediaSource.duration),this._stat.isLive)this._mseDuration=this._mediaSource.duration=1/0;else if(this._duration!==this._mseDuration&&this._duration!==t||!Object(ee.a)(t)){var i=!0;for(var n in this._sourceBuffer)i=i&&!!this._duration&&this.bufferedEndByType(n)<this._duration;i&&this._duration&&(this._mseDuration=this._mediaSource.duration=this._duration),this._duration=null}}},i._checkSourceBuffer=function(){var e=(this._hasAudio?1:0)+(this._hasVideo?1:0),t=(this._mimeCodec.audio?1:0)+(this._mimeCodec.video?1:0);if(v.b.v("mse","checkSourceBuffer",e,t,this._mimeCodec),this._mediaSource&&"open"===this._mediaSource.readyState&&e>0&&t>=e)for(var i in this._mimeCodec)this._mimeCodec[i]&&this._addSourceBuffer(i)},i._addSourceBuffer=function(e){var t=this;if(!this._sourceBuffer[e]&&!this._souceBufferLocked){try{this._mediaSource&&(this._sourceBuffer[e]=this._mediaSource.addSourceBuffer(this._mimeCodec[e]),this._lastAppendInfo[e]={sn:0,subSn:0,codec:this._mimeCodec[e]},this._sbAppendStarted[e]=!1)}catch(t){return v.b.e("mse",t),void this._onError({type:f.b.MSE_ERROR,details:f.a.ADDSOURCEBUFFER_ERROR,fatal:!0,reason:"type:"+e+" codec:"+this._mimeCodec[e]+" code:"+t.code+" msg:"+t.message})}var i=this._sourceBuffer[e];this._sbHandler[e]={updateend:function(){t._onSourceBufferUpdateEnd(e)},error:function(e){t._onSourceBufferError(e)}},i.addEventListener("error",this._sbHandler[e].error),i.addEventListener("updateend",this._sbHandler[e].updateend),this._duration&&this._mediaSource&&this._duration!==this._mediaSource.duration&&(this._mediaSource.duration=this._duration)}},i._hasPendingData=function(){return!(!this._appendQueue||!(this._appendQueue.video&&this._appendQueue.video.length||this._appendQueue.audio&&this._appendQueue.audio.length))},i.refresh=function(){for(var e in this._sourceBuffer)this._update(e)},i._doAppend=function(e){if(this._appendQueue[e]&&this._appendQueue[e].length>0){if(!this._appendEnabled)return void(this._getBufferQueueSize()>209715200&&!this._appendBufferError&&(this._appendBufferError=!0,this._onError({type:f.b.MSE_ERROR,details:f.a.APPENDBUFFER_ERROR,fatal:!0,reason:"bufferfull"})));if(this._sourceBuffer[e]&&!this._sourceBuffer[e].updating&&!this._appendBufferError){var t=this._appendQueue[e].shift();this._appendBuffer(t)}}},i.mediaSegment=function(e){var t=this;e.forEach((function(e){var i=e.type;e.codec=t._mimeCodec[e.type],t._appendQueue[i].push(e),t._sourceBuffer[i]&&(t._souceBufferLocked=!0,t._update(i))}))},i.bufferedByType=function(e){var t=this._sourceBuffer[e];return t&&t.buffered.length>0?{start:t.buffered.start(0),end:t.buffered.end(t.buffered.length-1)}:{start:0,end:0}},i.bufferedEndByType=function(e){var t=this._sourceBuffer[e];return t&&t.buffered.length>0?t.buffered.end(t.buffered.length-1):0},i.bufferSliceNumByType=function(e){var t=this._sourceBuffer[e];return t?t.buffered.length:0},i.pendingSecByType=function(e){var t=this._appendQueue[e];return t?t.reduce((function(e,t){return e+t.endDTS-t.startDTS}),0):0},i.pendingNum=function(){var e=0;for(var t in this._appendQueue)e+=this._appendQueue[t].length;return e},i._calculateRemoveRange=function(e){var t=this.video;if(t&&!t.seeking){var i=t.currentTime;if(this._sourceBuffer[e]){var n=this._cleanUpTask[e],r=this._sourceBuffer[e].buffered;if(r.length>=1&&i-r.start(0)>=10){var a=i-5;if(n.length&&0===n[n.length-1].start&&n[n.length-1].end===a)return;n.push({start:0,end:a})}}}},i._cleanUpRange=function(e,t){try{for(var i=0;i<e.buffered.length;i++){var n=e.buffered.start(i),r=e.buffered.end(i),a=Math.max(n,t.start),s=Math.min(r,t.end);if(s>a)return e.remove(a,s),this.emit(p.a.MSE_REMOVE),!(t.end>r&&i<e.buffered.length-1&&(t.start=Math.max(t.start,s),1));if(!(t.end>s))break;t.start=Math.max(t.start,s)}return!0}catch(t){return!(e&&e.updating)}},i._appendBuffer=function(e){if(e&&this._sourceBuffer[e.type]&&this.video&&!this.video.error){var t=this._lastAppendInfo[e.type],i=this._sourceBuffer[e.type];if(e.codec&&t&&e.codec!==t.codec&&(v.b.i("mse",e.type+" codecType change: "+e.codec),i&&this._changeTypeSupported)){v.b.i("mse",e.type+" changeType: "+e.codec);try{i.changeType(e.codec),t.subSn=0}catch(t){return void this._onError({type:f.b.MSE_ERROR,details:f.a.CHANGETYPE_ERROR,fatal:!0,reason:"type:"+e.type+" codec:"+e.codec+" code:"+t.code+" msg:"+t.message})}}t&&(t.codec=e.codec,t.start=e.startDTS,t.end=e.endDTS,t.sn++,t.subSn++);try{e.updateTimestampOffset&&!i.buffered.length&&(i.timestampOffset=e.startPTS),i.appendBuffer(e.payload.buffer),this._sbAppendStarted[e.type]=!0}catch(t){v.b.i("mse",e.type,t.code,t.message),22!==t.code?(this._appendError?this._appendError++:this._appendError=1,this._appendError>this._config.appendErrorMaxRetry?(this._appendBufferError=!0,this._onError({type:f.b.MSE_ERROR,details:f.a.APPENDBUFFER_ERROR,fatal:!0,reason:"code:"+t.code+" type:"+e.type+" msg:"+t.message})):this._appendQueue[e.type].unshift(e)):(this._appendQueue[e.type].unshift(e),this._calculateRemoveRange(e.type),this.hasCleanUpTask(e.type)&&this._cleanUp(e.type),v.b.i("mse","mse bufferfull"),this.emit(p.a.MSE_BUFFER_FULL))}}},i._getSourceBufferType=function(e){for(var t in this._sourceBuffer)if(this._sourceBuffer[t]===e)return t;return"unknown"},i.flush=function(e,t,i){var n=0,r=Number.POSITIVE_INFINITY;for(var a in this._sbAppendStarted={},this._endOfData=!1,this._sourceBuffer)if(this._sbAppendStarted[a]=!1,(!i||i===a)&&this._sourceBuffer[a]){if(e){n=Math.max(n,e);for(var s=this._appendQueue[a].length-1;s>=0&&(!this._appendQueue[a][s].startPTS||this._appendQueue[a][s].startPTS>=e);s--)this._appendQueue[a].pop()}else this._appendQueue[a]=[];t&&(r=Math.min(r,t)),this._cleanUpTask[a].push({start:n,end:r}),this._cleanUp(a)}this._appendEnabled=!0},i.setAppendEnabled=function(e){!this._appendEnabled&&e?(this._appendEnabled=e,this.refresh()):this._appendEnabled=e},i.getAppendEnabled=function(){return this._appendEnabled},i.endOfData=function(){v.b.i("mse","data end"),this._endOfData=!0,!this._hasPendingData()&&(this._stat.isLive||!this._stat.isLive&&void 0!==this._duration)&&this.video&&this.video.buffered.length&&this._endOfStream()},i.ended=function(){return this._endOfData},i._endOfStream=function(){var e=this._mediaSource;if(e&&"open"===e.readyState){for(var t in this._sourceBuffer){var i=this._sourceBuffer[t];if(i&&i.updating)return}try{v.b.i("mse","end of stream"),e.endOfStream()}catch(e){v.b.e("mse",e),this._onError({type:f.b.MSE_ERROR,details:f.a.ENDOFSTREAM_ERROR,fatal:!0,reason:"code:"+e.code+" msg:"+e.message})}}},i.destroy=function(){if(v.b.i("mse","destroy"),this._mediaSource){var e=this._mediaSource;if(this._endOfStream(),"closed"!==e.readyState)for(var t in this._sourceBuffer)this._sourceBuffer[t]&&this._sbHandler[t]&&(this._sourceBuffer[t].removeEventListener("error",this._sbHandler[t].error),this._sourceBuffer[t].removeEventListener("updateend",this._sbHandler[t].updateend),e.removeSourceBuffer(this._sourceBuffer[t]));e.removeEventListener("sourceopen",this._onSourceOpen),e.removeEventListener("sourceended",this._onSourceEnded),e.removeEventListener("sourceclose",this._onSourceClose),this._mediaSource=null}this._removeStartBufTimer(),this.removeAllListeners(),this._appendQueue={},this._mimeCodec={},this._sbAppendStarted={},this._cleanUpTask={},this._sourceBuffer={},this._sbHandler={}},i.hasCleanUpTask=function(e){var t=0;if(void 0===e)for(var i in this._cleanUpTask)t+=this._cleanUpTask[i].length;else this._cleanUpTask[e]&&(t=this._cleanUpTask[e].length);return t>0},i.hasSourceBuffer=function(){return!!Object.keys(this._sourceBuffer).length},i.hasTrackInfo=function(){return!!Object.keys(this._mimeCodec).length},i.hasSourceBufferAppendStarted=function(){if(Object.keys(this._sbAppendStarted).length){var e=!0;for(var t in this._sbAppendStarted)e=e&&this._sbAppendStarted[t];return e}return!1},i._getBufferQueueSize=function(){var e=0;for(var t in this._appendQueue)e+=this._appendQueue[t].reduce((function(e,t){return t.payload&&t.payload.byteLength?e+t.payload.byteLength:e}),0);return e},i.getBufferQueueSec=function(e){var t=this;return this._appendQueue?(e?[e]:Object.keys(this._appendQueue)).reduce((function(e,i){return t._appendQueue[i]&&t._appendQueue[i].length>0&&(0===Object.keys(t._sourceBuffer).length||t._sourceBuffer[i])?Math.max(e,t._appendQueue[i].reduce((function(e,t){var i=t.endDTS-t.startDTS;return i?e+i:e}),0)):e}),0):0},i._update=function(e){if(this.hasCleanUpTask(e)&&this._cleanUp(e),this._startBufSec>0){if(!this.hasTrackInfo())return;for(var t in this._sourceBuffer)if(this.pendingSecByType(t)<this._startBufSec)return;this._startBufEnded()}this._doAppend(e)},i._cleanUp=function(e){for(var t=this._cleanUpTask[e];t&&t.length;){var i=t[0],n=this._sourceBuffer[e];if(n){if(n.updating||!this._cleanUpRange(n,i))return;t.shift()}else t.shift()}this.refresh()},i._removeStartBufTimer=function(){this._startBufTimer&&(clearTimeout(this._startBufTimer),this._startBufTimer=void 0)},s()(t,[{key:"readyState",get:function(){return this._mediaSource?this._mediaSource.readyState:"closed"}},{key:"trackBufInfo",get:function(){var e={};try{for(var t in this._sourceBuffer){var i=this._sourceBuffer[t].buffered;e[t]=[];for(var n=0;n<i.length;n++)e[t].push({st:i.start(n),ed:i.end(n)})}}catch(e){}return e}}]),t}(o.EventEmitter),ie=function(){function e(e){this.url=[],this.urlId=0,this.bitrate=0,this.maxBitrate=0,this.qualityType="",this.qualityLabel="",this.id=0,this.codec="",this.audioCodec="",this.videoCodec="",this.hidden=!1,this.enableAdaptive=!0,this.default=!1,this.width=void 0,this.height=void 0,this.index=0,this.drmSchemaId="",this.drmToken="",this.comment="",this.url=[e],this.urlId=0}return e.prototype.getKLevel=function(){return{width:this.width,height:this.height,qualityLabel:this.qualityLabel,qualityType:this.qualityType,bitrate:this.bitrate,maxBitrate:this.maxBitrate}},s()(e,[{key:"currentUrl",get:function(){return this.url[this.urlId]||""}}]),e}(),ne=function(e){function t(t){var i;return(i=e.call(this,t)||this).startSN=0,i.endSN=0,i.fragments=[],i.initSegment=null,i.live=!0,i.needSidxRanges=!1,i.startTimeOffset=null,i.targetduration=0,i.totalduration=0,i.type=null,i.version=null,i.details=null,i.PTSKnown=!1,i.m3u8Slice=void 0,i.audioGroupIds=void 0,i.attrs=void 0,i.averagetargetduration=void 0,i.name=void 0,i.lang=void 0,i.groupId="",i.instreamId="",i.autoselect=void 0,i.forced=void 0,i}return _()(t,e),s()(t,[{key:"hasProgramDateTime",get:function(){return!(!this.fragments[0]||"number"!=typeof this.fragments[0].programDateTime||!Object(ee.a)(this.fragments[0].programDateTime))}}]),t}(ie),re=i(27),ae=function(){function e(e,t){this._uri=null,this.baseuri=void 0,this.reluri=void 0,this.method=null,this.key=null,this.iv=void 0,this.baseuri=e,this.reluri=t}return s()(e,[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=Object(re.buildAbsoluteURL)(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),e}();!function(e){e.AUDIO="audio",e.VIDEO="video"}(Q||(Q={}));var se=function(){function e(){var e;this._url="",this._byteRange=null,this._decryptdata=null,this._elementaryStreams=((e={})[Q.AUDIO]=!1,e[Q.VIDEO]=!1,e),this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.relurl=void 0,this.baseurl=void 0,this.duration=void 0,this.sn=0,this.levelkey=void 0,this.level=0,this.start=0,this.cc=0,this.maxStartPTS=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.deltaPTS=void 0,this.dropped=void 0,this.backtracked=void 0,this.type=void 0,this.loader=void 0,this.title=null,this.urlId=void 0,this.data=void 0}var t=e.prototype;return t.setByteRange=function(e,t){var i=e.split("@",2),n=[];1===i.length?n[0]=t?t.byteRangeEndOffset:0:n[0]=parseInt(i[1],10),n[1]=parseInt(i[0],10)+n[0],this._byteRange=n},t.addElementaryStream=function(e){this._elementaryStreams[e]=!0},t.hasElementaryStream=function(e){return!0===this._elementaryStreams[e]},t.createInitializationVector=function(e){for(var t=new Uint8Array(16),i=12;i<16;i++)t[i]=e>>8*(15-i)&255;return t},t.setDecryptDataFromLevelKey=function(e,t){var i=e;return e&&e.method&&e.uri&&!e.iv&&((i=new ae(e.baseuri,e.reluri)).method=e.method,i.iv=this.createInitializationVector(t)),i},s()(e,[{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=Object(re.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(e){this._url=e}},{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var e=this.sn;"number"!=typeof e&&(e=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,e)}return this._decryptdata}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!Object(ee.a)(this.programDateTime))return null;var e=Object(ee.a)(this.duration)?this.duration:0;return this.programDateTime+1e3*e}},{key:"encrypted",get:function(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)}}]),e}(),oe=/^(\d+)x(\d+)$/,ce=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,_e=function(){function e(t){for(var i in"string"==typeof t&&(t=e.parseAttrList(t)),t)t.hasOwnProperty(i)&&(this[i]=t[i])}var t=e.prototype;return t.decimalInteger=function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var i=new Uint8Array(t.length/2),n=0;n<t.length/2;n++)i[n]=parseInt(t.slice(2*n,2*n+2),16);return i}return null},t.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.decimalFloatingPoint=function(e){return parseFloat(this[e])},t.optionalFloat=function(e,t){var i=this[e];return i?parseFloat(i):t},t.enumeratedString=function(e){return this[e]},t.bool=function(e){return"YES"===this[e]},t.decimalResolution=function(e){var t=oe.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},e.parseAttrList=function(e){var t,i={};for(ce.lastIndex=0;null!==(t=ce.exec(e));){var n=t[2];0===n.indexOf('"')&&n.lastIndexOf('"')===n.length-1&&(n=n.slice(1,-1)),i[t[1]]=n}return i},e}(),de={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};function ue(e){var t={};return(e||"").split(/[ ,]+/).forEach((function(e){0!==e.indexOf("avc1")&&0!==e.indexOf("hev1")&&0!==e.indexOf("av01")&&0!==e.indexOf("kvc")||(t.video=e),0===e.indexOf("mp4a")&&(t.audio=e)})),t}function le(e,t){var i=[].concat(e.split(/[ ,]+/));["video","audio"].forEach((function(e){var n=i.filter((function(t){return i=t,!!(n=de[e])&&!0===n[i.slice(0,4)];var i,n}));if(n.length){var r=n.filter((function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("av01",0)||0===e.lastIndexOf("hev1",0)||0===e.lastIndexOf("hvc1",0)||0===e.lastIndexOf("mp4a",0)}));t[e+"Codec"]=r.length>0?r[0]:n[0],i=i.filter((function(e){return-1===n.indexOf(e)}))}})),t.codec=i.join(",")}var he=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,fe=/#EXT-X-MEDIA:(.*)/g,pe=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),me=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,ve=/\.(mp4|m4s|m4v|m4a)$/i;function ge(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),"number"==typeof e.programDateTime&&Object(ee.a)(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}var ye,Ee=function(){function e(){}return e.findGroup=function(e,t){for(var i=0;i<e.length;i++){var n=e[i];if(n.id===t)return n}},e.convertAVC1ToAVCOTI=function(e){var t,i=e.split(".");return i.length>2?(t=i.shift()+".",t+=parseInt(i.shift(),10).toString(16),t+=("000"+parseInt(i.shift(),10).toString(16)).substr(-4)):t=e,t},e.resolve=function(e,t){return Object(re.buildAbsoluteURL)(t,e,{alwaysNormalize:!0})},e.parseMasterPlaylist=function(t,i){var n,r=[];for(he.lastIndex=0;null!==(n=he.exec(t));){var a=new ne(e.resolve(n[2],i)),s=a.attrs=new _e(n[1]),o=s.decimalResolution("RESOLUTION");o&&(a.width=o.width,a.height=o.height),a.maxBitrate=s.decimalInteger("BANDWIDTH")/1e3;var c=s.decimalInteger("AVERAGE-BANDWIDTH")/1e3;a.bitrate=c||a.maxBitrate,a.name=s.NAME,le(s.CODECS||"",a),a.videoCodec&&-1!==a.videoCodec.indexOf("avc1")&&(a.videoCodec=e.convertAVC1ToAVCOTI(a.videoCodec)),r.push(a)}return r},e.parseMasterPlaylistMedia=function(t,i,n,r){var a;void 0===r&&(r=[]);var s=[],o=0;for(fe.lastIndex=0;null!==(a=fe.exec(t));){var c=new _e(a[1]);if(c.TYPE===n){var _=new ne(c.URI?e.resolve(c.URI,i):"");if(_.attrs=c,_.index=_.id=o++,_.groupId=c["GROUP-ID"]||"",_.instreamId=c["INSTREAM-ID"]||"",_.name=c.NAME||c.LANGUAGE,_.type=n,_.default="YES"===c.DEFAULT,_.autoselect="YES"===c.AUTOSELECT,_.forced="YES"===c.FORCED,_.lang=c.LANGUAGE||"",r.length){var d=e.findGroup(r,_.groupId);_.audioCodec=d?d.codec:r[0].codec}s.push(_)}}return s},e.parseLevelPlaylist=function(e,t,i,n,r){void 0===n&&(n=R.e.MAIN),void 0===r&&(r=0);var a,s,o,c=0,_=0,d=0,u=null,l=new se,h=null,f=new ne(t);for(pe.lastIndex=0;null!==(s=pe.exec(e));){var p=s[1];if(p){l.duration=parseFloat(p);var m=(" "+s[2]).slice(1);l.title=m||null,l.tagList.push(m?["INF",p,m]:["INF",p])}else if(s[3]){if(Object(ee.a)(l.duration)){var g=c++;l.type=n,l.start=_,l.levelkey=a,l.sn=g,l.level=i,l.cc=d,l.urlId=r,l.baseurl=t,l.relurl=(" "+s[3]).slice(1),ge(l,u),f.fragments.push(l),u=l,_+=l.duration,l=new se}}else if(s[4]){var y=(" "+s[4]).slice(1);u?l.setByteRange(y,u):l.setByteRange(y)}else if(s[5])l.rawProgramDateTime=(" "+s[5]).slice(1),l.tagList.push(["PROGRAM-DATE-TIME",l.rawProgramDateTime]),null===h&&(h=f.fragments.length);else{if(!(s=s[0].match(me))||s.length<=0)break;for(o=1;o<s.length&&void 0===s[o];o++);var E=(" "+s[o+1]).slice(1),b=(" "+s[o+2]).slice(1);switch(s[o]){case"#":l.tagList.push(b?[E,b]:[E]);break;case"PLAYLIST-TYPE":f.type=E.toUpperCase();break;case"MEDIA-SEQUENCE":c=f.startSN=parseInt(E,10);break;case"TARGETDURATION":f.targetduration=parseFloat(E);break;case"VERSION":f.version=parseInt(E,10);break;case"EXTM3U":break;case"ENDLIST":f.live=!1;break;case"DIS":d++,l.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":d=parseInt(E,10);break;case"KEY":var A=new _e(E),T=A.enumeratedString("METHOD"),S=A.URI,x=A.hexadecimalInteger("IV");T&&(a=new ae(t,S),S&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(T)>=0&&(a.method=T,a.key=null,x&&(a.iv=x)));break;case"START":var L=new _e(E).decimalFloatingPoint("TIME-OFFSET");Object(ee.a)(L)&&(f.startTimeOffset=L);break;case"MAP":var C=new _e(E);l.relurl=C.URI,C.BYTERANGE&&l.setByteRange(C.BYTERANGE),l.baseurl=t,l.level=i,l.type=n,l.sn="initSegment",f.initSegment=l,(l=new se).rawProgramDateTime=f.initSegment.rawProgramDateTime;break;default:v.b.w("line parsed but not handled: "+s)}}}return(l=u)&&!l.relurl&&(f.fragments.pop(),_-=l.duration),f.totalduration=_,f.averagetargetduration=_/f.fragments.length,f.endSN=c-1,!f.initSegment&&f.fragments.length&&f.fragments.every((function(e){return ve.test(e.relurl)}))&&(v.b.w("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(l=new se).relurl=f.fragments[0].relurl,l.baseurl=t,l.level=i,l.type=n,l.sn="initSegment",f.initSegment=l,f.needSidxRanges=!0),h&&function(e,t){for(var i=e[t],n=t-1;n>=0;n--){var r=e[n];i.programDateTime&&(r.programDateTime=i.programDateTime-1e3*r.duration),i=r}}(f.fragments,h),f},e}();function be(e){switch(e){case R.e.MAIN:return ye.LEVEL;case R.e.SUBTITLE:return ye.SUBTITLE_TRACK;case R.e.AUDIO:return ye.AUDIO_TRACK;default:return ye.LEVEL}}!function(e){e.MANIFEST="manifest",e.LEVEL="level",e.AUDIO_TRACK="audioTrack",e.SUBTITLE_TRACK="subtitleTrack"}(ye||(ye={}));var Ae=function(e){function t(t){var i;return(i=e.call(this)||this).loaders={},i.tag="PlaylistLoader",i._config=void 0,i._loadsuccess=function(e,t,n){if(i.emit(p.a.DOWNLOAD,Oe(Le.SUCCESS,e,n)),e.isSidxRequest)i._onError({type:f.b.OTHER_ERROR,details:f.a.UNSUPPORTED,fatal:!0,url:e.url.toString(),reason:"unsupport sidx",statusCode:n.code});else if(i._resetInternalLoader(e.type),"string"==typeof t){if(0!==t.indexOf("#EXTM3U")){var r=t;return r.length>100&&(r=r.slice(0,100)),void i._handleManifestParsingError(e,"no EXTM3U delimiter."+r,n)}t.indexOf("#EXTINF:")>0||t.indexOf("#EXT-X-TARGETDURATION:")>0?i._handleTrackOrLevelPlaylist(e,t,n):i._handleMasterPlaylist(e,t,n)}else i._onError({type:f.b.NETWORK_ERROR,details:f.a.MANIFEST_PARSING_ERROR,fatal:!0,url:e.url.toString(),reason:'expected responseType of "text" for PlaylistLoader',statusCode:n.code})},i._loaderror=function(e,t){i._handleNetworkError(e,t)},i._loadAbort=function(e,t){i.emit(p.a.DOWNLOAD,Oe(Le.ABORT,e,t))},i._onError=function(e){i.emit(p.a.ERROR,e)},i._config=t,i.loaders={},i}_()(t,e),t.canHaveQualityLevels=function(e){return e===ye.LEVEL},t.mapContextToLevelType=function(e){switch(e.type){case ye.AUDIO_TRACK:return R.e.AUDIO;case ye.SUBTITLE_TRACK:return R.e.SUBTITLE;default:return R.e.MAIN}},t.getResponseUrl=function(e){var t=e.responseUrl;return t&&0!==t.indexOf("data:")||"string"!=typeof e.url||(t=e.url),t||""};var i=t.prototype;return i._createInternalLoader=function(e){var t=new M;return e.loader=t,this.loaders[e.type]=t,t},i._getInternalLoader=function(e){return this.loaders[e.type]},i._resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},i._destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this._resetInternalLoader(e)}},i.destroy=function(){this.removeAllListeners(),this._destroyInternalLoaders()},i.load=function(e){v.b.d(this.tag,"Loading playlist of type "+e.type+", level: "+e.level+", id: "+e.id);var t,i,n,r,a=this._getInternalLoader(e);if(a){var s=a.context;if(s&&s.url===e.url)return v.b.i(this.tag,"playlist request ongoing"),!1;v.b.w(this.tag,"aborting previous loader for type: "+e.type),a.abort()}if(e.type===ye.MANIFEST)t=this._config.manifestLoadingMaxRetry,i=this._config.manifestConnectionTimeout,n=this._config.manifestTransmissionTimeout,r=this._config.manifestLoadingRetryDelay;else t=this._config.levelLoadingMaxRetry,i=this._config.levelConnectionTimeout,n=this._config.levelTransmissionTimeout,r=this._config.levelLoadingRetryDelay;a=this._createInternalLoader(e),e.responseType=e.responseType||"text";var o={connectionTimeout:i,transmissionTimeout:n,maxRetry:t,retryDelay:r},c={onEnd:this._loadsuccess,onError:this._loaderror,onAbort:this._loadAbort};return v.b.d(this.tag,"Calling internal loader delegate for URL: "+e.url),a.load(e,c,o),!0},i._handleMasterPlaylist=function(e,i,n){var r=i,a=t.getResponseUrl(e),s=Ee.parseMasterPlaylist(r,a);if(s.length){var o=s.map((function(e){return{id:e.attrs.AUDIO,codec:e.audioCodec}})),c=Ee.parseMasterPlaylistMedia(r,a,"AUDIO",o),_=Ee.parseMasterPlaylistMedia(r,a,"SUBTITLES",o);if(c.length){var d=!1;if(c.forEach((function(e){e.url||(d=!0)})),!1===d&&s[0].audioCodec&&!s[0].attrs.AUDIO){v.b.v(this.tag,"audio codec signaled in quality level, but no embedded audio track signaled, create one");var u=new ne("");u.type=R.e.MAIN,u.name="main",u.id=-1,c.unshift(u)}}this.emit(p.a.MANIFEST_PARSED,{levels:s,audioTracks:c,subtitleTracks:_,url:a,stats:n})}else this._handleManifestParsingError(e,"no level found in manifest",n)},i._handleTrackOrLevelPlaylist=function(e,i,n){var r=e.id,a=e.level,s=e.type,o=t.getResponseUrl(e),c=Object(ee.a)(r)?r:0,_=Object(ee.a)(a)?a:c,d=t.mapContextToLevelType(e),u=Ee.parseLevelPlaylist(i,o,_,d,c);if(s===ye.MANIFEST&&this.emit(p.a.MANIFEST_PARSED,{levels:[u],singleLevel:!0,url:o,stats:n}),u.needSidxRanges&&u.initSegment){var l=u.initSegment.url;this.load({url:l,isSidxRequest:!0,type:s,level:a,levelDetails:u,id:r,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",headers:this._config.headers})}else e.levelDetails=u,this._handlePlaylistLoaded(e,n)},i._handleManifestParsingError=function(e,t,i){this._onError({type:f.b.NETWORK_ERROR,details:f.a.MANIFEST_PARSING_ERROR,fatal:!0,url:e.url.toString(),reason:t,statusCode:i.code})},i._handleNetworkError=function(e,t){var i,n;v.b.i(this.tag,"A network error occured while loading a "+e.type+"-type playlist");var r=this._getInternalLoader(e);switch(e.type){case ye.MANIFEST:i=f.a.MANIFEST_LOAD_ERROR,n=!0;break;case ye.LEVEL:i=f.a.LEVEL_LOAD_ERROR,n=!1;break;case ye.AUDIO_TRACK:i=f.a.AUDIO_TRACK_LOAD_ERROR,n=!1;break;case ye.SUBTITLE_TRACK:i=f.a.SUBTITLE_TRACK_LOAD_ERROR,n=!1;break;default:i=f.a.MANIFEST_LOAD_ERROR,n=!1}this.emit(p.a.DOWNLOAD,Oe(Le.FAIL,e,t)),t.fatal&&(r&&(r.abort(),this._resetInternalLoader(e.type)),this._onError({type:f.b.NETWORK_ERROR,details:i,fatal:n,url:e.url.toString(),reason:t.text,statusCode:t.code}))},i._handlePlaylistLoaded=function(e,i){var n=e.type,r=e.level,a=e.id,s=e.levelDetails;if(s&&s.targetduration)if(t.canHaveQualityLevels(e.type))this.emit(p.a.LEVEL_LOADED,{details:s,level:r||0,id:a||0,stats:i});else switch(n){case ye.AUDIO_TRACK:this.emit(p.a.AUDIO_TRACK_LOADED,{details:s,level:r||0,id:a,stats:i});break;case ye.SUBTITLE_TRACK:this.emit(p.a.SUBTITLE_TRACK_LOADED,{details:s,level:r||0,id:a,stats:i})}else this._handleManifestParsingError(e,"invalid target duration",i)},t}(o.EventEmitter),Te={400:"01",401:"02",403:"03",404:"04",other4xx:"05",serverError:"06",timeoutOpen:"07",timeoutIO:"08",200:"09",206:"09"};function Se(e,t,i){if(void 0===i&&(i=0),e>=100)return e;var n="00";return"timeout"===t?n=i?Te.timeoutIO:Te.timeoutOpen:Te.hasOwnProperty(i)?n=Te[i]||n:/^4\d{2}$/.test(i.toString())?n=Te.other4xx:/^5\d{2}$/.test(i.toString())&&(n=Te.serverError),parseInt(e+n,10)}function Re(){performance.removeEventListener("resourcetimingbufferfull",Ce)}var xe,Le,Ce=function(){performance&&("function"==typeof performance.clearResourceTimings?performance.clearResourceTimings():"function"==typeof performance.webkitClearResourceTimings&&performance.webkitClearResourceTimings())},De=/\_([A-Za-z0-9]+)\_/,Ie=/\/[A-Za-z0-9]+\_([A-Za-z0-9]+)\./;function we(e){if("string"!=typeof e)return"";var t=e.match(De);return t&&t.length>1||(t=e.match(Ie))&&t.length>1?t[1]:""}!function(e){e.FAIL="FAIL",e.ABORT="ABORT",e.SUCCESS="SUCCESS"}(Le||(Le={}));var ke=((xe={})[ye.MANIFEST]=f.a.MANIFEST_LOAD_ERROR,xe[ye.LEVEL]=f.a.LEVEL_LOAD_ERROR,xe[ye.AUDIO_TRACK]=f.a.AUDIO_TRACK_LOAD_ERROR,xe[ye.SUBTITLE_TRACK]=f.a.SUBTITLE_TRACK_LOAD_ERROR,xe);function Oe(e,t,i,n,r,a){void 0===r&&(r=!1);var s="string"==typeof t.url?t.url:"",o={domain:new S.a(s).host,download_url:s,download_start_time:i.tsload,download_spend_time:i.tload?Math.round(i.tload-i.tstart):Math.round(performance.now()-i.tstart),http_response_time:i.tfirst?Math.round(i.tfirst-i.tstart):0,download_status:e,http_status_code:i.code,retry_index:i.retry,error_code:0,error_message:"",loader_id:i.id,download_size:i.total||i.loaded||0,resource_type:t.type||"",preload:r?1:0};a&&(o.codec=a),n&&(o.quality_type=n);var c=t.frag;if(c&&(o.slice_play_start_time=Math.round(1e3*c.start),c.duration&&(o.slice_play_duration=Math.round(1e3*c.duration)),c.sn&&(o.slice_index=c.sn),c.level&&(o.slice_level_index=c.level)),e===Le.FAIL){var _=ke[t.type]||f.a.LOAD_ERROR;o.error_code=Se(_,i.text,i.code)}if(i.text&&(o.error_message=i.text),t.responseHeader){var d=D(t.responseHeader);d&&(o.custom_http_header=d)}"number"==typeof t.rangeStart&&(o.range_start=t.rangeStart),t.rangeEnd&&(o.range_end=t.rangeEnd);var u=we(o.download_url);if(u&&(o.transcoding_template=u),"string"==typeof t.url){var l=function(e){if(performance&&"function"==typeof performance.getEntriesByName){var t=performance.getEntriesByName(e,"resource");if(t.length){var i=t[t.length-1],n={};return i.redirectStart&&(n.redirect=Math.round(i.redirectEnd-i.redirectStart)),n.dns=Math.round(i.domainLookupEnd-i.domainLookupStart),n.tcp=Math.round(i.connectEnd-i.connectStart),n.request=Math.round(i.requestStart-i.connectEnd),n.firstResponse=Math.round(i.responseStart-i.requestStart),i.responseStart>0?n.response=Math.round(i.responseEnd-i.responseStart):n.response=Math.round(i.responseEnd-i.fetchStart),n.duration=Math.round(i.duration)||0,n}}return null}(t.url);l&&(l.redirect&&(o.time_redirect=l.redirect),l.dns&&(o.time_dns=l.dns),l.tcp&&(o.time_tcp=l.tcp),l.request&&(o.time_request=l.request),l.firstResponse&&(o.time_first_response=l.firstResponse),l.response&&(o.time_response=l.response),l.duration&&(o.duration=l.duration))}return o}var Ne,Pe={beacon:!1,predictStep:5,targetBuffer:10,duration:5,smoothRatioToTarget:0,switchpanelty:2.5*1e-6,slidingWindowSize:3,kalmanR:Math.pow(.2,2),kalmanQ:4e-4,initBitrate:2e6,startBitrateLimit:!0,speedPredictRatio:1.5,speedPredictNum:3,algorithm:1,speedPredictRatioOnStart:3,lowProfileThreshold:4,lowProfileBitrate:25e5,lowProfileStartThreshold:5};!function(e){e[e.Default=0]="Default",e[e.Seek=1]="Seek"}(Ne||(Ne={}));var Me=function(){function e(e){this._ctx=void 0,this._conf=void 0,this._bufferSize=0,this._lastBufferSize=0,this._pastThroughput=void 0,this._bitrates=[],this._qos={},this._storage=void 0,this._index=0,this._nextIndex=0,this._status=Ne.Default,this._speedPredictCnt=0,this._lowProfile=!1,this._lowProfileIndex=0,this._lowProfileHistory=0,this._renderBlockCount=0,this._initBitrate=0,this._storage=new F,this._conf=r()({},Pe),this._ctx=e}var t=e.prototype;return t.init=function(e){var t=r()({},Pe);this._conf=r()(t,e),this._initBitrate=this._conf.initBitrate},t.onManifestUpdated=function(){var e=this,t=this._ctx.lctx;this._initBitrate=this._conf.initBitrate,this._bitrates=[],t.abrLevels.forEach((function(t){e._bitrates.push(1e3*t.bitrate),t.default&&(e._initBitrate=t.bitrate)})),this._index=Math.min(t.abrDefault,this._bitrates.length-1),v.b.i("algorithm-hls","setInfo "+this._bitrates+", "+this._index),this._nextIndex=0,this._bufferSize=this._conf.duration,this._lastBufferSize=0,this._pastThroughput=new Array(this._conf.slidingWindowSize),this._pastThroughput[this._conf.slidingWindowSize-1]=0,this._status=Ne.Default,this._lowProfileIndex=this._maxBitrateIndex(this._bitrates,this._conf.lowProfileBitrate)},t.destroy=function(){},t.bitrateInit=function(){var e=this,t=this._bitrateToIndex(this._bitrates,this._initBitrate),i=this._storage.read("kwai_hls_adaptive");if(v.b.i("algorithm-hls","storage read:"+i),void 0!==i&&i.bitrate>=0&&i.speed>0&&2===i.version){i.time&&i.lowProfile&&Date.now()-i.time<2592e5&&(this._lowProfileHistory=Math.min(parseInt(i.lowProfile),this._conf.lowProfileStartThreshold+1),this._lowProfileHistory>this._conf.lowProfileStartThreshold&&(this._lowProfile=!0,t=Math.min(t,this._lowProfileIndex)));var n=Math.min(i.bitrate,1024*i.speed/this._conf.speedPredictRatioOnStart),r=this._bitrates.reduce((function(t,i,r){return Math.abs(i-n)<Math.abs(e._bitrates[t]-n)?r:t}),0);t=this._conf.startBitrateLimit?Math.min(t,r):r}return t},t.onLevelLoad=function(e){e<this._bitrates.length&&e>=0&&(this._index=e)},t.onKeyPoint=function(e){if(e.byteLength){var t=e.duration||e.spendTime,i=e.byteLength/t*7.8125;this._qos=r()({cache:!1},e),v.b.v("algorithm-hls","report download time:"+t+" bytes:"+e.byteLength+" buffered:"+e.buffered+" speed:"+i+" cache:"+this._qos.cache);var n=this._nextRateIndex(i,e.buffered/1e3);n!==this._nextIndex&&this._storage.write("kwai_hls_adaptive",{version:2,index:n,bitrate:this._bitrates[n],speed:this._qos&&this._qos.speed?this._qos.speed:0,lowProfile:Math.max(0,this._lowProfile?this._lowProfileHistory+1:this._lowProfileHistory-1),time:Date.now()}),this._nextIndex=n,this._qos.speed=i,this._qos.buffered=e.buffered,this._qos.nextBitrate=this._bitrates[this._nextIndex],this._qos.currentBitrate=this._bitrates[this._index]}},t.onSeek=function(e){v.b.v("algorithm-hls","report seek buffered:"+e.buffered+" inBuffer:"+e.isInBuffer),e.isInBuffer?this._resetAlgorithm():this._qos.seek=1,(!e.isInBuffer||e.buffered/1e3<this._conf.targetBuffer)&&(v.b.i("algorithm-hls","status change to seek."),this._status=Ne.Seek,this._speedPredictCnt=this._conf.speedPredictNum)},t.onDownloadEnabled=function(e){e||this._resetAlgorithm()},t._resetAlgorithm=function(){this._bufferSize=0,this._lastBufferSize=0,this._pastThroughput=new Array(this._conf.slidingWindowSize)},t._nextRateIndex=function(e,t){this._bufferSize=t,this._pastThroughput.shift(),this._pastThroughput.push(e),this._status===Ne.Seek&&(t>=this._conf.targetBuffer||this._speedPredictCnt<=0)&&(this._speedPredictCnt=0,this._status=Ne.Default,v.b.i("algorithm-hls","status change to default. buffered:"+t+" step:"+this._speedPredictCnt));var i=-1;return this._status===Ne.Seek?(this._speedPredictCnt--,this._lastBufferSize=this._bufferSize,i=this._nextRateBySpeed(e)):i=this._nextRateBySpeedAndBuffered(e,t),this._lowProfile&&(i=Math.min(i,this._lowProfileIndex)),i},t._nextRateBySpeed=function(e){var t=1024*e,i=this._bitrates[this._index];if(t<i||t>i*this._conf.speedPredictRatio)for(var n=this._bitrates.length-1;n>=0;n--)if(t>this._bitrates[n]*this._conf.speedPredictRatio)return n;return this._index},t._nextRateBySpeedAndBuffered=function(e,t){var i,n=1024*e,r=this._bitrates,a=r[this._index],s=this._ctx.playbackRate;for(i=r.length-1;i>0&&!(n>r[i]*s);i--);var o=r[i],c=this._index,_=t/s;return o>a?_>o*this._conf.duration/n&&(c=i):o<a&&_<a*this._conf.duration/n+this._conf.duration&&(c=i),v.b.v("algorithm-hls","_nextRateBySpeedAndBuffered bitrateBySpeed:"+o+", nextBitrate:"+c+", bitrate:"+a+", remainingTime:"+_+", speed:"+n+", playbackRate:"+s),c},t._bitrateToIndex=function(e,t){return e.reduce((function(i,n,r){return(e[i]+n)/2>=t?i:r}),0)},t._maxBitrateIndex=function(e,t){return e.reduce((function(e,i,n){return i>t?e:n}),0)},s()(e,[{key:"nextLevel",get:function(){return this._nextIndex}},{key:"lowProfile",get:function(){return this._lowProfile}}]),e}(),Ve={speedPredictRatioOnStart:6},Fe=function(e){function t(t){var i;return(i=e.call(this)||this)._ctx=void 0,i._algorithm=void 0,i._downloadEnd=void 0,i._downloadStartTime=0,i._index=0,i._ctx=t,i._downloadEnd=0,i}_()(t,e);var i=t.prototype;return i.init=function(){return this._algorithm=new Me(this._ctx),this._algorithm.init(this._ctx.config.hlsAdaptiveConfig||Ve),this._algorithm.onManifestUpdated(),this._algorithm.bitrateInit()},i.onAbrLevelsUpdated=function(){var e;null==(e=this._algorithm)||e.onManifestUpdated()},i.destory=function(){this._algorithm&&(this._algorithm=void 0)},i.onDownload=function(e){if(this._algorithm&&this._ctx.isAbrAvailable&&"number"==typeof e.slice_play_start_time&&"number"==typeof e.slice_play_duration&&Object(ee.a)(e.slice_play_start_time)&&Object(ee.a)(e.slice_play_duration)&&e.download_status===Le.SUCCESS){this._downloadEnd=e.slice_play_start_time+e.slice_play_duration;var t={buffered:this._downloadEnd-1e3*this._ctx.currentTime,duration:e.duration||0,spendTime:e.download_spend_time,byteLength:e.download_size};this._algorithm.onKeyPoint(t)}},i.onNewSource=function(){if(this._algorithm){var e=this._ctx.lctx.currentIdx;this._downloadStartTime=this._downloadStartTime||performance.now(),e>=0&&e<this._ctx.lctx.levels.length&&(this._index=e),this._algorithm.onLevelLoad(this._ctx.lctx.orignIndexToAbr(e))}},i.onSeek=function(e){this._algorithm&&this._ctx.isAbrAvailable&&this._algorithm.onSeek({isInBuffer:e.isInBuffer,buffered:this._downloadEnd-1e3*this._ctx.currentTime})},i.nextBitrateIndex=function(){var e=this._ctx.lctx;if(e.abr&&this._algorithm){var t=e.abrIndexToOrign(this._algorithm.nextLevel);if(t!==this._index&&t>=0&&t<e.levels.length)return t}return this._index},i.setDownloadEnabled=function(e){this._algorithm&&this._algorithm.onDownloadEnabled(e)},s()(t,[{key:"abrInitLevel",get:function(){var e;return(null==(e=this._algorithm)?void 0:e.bitrateInit())||0}}]),t}(o.EventEmitter);function Ue(e,t,i){var n=e[t],r=e[i],a=r.startPTS;Object(ee.a)(a)?i>t?(n.duration=a-n.start,n.duration<0&&v.b.w("LevelHelper","negative duration computed for frag "+n.sn+",level "+n.level+", there should be some duration drift between playlist and fragment!")):(r.duration=n.start-a,r.duration<0&&v.b.w("LevelHelper","negative duration computed for frag "+r.sn+",level "+r.level+", there should be some duration drift between playlist and fragment!")):r.start=i>t?n.start+n.duration:Math.max(n.start-r.duration,0)}function Be(e,t,i,n,r,a){var s=i;if(Object(ee.a)(t.startPTS)){var o=Math.abs(t.startPTS-i);Object(ee.a)(t.deltaPTS)?t.deltaPTS=Math.max(o,t.deltaPTS):t.deltaPTS=o,s=Math.max(i,t.startPTS),i=Math.min(i,t.startPTS),n=Math.max(n,t.endPTS),r=Math.min(r,t.startDTS),a=Math.max(a,t.endDTS)}var c=i-t.start;t.start=t.startPTS=i,t.maxStartPTS=s,t.endPTS=n,t.startDTS=r,t.endDTS=a,t.duration=n-i;var _,d=t.sn;if(!e||d<e.startSN||d>e.endSN||"number"!=typeof d)return 0;var u=d-e.startSN,l=e.fragments;for(l[u]=t,_=u;_>0;_--)Ue(l,_,_-1);for(_=u;_<l.length-1;_++)Ue(l,_,_+1);return e.PTSKnown=!0,c}function He(e,t){t.initSegment&&e.initSegment&&(t.initSegment=e.initSegment);var i,n=0;if(function(e,t,i){if(e&&t)for(var n=Math.max(e.startSN,t.startSN)-t.startSN,r=Math.min(e.endSN,t.endSN)-t.startSN,a=t.startSN-e.startSN,s=n;s<=r;s++){var o=e.fragments[a+s],c=t.fragments[s];if(!o||!c)break;i(o,c,s)}}(e,t,(function(e,r){n=e.cc-r.cc,Object(ee.a)(e.startPTS)&&(r.start=r.startPTS=e.startPTS,r.endPTS=e.endPTS,r.duration=e.duration,r.backtracked=e.backtracked,r.dropped=e.dropped,i=r),t.PTSKnown=!0})),t.PTSKnown){if(n){v.b.v("LevelHelper","discontinuity sliding from playlist, take drift into account");for(var r=t.fragments,a=0;a<r.length;a++)r[a].cc+=n}i?Be(t,i,i.startPTS,i.endPTS,i.startDTS,i.endDTS):function(e,t){var i=t.startSN-e.startSN,n=e.fragments,r=t.fragments;if(!(i<0||i>n.length))for(var a=0;a<r.length;a++)r[a].start+=n[i].start}(e,t),t.PTSKnown=e.PTSKnown}}function je(e,t,i){var n=1e3*(t.averagetargetduration?t.averagetargetduration:t.targetduration),r=n/2;return e&&t.endSN===e.endSN&&(n=r),i&&(n=Math.max(r,n-(performance.now()-i))),Math.round(n)}var We,ze,Ge=function(e){function t(t){var i;return(i=e.call(this)||this)._ctx=void 0,i._onManifestLoaded=function(){i.emit(p.a.MANIFEST_PARSED)},i._ctx=t,i}_()(t,e);var i=t.prototype;return i.loadManifest=function(){this._onManifestLoaded()},i.loadLevel=function(e,t){void 0===t&&(t=R.e.MAIN)},i.destroy=function(){},t}(o.EventEmitter),Ke=function(){function e(){}return e.verify=function(e){return!!(e&&e.hasOwnProperty("version")&&e.hasOwnProperty("adaptationSet")&&e.adaptationSet.hasOwnProperty("representation")&&Array.isArray(e.adaptationSet.representation)&&e.adaptationSet.representation.length>0)&&e.adaptationSet.representation.reduce((function(e,t){return!!(e&&t.url&&t.bitrate&&t.qualityType)}),!0)},e.parse=function(t){var i,n=[];return e.verify(t)&&t.adaptationSet.representation.forEach((function(e,t){var r=new ie(e.url);r.id=e.id||t,r.maxBitrate=e.bitrate||0,r.bitrate=e.averageBitrate||r.maxBitrate,r.qualityType=e.qualityType||"",r.qualityLabel=e.name||"",r.codec=e.codec||"",r.hidden=e.hidden||!1,r.enableAdaptive=void 0===e.enableAdaptive||!!e.enableAdaptive,r.default=e.defaultSelect||!1,r.index=t,n.push(r),r.default&&void 0===i&&(i=t)})),{levels:n,def:i||0,srcType:R.i.KWAI_FLV_ABR}},e}(),Ye=function(){function e(){}return e.verify=function(e){return!!(e&&e.hasOwnProperty("segments")&&Array.isArray(e.segments)&&e.segments.length>0)&&(e.segments.forEach((function(e){if(!e.url||!e.duration||!e.time)return!1})),!0)},e.parse=function(t,i){void 0===i&&(i="");var n=[],r={levels:n,withCredentials:!1,hasVideo:!0,hasAudio:!0};if(e.verify(t)){var a=new ne("");n.push(a);var s=new ne(""),o=t;r.withCredentials=!!o.withCredentials,void 0!==o.hasAudio&&(r.hasAudio=!!o.hasAudio),void 0!==o.hasVideo&&(r.hasVideo=!!o.hasVideo);var c=0,_=0,d=0;o.segments.forEach((function(e,t){var n=new se;n.sn=t,"string"==typeof e.startUtcTime?n.programDateTime=parseInt(e.startUtcTime):"number"==typeof e.startUtcTime&&(n.programDateTime=e.startUtcTime),"string"==typeof e.duration?n.duration=(parseFloat(e.duration)||0)/1e3:n.duration=(e.duration||0)/1e3,n.start=c,n.baseurl=i,n.relurl=e.url,c+=n.duration,t>0&&d!==e.periodId&&(n.tagList.push(["DIS"]),_++),n.cc=_,d=e.periodId,s.fragments.push(n)})),s.live=!1,s.type=R.e.MAIN,s.startSN=0,s.endSN=s.fragments.length-1,s.totalduration=c,a.details=s}return r},e}(),Xe=function(){function e(){}return e.verify=function(e){return!!(e&&e.adaptationSet&&e.adaptationSet.representation&&e.adaptationSet.representation.length)&&e.adaptationSet.representation.reduce((function(e,t){return!!(t.url&&t.bandwidth&&e)}),!0)},e.parse=function(t){var i=[];return e.verify(t)&&t.adaptationSet.representation.forEach((function(e){if(e&&(e.url||e.m3u8)){var t=new ne(e.baseUrl?Object(re.buildAbsoluteURL)(e.baseUrl,e.url,{alwaysNormalize:!0}):e.url);t.bitrate=Math.floor(e.bandwidth/1e3),t.maxBitrate=Math.floor(e.bandwidth/1e3),t.qualityType=e.qualityType||"",t.qualityLabel=e.qualityLabel||"",e.width&&e.height&&(t.width=e.width,t.height=e.height),le(e.codecs||"",t),t.audioCodec="",t.m3u8Slice=e.m3u8||e.m3u8Slice,t.totalduration=e.duration,e.backupUrl&&e.backupUrl.length&&(t.url=t.url.concat(e.backupUrl)),t.default=e.defaultSelect||!1,t.urlId=0,i.push(t)}})),{levels:i,def:0}},e}();!function(e){e[e.HLSTS=1]="HLSTS",e[e.MP4=2]="MP4",e[e.FLV=3]="FLV",e[e.HLSFMP4=4]="HLSFMP4"}(We||(We={})),function(e){e[e.LongVideo=1]="LongVideo",e[e.ShortVideo=2]="ShortVideo",e[e.LiveGame=3]="LiveGame",e[e.LiveShow=4]="LiveShow",e[e.LivePlayBack=5]="LivePlayBack"}(ze||(ze={}));var qe={1:R.g.hls_ts,2:R.g.mp4,3:R.g.flv,4:R.g.hls_fmp4},Ze=function(){function e(){}return e.verify=function(e){return!!(e&&e.adaptationSet&&e.adaptationSet.length)&&e.adaptationSet.reduce((function(e,t){return!!(e&&t.representation&&t.representation.length)}),!0)},e.parse=function(t){var i,n,r,a,s,o,c,_=[],d=!1,u=0;if(e.verify(t)){var l=t;o=qe[l.mediaType],c=1===l.stereoType?R.k.V360:R.k.Normal,l.adaptationSet.forEach((function(e){var t=e.duration/1e3;!u&&t&&(u=t);var o=e.drmSchemaId,c=e.drmToken;e.drmSchemaId&&(d=!0);var h=R.e.MAIN;if(e.mimeType&&(-1!==e.mimeType.indexOf("video")||(h=-1!==e.mimeType.indexOf("audio")?R.e.AUDIO:"text/vtt"===e.mimeType?R.e.SUBTITLE:void 0)),h){var f=e.representation.map((function(i,n){var _;if(l.mediaType===We.HLSTS||l.mediaType===We.HLSFMP4?((_=new ne(i.url)).lang=e.language||"",_.default=!!i.defaultSelect,_.id=i.id||n,_.m3u8Slice=i.m3u8Slice,_.totalduration=t||u,_.maxBitrate=i.maxBitrate||0):(_=new ie(i.url)).maxBitrate=i.maxBitrate||0,_.bitrate=i.avgBitrate||_.maxBitrate,_.qualityType=i.qualityType||"",_.qualityLabel=i.qualityLabel||"",_.codec=i.codecs||"",_.codec){var f=ue(_.codec);_.audioCodec=f.audio||"",_.videoCodec=f.video||""}return 1===l.adaptationSet.length&&(_.audioCodec=""),i.width&&i.height&&(_.width=i.width,_.height=i.height),_.hidden=i.hidden||!1,_.enableAdaptive=void 0===i.disableAdaptive||!i.disableAdaptive,_.default=i.defaultSelect||!1,_.index=n,_.drmSchemaId=i.drmSchemaId||o,_.drmToken=i.drmToken||c,_.drmSchemaId&&(d=!0),i.backupUrl&&i.backupUrl.length&&(_.url=_.url.concat(i.backupUrl)),_.urlId=0,_.default&&void 0===r&&(h===R.e.MAIN?r=n:h===R.e.AUDIO?a=n:h===R.e.SUBTITLE&&(s=n)),_.comment=i.comment,_}));h===R.e.MAIN?_=_.concat(f):h===R.e.AUDIO?(i||(i=[]),i=i.concat(f)):h===R.e.SUBTITLE&&(n||(n=[]),n=n.concat(f))}}))}return n&&e.processingSubtitleType(n,u),{levels:_,def:r||0,audioTracks:i,defAudio:a||0,subtitleTracks:n,defSubtitle:s||0,drm:d,box:o,stereoType:c}},e.processingSubtitleType=function(e,t){e.forEach((function(e,i){if(-1===e.currentUrl.indexOf(".m3u8")){e.live=!1,e.index=i,e.details=new ne(""),e.totalduration=t;var n=new se;n.type=R.e.SUBTITLE,n.start=0,n.sn=1,n.level=i,n.cc=0,n.url=e.currentUrl,n.duration=t,e.details.live=!1,e.details.targetduration=t,e.details.totalduration=t,e.details.endSN=1,e.details.fragments=[n]}}))},e.getAdaptationIdxByType=function(e,t){for(var i=0;i<e.adaptationSet.length;i++){var n;if(void 0===e.adaptationSet[i].mimeType)return"video"===t?0:-1;if(0===(null==(n=e.adaptationSet[i].mimeType)?void 0:n.indexOf(t)))return i}return-1},e}();function Qe(e,t,i){var n=Math.min(e,t);return n>1080||1080===n&&i>35}var Je=[R.g.hls,R.g.hls_ts,R.g.hls_fmp4];function $e(e){return!!e&&-1!==Je.indexOf(e)}var et=new RegExp('codecs="((/w|.)+)"'),tt=[{k:"video/mp4",v:R.g.mp4},{k:"video/quicktime",v:R.g.mp4},{k:"video/x-flv",v:R.g.flv},{k:"video/webm",v:R.g.matroska},{k:"video/x-matroska",v:R.g.matroska},{k:"video/mp2t",v:R.g.ts},{k:"audio/x-matroska",v:R.g.matroska},{k:"audio/mp4",v:R.g.mp4},{k:"audio/mpeg",v:R.g.mp3},{k:"audio/aac",v:R.g.aac},{k:"application/vnd.apple.mpegurl",v:R.g.hls},{k:"application/x-mpegurl",v:R.g.hls}];function it(e){for(var t={type:e,box:R.g.unknown,vCodec:R.b.unknown},i=0;i<tt.length;i++)if(0===e.toLocaleLowerCase().indexOf(tt[i].k)){t.box=tt[i].v;var n=e.match(et);n&&n.length>2&&n[1].split(",").forEach((function(e){0===e.indexOf("avc1")?t.vCodec=R.b.h264:0===e.indexOf("av01")?t.vCodec=R.b.av1:0!==e.indexOf("hev1")&&0!==e.indexOf("hvc1")||(t.vCodec=R.b.hevc)}));break}return t}var nt=new RegExp("^((http|https)://)|blob:"),rt=[R.g.matroska,R.g.mp3,R.g.aac],at=[R.g.flv,R.g.raw,R.g.webrtc,R.g.ivf],st=[R.g.mp4,R.g.flv,R.g.hls,R.g.raw,R.g.hls_fmp4,R.g.hls_ts,R.g.ts,R.g.ivf],ot=Object.keys(R.b).map((function(e){return R.b[e]})),ct=function(){function e(){}return e.verifyMix=function(e){var t=0;for(var i in e)-1!==ot.indexOf(i)&&t++;return t>0},e.isSrcEmpty=function(e){try{if("string"==typeof e){if(!(e=e.trim()))return!0;if(!nt.test(e))return 0===Object.keys(JSON.parse(e)).length}else if(!(e instanceof Blob))return 0===Object.keys(e).length}catch(e){}return!1},e.filterLevels=function(e){var t=x.a.chrome||x.a.firefox;e.levels.forEach((function(e){t&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec="")}));var i=wi.isMSEAvailable()?wi.isMSECodecStrSupportedInMp4:wi.isVideoCodecStrSupportedInMp4;e.levels=e.levels.filter((function(e){var t=e.audioCodec,n=e.videoCodec;return(!t||i(t,"audio"))&&(!n||i(n))}));var n=!1;return e.levels.forEach((function(t,i){t.index=i,t.default&&(e.def=i,n=!0)})),n||(v.b.i("media-src","no default main level, select the one with the lowest bit rate."),e.def=e.levels.reduce((function(t,i,n){return i.bitrate<e.levels[t].bitrate?n:t}),0)),e.audioTracks&&(e.audioTracks=e.audioTracks.filter((function(e){return!e.audioCodec||i(e.audioCodec,"audio")})),e.defAudio=void 0,e.audioTracks.forEach((function(t,i){t.index=i,t.default&&(e.defAudio=i)})),void 0===e.defAudio&&(e.defAudio=0)),e.subtitleTracks&&e.subtitleTracks.length&&e.subtitleTracks.forEach((function(t,i){t.index=i,t.default&&(e.defSubtitle=i)})),e},e.preParse=function(t,i,n,r){if(void 0===i&&(i=!1),"string"==typeof t){if(t=t.trim(),!nt.test(t))try{t=JSON.parse(t)}catch(e){return v.b.i("media-src","pre prese src error",t),{src:t,box:R.g.unknown,srcType:R.i.OTHERS}}}else t instanceof Blob||(t=JSON.parse(JSON.stringify(t)));if(Array.isArray(t)){for(var a,s=[],o=t.map((function(t){if(!t||!t.src)return{info:void 0,priority:0};var a=e._preParseMd(t.src,i,n,r);return s.push(a.box),{info:a,mime:t.type?it(t.type):void 0,priority:0}})),c=0;c<o.length;c++){var _=o[c];if(_.info&&_.info.src)if(_.mime&&(_.mime.box!==R.g.unknown&&(_.info.box=_.mime.box),_.mime.vCodec!==R.b.unknown&&(_.info.codecType=_.mime.vCodec)),void 0!==n&&n!==_.info.nativeFirst||_.priority++,_.info.nativeFirst)_.priority+=_.info.box===R.g.unknown?1:wi.isVideoBoxSupported(_.info.box)?2:-2,_.priority+=_.info.codecType===R.b.unknown?1:r&&r===_.info.codecType||wi.isVideoCodecSupported(_.info.codecType)?2:-2;else{if(!wi.isMSEAvailable())continue;_.priority+=_.info.box===R.g.unknown?1:st.indexOf(_.info.box)>=0?2:-2,_.priority+=_.info.codecType===R.b.unknown?1:r&&r===_.info.codecType||wi.isMSECodecSupported(_.info.codecType)?2:-2}}return o.sort((function(e,t){return t.priority-e.priority})),null!=(a=o[0])&&a.info?(o[0].info.mixContainerInput=s,o[0].info):{src:t,box:R.g.unknown,srcType:R.i.OTHERS}}return e._preParseMd(t,i,n,r)},e._preParseMd=function(t,i,n,a){if(void 0===i&&(i=!1),"string"==typeof t&&(t=t.trim(),!nt.test(t)))try{t=JSON.parse(t)}catch(e){return v.b.i("media-src","pre prese src error",t),{src:t,box:R.g.unknown,srcType:R.i.OTHERS}}var s,o,c=[],_=wi.isMSEAvailable();if(e.verifyMix(t)){var d={},u=t;for(var l in o={},u){var h=l;if(-1!==ot.indexOf(h)){var f=u[h];if("string"==typeof f&&(f=f.trim()),!f)continue;var p=this._getBoxBySrc(f);if(p.nativeFirst=this._getNativeFirstByBox(p.box,_,n),c.push(h),_&&!p.nativeFirst){var m=wi.getVideoCodecCompatibilityByCodec(h);o[h]=m.decoder,h===R.b.h264&&(m={decoder:R.c.buildin,smooth:!0,mix:m.mix}),m.smooth&&m.decoder===R.c.buildin&&f&&(p.compatibility=m,p.codecType=h,d[h]=p)}else{var g=wi.isVideoCodecSupported(h);o[h]=g?R.c.buildin:R.c.unsupported,(!g||x.a.ios&&h===R.b.hevc&&p.box===R.g.hls_ts)&&h!==R.b.h264||(p.compatibility={decoder:R.c.buildin,smooth:!0,mix:!1},p.codecType=h,d[h]=p)}}}var y,E=d[R.b.hevc],b=d[R.b.av1],A=d[R.b.h264];if(a&&d[a])s=d[a];else{var T,S=b||E;!x.a.mobile&&i&&S&&S.compatibility&&S.compatibility.mix&&A&&(Ze.verify(S.src)&&Ze.verify(A.src)&&S.box===A.box?T=function(e,t,i){if(void 0===i&&(i=R.b.hevc),e.mediaType===t.mediaType){var n=Ze.getAdaptationIdxByType(e,"audio"),a=Ze.getAdaptationIdxByType(t,"audio");if(n>=0&&a>=0||-1===n&&-1===a){var s=Ze.getAdaptationIdxByType(e,"video"),o=Ze.getAdaptationIdxByType(t,"video");if(-1===s||-1===o)return;var c=e.adaptationSet[s].representation,_=t.adaptationSet[o].representation;if(0===c.length||0===_.length||1===c.length&&1===_.length)return;var d=[],u=[],l={},h=c.length>1?c:_,f=h[0].width<h[h.length-1].width;if(_.forEach((function(e){Qe(e.height,e.width,e.frameRate)||(l[e.qualityType]=i,u.push(e))})),c.forEach((function(e){(Qe(e.height,e.width,e.frameRate)||0===u.length)&&(l[e.qualityType]=R.b.h264,d.push(e))})),0===d.length&&0===u.length)return;var p=d.concat(u);if(u.length&&p.sort((function(e,t){return f?e.width-t.width:t.width-e.width})),p.length){var m=r()({},t);return m.adaptationSet[o].representation=p,{manifest:m,qualityList:l}}}}}(A.src,S.src,S.codecType):Ke.verify(S.src)&&Ke.verify(A.src)&&(A.src,S.src,T=void(void 0===S.codecType&&R.b.hevc)),T&&(v.b.i("media-src","mix kwai manifest"),S.src=T.manifest,S.mediaLevels=e.filterLevels(Ze.parse(S.src)),S.codecType=R.b.unknown,S.mixQualityList=T.qualityList,s=S))}s||((s=b||E||A)&&(s.nativeFirst=this._getNativeFirstByBox(s.box,_,n)),v.b.i("media-src","select src",null==(y=s)?void 0:y.codecType))}else(s=this._getBoxBySrc(t)).nativeFirst=this._getNativeFirstByBox(s.box,_,n);return s||(s={src:t,box:R.g.unknown,srcType:R.i.OTHERS}),c.length&&(s.mixCodecInput=c),s.mixCodecAvailable=o,s},e._getNativeFirstByBox=function(e,t,i){return!t||-1!==rt.indexOf(e)||!(-1!==at.indexOf(e)||!wi.isVideoBoxSupported(e))&&(x.a.mobile?e===R.g.mp4||e===R.g.hls||e===R.g.hls_ts||e===R.g.ts?!(void 0!==i&&!i||!wi.isVideoBoxSupported(e)):e===R.g.hls_fmp4?!(void 0!==i&&!i||!wi.isVideoBoxSupported(e)||!x.a.x5&&!x.a.xweb):void 0:i?!!wi.isVideoBoxSupported(e):void 0===i&&!wi.isMSEAvailable())},e._getBoxBySrc=function(t){var i={src:t,box:R.g.unknown,srcType:R.i.OTHERS};if("string"==typeof t)i.box=e._getMediaBoxByURL(t),i.mediaLevels={levels:[new ie(t)],def:0},i.isLive=this._getIsLiveByBox(i.box);else if(t instanceof Blob)i.mediaLevels={levels:[new ie(URL.createObjectURL(t))],def:0},i.box=t instanceof File?e._getMediaBoxByURL(t.name):R.g.unknown,i.srcType=R.i.FILE,i.isLive=!1;else if(Ze.verify(t))i.mediaLevels=e.filterLevels(Ze.parse(t)),i.box=i.mediaLevels.box||e._getMediaBoxByURL(t.adaptationSet[0].representation[0].url),i.srcType=R.i.KWAI,i.isLive=this._getIsLiveByBox(i.box);else if(Ke.verify(t))i.mediaLevels=e.filterLevels(Ke.parse(t)),i.box=R.g.flv,i.isLive=!0,i.srcType=R.i.KWAI_FLV_ABR;else if(Ye.verify(t)){var n=Ye.parse(t);i.mediaLevels=r()({def:0},n),i.box=R.g.flv,i.isLive=!1,i.multipart=!0,i.srcType=R.i.KWAI_FLV_MP}else Xe.verify(t)&&(i.mediaLevels=e.filterLevels(Xe.parse(t)),i.box=R.g.hls,i.srcType=R.i.KWAI);return $e(i.box)&&(i.multipart=!0),i},e._getIsLiveByBox=function(e){var t;return-1===[R.g.flv,R.g.hls,R.g.unknown,R.g.ivf,R.g.yuv].indexOf(e)&&(t=!1),e===R.g.webrtc&&(t=!0),t},e._getMediaBoxByURL=function(e){return e.indexOf(".mp4")>0||e.indexOf(".m4s")>0||e.indexOf(".mov")>0||e.indexOf(".m4a")>0?R.g.mp4:e.indexOf(".flv")>0?R.g.flv:e.indexOf(".m3u8")>0?R.g.hls:e.indexOf(".sdp")>0?R.g.webrtc:e.indexOf(".webm")>0||e.indexOf(".mkv")>0||e.indexOf(".mka")>0?R.g.matroska:e.indexOf(".mp3")>0?R.g.mp3:e.indexOf(".aac")>0?R.g.aac:e.indexOf(".ts")>0?R.g.ts:e.indexOf(".yuv")>0?R.g.yuv:R.g.unknown},e}(),_t=function(){function e(){}return e.parse=function(e){return Xe.verify(e)?Xe.parse(e):Ze.verify(e)?Ze.parse(e):{levels:[],def:0}},e.parseLevelSlice=function(e,t){if(e.m3u8Slice){var i=Ee.parseLevelPlaylist(e.m3u8Slice,e.url[0],e.index,t,0);if(delete e.m3u8Slice,0===i.fragments.length)return;return i}},e}(),dt=function(e){function t(t){var i;return(i=e.call(this)||this)._playlistLoader=void 0,i._ctx=void 0,i._onManifestLoaded=function(e){var t=i._ctx.lctx;e=ct.filterLevels(e),i._ctx.stat.drm=e.drm,t.levels=e.levels,t.currentIdx=e.def,e.audioTracks&&(t.audioTracks=e.audioTracks,t.audioIdx=e.defAudio||0),e.subtitleTracks&&(t.subtitleTracks=e.subtitleTracks,t.subtitleIdx=e.defSubtitle||0),i.emit(p.a.MANIFEST_PARSED)},i._onLevelLoaded=function(e){i.emit(p.a.LEVEL_LOADED,e,R.e.MAIN)},i._onAudioLevelLoaded=function(e){i.emit(p.a.AUDIO_TRACK_LOADED,e)},i._onSubtitleLevelLoaded=function(e){i.emit(p.a.SUBTITLE_TRACK_LOADED,e)},i._ctx=t,i._playlistLoader=new Ae(i._ctx.config),i._playlistLoader.on(p.a.MANIFEST_PARSED,i._onManifestLoaded),i._playlistLoader.on(p.a.LEVEL_LOADED,i._onLevelLoaded),i._playlistLoader.on(p.a.AUDIO_TRACK_LOADED,i._onAudioLevelLoaded),i._playlistLoader.on(p.a.SUBTITLE_TRACK_LOADED,i._onSubtitleLevelLoaded),i._playlistLoader.on(p.a.DOWNLOAD,(function(e){i.emit(p.a.DOWNLOAD,e)})),i._playlistLoader.on(p.a.ERROR,(function(e){i.emit(p.a.ERROR,e)})),i}_()(t,e);var i=t.prototype;return i.loadManifest=function(){this._ctx.lctx.levels.length?this.emit(p.a.MANIFEST_PARSED):this._playlistLoader&&this._playlistLoader.load({url:this._ctx.src,type:ye.MANIFEST,level:0,id:null,credentials:this._ctx.config.credentials,headers:this._ctx.config.headers})},i.loadLevel=function(e,t){if(void 0===t&&(t=R.e.MAIN),e.m3u8Slice){var i=_t.parseLevelSlice(e,t);if(i&&(e.totalduration&&(i.totalduration=e.totalduration),e.details=i,this.emit(p.a.LEVEL_UPDATED,t),!i.live))return}if(this._playlistLoader){var n=e.urlId,r=e.url[n];this._playlistLoader.load({url:r,type:be(t),level:e.index,id:n,credentials:this._ctx.config.credentials,headers:this._ctx.config.headers})}},i.destroy=function(){this._playlistLoader&&(this._playlistLoader.destroy(),this._playlistLoader=void 0)},t}(o.EventEmitter),ut=dt?{hls:dt,hls_ts:dt,hls_fmp4:dt,flv:Ge}:{flv:Ge},lt=i(20),ht=i(26),ft={local:0,server:0},pt=function(){function e(){var e=this;this._loader=void 0,this._callback=void 0,this._loaderConfig=void 0,this._onLoaderError=function(){e._disposeLoader()},this._onLoaderEnd=function(t,i){if(e._disposeLoader(),"string"==typeof i){ft.local=performance.now();var n=i.split(",");ft.server=1e3*parseFloat(n[0])+parseInt(n[1],10)/1e3/2}},this._callback={onError:this._onLoaderError,onEnd:this._onLoaderEnd},this._loaderConfig={useFetch:!1,connectionTimeout:5e3}}e.serverMs=function(e){return ft.server?e-ft.local+ft.server:null},e.clear=function(){ft.local=0,ft.server=0};var t=e.prototype;return t.update=function(e){e?ft={server:e,local:0}:this.load()},t.load=function(){this._disposeLoader();(this._loader=new M).load({url:"https://ntp.nc.gifshow.com/",responseType:"text"},this._callback,this._loaderConfig)},t.destroy=function(){this._disposeLoader()},t._disposeLoader=function(){this._loader&&this._loader.destroy()},s()(e,[{key:"time",get:function(){return r()({},ft)}}],[{key:"serverNowMs",get:function(){return ft.server?performance.now()-ft.local+ft.server:null}}]),e}(),mt=function(){function e(){this._ntp=void 0,this._priv={keyAbstMs:0,keyPtsOrignMs:0,keyDtsOrignMs:0},this._vLastExtraInfo=void 0,this._aLastExtraInfo=void 0,this._ntp=new pt}var t=e.prototype;return t.init=function(){!pt.serverNowMs&&this._ntp&&this._ntp.load()},t.onPrivNal=function(e){this._priv.keyAbstMs=e.abst,this._priv.keyPtsOrignMs=e.ptsOrignMs,this._priv.keyDtsOrignMs=e.timestamp},t.onParsing=function(e){var t=this;e.segments.forEach((function(e){Array.isArray(e.samplesExtra)&&(e.type===R.l.VIDEO?t._vLastExtraInfo=e.samplesExtra[e.samplesExtra.length-1]:e.type===R.l.AUDIO&&(t._aLastExtraInfo=e.samplesExtra[e.samplesExtra.length-1]))}))},t.destroy=function(){this._ntp&&(this._ntp.destroy(),this._ntp=void 0)},t.getDisplayDelay=function(e){return this._renderDelay(1e3*e,this._vLastExtraInfo)},t.getAudioRenderDelay=function(e){return this._renderDelay(1e3*e,this._aLastExtraInfo)},t.getRecDelay=function(){var t=this._vLastExtraInfo;if(pt.serverNowMs&&t){var i=this._priv;return Math.round(pt.serverMs(t.parseMs+e._workerStartMs)-(t.dtsOrignMs-i.keyDtsOrignMs+i.keyAbstMs))}return 0},t._renderDelay=function(e,t){var i=pt.serverNowMs,n=this._priv;return i&&t&&n.keyAbstMs?Math.round(t.ptsMs-e+i-(t.ptsOrignMs-n.keyPtsOrignMs+n.keyAbstMs)):0},s()(e,null,[{key:"workerTimeOffset",set:function(t){e._workerStartMs=t}}]),e}();mt._workerStartMs=0;var vt=mt,gt=i(39),yt=function(){function e(e,t,i){var n=this;this._id=void 0,this._eventEmitter=void 0,this._ctx=void 0,this._w=void 0,this._inlineEventEmitter=void 0,this._chunkIndex=void 0,this._seek=!1,this._demuxer=void 0,this._progressTime=0,this._lastTRequest=0,this._transmuxData=void 0,this._ended=!1,this._onWorkMessage=function(e){n._onMessage(e.data.event,e.data.data)},this._id=i,this._eventEmitter=e,this._ctx=t;try{t.stat.webWorker&&(this._w=h()(47)),vt.workerTimeOffset=performance.now()}catch(e){}this._chunkIndex=0,this._transmuxData={audioCodec:t.stat.audioCodec,videoCodec:"",duration:0,remuxId:1}}var t=e.prototype;return t.init=function(){var e=this,t=this._inlineEventEmitter=new o.EventEmitter,i=this._onMessage.bind(this);if(t.on(p.a.PRIV_NAL,(function(e){return i(p.a.PRIV_NAL,e)})),t.on(p.a.INIT_PTS_FOUND,(function(e){return i(p.a.INIT_PTS_FOUND,e)})),t.on(p.a.PARSING_INIT_SEGMENT,(function(e){return i(p.a.PARSING_INIT_SEGMENT,e)})),t.on(p.a.PARSED_DATA,(function(e){return i(p.a.PARSED_DATA,e)})),t.on(p.a.RAW_DATA,(function(e){return i(p.a.RAW_DATA,e)})),t.on(p.a.VIDEO_CODEC_DETECTED,(function(e){return i(p.a.VIDEO_CODEC_DETECTED,e)})),t.on(p.a.LOAD_END,(function(e){return i(p.a.LOAD_END,e)})),t.on(p.a.ERROR,(function(e){return i(p.a.ERROR,e)})),t.on(p.a.PARSING_DATA,(function(e){return i(p.a.PARSING_DATA,e)})),t.on(p.a.DEMUXER_DETECTED,(function(e){return i(p.a.DEMUXER_DETECTED,e)})),t.on(p.a.MEDIA_DEMUX,(function(e){return i(p.a.MEDIA_DEMUX,e)})),t.on(p.a.METADATA,(function(e){return i(p.a.METADATA,e)})),t.on(p.a.KEY_FRAME_INDEXS,(function(e){return i(p.a.KEY_FRAME_INDEXS,e)})),t.on(p.a.KEY_FRAME,(function(e){return i(p.a.KEY_FRAME,e)})),t.on(p.a.VIDEO_FRAME_INFO,(function(e){return i(p.a.VIDEO_FRAME_INFO,e)})),t.on(p.a.MP4_NOT_FASTSTART,(function(e){return i(p.a.MP4_NOT_FASTSTART,e)})),v.b.i("muxer-base","TYPE_SUPPORTED","hw: "+wi.isSupportHW,wi.TYPE_SUPPORTED),this._w){this._w.addEventListener("message",this._onWorkMessage),this._w.addEventListener("error",(function(t){v.b.i("muxer-base","worker onerror",t.message),e._eventEmitter.emit(p.a.ERROR,{type:f.b.MUX_ERROR,details:f.a.REMUX_WORKER_ERROR,fatal:!0,reason:t.message})}));try{this._w.postMessage({cmd:ht.a.INIT,typeSupported:wi.TYPE_SUPPORTED,config:this._ctx.getRemuxConfig(),vendor:navigator.vendor})}catch(e){v.b.i("muxer-base","worker init error"),this._w.terminate(),this._w=void 0}}this._w||(this._demuxer=new gt.a(t,wi.TYPE_SUPPORTED,this._ctx.getRemuxConfig(),navigator.vendor))},t.destroy=function(){this._w&&(this._w.postMessage({cmd:ht.a.DESTROY}),this._w.removeEventListener("message",this._onWorkMessage),this._w.terminate()),this._inlineEventEmitter&&(this._inlineEventEmitter.removeAllListeners(),this._inlineEventEmitter=void 0)},t.trackInfo=function(e,t){this._transmuxData.hasVideo=e,this._transmuxData.hasAudio=t},t.reset=function(e){v.b.i("muxer-base","reset: "+e),this._transmuxData.remuxId++,this._chunkIndex=0,this._seek=e,this._ended=!1},t.end=function(){this._ended||(this._ended=!0,this._w?this._w.postMessage({cmd:ht.a.LOAD_END}):this._demuxer&&this._demuxer.end())},t.onFragProgress=function(e){this._demux(e,!1)},t.onFragLoaded=function(e){this._demux(e,!0)},t.updateSuffix=function(e){this._transmuxData.suffix=e},t._demux=function(e,t){var i=e.context.frag,n=!1,r=i.start||0,a=!1,s=!0,o=null;if(this._transmuxData.progress=e.progress,e.data&&e.data.byteLength){var c=performance.now(),_=c-(this._progressTime||e.stats.trequest);e.stats.trequest!==this._lastTRequest&&(this._lastTRequest=e.stats.trequest,_=c-e.stats.trequest),this._progressTime=c,this._eventEmitter.emit(p.a.LOADER_CHUNK_ARRIVAL,{byteLength:e.data.byteLength,timeCost:_})}0===this._chunkIndex&&(n=!0,a=!1,s=e.remuxContiguous||!1,v.b.i("muxer-base","chunk 0 contiguous: "+s)),t?(this._progressTime=0,this._chunkIndex=0,o=e.data?new Uint8Array(e.data):new Uint8Array):(this._chunkIndex++,e.data&&(o=new Uint8Array(e.data))),o&&(this._push(o,i.decryptdata,e.initData,r,s,n,a,!this._seek||0===i.start,t),this._seek=!1)},t._onParsing=function(e){return!(e.extra&&e.extra.remuxId!==this._transmuxData.remuxId&&(v.b.i("muxer-base","parsing data expired"),1))},t._onParsed=function(e){return!(e.extra&&e.extra.remuxId!==this._transmuxData.remuxId&&(v.b.i("muxer-base","parsed expired"),1))},t._push=function(e,t,i,n,a,s,o,c,_){a||v.b.i("muxer-base"," demux contiguous false");var d=this._transmuxData;this._w?this._w.postMessage({cmd:ht.a.PUSH,data:e,decryptdata:t,initSegment:i,timeOffset:n||0,contiguous:a,trackSwitch:s,discontinuity:o,accurateTimeOffset:c,fragEnd:_,transmuxData:d},[e.buffer]):this._demuxer&&this._demuxer.push(e,t,i,n,a,s,o,c,_,r()({},d))},t._onMessage=function(e,t){switch(e){case p.a.PARSING_DATA:if(!this._onParsing(t))return;break;case p.a.PARSED_DATA:if(!this._onParsed(t))return;t&&(t.trackType=this._id);break;case p.a.RAW_DATA:if(t.extra&&t.extra.remuxId!==this._transmuxData.remuxId)return}this._eventEmitter.emit(e,t)},s()(e,[{key:"totalDuration",set:function(e){this._transmuxData.duration=e}},{key:"id",get:function(){return this._id}}]),e}(),Et=function(e){function t(t,i,n){var r;return(r=e.call(this,t,i,n)||this)._frag=null,r._fragInfo=void 0,r._frag=null,r._fragInfo={},r}_()(t,e);var i=t.prototype;return i.reset=function(t){e.prototype.reset.call(this,t),this._frag=null},i._demux=function(e,t){var i=e.context.frag,n=this._frag,r=!1,a=Object(ee.a)(i.startDTS)?i.startDTS:i.start,s=!1,o=!0,c=null;if(this._transmuxData.progress=e.progress,e.data&&e.data.byteLength){var _=performance.now(),d={byteLength:e.data.byteLength,timeCost:performance.now()-(this._progressTime||e.stats.trequest)};this._progressTime=_,this._eventEmitter.emit(p.a.LOADER_CHUNK_ARRIVAL,d)}if(0===this._chunkIndex){this._fragInfo={},r=!(n&&i.level===n.level),s=!(n&&i.cc===n.cc);var u=n&&i.sn===n.sn+1;o=!(r||!u),this._ctx.stat.isLive&&(s=s||!u),n&&e.remuxContiguous&&(o||(a=Object(ee.a)(n.endDTS)?n.endDTS:n.start+n.duration),o=!0)}t?(this._progressTime=0,this._chunkIndex=0,this._frag=e.context.frag,c=e.data?new Uint8Array(e.data):new Uint8Array,this._frag=i):(this._chunkIndex++,e.data&&(c=new Uint8Array(e.data))),c&&(this._push(c,i.decryptdata,e.initData,a,o,r,s,!this._seek||0===e.context.frag.start,t),this._seek=!1)},i._onParsing=function(e){var t=this;if(e.extra&&e.extra.remuxId!==this._transmuxData.remuxId)return v.b.i("mux-multipart","parsing data expired"),!1;var i=this._fragInfo;return e.segments.forEach((function(e){var n=e.type;i.hasOwnProperty(n)?(i[n].endPTS=e.endPTS,i[n].endDTS=e.endDTS):(e.endPTS||e.endDTS||!t._frag||(e.endPTS=e.startPTS+t._frag.duration,e.endDTS=e.startDTS+t._frag.duration),i[n]={startDTS:e.startDTS,startPTS:e.startPTS,endPTS:e.endPTS,endDTS:e.endDTS})})),!0},i._onParsed=function(e){return e.extra&&e.extra.remuxId!==this._transmuxData.remuxId?(v.b.i("mux-multipart","parsed expired"),!1):(e.info=r()({},this._fragInfo),e.frag=this._frag,this._fragInfo={},!0)},t}(yt),bt=i(33);function At(e,t){return t?bt.a.searchIndex(t,(function(t){return e<t.start?-1:e>t.start+t.duration?1:0})):-1}var Tt=function(e){function t(t,i){var n;return(n=e.call(this)||this)._loaders=void 0,n._config=void 0,n._loaderConfig=void 0,n._decryptkey=void 0,n._decrypturl=void 0,n._loadEnd=function(e,t,i){if(t&&t instanceof ArrayBuffer){var r=e.frag;n._decryptkey=r.decryptdata.key=new Uint8Array(t),n._loaders[r.type]=null,n.emit(p.a.HLS_KEY_LOADED,{frag:r})}else n._onError({type:f.b.NETWORK_ERROR,details:f.a.KEY_LOAD_ERROR,fatal:!0,reason:"key empty",statusCode:i.code})},n._loadError=function(e,t){var i=e.frag.loader;t.fatal&&(i&&i.abort(),n._loaders[e.frag.type]=null,n._onError({type:f.b.NETWORK_ERROR,details:f.a.KEY_LOAD_ERROR,fatal:!0,reason:t.text,statusCode:t.code}))},n._onError=function(e){n.emit(p.a.ERROR,e)},n._config=t,n._loaderConfig=i,n._loaders={},n._decryptkey=null,n._decrypturl=null,n}_()(t,e);var i=t.prototype;return i.destroy=function(){for(var e in this._loaders){var t=this._loaders[e];t&&t.destroy()}this._loaders={}},i.load=function(e){var t=e.type,i=this._loaders[t],n=e.decryptdata,r=null;if(n&&(r=n.uri),!r||r===this._decrypturl&&null!==this._decryptkey)this._decryptkey&&(n&&(n.key=this._decryptkey),this.emit(p.a.HLS_KEY_LOADED,{frag:e}));else{var a=this._loaderConfig;i&&(v.b.w("KeyLoader","abort previous key loader for type:"+t),i.abort()),e.loader=this._loaders[t]=new M,this._decrypturl=r,this._decryptkey=null;var s={url:r,frag:e,responseType:"arraybuffer",credentials:this._config.credentials,headers:this._config.headers},o=a,c={onEnd:this._loadEnd,onError:this._loadError};e.loader.load(s,c,o)}},t}(o.EventEmitter),St="initSegment",Rt=function(){function e(e,t,i,n){var r=this;this._eventEmitter=void 0,this._type=void 0,this._levels=void 0,this._pos=0,this._failPos=-1,this._mux=void 0,this._loadEnabled=!0,this._newSource=!0,this._startSN=0,this._fragLoadFailSec=0,this._demuxing=!1,this._loader=void 0,this._initFragLoader=void 0,this._keyLoader=void 0,this._remuxContiguous=!1,this._ctx=void 0,this._fragAlign=void 0,this._callback=void 0,this._loadConfig=void 0,this._keyLoadConfig=void 0,this._streamingMux=!0,this._parallelStartCache=void 0,this._tryLoadNext=function(){var e=r._ctx.lctx.getNextIdx(r._type);r._ctx.lctx.getLevelIdx(r._type)!==e&&r._ctx.lctx.setLevelIdx(e,r._type);var t=r.level;if(t){if(r._fragAlign&&t.details){var i=r._fragAlign.frag,n=t.details.fragments[r._pos];n&&r._pos===r._fragAlign.pos&&i&&Object(ee.a)(i.startPTS)&&Be(t.details,n,i.startPTS,i.endPTS,i.startDTS,i.endDTS)}if(r._loadEnabled&&!r._loader&&!r._demuxing){if(r._isLevelEnd())return void r._mux.end();var a=r._nextFragment();a&&(t.details&&t.details.initSegment&&!t.details.initSegment.data&&r._loadFrag(t.details.initSegment),r._loadFrag(a))}}},this._fragParsed=function(e){if(e.trackType===r._type){for(var t in r._demuxing=!1,r._remuxContiguous=!1,r._eventEmitter.emit(p.a.MUX_INFO,e),e.info){var i=e.info[t];if(i&&i.endPTS&&i.endDTS){var n=e.frag,a=r._levels[n.level].details;a&&Be(a,n,i.startPTS,i.endPTS,i.startDTS,i.endDTS)}}r._fragAlign&&(r._fragAlign=void 0),r._isLevelEnd()?r._mux.end():r._type===R.e.MAIN&&r._eventEmitter.emit(p.a.ABR_NEXT,{startSec:r._getFragStartByPos(r._pos)}),r._tryLoadNext()}},this._tryStartDemux=function(){if(r._parallelStartCache&&r._isReady(r._parallelStartCache.context.frag,r._levels[r._parallelStartCache.context.frag.level])){var e=r._parallelStartCache.data.get(r._parallelStartCache.data.unreadLen);e&&r._startDemux(r._parallelStartCache.context,e.buffer,r._parallelStartCache.stats,r._parallelStartCache.progress),r._parallelStartCache=void 0}},this._onProgress=function(e,t,i){r._levels[e.frag.level],e.frag&&e.frag.sn===St||t instanceof ArrayBuffer&&r._preprocessed(e,t,i,!0)},this._onEnd=function(e,t,i){r._failPos=-1,r._fragLoadFailSec=0,e.frag&&e.frag.sn===St?r._destroyInitLoader():r._destroyLoader();var n=r._levels[e.frag.level],a=Oe(Le.SUCCESS,e,i,null==n?void 0:n.qualityType,r._ctx.stat.isPreload,null==n?void 0:n.codec);r._eventEmitter.emit(p.a.DOWNLOAD,a),"string"!=typeof t&&(e.frag&&e.frag.sn===St&&t?(e.frag.data=new Uint8Array(t),r._demuxing=!1,r._tryStartDemux()):r._preprocessed(e,t,i,!1))},this._onError=function(e,t){r._demuxing=!1;var i=r._levels[e.frag.level];if(r._eventEmitter.emit(p.a.DOWNLOAD,Oe(Le.FAIL,e,t,null==i?void 0:i.qualityType,r._ctx.stat.isPreload,null==i?void 0:i.codec)),t.fatal)if(r._remuxContiguous=!1,r._failPos<0&&(r._failPos=Math.max(0,r._pos-1)),r._resetIO(),r._fragLoadFailSec+=e.frag.duration||0,e.frag.sn===St||404!==t.code||r._ctx.config.maxFragFailSec&&r._fragLoadFailSec>=r._ctx.config.maxFragFailSec||r._isLevelEnd()){var n={type:f.b.NETWORK_ERROR,details:f.a.LOAD_ERROR,fatal:!0,reason:t.text,statusCode:t.code,url:e.url.toString()};r._eventEmitter.emit(p.a.ERROR,n)}else r._tryLoadNext()},this._onAbort=function(e,t){var i=r._levels[e.frag.level];r._eventEmitter.emit(p.a.DOWNLOAD,Oe(Le.ABORT,e,t,i.qualityType,r._ctx.stat.isPreload,i.codec))},this._type=e,this._eventEmitter=t,this._ctx=i,this._levels=e===R.e.MAIN?i.lctx.levels:i.lctx.audioTracks,i.lctx.setLevelIdx(n,this._type),i.lctx.setNextIdx(n,this._type),this._callback={onProgress:this._onProgress,onEnd:this._onEnd,onError:this._onError,onAbort:this._onAbort},this._loadConfig={connectionTimeout:i.config.connectionTimeout,transmissionTimeout:i.config.transmissionTimeout,maxRetry:i.config.maxRetry,retryDelay:i.config.retryDelay,breakpointContinuation:i.config.breakpointContinuation},this._keyLoadConfig={connectionTimeout:i.config.keyConnectionTimeout,transmissionTimeout:i.config.keyTransmissionTimeout,maxRetry:i.config.keyLoadingMaxRetry,retryDelay:i.config.keyLoadingRetryDelay},this._eventEmitter.on(p.a.PARSED_DATA,this._fragParsed),this._mux=new Et(t,i,e),i.stat.isPreload?this.streamingMux(!1):this._mux.init()}var t=e.prototype;return t.levelUpdated=function(){if(this.level&&this.level.details){var e=this.level.details.startSN;Object(ee.a)(this._startSN)&&this._startSN!==e&&(this._pos=Math.max(0,this._pos-(e-this._startSN))),this._startSN=e,this._mux.totalDuration=this.level.details.totalduration,this.level.details.initSegment&&(this._ctx.stat.streamingMux=!1),this._tryLoadNext()}},t.seek=function(e,t){void 0===t&&(t=!1),this._remuxContiguous=!1;var i=this.level;if(this._loadEnabled=!0,this._fragAlign=void 0,this._resetIO(),this._parallelStartCache=void 0,i&&i.details){var n=0===e?0:At(e,i.details.fragments);n>=0?this._pos=n:(this._pos=0,i.details.fragments.length&&e>=i.details.fragments[0].start&&(this._pos=i.details.fragments.length-1)),this._reset(!0),t&&(e=i.details.fragments[this._pos].start,v.b.i("stream-media","to keyframe: "+e),this._eventEmitter.emit(p.a.VIDEO_SEEK,{sec:e})),this._tryLoadNext()}return e},t.destroy=function(){this._resetIO(),this._mux&&this._mux.destroy(),this._keyLoader&&(this._keyLoader.destroy(),this._keyLoader=void 0),this._fragAlign=void 0},t.nextBackup=function(e){if(this._levels)for(var t=0;t<this._levels.length;t++){var i=this._levels[t];if(i.urlId>=i.url.length-1)return!1;i.urlId++,delete i.m3u8Slice,i.details=null}return this._resetIO(),this._newSource=!0,this._failPos>=0&&(this._pos=this._failPos),this._reset(!0),!0},t.streamingMux=function(e){this._streamingMux=e},t.trackInfo=function(e,t){this._mux.trackInfo(e,t)},t.setDownloadEnabled=function(e){!this._loadEnabled&&e?(this._loadEnabled=e,this._tryLoadNext()):this._loadEnabled=e},t.setIndex=function(e){this._resetIO(),this._newSource=!0,this._ctx.lctx.setLevelIdx(e,this._type),this._ctx.lctx.setNextIdx(e,this._type),this._fragAlign=void 0},t.setNext=function(e){this._newSource=!0,this._ctx.lctx.setNextIdx(e,this._type),this._remuxContiguous=!0},t._fragAlignStart=function(e){return e.maxStartPTS||e.startPTS||e.start},t._getFragByPos=function(e){if(this.level&&this.level.details)return this.level.details.fragments[e]},t._getFragStartByPos=function(e){var t=this._getFragByPos(e);return t?this._fragAlignStart(t):0},t._reset=function(e){this._demuxing=!1,this._mux.reset(e)},t._resetIO=function(){this._parallelStartCache=void 0,this._destroyLoader(),this._destroyInitLoader()},t._destroyLoader=function(){this._loader&&(this._loader.destroy(),this._loader=void 0)},t._destroyInitLoader=function(){this._initFragLoader&&(this._initFragLoader.destroy(),this._initFragLoader=void 0)},t._loadKey=function(e){var t=this;this._keyLoader||(this._keyLoader=new Tt({credentials:this._ctx.config.credentials,headers:this._ctx.config.headers},this._keyLoadConfig),this._keyLoader.on(p.a.HLS_KEY_LOADED,this._tryStartDemux),this._keyLoader.on(p.a.ERROR,(function(e){t._eventEmitter.emit(p.a.ERROR,e)}))),this._keyLoader.load(e)},t._isLevelEnd=function(){var e=this.level;return!!(e&&e.details&&!e.details.live&&this._pos>=e.details.fragments.length)},t._nextFragment=function(){var e=this.level,t=null;return e&&e.details&&this._pos<e.details.fragments.length&&(t=e.details.fragments[this._pos]),t&&(t.encrypted&&t.decryptdata&&this._loadKey(t),"number"==typeof t.sn&&this._pos++),t},t._loadFrag=function(e){if(e){var t={url:e.url,responseType:"arraybuffer",progress:this._streamingMux&&this._ctx.stat.streamingMux,frag:e,type:"frag",credentials:this._ctx.config.credentials,headers:this._ctx.config.headers},i=e.byteRangeStartOffset,n=e.byteRangeEndOffset;if(Object(ee.a)(i)&&Object(ee.a)(n)&&(t.rangeStart=i,t.rangeEnd=n,t.rangeType=this._ctx.config.httpRangeType),e.sn===St)t.progress=!1,this._destroyInitLoader(),this._initFragLoader=new M,this._initFragLoader.load(t,this._callback,this._loadConfig);else if(this._destroyLoader(),this._loader=new M,this._loader.load(t,this._callback,this._loadConfig),this._demuxing=!0,this._type===R.e.MAIN&&this._newSource){var r=e.start;this._eventEmitter.emit(p.a.NEW_SOURCE,{sync:r}),this._newSource=!1}}},t._preprocessed=function(e,t,i,n){if(this._isReady(e.frag,this._levels[e.frag.level])){if(this._parallelStartCache){this._updateParallelStartCache(e,t,i,n);var r=this._parallelStartCache.data.get(this._parallelStartCache.data.unreadLen);this._parallelStartCache=void 0,r&&(t=r)}this._startDemux(e,t,i,n)}else this._parallelStartCache?this._updateParallelStartCache(e,t,i,n):(this._parallelStartCache={context:e,stats:i,data:new lt.a,progress:n},t&&this._parallelStartCache.data.put(new Uint8Array(t)))},t._updateParallelStartCache=function(e,t,i,n){this._parallelStartCache&&(this._parallelStartCache.context=e,this._parallelStartCache.stats=i,this._parallelStartCache.progress=n,t&&this._parallelStartCache.data.put(new Uint8Array(t)))},t._isReady=function(e,t){var i;return!(e.encrypted&&e.decryptdata&&!e.decryptdata.key||null!=t&&null!=(i=t.details)&&i.initSegment&&!t.details.initSegment.data)},t._startDemux=function(e,t,i,n){var r,a,s,o=this._levels[e.frag.level],c={context:e,data:t,initData:null==o||null==(r=o.details)||null==(a=r.initSegment)?void 0:a.data,stats:i,audioCodec:null==o?void 0:o.audioCodec,videoCodec:null==o?void 0:o.videoCodec,remuxContiguous:this._remuxContiguous||!(null==o||null==(s=o.details)||!s.live),progress:n};n?this._mux.onFragProgress(c):this._ctx.stat.isPreload?this._eventEmitter.emit(p.a.PRELOAD_COMPLETE):this._mux.onFragLoaded(c)},s()(e,[{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this._ctx.lctx.getLevel(this._type)}},{key:"index",get:function(){return this._ctx.lctx.getLevelIdx(this._type)}},{key:"manualNext",set:function(e){var t;if(this._type===R.e.MAIN){var i=null==(t=this.level)?void 0:t.details;if(i){var n=At(this._ctx.currentTime+(i.targetduration||5)/2,i.fragments)+1;if(n>0&&n<i.fragments.length){n<this._pos&&(this._resetIO(),this._reset(!1),this._pos=n,this._remuxContiguous=!1),this._newSource=!0,this._ctx.lctx.setNextIdx(e,this._type);var r=i.fragments[this._pos],a=this._fragAlignStart(r);return this._eventEmitter.emit(p.a.LEVEL_SWITCHING,{type:this._type,startSec:a,level:e,smooth:!0}),(this._fragAlign&&this._fragAlign.frag.sn!==r.sn||!this._fragAlign)&&(this._fragAlign={level:this._ctx.lctx.getLevelIdx(this._type),pos:this._pos,frag:r,alignPTS:a}),this._eventEmitter.emit(p.a.BUFFER_FLUSHING,{startSec:this._fragAlign.alignPTS||a}),void this._tryLoadNext()}}this._eventEmitter.emit(p.a.LEVEL_SWITCH_FAILED,{smooth:!0,level:e})}}},{key:"type",get:function(){return this._type}},{key:"lastLoadedFrag",get:function(){var e=this._pos;return this._loader&&e--,this._getFragByPos(e)}}]),e}(),xt=function(){function e(e,t){var i=this;this._eventEmitter=void 0,this._ctx=void 0,this._loader=void 0,this._loadEnabled=!0,this._pos=0,this._startSN=0,this._callback=void 0,this._loadConfig=void 0,this._fullyLoaded=[],this._tryLoadNext=function(){if(!(i.index<0)){var e=i.level;if(i._loadEnabled&&e&&!i._loader){var t=i._nextFragment();t&&i._loadFrag(t)}}},this._onEnd=function(e,t,n){i._destroyLoader();var r=i._ctx.lctx.subtitleTracks[e.frag.level],a=Oe(Le.SUCCESS,e,n,r.qualityType);i._eventEmitter.emit(p.a.DOWNLOAD,a),t&&"string"!=typeof t&&(r&&r.details&&1===r.details.fragments.length&&!r.details.live&&-1===i._fullyLoaded.indexOf(e.frag.level)&&i._fullyLoaded.push(e.frag.level),i._eventEmitter.emit(p.a.SUBTITLE_LOADED,{data:t,cc:e.frag.cc,start:e.frag.start})),i._tryLoadNext()},this._onError=function(e,t){var n;i._eventEmitter.emit(p.a.DOWNLOAD,Oe(Le.FAIL,e,t,null==(n=i._ctx.lctx.subtitleTracks[e.frag.level])?void 0:n.qualityType)),i._destroyLoader(),i._tryLoadNext()},this._eventEmitter=e,this._ctx=t,t.lctx.subtitleIdx=t.lctx.subtitleTracks.reduce((function(e,t,i){return t.default?i:e}),-1),this._callback={onEnd:this._onEnd,onError:this._onError},this._loadConfig={connectionTimeout:t.config.connectionTimeout,transmissionTimeout:t.config.transmissionTimeout,maxRetry:t.config.maxRetry,retryDelay:t.config.retryDelay}}var t=e.prototype;return t.levelUpdated=function(){if(this.level&&this.level.details){var e=this.level.details.startSN;Object(ee.a)(this._startSN)&&this._startSN!==e&&(this._pos=Math.max(0,this._pos-(e-this._startSN))),this._startSN=e,this._tryLoadNext()}},t.seek=function(e){if(this.index<0)return 0;var t=this.level;if(-1!==this._fullyLoaded.indexOf(this.index))return e;if(this._loadEnabled=!0,t&&t.details){var i=0===e?0:At(e,t.details.fragments),n=t.details.fragments[i];this._loader&&n&&this._loader.context.frag.sn===n.sn&&this._loader.context.frag.level===n.level||(this._pos=i>=0?i:t.details.fragments.length-1,this._destroyLoader(),this._tryLoadNext())}return e},t.setDownloadEnabled=function(e){!this._loadEnabled&&e?(this._loadEnabled=e,this._tryLoadNext()):this._loadEnabled=e},t.setIndex=function(e){this._destroyLoader(),this._ctx.lctx.subtitleIdx=e},t._nextFragment=function(){var e=this.level;if(e&&e.details&&this._pos<e.details.fragments.length){var t=e.details.fragments[this._pos];if(t&&"number"==typeof t.sn)return this._pos++,t}},t._destroyLoader=function(){this._loader&&(this._loader.destroy(),this._loader=void 0)},t._loadFrag=function(e){if(e){var t={url:e.url,responseType:"arraybuffer",frag:e,type:"frag",credentials:this._ctx.config.credentials},i=e.byteRangeStartOffset,n=e.byteRangeEndOffset;Object(ee.a)(i)&&Object(ee.a)(n)&&(t.rangeStart=i,t.rangeEnd=n),this._destroyLoader(),this._loader=new M,this._loader.load(t,this._callback,this._loadConfig)}},s()(e,[{key:"levels",get:function(){return this._ctx.lctx.subtitleTracks}},{key:"level",get:function(){return this._ctx.lctx.subtitle}},{key:"index",get:function(){return this._ctx.lctx.subtitleIdx}},{key:"lastLoadedFrag",get:function(){var e=this._pos;if(this._loader&&e--,this.level&&this.level.details)return this.level.details.fragments[e]}}]),e}(),Lt=function(){function e(e,t){var i=this;this._eventEmitter=void 0,this._abr=void 0,this._ctx=void 0,this._main=void 0,this._audio=void 0,this._timer=void 0,this._seekKeyframe=void 0,this._totalduration=0,this._manifestReady=!1,this._mediaProtocol=void 0,this._subtitle=void 0,this._subtitleStarted=!1,this._onManifestLoaded=function(){v.b.i("hls","_onManifestLoaded");var e=i._ctx,t=e.lctx;if(e.stat.drm&&e.stat.isPreload)i._eventEmitter.emit(p.a.ERROR,{type:f.b.OTHER_ERROR,details:f.a.UNSUPPORTED,fatal:!0,reason:"drm no supported preload"});else if(t.audioTracks&&t.audioTracks.length&&(i._audio=new Rt(R.e.AUDIO,i._eventEmitter,e,t.audioIdx)),t.subtitleTracks&&t.subtitleTracks.length&&(i._subtitle||(i._subtitle=new xt(i._eventEmitter,e)),i._startSubtitle()),t.levels.length>0){var n=0;i._abr&&(n=i._abr.init()||0),i._main=new Rt(R.e.MAIN,i._eventEmitter,e,n),"boolean"==typeof e.stat.hasVideo&&"boolean"==typeof e.stat.hasAudio&&i._main.trackInfo(e.stat.hasVideo,e.stat.hasAudio),i._eventEmitter.emit(p.a.MANIFEST_PARSED,{}),i._abr&&i._ctx.lctx.abr&&i._main.setIndex(i._abr.abrInitLevel),i._manifestReady=!0;var r,a,s,o,c=e.lctx.current;if(!c)return;if(c.details){if(e.stat.isLive=null==(r=c.details)?void 0:r.live,i._levelUpdated(R.e.MAIN),null!=(a=c.details)&&a.live){i._updateLiveDelay(c),i._seekByLiveDelay();var _=je(null,c.details,0);i._timer=setTimeout((function(e){return i._loadLevel(e,R.e.MAIN)}),_,i._main.index)}}else i._loadLevel(e.lctx.currentIdx,R.e.MAIN,!0);i._audio&&e.lctx.audioTracks.length&&(null!=(s=e.lctx.audio)&&s.details?(i._levelUpdated(R.e.AUDIO),null!=(o=c.details)&&o.live&&i._loadLevel(e.lctx.audioIdx,R.e.AUDIO,!0)):i._loadLevel(e.lctx.audioIdx,R.e.AUDIO,!0))}else t.levels.length?i._eventEmitter.emit(p.a.ERROR,{type:f.b.MUX_ERROR,details:f.a.MANIFEST_PARSING_ERROR,fatal:!0,reason:"manifest parsing error"}):i._eventEmitter.emit(p.a.ERROR,{type:f.b.MUX_ERROR,details:f.a.UNSUPPORTED,fatal:!0,reason:"no supported codec"})},this._onAudioLevelLoaded=function(e){i._onLevelLoaded(e,R.e.AUDIO)},this._onSubtitleLevelLoaded=function(e){i._onLevelLoaded(e,R.e.SUBTITLE)},this._onLevelLoaded=function(e,t){void 0===t&&(t=R.e.MAIN);var n=e.level,r=i._getTrack(t);if(r&&r.level&&n===r.index){var a=r.level,s=e.details;if(i._ctx.stat.isLive=s.live,s.live){var o=a.details,c=je(a.details,e.details,e.stats?e.stats.trequest:0);i._updateLiveDelay(s),o?s.endSN!==o.endSN&&(He(o,s),a.details=s,i._levelUpdated(t)):(a.details=s,i._levelUpdated(t),i._seekByLiveDelay()),v.b.v("live playlist, reload in "+Math.round(c)+" ms"),i._timer=setTimeout((function(e){return i._loadLevel(e,t)}),c,r.index)}else i._clearLevelTimer(),a.details&&He(a.details,s),a.details=s,a.live=a.details.live,i._ctx.stat.isLive=a.live,i._levelUpdated(t);t===R.e.MAIN&&i._eventEmitter.emit(p.a.LEVEL_LOADED,{bitrate:r.level.bitrate,duration:i._totalduration})}},this._levelUpdated=function(e){void 0===e&&(e=R.e.MAIN),i._ctx.stat.isLive&&(i._ctx.stat.startFromSec=-1),i._ctx.stat.startFromSec>=0&&i.seek(i._ctx.stat.startFromSec,i._seekKeyframe);var t=i._getTrack(e);if(t&&t.level&&t.level.details){t.setDownloadEnabled(!0),i._totalduration=t.level.details.totalduration;var n=[],r=[];t.level.details.live||t.level.details.fragments.forEach((function(e){n.push(e.start),"number"==typeof e.programDateTime&&r.push(e.programDateTime)})),i._eventEmitter.emit(p.a.LEVEL_UPDATED,{type:e,duration:i._totalduration,times:n,utcs:r,targetduration:t.level.details.targetduration}),t.levelUpdated(),e!==R.e.SUBTITLE||t.level.details.live||t.seek(i._ctx.currentTime)}},this._onInitPTSFound=function(e){},this._abrNext=function(e){if(i._abr&&i._ctx.lctx.abr&&i._main){var t=i._abr.nextBitrateIndex();t>=0&&t!==i._ctx.lctx.currentIdx&&(i._eventEmitter.emit(p.a.LEVEL_SWITCHING,{startSec:e.startSec,level:t,smooth:!0}),i.setNextLevel(t))}},this._syncStream=function(e,t){var i=e.lastLoadedFrag,n=t.lastLoadedFrag;i?n&&(n.start+n.duration>i.start+i.duration-.5?t.setDownloadEnabled(!1):t.setDownloadEnabled(!0)):t.setDownloadEnabled(!0)},this._getTrack=function(e){return void 0===e&&(e=R.e.MAIN),e===R.e.MAIN?i._main:e===R.e.AUDIO?i._audio:i._subtitle},this._getTrackLevels=function(e){return void 0===e&&(e=R.e.MAIN),e===R.e.MAIN?i._ctx.lctx.levels:e===R.e.AUDIO?i._ctx.lctx.audioTracks:i._ctx.lctx.subtitleTracks},this._eventEmitter=e,this._ctx=t,this._seekKeyframe=t.config.startFromKeyframe}var t=e.prototype;return t.init=function(){var e=this;this._eventEmitter.on(p.a.DOWNLOAD,(function(t){e._abr&&e._abr.onDownload(t),e._main&&(e._audio&&e._syncStream(e._main,e._audio),e._subtitle&&e._syncStream(e._main,e._subtitle))})),this._eventEmitter.on(p.a.BUFFER_FLUSHING,(function(t){e._audio&&e._audio.seek(t.startSec)})),this._initMultirate();var t=ut[this._ctx.stat.box||R.g.hls];t?(this._mediaProtocol=new t(this._ctx),this._mediaProtocol.on(p.a.MANIFEST_PARSED,this._onManifestLoaded),this._mediaProtocol.on(p.a.LEVEL_LOADED,this._onLevelLoaded),this._mediaProtocol.on(p.a.LEVEL_UPDATED,this._levelUpdated),this._mediaProtocol.on(p.a.AUDIO_TRACK_LOADED,this._onAudioLevelLoaded),this._mediaProtocol.on(p.a.SUBTITLE_TRACK_LOADED,this._onSubtitleLevelLoaded),this._mediaProtocol.on(p.a.DOWNLOAD,(function(t){e._eventEmitter.emit(p.a.DOWNLOAD,t)})),this._mediaProtocol.on(p.a.ERROR,(function(t){var i=e._ctx.lctx.current;!i||e._ctx.stat.isLive||i.details&&i.details.live||(t.fatal=!0),e._eventEmitter.emit(p.a.ERROR,t)}))):this._eventEmitter.emit(p.a.ERROR,{type:f.b.OTHER_ERROR,details:f.a.UNSUPPORTED,fatal:!0,reason:"unsupported box: "+this._ctx.stat.box})},t.destroy=function(){this._mediaProtocol&&(this._mediaProtocol.destroy(),this._mediaProtocol=void 0),this._clearLevelTimer(),this._main&&(this._main.destroy(),this._main=void 0),this._audio&&(this._audio.destroy(),this._audio=void 0),this._abr&&(this._abr.removeAllListeners(),this._abr.destory(),this._abr=void 0)},t.loadSource=function(){this._mediaProtocol&&this._mediaProtocol.loadManifest(this._ctx.src)},t.setDownloadEnabled=function(e){void 0===e&&(e=!0),this._ctx.stat.isNetworkInUse=e,this._main&&this._main.setDownloadEnabled(e),this._abr&&this._abr.setDownloadEnabled(e)},t.isSeekable=function(){return!this._ctx.stat.isLive},t.seek=function(e,t,i){if(void 0===t&&(t=!1),void 0===i&&(i=!1),this._abr&&this._abr.onSeek({isInBuffer:i}),!i&&this._main){if(this._main.level&&this._main.level.details){if(!this._audio)return this._main.seek(e,t),this._subtitle&&this._subtitle.seek(e),void(this._ctx.stat.startFromSec=-1);if(this._audio.level&&this._audio.level.details&&!this._audio.level.details.live){var n=this._main.seek(e,t);return this._audio.seek(n),this._subtitle&&this._subtitle.seek(n),void(this._ctx.stat.startFromSec=-1)}}this._ctx.stat.startFromSec=e,this._seekKeyframe=t}},t.nextBackup=function(){if(this._main){var e=this._main.nextBackup(this._ctx.currentTime);if(this._audio&&e&&(e=this._main.nextBackup(this._ctx.currentTime)),e)return this._main.setDownloadEnabled(!1),this._seekKeyframe=!1,this._loadLevel(this._ctx.lctx.currentIdx,R.e.MAIN),this._audio&&(this._audio.setDownloadEnabled(!1),this._loadLevel(this._ctx.lctx.audioIdx,R.e.AUDIO)),!0}return!1},t.streamingMux=function(e){this._main&&this._main.streamingMux(e)},t.onAbrLevelsUpdated=function(){this._abr&&this._abr.onAbrLevelsUpdated()},t.setAudioTrack=function(e){this._audio&&(e=Math.min(e,this._audio.levels.length-1),this._audio.setIndex(e),this._manifestReady&&(this.seek(this._ctx.currentTime),this._checkNextLevel(e,R.e.AUDIO),this._eventEmitter.emit(p.a.LEVEL_SWITCHING,{type:R.e.AUDIO,startSec:this._ctx.currentTime,level:e,smooth:!1})))},t.setSubtitleTrack=function(e){this._subtitle&&(e=Math.min(e,this._subtitle.levels.length-1),this._subtitle.setIndex(e),this._manifestReady&&e>=0&&(this._checkNextLevel(e,R.e.SUBTITLE)||this._subtitle.seek(this._ctx.currentTime),this._eventEmitter.emit(p.a.LEVEL_SWITCHING,{type:R.e.SUBTITLE,startSec:this._ctx.currentTime,level:e,smooth:!1})))},t._loadLevel=function(e,t,i){var n=this._getTrackLevels(t);if(n.length){var r=n[e];r&&"object"==typeof r&&r.url.length>0&&this._mediaProtocol&&this._mediaProtocol.loadLevel(r,t)}},t._clearLevelTimer=function(){null!==this._timer&&(clearTimeout(this._timer),this._timer=null)},t._initMultirate=function(){var e=this;this._ctx.lctx.abr&&!this._abr&&(this._abr=new Fe(this._ctx),this._eventEmitter.on(p.a.INIT_PTS_FOUND,this._onInitPTSFound),this._eventEmitter.on(p.a.ABR_NEXT,this._abrNext),this._eventEmitter.on(p.a.NEW_SOURCE,(function(t){var i;null==(i=e._abr)||i.onNewSource()})))},t.setCurrentLevel=function(e){e>=0?(this._abrActive(!1),this._main&&(e=Math.min(e,this._main.levels.length-1),this._main.setIndex(e),this._manifestReady&&(this.seek(this._ctx.currentTime),this._checkNextLevel(e),this._eventEmitter.emit(p.a.LEVEL_SWITCHING,{startSec:this._ctx.currentTime,level:e,smooth:!1})))):this._abrActive(!0)},t.setManualNextLevel=function(e){var t;this._abrActive(e<0),this._manifestReady?null!=(t=this._main)&&t.level&&this._main.level.details&&e>=0&&(e=Math.min(e,this._main.levels.length-1),this._main.manualNext=e,this._checkNextLevel(e)||this.setDownloadEnabled(!0)):this.setCurrentLevel(e)},t.setNextLevel=function(e){this._main&&this._ctx.lctx.nextIdx!==e&&(this._main.setNext(e),this._checkNextLevel(e))},t._checkNextLevel=function(e,t){void 0===t&&(t=R.e.MAIN);var i=this._getTrack(t);return!(!i||!i.levels||i.levels[e].details&&!i.levels[e].live||(i.setDownloadEnabled(!1),this._loadLevel(e,t),0))},t._abrActive=function(e){this._abr&&(e&&!this._ctx.lctx.abr&&this._ctx.isAbrAvailable&&this._eventEmitter.emit(p.a.LEVEL_SWITCHING,{startSec:this._ctx.currentTime,level:-1,smooth:!0}),this._ctx.lctx.abr=e&&this._ctx.isAbrAvailable)},t._startSubtitle=function(){if(!this._subtitleStarted&&this._subtitle){var e=this._ctx.lctx.subtitle;e&&(e.details?this._levelUpdated(R.e.SUBTITLE):this._loadLevel(this._ctx.lctx.subtitleIdx,R.e.SUBTITLE,!0)),this._subtitleStarted=!0}},t._updateLiveDelay=function(e){var t=this._ctx.config.liveDelayFragNum;t&&t>0&&(this._ctx.stat.multipartLiveDelay=-t*(e.averagetargetduration?e.averagetargetduration:e.targetduration)*1e3)},t._seekByLiveDelay=function(){var e=this._ctx.lctx.current;if(e&&e.details&&this._ctx.config.liveDelayFragNum){v.b.i("hls","seek by live delay: "+this._ctx.config.liveDelayFragNum);for(var t=0,i=0,n=this._ctx.config.liveDelayFragNum,r=e.details.fragments.length-1;r>=0;r--)t+=e.details.fragments[r].duration,n>0&&(i+=e.details.fragments[r].duration,n--);t&&t-i>0&&this.seek(t-i+.1)}},s()(e,[{key:"mediaTrackNum",get:function(){return this._audio?2:1}},{key:"audioTracks",get:function(){return this._audio?this._audio.levels:[]}}]),e}();function Ct(e,t){if(void 0===t)return e;var i=new S.a(e,!0);return t&&(i.query.kabr_spts=""+t),i.toString()}var Dt,It=function(){function e(){var e=this;this._context=void 0,this._result=void 0,this._callback=void 0,this._loader=void 0,this._loaderConf=void 0,this._loaderCallbacks=void 0,this._timer=void 0,this._startTime=0,this._testEnd=function(){e._stopTimer(),e._loader&&e._loader.destroy(),e._context&&e._result&&e._callback&&(e._result.firstPackageDuration=Math.round(e._result.firstPackageDuration),e._result.duration=Math.round(performance.now()-e._startTime),e._callback.onEnd(e._context,e._result))},this._onProgress=function(t,i,n){e._result&&(e._result.firstPackageDuration=n.tfirst?n.tfirst-n.trequest:0,e._result.loaded=n.loaded)},this._onLoaderError=function(t,i){e._result&&(e._result.succeeded=!1),e._testEnd()},this._onLoaderEnd=function(){e._testEnd()},this._loaderConf={connectionTimeout:0,transmissionTimeout:0,maxRetry:0,retryDelay:0,useFetch:!0},this._loaderCallbacks={onProgress:this._onProgress,onError:this._onLoaderError,onEnd:this._onLoaderEnd}}var t=e.prototype;return t.start=function(e,t){this._context=e,this._callback=t,this._result={loaded:0,duration:0,firstPackageDuration:0,succeeded:!0},this._startTime=performance.now(),this._loader&&this._loader.destroy();var i=Math.min(1e4,e.timeout);this._loaderConf.connectionTimeout=i;var n={url:e.url,progress:!0,responseType:"arraybuffer"};this._loader=new M,this._startTimer(i),this._loader.load(n,this._loaderCallbacks,this._loaderConf)},t.cancel=function(){this._stopTimer(),this._loader&&this._loader.destroy()},t.destroy=function(){this.cancel()},t._startTimer=function(e){var t=this;this._timer=setTimeout((function(){return t._testEnd()}),e)},t._stopTimer=function(){clearTimeout(this._timer)},e}(),wt={stableBufferDiffThresholdSecond:.15,stableBufferIntervalMs:2e3,speedTestTimeoutMs:500,generateSpeedGapMs:3e3,bufferCheckIntervalMs:500,smoothedSpeedUtilizationRatio:.8,smallSpeedToBitrateRatio:.7,enoughSpeedToBitrateRatio:.9,bufferLowerLimitSecond:.8,recentBufferedSize:16,smoothedSpeedRatio:.9,isSpeedFullyUsed:!1},kt=function(){function e(e){this._ctx=void 0,this._conf=void 0,this._pastBuffer=void 0,this._levels=void 0,this._current=0,this._next=0,this._stableBufferStartTime=performance.now(),this._speedTester=new It,this._generatedSpeed=0,this._lastCheckBuffer=0,this._lastSpeed=0,this._timer=void 0,this._ctx=e}var t=e.prototype;return t.init=function(e){var t=this;this._conf=r()({},wt),r()(this._conf,e),v.b.i("algorithm-simple","init",e,this._conf),this._pastBuffer=[0],this._timer=setInterval((function(){t._checkBuffer()}),this._conf.bufferCheckIntervalMs)},t.onManifestUpdated=function(){this._levels=this._ctx.lctx.abrLevels.slice(0),this._next=this._ctx.lctx.abrDefault},t.onKeyPoint=function(e){var t=e.byteLength/Math.max(e.spendTime,.05)*8/1024;v.b.i("algorithm-simple","buffered: "+e.byteLength.toFixed(2)+", size: "+e.byteLength+", time: "+e.spendTime.toFixed(2)),this._next=this._nextRateIndex(t,e.buffered)},t.onLevelLoad=function(e){this._current=Math.max(0,e)},t.onSeek=function(e){},t.onDownloadEnabled=function(e){},t.destroy=function(){this._speedTester.destroy(),clearInterval(this._timer)},t._updateStableBuffer=function(e){var t=e-this._lastCheckBuffer,i=t/e,n=performance.now();return(t<-this._conf.stableBufferDiffThresholdSecond||i<-.2)&&(v.b.v("algorithm-simple","bufferDiffDown: "+t.toFixed(2)+"s, diffRatio: "+i.toFixed(2)),this._stableBufferStartTime=Math.max(n,this._stableBufferStartTime)),t>this._conf.stableBufferDiffThresholdSecond&&n-this._stableBufferStartTime+this._conf.bufferCheckIntervalMs>this._conf.stableBufferIntervalMs&&(this._stableBufferStartTime=Math.max(n-2*this._conf.bufferCheckIntervalMs,this._stableBufferStartTime+2*this._conf.bufferCheckIntervalMs),v.b.v("algorithm-simple","bufferDiffUp: "+t.toFixed(2)+"s")),this._lastCheckBuffer=e,n-this._stableBufferStartTime>this._conf.stableBufferIntervalMs},t._isSpeedFullyUsed=function(){return this._conf.isSpeedFullyUsed},t._checkBuffer=function(){var e=this._ctx.bufferedSec,t=this._updateStableBuffer(e);this._isSpeedFullyUsed()?t&&this._current+1<this._levels.length?this._generatedSpeed=this._levels[this._current+1].bitrate:this._generatedSpeed=0:t&&this._current+1<this._levels.length&&this._ctx.lctx.abr&&this._ctx.config.abrSpeedTest&&(this._startTesting(),this._stableBufferStartTime=performance.now()+this._conf.generateSpeedGapMs),this._pastBuffer.push(e),this._pastBuffer.length>this._conf.recentBufferedSize&&this._pastBuffer.shift()},t._startTesting=function(){var e=this;v.b.v("algorithm-simple","start speed testing on index: "+(this._current+1));var t=this._ctx.loadRec.traffic,i=this._levels[this._current+1].bitrate;this._speedTester.start({url:this._levels[this._current+1].url[this._levels[this._current+1].urlId],timeout:this._conf.speedTestTimeoutMs},{onEnd:function(n,r){var a=e._ctx.loadRec.traffic-t;if(r.succeeded&&r.duration>0&&r.firstPackageDuration>0){var s=8*(a+r.loaded)/r.duration;v.b.v("algorithm-simple","testSpeed: "+s.toFixed(0)),s>=i&&(e._generatedSpeed=i)}v.b.v("algorithm-simple","succeeded: "+r.succeeded+", firstPackageDuration: "+r.firstPackageDuration+", originalDownloadSize: "+a+", downloadSize: "+r.loaded+", downloadTime: "+r.duration)}})},t._quantization=function(e){for(var t=0,i=this._levels.length-1;i>=0;i--)if(e>=this._levels[i].bitrate){t=i;break}return t},t._nextRateIndex=function(e,t){var i=this._nextRateBySpeedAndBuffered(e,t);return i!=this._current&&(this._stableBufferStartTime=performance.now()+this._conf.generateSpeedGapMs),i<this._current?(this._speedTester.cancel(),this._generatedSpeed=0,this._lastSpeed=e,this._pastBuffer=[t]):this._lastSpeed=this._getSmoothedSpeed(e),i},t._getSmoothedSpeed=function(e){return this._lastSpeed>0?e*(1-this._conf.smoothedSpeedRatio)+this._lastSpeed*this._conf.smoothedSpeedRatio:e},t._getPredictedBuffer=function(e){return e+(e-Math.max.apply(Math,this._pastBuffer))},t._getBufferSpeed=function(e){var t=Math.max.apply(Math,this._pastBuffer);return(1+(e-t)/t)*this._levels[this._current].bitrate},t._isSpeedTooSmall=function(e){return e/this._levels[this._current].bitrate<this._conf.smallSpeedToBitrateRatio},t._isSpeedEnough=function(e){return e/this._levels[this._current].bitrate>this._conf.enoughSpeedToBitrateRatio},t._nextRateBySpeedAndBuffered=function(e,t){var i=this._getBufferSpeed(t),n=this._getSmoothedSpeed(e);v.b.v("algorithm-simple","gopSpeed: "+e.toFixed(0)+", smoothedSpeed: "+n.toFixed(0));var r=this._getPredictedBuffer(t);v.b.v("algorithm-simple","bufferSpeed: "+i.toFixed(0)+", predictedBuffered: "+r.toFixed(1));var a=this._current;return r<this._conf.bufferLowerLimitSecond||this._isSpeedTooSmall(i)?a=Math.min(this._current,this._quantization(i)):this._isSpeedEnough(i)&&(this._generatedSpeed>0?(v.b.i("algorithm-simple","generatedSpeed used"),a=this._quantization(this._generatedSpeed),this._generatedSpeed=0):a=this._quantization(n*this._conf.smoothedSpeedUtilizationRatio),a=Math.min(this._current+1,Math.max(a,this._current))),a},s()(e,[{key:"nextLevel",get:function(){return v.b.v("algorithm-simple","nextLevel: "+this._next),this._next}},{key:"lowProfile",get:function(){return!1}}]),e}(),Ot=function(){function e(e,t){this._eventEmitter=void 0,this._ctx=void 0,this._smooth=void 0,this._downloadSize=0,this._downloadStartTime=0,this._keyCount=0,this._index=0,this._algorithm=void 0,this._eventEmitter=e,this._ctx=t,t.lctx.abr=t.isAbrAvailable,this._algorithm=new kt(t)}var t=e.prototype;return t.init=function(){return this._downloadSize=0,this._downloadStartTime=performance.now(),this._keyCount=0,this._algorithm.init(this._ctx.config.liveAdaptiveConfig),this._algorithm.onManifestUpdated(),this._ctx.lctx.levels.length&&(this._ctx.lctx.abr?this._index=this._ctx.lctx.abrIndexToOrign(this._algorithm.nextLevel):this._index=this._ctx.lctx.default,this._eventEmitter.emit(p.a.MANIFEST_PARSED,{})),this._index},t.destory=function(){this._algorithm&&this._algorithm.destroy()},t.onAbrLevelsUpdated=function(){this._algorithm.onManifestUpdated(),this._index=this._ctx.lctx.abrIndexToOrign(this._algorithm.nextLevel)},t.onLoaderChunk=function(e){this._downloadSize+=e},t.onLevelLoad=function(e){var t=this._ctx.lctx;t.levels.length&&e>=0&&e<t.levels.length&&(this._keyCount=0,this._downloadStartTime=performance.now(),this._downloadSize=0,this._index=e,this._algorithm.onLevelLoad(t.orignIndexToAbr(e)))},t.onKeyFrame=function(e){var t=this._ctx,i=t.lctx.levels;if(this._keyCount++,(t.lctx.abr||"number"==typeof this._smooth)&&this._keyCount>1&&i){var n=this._index,r=!1,a=performance.now();if(this._algorithm.onKeyPoint({buffered:t.bufferedSec,byteLength:this._downloadSize,spendTime:(a-this._downloadStartTime)/1e3}),this._downloadSize=0,this._downloadStartTime=a,"number"==typeof this._smooth)n=this._smooth,this._smooth=void 0;else{if(!t.lctx.abr||!this._algorithm)return;n=t.lctx.abrIndexToOrign(this._algorithm.nextLevel),r=!0}if(n!==this._index)return{url:this.getRequestUrl(n,e),level:n,auto:r}}},t.getRequestUrl=function(e,t){var i=this._ctx.src,n=this._ctx.lctx.levels[e];return n&&(i=n.currentUrl),this._ctx.stat.box===R.g.flv?Ct(i,t||this._ctx.config.defaultSpts):i},s()(e,[{key:"nextLevel",get:function(){return"number"==typeof this._smooth?this._smooth:this._index},set:function(e){var t=this._ctx.lctx;e>=0?(e=Math.min(t.levels.length-1,e),t.abr=!1,this._smooth=e):-1===e&&(t.abr=this._ctx.isAbrAvailable)}},{key:"currentLevel",get:function(){return this._index},set:function(e){var t=this._ctx.lctx;e>=0?(e=Math.min(t.levels.length-1,e),t.abr=!1,this._index=e):-1===e&&(t.abr=this._ctx.isAbrAvailable)}}]),e}(),Nt=i(15);!function(e){e[e.tagType=0]="tagType",e[e.tagSize=1]="tagSize",e[e.timestamp=2]="timestamp",e[e.frameType=3]="frameType",e[e.packetType=4]="packetType"}(Dt||(Dt={}));var Pt,Mt=function(){function e(){this._pos=0,this._isFlv=void 0,this._header=new Uint8Array(Nt.a),this._headerPos=0,this._detectType=Dt.tagType,this._tagSize=0,this._tagSizeLen=0,this._timestamp=0,this._timestampLen=0,this._tagType=0,this._frameType=0,this._keyframeList=[],this.reset()}var t=e.prototype;return t.reset=function(){v.b.i("flv-key-detector","reset"),this._pos=Nt.a,this._isFlv=void 0,this._header=new Uint8Array(Nt.a),this._headerPos=0,this._detectType=Dt.tagType,this._tagSize=0,this._tagSizeLen=3,this._timestamp=0,this._timestampLen=4,this._tagType=0,this._frameType=0,this._keyframeList=[]},t.append=function(e){if(!1===this._isFlv)return[];if(void 0===this._isFlv&&(e.length+this._headerPos>=Nt.a?(this._header.set(e.subarray(0,Nt.a-this._headerPos),this._headerPos),this._headerPos=Nt.a,this._isFlv=70===this._header[0]&&76===this._header[1]&&86===this._header[2],v.b.i("flv-key-detector","get header: "+this._isFlv)):(this._header.set(e,this._headerPos),this._headerPos+=e.length)),this._pos>e.byteLength)return this._pos-=e.byteLength,[];this._keyframeList=[];for(var t=this._pos,i=0;t<e.byteLength;)switch(this._detectType){case Dt.tagType:this._tagType=e[t],this._tagSize=0,this._tagSizeLen=3,i=t,t++,this._detectType=Dt.tagSize;break;case Dt.tagSize:if(this._tagSize=this._tagSize+(e[t]<<8*(this._tagSizeLen-1)),this._tagSizeLen--,t++,this._tagSizeLen>0)break;this._tagType===Nt.f.VIDEO?(this._timestamp=0,this._timestampLen=4,this._detectType=Dt.timestamp):(t+=7+this._tagSize+4,this._detectType=Dt.tagType);break;case Dt.timestamp:this._timestamp+=1===this._timestampLen?e[t]<<24:e[t]<<8*(this._timestampLen-2),this._timestampLen--,t++,0===this._timestampLen&&(t+=3,this._frameType=0,this._detectType=Dt.frameType);break;case Dt.frameType:this._frameType=e[t]>>4,t++,this._detectType=Dt.packetType;break;case Dt.packetType:1===this._frameType&&1===e[t]&&this._keyframeList.push({timestamp:this._timestamp,pos:i}),t+=this._tagSize-1+4,this._detectType=Dt.tagType}return this._pos=t-e.byteLength,this._keyframeList},s()(e,[{key:"isFlv",get:function(){return this._isFlv}},{key:"header",get:function(){return this._isFlv?this._header:void 0}}]),e}(),Vt=i(24),Ft=i(28),Ut=i(17),Bt=i(25),Ht=i(10),jt=i(31),Wt=i(16),zt=["mono","4:2:0","4:2:2","4:4:4"],Gt={colorRange:Wt.b.AVCOL_RANGE_JPEG,colourPrimaries:Wt.a.AVCOL_PRI_BT2020,transferCharacteristics:Wt.d.AVCOL_TRC_SMPTEST2084,matrixCoefficients:Wt.c.AVCOL_SPC_BT2020_CL},Kt=function(){function e(e,t,i){this._id=void 0,this._evt=void 0,this._internalEvt=void 0,this._ctx=void 0,this._cache=new lt.a,this._ended=!1,this._timeOffset=-1,this._frameIdx=0,this._remuxer=void 0,this._firstRemux=!0,this._videoTrack=void 0,this._audioTrack=void 0,this._slientAudio=void 0,this._contiguous=!1,this._accurateTimeOffset=!1,this._frameDuration=0,this._params=void 0,this._progressTime=0,this._decode=0,this._fullFrameInfo=void 0,this._duration=0,this._id=i,this._evt=e,this._ctx=t,this._slientAudio=new Ft.a,this._internalEvt=new o.EventEmitter,this._remuxer=new Bt.b(this._evt,t.getRemuxConfig(),wi.TYPE_SUPPORTED)}var t=e.prototype;return t.init=function(){this._evt.emit(p.a.DEMUXER_DETECTED,{type:Ht.b.YUV}),this._ctx.cOutput.updateRendererType(R.o.canvas),this._initTrack(0)},t.destroy=function(){this._cache.clear(),this._internalEvt.removeAllListeners(),this._remuxer.destroy()},t.trackInfo=function(e,t){},t.reset=function(e){v.b.i("yuv","reset: "+e),this._ended=!1,this._timeOffset=-1,this._slientAudio&&this._slientAudio.reset(),this._firstRemux=!1},t.end=function(){this._ended||(this._ended=!0,this._evt.emit(p.a.LOAD_END))},t.onFragProgress=function(e){this._append(e,!1)},t.onFragLoaded=function(e){this._append(e,!0)},t.updateSuffix=function(e){},t._append=function(e,t){if(e.data&&e.data.byteLength){var i=performance.now(),n={byteLength:e.data.byteLength,timeCost:performance.now()-(this._progressTime||e.stats.trequest)};this._progressTime=i,this._evt.emit(p.a.LOADER_CHUNK_ARRIVAL,n)}var r=e.context.frag,a=this._videoTrack;if(a)if(this._checkParams(),this._params){var s=this._params;if(s){var o,c=r.start||0;for(this._timeOffset!==c?(this._frameIdx=Math.floor(c/(1/s.fps)),this._timeOffset=c,this._contiguous=!1,this._accurateTimeOffset=!1,this._remuxer.resetInitSegment({duration:this._duration,remuxId:0})):this._accurateTimeOffset=!0,e.data&&this._cache.put(new Uint8Array(e.data)),a.width||(a.width=s.width,a.height=s.height,a.fps=s.fps,a.bitDepth=s.bpp,a.codecType=R.b.rawvideo);o=this._getFrame();){var _=Math.floor(this._frameIdx*this._frameDuration);o.format.pts=_/(a.inputTimescale/1e3),this._frameIdx++,a.samples.push({units:[],dts:_,cts:0,pts:_,streamDTS:_,key:!0,yuv:o,duration:this._frameDuration}),this._decode++}this._ctx.updateVideoPlaybackQuality(this._decode,0),this._remux(t),t&&(this._progressTime=0,this._duration||(this._duration=this._frameIdx/s.fps,this._evt.emit(p.a.METADATA,{duration:this._duration})))}}else this._evt.emit(p.a.ERROR,{type:f.b.MUX_ERROR,details:f.a.PARSING_ERROR,fatal:!0,reason:"yuv params error. "+JSON.stringify(this._params)})},t._initTrack=function(e){this._videoTrack=Object(Ut.b)(e),this._videoTrack.active=!0,this._videoTrack.outputRaw=!0,this._videoTrack.codec="yuv",this._audioTrack=Object(Ut.a)(e),Vt.a.initAudioForFillSilent(this._audioTrack,this._ctx.stat.audioCodec)},t._getFrame=function(){if(this._params){var e=this._params.dataSize;if(e)return this._cache.unreadLen>=e?this._getFrameData():void 0;this._evt.emit(p.a.ERROR,{type:f.b.MUX_ERROR,details:f.a.REMUX_ERROR,fatal:!0,reason:"yuv params error, can not get img size. "+JSON.stringify(this._params)})}},t._checkParams=function(){if(!this._params){var e;if(this._params=this._ctx.yuvParams,this._params&&this._videoTrack){this._params.bpp>8&&(this._videoTrack.colorInfo=Gt);var t={};if(this._frameDuration=Math.round(this._videoTrack.inputTimescale/this._params.fps),this._videoTrack&&(this._videoTrack.chromaFormat=zt[this._params.chroma]),this._ctx.loadRec.contentLen){this._fullFrameInfo=[];var i=Math.floor(this._ctx.loadRec.contentLen/this._params.dataSize);this._duration=t.duration=i/this._params.fps;for(var n=[],r=0;r<i;r++){var a=r*this._frameDuration/this._videoTrack.inputTimescale;this._fullFrameInfo.push({index:r,dts:a,pts:a,duration:this._frameDuration}),n.push({time:a,position:this._params.dataSize*r})}t.keyframes=n}this._evt.emit(p.a.METADATA,t),this._evt.emit(p.a.VIDEO_FRAME_INFO,{videoFramesInfo:this._fullFrameInfo})}return this._evt.emit(p.a.VIDEO_CODEC_DETECTED,{decoder:R.c.none,enabled:!0,codecType:R.b.yuv,bitDepth:null==(e=this._params)?void 0:e.bpp,timeOffset:0}),this._params}},t._getFrameData=function(){var e=this._params;if(e){var t=this._cache,i=e.bpp>8?2:1,n=t.get(e.width*e.height*i),a=t.get(e.chromaWidth*e.chromaHeight*i),s=t.get(e.chromaWidth*e.chromaHeight*i);return n&&a&&s?{format:r()({},e),y:{bytes:n,stride:e.width*i,bits:e.bpp},u:{bytes:a,stride:e.chromaWidth*i,bits:e.bpp},v:{bytes:s,stride:e.chromaWidth*i,bits:e.bpp}}:void 0}},t._remux=function(e){void 0===e&&(e=!1);var t=this._audioTrack,i=this._videoTrack;if(i&&t)if(this._slientAudio.update(t,i),0!==t.samples.length||0!==i.samples.length){if(e||!(t.active&&0===t.samples.length||i.active&&i.samples.length<2)){if(this._firstRemux&&(this._duration||this._evt.emit(p.a.KEY_FRAME_INDEXS,{keyframes:[{time:0,position:0}]}),this._firstRemux=!1,this._evt.emit(p.a.MEDIA_DEMUX,{type:Ht.b.YUV})),!this._fullFrameInfo){var n=Object(jt.a)(i,this._frameIdx-i.samples.length);this._evt.emit(p.a.VIDEO_FRAME_INFO,{videoFramesInfo:n})}try{this._remuxer.remux(t,i,this._timeOffset,this._contiguous,this._accurateTimeOffset,e),this._contiguous=!0}catch(e){v.b.e("yuv",e),this._evt.emit(p.a.ERROR,{type:f.b.MUX_ERROR,details:f.a.REMUX_ERROR,fatal:!0,reason:e.message})}}}else e&&this._remuxer.flush()},s()(e,[{key:"totalDuration",set:function(e){}},{key:"id",get:function(){return this._id}}]),e}(),Yt=function(){function e(e,t){var i=this;this._callback=void 0,this._ctx=void 0,this._context=void 0,this._contentLen=0,this._loader=void 0,this._internalCallback=void 0,this._loaderConfig=void 0,this._firstReq=!0,this._ended=!1,this._pos=void 0,this._nextRangeStart=0,this._downloadEnabled=!0,this._currentReqLen=0,this._streamingMux=!1,this._connetced=!1,this._isBlob=!1,this._rangeWithoutPreflight=!1,this._defaultRangeLen=Z.c,this._onLoaderConnect=function(e,t){i._updateContentLen(t),!i._connetced&&i._callback.onConnect&&i._callback.onConnect(e,t),i._connetced=!0},this._onLoaderProgress=function(e,t,n){var r;"string"!=typeof t&&(i._currentReqLen+=t.byteLength,!e.rangeEnd&&i._currentReqLen>=i._defaultRangeLen&&!1===i._ctx.stat.isLive&&(!i._contentLen||i._contentLen&&i._currentReqLen<i._contentLen)&&(null==(r=i._loader)||r.abort(),i._destroyLoader(),i._nextRangeStart=i._currentReqLen,i._request()),i._callback.onProgress&&i._callback.onProgress(e,t,n))},this._onLoaderAbort=function(e,t){i._callback.onAbort&&i._callback.onAbort(e,t),i._destroyLoader()},this._onLoaderError=function(e,t){t.fatal&&(i._destroyLoader(),i._ctx.stat.isNetworkInUse=!1),416===t.code&&(!i._contentLen||e.rangeEnd&&e.rangeEnd>=i._contentLen)?(v.b.i("media-loader","416 end"),i._ended=!0,i._destroyLoader(),i._callback.onEnd(e,null,t)):i._callback.onError&&i._callback.onError(e,t)},this._onLoaderEnd=function(e,t,n){if(e.range&&i._callback.onRangeEnd&&i._callback.onRangeEnd(e,n),i._updateContentLen(n),i._destroyLoader(),"string"!=typeof t){var r=(null==t?void 0:t.byteLength)||0;!i._ctx.stat.isLive&&t&&i._callback.onProgress&&i._callback.onProgress(e,t,n),(!e.range||"number"==typeof e.rangeStart&&e.rangeEnd&&e.rangeEnd-e.rangeStart>i._currentReqLen+r||i._contentLen&&e.rangeEnd&&e.rangeEnd>=i._contentLen)&&(v.b.i("media-loader","end true"),i._ended=!0),i._ended||i._ctx.stat.isLive?(n.fatal&&(i._ctx.stat.isNetworkInUse=!1),i._callback.onEnd(e,null,n)):(e.rangeEnd&&(i._nextRangeStart=e.rangeEnd),i._request())}},this._callback=e,this._ctx=t,this._internalCallback={onConnect:this._onLoaderConnect,onEnd:this._onLoaderEnd,onError:this._onLoaderError,onAbort:this._onLoaderAbort,onProgress:this._onLoaderProgress},this._loaderConfig={connectionTimeout:t.config.connectionTimeout,transmissionTimeout:t.config.transmissionTimeout},this._isBlob=this._ctx.src instanceof Blob,t.stat.box===R.g.yuv&&t.yuvParams?this._defaultRangeLen=t.yuvParams.dataSize:this._defaultRangeLen=this._isBlob?Z.a:Z.c,this._isBlob&&(this._ctx.loadRec.contentLen=this._contentLen=this._ctx.src.size),x.a.version&&(this._rangeWithoutPreflight="chrome"===x.a.name&&x.a.version.major>=99),v.b.i("media-loader","without preflight: "+this._rangeWithoutPreflight+"; range size: "+this._defaultRangeLen,this._contentLen),this.updateConfig()}var t=e.prototype;return t.load=function(e){v.b.i("media-loader","load"),this._destroyLoader(),this._firstReq=!0,this._connetced=!1,this._streamingMux=this._ctx.stat.box===R.g.flv&&this._ctx.stat.isLive||this._ctx.stat.streamingMux&&!this._isBlob,this._context=e,this._context.progress=this._streamingMux,this._context.responseType="arraybuffer",this._context.credentials=this._ctx.config.credentials,this._context.headers=this._ctx.config.headers,this._request()},t.seek=function(e){var t;v.b.i("media-loader","seek time:"+e.time+", pos:"+e.position),null==(t=this._loader)||t.abort(),this._destroyLoader(),this._downloadEnabled=!0,this._pos=e,this._ended=!1,this._request()},t.updateConfig=function(){var e=this._ctx;v.b.i("media-loader","update loader config"),this._loaderConfig.maxRetry=e.stat.isLive?0:e.config.maxRetry,this._loaderConfig.retryDelay=e.stat.isLive?0:e.config.retryDelay,this._loaderConfig.useFetch=e.stat.isLive||void 0===e.stat.isLive,this._loaderConfig.breakpointContinuation=!(e.stat.box===R.g.flv&&e.stat.isLive)&&e.config.breakpointContinuation},t.destroy=function(){this._destroyLoader()},t.ended=function(){return this._ended},t.streamingMux=function(e){this._streamingMux=e&&!this._isBlob},t.setDownloadEnabled=function(e){void 0===e&&(e=!0),this._downloadEnabled!==e&&(this._downloadEnabled=e,e&&!this._loader&&this._request())},t._request=function(){if(this._downloadEnabled&&!this._ended&&this._context)if(this._destroyLoader(),this._pos&&(this._nextRangeStart=this._pos.position,this._context.frag.start=this._pos.time,this._pos=void 0),this._contentLen&&this._nextRangeStart>=this._contentLen)this._ctx.stat.isNetworkInUse=!1;else{var e=this._context;this._ctx.stat.isLive?this._firstReq=!1:(this._context.progress=this._streamingMux,this._firstReq&&e.progress&&"string"==typeof e.url&&!this._rangeWithoutPreflight?this._firstReq=!1:(this._firstReq=!1,e.rangeStart=this._nextRangeStart,e.rangeEnd=(Math.floor(this._nextRangeStart/this._defaultRangeLen)+1)*this._defaultRangeLen,e.rangeType=this._ctx.config.httpRangeType,this._checkEnd(e))),this._ctx.stat.isNetworkInUse=!0,this._currentReqLen=0,this._loader=new M,this._loader.load(e,this._internalCallback,this._loaderConfig)}else this._ctx.stat.isNetworkInUse=!1},t._destroyLoader=function(){this._loader&&(this._loader.destroy(),this._loader=void 0)},t._checkEnd=function(e){e.rangeEnd&&this._contentLen&&e.rangeEnd>this._contentLen&&(this._ended=!0)},t._updateContentLen=function(e){!this._contentLen&&e.contentLength&&(this._ctx.loadRec.contentLen=this._contentLen=e.contentLength)},e}(),Xt=i(38),qt=/\.(\w)+$/,Zt=function(){function e(e,t){var i=this;this._evt=void 0,this._ctx=void 0,this._loader=void 0,this._loaderCallbacks=void 0,this._multirate=void 0,this._baseTimeSec=0,this._ready=!1,this._remuxContiguous=!1,this._flvKeyDetector=void 0,this._metadata=void 0,this._keyframes=void 0,this._appendFLVHead=!1,this._faststart=!0,this._loadEndCallbackonMeta=!1,this._hasContentLength=!1,this._mux=void 0,this._onLoaderProgress=function(e,t,n){if(t instanceof ArrayBuffer){var a,s;if(i._multirate&&i._multirate.onLoaderChunk(t.byteLength),i._flvKeyDetector&&!1!==i._flvKeyDetector.isFlv){var o=i._flvKeyDetector.append(new Uint8Array(t));if(i._multirate&&i._ctx.lctx.levels.length>1)for(var c=0;c<o.length;c++)if(void 0===i._ctx.localTimeOffset&&(i._ctx.localTimeOffset=o[c].timestamp/Z.e),i._multirate&&(a=i._multirate.onKeyFrame(o[c].timestamp))){var _=new Uint8Array(o[c].pos);_.set(new Uint8Array(t).subarray(0,o[c].pos)),t=_.buffer;var d=r()({},a);d.smooth=!0,d.timestamp=o[c].timestamp,d.startSec=i._baseTimeSec||i._ctx.currentTime,i._evt.emit(p.a.LEVEL_SWITCHING,d),i._baseTimeSec=i._ctx.getLocalTime(o[c].timestamp/Z.e)||0;break}}i._appendFLVHead&&(null!=(s=i._flvKeyDetector)&&s.header&&(t=i._onFlvSeekFirstChunk(t)),i._appendFLVHead=!1);var u={context:e,data:t,stats:n,remuxContiguous:i._remuxContiguous,progress:!0};a?(i._remuxContiguous||(i._remuxContiguous=!0),i._mux.onFragLoaded(u),i._flvKeyDetector&&i._flvKeyDetector.reset(),i._load(a.url,a.level)):i._mux.onFragProgress(u)}},this._onLoaderConnect=function(e,t){if(void 0===i._ctx.stat.box||i._ctx.stat.box===R.g.unknown){var n,r=null==(n=e.responseHeader)?void 0:n["content-type"];r&&(i._ctx.stat.box=it(Array.isArray(r)?r[0]:r).box)}i._hasContentLength=!!t.contentLength,v.b.i("single","on connect. contentLength: "+t.contentLength),i._evt.emit(p.a.MEDIA_CONNECTED,{headers:e.responseHeader})},this._onLoaderAbort=function(e,t){i._onDownload(Le.ABORT,e,t)},this.onLoaderRangeEnd=function(e,t){i._onDownload(Le.SUCCESS,e,t)},this._onLoaderError=function(e,t){if(i._onDownload(Le.FAIL,e,t),t.fatal){var n={type:f.b.NETWORK_ERROR,details:f.a.LOAD_ERROR,fatal:!0,reason:t.text,statusCode:t.code,url:e.url};i._evt.emit(p.a.ERROR,n)}},this._onLoaderEnd=function(e,t,n){i._ctx.config.flvLoadEndError&&i._ctx.stat.isLive&&i._ctx.stat.box===R.g.flv?i._evt.emit(p.a.ERROR,{type:f.b.NETWORK_ERROR,details:f.a.LIVE_DISCONNECTED_ERROR,fatal:!0,reason:"flv live load end",statusCode:n.code,url:e.url}):(i._mux.onFragLoaded({context:e,data:null,stats:n,remuxContiguous:!1,progress:!0}),i._onDownload(Le.SUCCESS,e,n),i._metadata?i._mux.end():i._loadEndCallbackonMeta=!0)},this._onMetadata=function(e){var t=i._ctx.stat;i._metadata=r()({},e),i._metadata.keyframes&&(i._keyframes=i._metadata.keyframes,v.b.i("single","metadata keyframe",i._keyframes)),i._metadata.keyframes||i._metadata.duration?t.isLive=!1:t.box===R.g.flv&&void 0===t.isLive&&(t.isLive=!0),i._loader.updateConfig(),i._faststart?t.startFromSec>0&&!t.isLive&&i._keyframes&&i._keyframes.length>1?i.seek(t.startFromSec,!0):i._loadEndCallbackonMeta&&i._mux.end():i.seek(t.startFromSec,!0),t.startFromSec=-1,i._loadEndCallbackonMeta=!1},this._onParsing=function(){i._loadEndCallbackonMeta&&(i._mux.end(),i._loadEndCallbackonMeta=!1)},this._onKeyFrameIndex=function(e){v.b.i("single","get key index"),i._keyframes=e.keyframes},this._onNotFaststart=function(e){v.b.i("single","not faststart",e.pos),i._loader.seek({position:e.pos,time:0}),i._mux.reset(!0),i._faststart=!1,i._loadEndCallbackonMeta=!1},this._onDemuxerDetected=function(e){i._ctx.demuxerType=e.type,i._hasContentLength&&(i._ctx.stat.isLive=!1),v.b.i("single","demuxer detected: "+e.type+", box:"+i._ctx.stat.box+" isLive:"+i._ctx.stat.isLive),i._loader.updateConfig()},this._evt=e,this._ctx=t,this._flvKeyDetector=new Mt,this._loaderCallbacks={onConnect:this._onLoaderConnect,onProgress:this._onLoaderProgress,onError:this._onLoaderError,onEnd:this._onLoaderEnd,onAbort:this._onLoaderAbort,onRangeEnd:this.onLoaderRangeEnd},this._loader=new Yt(this._loaderCallbacks,t),this._mux=Kt&&t.stat.box===R.g.yuv?new Kt(this._evt,t,R.e.MAIN):new yt(this._evt,t,R.e.MAIN),this._mux.init(),this._evt.on(p.a.METADATA,this._onMetadata),this._evt.on(p.a.PARSING_INIT_SEGMENT,this._onParsing),this._evt.on(p.a.KEY_FRAME_INDEXS,this._onKeyFrameIndex),this._evt.on(p.a.MP4_NOT_FASTSTART,this._onNotFaststart),this._evt.on(p.a.DEMUXER_DETECTED,this._onDemuxerDetected)}var t=e.prototype;return t.init=function(){this._ctx.stat.box===R.g.yuv&&this._mux instanceof yt&&this._evt.emit(p.a.ERROR,{type:f.b.MUX_ERROR,details:f.a.UNSUPPORTED,fatal:!0,reason:"yuv is not unsupported."}),this._multirate||(this._multirate=new Ot(this._evt,this._ctx),this._ctx.lctx.currentIdx=this._multirate.init()),this._ready=!0},t.destroy=function(){this._evt.off(p.a.METADATA,this._onMetadata),this._evt.off(p.a.PARSING_INIT_SEGMENT,this._onParsing),this._evt.off(p.a.KEY_FRAME_INDEXS,this._onKeyFrameIndex),this._evt.off(p.a.MP4_NOT_FASTSTART,this._onNotFaststart),this._evt.off(p.a.DEMUXER_DETECTED,this._onDemuxerDetected),this._loader&&this._loader.destroy(),this._multirate&&this._multirate.destory(),this._flvKeyDetector=void 0,this._mux.destroy()},t.loadSource=function(){var e=this._multirate;if(e){var t=this._ctx.lctx.current;t?this._load(this._ctx.stat.isLive?Ct(t.currentUrl,this._ctx.config.defaultSpts):t.currentUrl,e.currentLevel):this._evt.emit(p.a.ERROR,{type:f.b.OTHER_ERROR,details:f.a.MANIFEST_PARSING_ERROR,fatal:!0,reason:"manifest parse error."})}else this._load(this._ctx.src)},t.setDownloadEnabled=function(e){void 0===e&&(e=!0),this._loader.setDownloadEnabled(e)},t.isSeekable=function(){return!(!this._keyframes||!this._keyframes.length||this._ctx.stat.isLive)},t.seek=function(e,t,i){void 0===t&&(t=!1),void 0===i&&(i=!1),v.b.i("single","seek: "+e+" "+t+" "+i);var n=this._keyframes;if((n||e<Z.i)&&!i){var r=n?Xt.a.getPosByTime(n,e):{time:0,position:0};r&&(this._loader.seek(r),this._baseTimeSec=r.time,this._mux.reset(!0),this._appendFLVHead=r.position>0,t&&this._evt.emit(p.a.VIDEO_SEEK,{sec:r.time}))}else v.b.w("single","no keyframe index"),this._evt.emit(p.a.ERROR,{type:f.b.MEDIA_ERROR,details:f.a.CANNOT_SEEK,fatal:!1,reason:"can not seek"})},t.nextBackup=function(){return!1},t.streamingMux=function(e){this._loader.streamingMux(e)},t.onAbrLevelsUpdated=function(){var e;null==(e=this._multirate)||e.onAbrLevelsUpdated()},t.setCurrentLevel=function(e){var t=this._multirate;if(t){var i=e>=0||e!==t.currentLevel;t.currentLevel=e;var n=this._ctx.lctx.current;if(i&&n&&this._ready){var r=this._ctx.stat.isLive?Ct(n.currentUrl,this._ctx.config.defaultSpts):n.currentUrl;this._flvKeyDetector&&this._flvKeyDetector.reset(),this._remuxContiguous=!1,this._baseTimeSec=this._ctx.currentTime,this._evt.emit(p.a.LEVEL_SWITCHING,{level:t.currentLevel,startSec:this._baseTimeSec,smooth:!1,auto:!1}),this._mux.reset(!0),this._load(r,t.currentLevel)}}},t.setManualNextLevel=function(e){this.setNextLevel(e)},t.setNextLevel=function(e){this._ready||this.setCurrentLevel(e);var t=this._multirate;t&&(-1===e&&this._evt.emit(p.a.LEVEL_SWITCHING,{level:-1,startSec:this._ctx.currentTime,smooth:!0,auto:!0}),t.nextLevel=e)},t.setAudioTrack=function(e){},t.setSubtitleTrack=function(e){},t._load=function(e,t){void 0===t&&(t=0),this._multirate&&this._multirate.onLevelLoad(t),this._ctx.lctx.currentIdx=t;var i=this._ctx.lctx.current;this._ctx.stat.audioCodec=this._ctx.stat.audioCodec||(i?i.audioCodec:""),this._evt.emit(p.a.NEW_SOURCE,{sync:this._baseTimeSec});var n=new S.a("string"==typeof e?e:e.name||"").pathname.match(qt);n&&this._mux.updateSuffix(n[0]);var r={url:e,responseType:"arraybuffer",credentials:this._ctx.config.credentials,headers:this._ctx.config.headers,frag:{start:this._baseTimeSec,type:"frag"}};this._loader.load(r)},t._onDownload=function(e,t,i){var n,r=Oe(e,t,i,null==(n=this._ctx.lctx.current)?void 0:n.qualityType);this._evt.emit(p.a.DOWNLOAD,r)},t._onFlvSeekFirstChunk=function(e){var t,i=null==(t=this._flvKeyDetector)?void 0:t.header;if(i){var n=new Uint8Array(e.byteLength+i.length);return n.set(i),n.set(new Uint8Array(e),i.length),n.buffer}return e},s()(e,[{key:"mediaTrackNum",get:function(){return 1}}]),e}(),Qt=function(e){function t(t){var i;return(i=e.call(this)||this)._eventEmitter=void 0,i._trans=void 0,i._ctx=void 0,i._initSegments={main:void 0,audio:void 0},i._initSegmentReady=!1,i._loadEnd=0,i._mediaSegmentsBuffer=[],i._onMessage=function(e,t){switch(e){case p.a.PARSING_INIT_SEGMENT:var n=i._getInitSegment(t);if(n){if(i.emit(p.a.PARSING_INIT_SEGMENT,n),!i._initSegmentReady)for(;i._mediaSegmentsBuffer.length;)i.emit(p.a.PARSING_DATA,i._mediaSegmentsBuffer.shift());i._initSegmentReady=!0}break;case p.a.PARSING_DATA:t.segments.forEach((function(e){e.type===R.l.AUDIO&&e.streamDTS&&(i._ctx.localTimeOffset=e.streamDTS-e.startDTS)})),i._initSegmentReady?i.emit(e,t):i._mediaSegmentsBuffer.push(t);break;case p.a.MANIFEST_PARSED:i._initSegmentReady=1===i._trans.mediaTrackNum,i.emit(e,t);break;case p.a.ERROR:i._ctx.config.retryWithBackup&&i._trans.nextBackup()?i.emit(p.a.USE_BACKUP):i.emit(e,t);break;case p.a.LOAD_END:i._loadEnd++,i._loadEnd>=i._trans.mediaTrackNum&&i.emit(e,t);break;case p.a.DEMUXER_DETECTED:i._ctx.demuxerType=t.type,v.b.i("transmuxer",e+", box:"+i._ctx.stat.box+" isLive:"+i._ctx.stat.isLive),i.emit(e,t);break;case p.a.MEDIA_DEMUX:i._ctx.demuxerType=t.type,i.emit(e,t);break;default:i.emit(e,t)}},i._eventEmitter=new o.EventEmitter,i._ctx=t,t.stat.multipart?i._trans=new Lt(i._eventEmitter,t):i._trans=new Zt(i._eventEmitter,t),i}_()(t,e);var i=t.prototype;return i.init=function(){this._bindEvents(this._eventEmitter),this._trans.init()},i.destroy=function(){this._trans.destroy(),this._eventEmitter.removeAllListeners()},i.loadSource=function(){this._trans.loadSource()},i.setDownloadEnabled=function(e){void 0===e&&(e=!0),this._trans.setDownloadEnabled(e)},i.seek=function(e,t,i){void 0===i&&(i=!1),this._trans.seek(e,t,i)},i.heartbeat=function(){},i.isSeekable=function(){return this._trans.isSeekable()},i.setNextLevel=function(e){e>=0&&e!==this._ctx.lctx.nextIdx&&this._resetInitSegments(),this._trans.setManualNextLevel(e)},i.setCurrentLevel=function(e){e>=0&&e!==this._ctx.lctx.currentIdx&&this._resetInitSegments(),this._trans.setCurrentLevel(e)},i.onAbrLevelsUpdated=function(){this._trans.onAbrLevelsUpdated()},i.streamingMux=function(e){this._trans.streamingMux(e)},i.setAudioTrack=function(e){this._resetInitSegments(),this._ctx.lctx.audioTracks.length&&this._trans.setAudioTrack(e)},i.setSubtitleTrack=function(e){this._ctx.lctx.subtitleTracks.length&&this._trans.setSubtitleTrack(e)},i._bindEvents=function(e){var t=this._onMessage;e.on(p.a.PRIV_NAL,(function(e){return t(p.a.PRIV_NAL,e)})),e.on(p.a.PARSING_INIT_SEGMENT,(function(e){return t(p.a.PARSING_INIT_SEGMENT,e)})),e.on(p.a.PARSING_DATA,(function(e){return t(p.a.PARSING_DATA,e)})),e.on(p.a.RAW_DATA,(function(e){return t(p.a.RAW_DATA,e)})),e.on(p.a.VIDEO_CODEC_DETECTED,(function(e){return t(p.a.VIDEO_CODEC_DETECTED,e)})),e.on(p.a.ERROR,(function(e){return t(p.a.ERROR,e)})),e.on(p.a.LEVEL_UPDATED,(function(e){return t(p.a.LEVEL_UPDATED,e)})),e.on(p.a.LEVEL_SWITCH_FAILED,(function(e){return t(p.a.LEVEL_SWITCH_FAILED,e)})),e.on(p.a.LEVEL_SWITCHING,(function(e){return t(p.a.LEVEL_SWITCHING,e)})),e.on(p.a.SUBTITLE_LOADED,(function(e){return t(p.a.SUBTITLE_LOADED,e)})),e.on(p.a.MANIFEST_PARSED,(function(e){return t(p.a.MANIFEST_PARSED,e)})),e.on(p.a.LOAD_END,(function(e){return t(p.a.LOAD_END,e)})),e.on(p.a.BUFFER_FLUSHING,(function(e){return t(p.a.BUFFER_FLUSHING,e)})),e.on(p.a.VIDEO_SEEK,(function(e){return t(p.a.VIDEO_SEEK,e)})),e.on(p.a.PRELOAD_COMPLETE,(function(e){return t(p.a.PRELOAD_COMPLETE,e)})),e.on(p.a.LOADER_CHUNK_ARRIVAL,(function(e){return t(p.a.LOADER_CHUNK_ARRIVAL,e)})),e.on(p.a.MEDIA_CONNECTED,(function(e){return t(p.a.MEDIA_CONNECTED,e)})),e.on(p.a.MEDIA_DEMUX,(function(e){return t(p.a.MEDIA_DEMUX,e)})),e.on(p.a.MUX_INFO,(function(e){return t(p.a.MUX_INFO,e)})),e.on(p.a.NEW_SOURCE,(function(e){return t(p.a.NEW_SOURCE,e)})),e.on(p.a.DOWNLOAD,(function(e){return t(p.a.DOWNLOAD,e)})),e.on(p.a.DISCONTINUITY,(function(e){return t(p.a.DISCONTINUITY,e)})),e.on(p.a.KEY_FRAME,(function(e){return t(p.a.KEY_FRAME,e)})),e.on(p.a.METADATA,(function(e){return t(p.a.METADATA,e)})),e.on(p.a.VIDEO_FRAME_INFO,(function(e){return t(p.a.VIDEO_FRAME_INFO,e)})),e.on(p.a.DEMUXER_DETECTED,(function(e){return t(p.a.DEMUXER_DETECTED,e)}))},i._resetInitSegments=function(){this._initSegments.audio=this._initSegments.main=void 0,this._initSegmentReady=1===this._trans.mediaTrackNum,this._loadEnd=0,v.b.i("transmuxer","resetInit initSegment ready: "+this._initSegmentReady)},i._getInitSegment=function(e){var t=e;if(1===this._trans.mediaTrackNum);else{if(e.tracks.hasOwnProperty("video")?this._initSegments.main=e.tracks.video:this._initSegments.audio=e.tracks.audio,!this._initSegments.main||!this._initSegments.audio)return;t={tracks:{video:this._initSegments.main,audio:this._initSegments.audio}}}var i=this._ctx.lctx.current;return i&&(t.base||(t.base={}),t.tracks&&t.tracks.video&&!i.codec&&(i.codec=t.tracks.video.codec),i.comment&&(t.base.comment=i.comment),i.audioCodec&&(t.base.manifestAudioCodec=i.audioCodec),i.videoCodec&&(t.base.manifestVideoCodec=i.videoCodec)),t},t}(o.EventEmitter);!function(e){e[e.waiting=0]="waiting",e[e.working=1]="working",e[e.ready=2]="ready",e[e.error=3]="error"}(Pt||(Pt={}));var Jt=function(e){function t(t){var i;return(i=e.call(this)||this)._data=void 0,i._trans=void 0,i._data=t,i}_()(t,e);var i=t.prototype;return i.start=function(e,t){if(!this._trans){v.b.i("preload-task","start preload task"),void 0===e&&(e=this._data.abr),void 0===t&&(t=this._data.qualityType);var i=this._data.ctx;this._data.abr=e,this._data.qualityType=t,this._data.stat=Pt.working,this._trans=new Qt(i),this._trans.streamingMux(!1),this._bind(this._trans),this._trans.init(),this._trans.loadSource()}},i.destroy=function(){v.b.i("preload-task","destroy"),this._trans&&(this._trans.removeAllListeners(),this._trans.destroy(),this._trans=void 0),this.removeAllListeners()},i._bind=function(e){var t=this,i=this._data;e.on(p.a.PRELOAD_COMPLETE,(function(){var n;i.qualityType=(null==(n=i.ctx.lctx.current)?void 0:n.qualityType)||"",i.stat=Pt.ready,e.removeAllListeners(),t.emit(p.a.PRELOAD_COMPLETE,!0),t.removeAllListeners()})),e.on(p.a.DOWNLOAD,(function(e){t.emit(p.a.DOWNLOAD,e)})),e.on(p.a.MANIFEST_PARSED,(function(t){if(i.levelCnt=i.ctx.lctx.levels.length,"string"==typeof i.qualityType&&i.qualityType){if(i.levelCnt<=1)return;var n=i.ctx.lctx.levels.reduce((function(e,t,n){return t.qualityType===i.qualityType?n:e}),-1);n>=0&&i.ctx.lctx.currentIdx!==n&&e.setCurrentLevel(n)}else"number"==typeof i.level&&i.level>=0&&i.level<i.ctx.lctx.levels.length&&e.setCurrentLevel(i.level)})),e.on(p.a.ERROR,this._onError.bind(this))},i._onError=function(){this.emit(p.a.PRELOAD_COMPLETE,!1),this._data.stat=Pt.error,this.destroy()},s()(t,[{key:"trans",get:function(){return this._trans}}]),t}(o.EventEmitter),$t=function(e){function t(t){var i;return(i=e.call(this)||this)._waiting=[],i._running=void 0,i._active=!1,i._updateTimer=void 0,i._timeout=void 0,i._ctx=void 0,i._onPreloadComplete=function(e){var t;i._stopTimeout(),i._running&&(e?(v.b.i("preload-m","preload task done",i._waiting.length),null==(t=i._running.app)||t.destroy(),i.emit(p.a.PRELOAD_COMPLETE)):i._running.app&&i._running.app.destroy()),i._running=void 0,i._update()},i._onPreloadDownload=function(e){i.emit(p.a.DOWNLOAD,e)},i._ctx=t,i}_()(t,e);var i=t.prototype;return i.add=function(e,t){v.b.i("preload-m","add preload task");var i=this._ctx.getNewCtx();if(i.setSrc(e),!i.stat.isLive&&(i.stat.isPreload=!0,i.src)){var n={data:{ctx:i,levelCnt:1,stat:Pt.waiting,level:t},ts:performance.now()};this._waiting.push(n),this._update()}},i.active=function(e){void 0===e&&(e=!1),this._active!==e&&(e?(this._active=e,this._update()):(this._active=e,this._stopUpdateTimer()))},i.clean=function(){v.b.i("preload-m","clean"),this._waiting=[],this._running&&(this._running.app&&this._running.app.destroy(),this._running=void 0),this._active=!1},i.destroy=function(){v.b.i("preload-m","destroy"),this.clean(),this._stopUpdateTimer(),this.removeAllListeners()},i._stopUpdateTimer=function(){this._updateTimer&&(clearTimeout(this._updateTimer),this._updateTimer=void 0)},i._update=function(){if(!this._running&&this._waiting.length&&this._active){var e=this._ctx.lctx.current,t=this._running=this._waiting.shift();t&&(this._startTimeout(5e3),t.app=new Jt(t.data),t.app.on(p.a.PRELOAD_COMPLETE,this._onPreloadComplete),t.app.on(p.a.DOWNLOAD,this._onPreloadDownload),t.app.start(this._ctx.lctx.abr,null==e?void 0:e.qualityType),v.b.i("preload-m","preload task start"))}},i._startTimeout=function(e){var t=this;this._timeout=setTimeout((function(){t._running&&t._running.app&&t._running.app.destroy(),t._running=void 0,t._update(),t._stopTimeout()}),e)},i._stopTimeout=function(){this._timeout&&(clearTimeout(this._timeout),this._timeout=void 0)},t}(o.EventEmitter),ei=i(35);var ti=function(){if("undefined"!=typeof self&&self.VTTCue)return self.VTTCue;var e=["","lr","rl"],t=["start","middle","end","left","right"];function i(e,t){if("string"!=typeof t)return!1;if(!Array.isArray(e))return!1;var i=t.toLowerCase();return!!~e.indexOf(i)&&i}function n(e){return i(t,e)}function r(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var s in a)e[s]=a[s]}return e}function a(t,a,s){if("undefined"!=typeof self){var o=self,c={enumerable:!0};o.hasBeenReset=!1;var _="",d=!1,u=t,l=a,h=s,f=null,p="",m=!0,v="auto",g="start",y=50,E="middle",b=50,A="middle";Object.defineProperty(o,"id",r({},c,{get:function(){return _},set:function(e){_=""+e}})),Object.defineProperty(o,"pauseOnExit",r({},c,{get:function(){return d},set:function(e){d=!!e}})),Object.defineProperty(o,"startTime",r({},c,{get:function(){return u},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");u=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",r({},c,{get:function(){return l},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");l=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",r({},c,{get:function(){return h},set:function(e){h=""+e,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",r({},c,{get:function(){return f},set:function(e){f=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",r({},c,{get:function(){return p},set:function(t){var n=i(e,t);if(!1===n)throw new SyntaxError("An invalid or illegal string was specified.");p=n,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",r({},c,{get:function(){return m},set:function(e){m=!!e,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",r({},c,{get:function(){return v},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");v=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",r({},c,{get:function(){return g},set:function(e){var t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");g=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",r({},c,{get:function(){return y},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",r({},c,{get:function(){return E},set:function(e){var t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");E=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",r({},c,{get:function(){return b},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");b=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",r({},c,{get:function(){return A},set:function(e){var t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");A=t,this.hasBeenReset=!0}})),o.displayState=void 0}}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a}(),ii=function(){function e(){}return e.prototype.decode=function(e,t){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))},e}(),ni=function(){function e(){this.values=Object.create(null)}var t=e.prototype;return t.set=function(e,t){this.get(e)||""===t||(this.values[e]=t)},t.get=function(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t},t.has=function(e){return e in this.values},t.alt=function(e,t,i){for(var n=0;n<i.length;++n)if(t===i[n]){this.set(e,t);break}},t.integer=function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},t.percent=function(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){var i=parseFloat(t);if(i>=0&&i<=100)return this.set(e,i),!0}return!1},e}();function ri(e,t,i,n){var r=n?e.split(n):[e];for(var a in r)if("string"==typeof r[a]){var s=r[a].split(i);2===s.length&&t(s[0],s[1])}}var ai=new ti(0,0,""),si="middle"===ai.align?"middle":"center";function oi(e,t,i){var n=e;function r(){var t=function(e){function t(e,t,i,n){return 3600*(0|e)+60*(0|t)+(0|i)+parseFloat(n||0)}var i=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return i?parseFloat(i[2])>59?t(i[2],i[3],0,i[4]):t(i[1],i[2],i[3],i[4]):null}(e);if(null===t)throw new Error("Malformed timestamp: "+n);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function a(){e=e.replace(/^\s+/,"")}if(a(),t.startTime=r(),a(),"--\x3e"!==e.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+n);e=e.substr(3),a(),t.endTime=r(),a(),function(e,t){var n=new ni;ri(e,(function(e,t){var r;switch(e){case"region":for(var a=i.length-1;a>=0;a--)if(i[a].id===t){n.set(e,i[a].region);break}break;case"vertical":n.alt(e,t,["rl","lr"]);break;case"line":r=t.split(","),n.integer(e,r[0]),n.percent(e,r[0])&&n.set("snapToLines",!1),n.alt(e,r[0],["auto"]),2===r.length&&n.alt("lineAlign",r[1],["start",si,"end"]);break;case"position":r=t.split(","),n.percent(e,r[0]),2===r.length&&n.alt("positionAlign",r[1],["start",si,"end","line-left","line-right","auto"]);break;case"size":n.percent(e,t);break;case"align":n.alt(e,t,["start",si,"end","left","right"])}}),/:/,/\s/),t.region=n.get("region",null),t.vertical=n.get("vertical","");var r=n.get("line","auto");"auto"===r&&-1===ai.line&&(r=-1),t.line=r,t.lineAlign=n.get("lineAlign","start"),t.snapToLines=n.get("snapToLines",!0),t.size=n.get("size",100),t.align=n.get("align",si);var a=n.get("position","auto");"auto"===a&&50===ai.position&&(a="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=a}(e,t)}var ci=function(){function e(){this.state="INITIAL",this.buffer="",this.decoder=new ii,this.regionList=[],this.cue=null,this.style="",this.oncue=void 0,this.onstyle=void 0,this.onparsingerror=void 0,this.onflush=void 0}var t=e.prototype;return t.parse=function(e){var t=this;function i(){var e=t.buffer,i=0;for(e=e.replace(/<br(?: \/)?>/gi,"\n");i<e.length&&"\r"!==e[i]&&"\n"!==e[i];)++i;var n=e.substr(0,i);return"\r"===e[i]&&++i,"\n"===e[i]&&++i,t.buffer=e.substr(i),n}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var n="";if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;var r=(n=i()).match(/^()?WEBVTT([ \t].*)?$/);if(!r||!r[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var a=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:n=i(),t.state){case"HEADER":/:/.test(n)?ri(n,(function(e,t){}),/:/):n||(t.state="ID");continue;case"NOTE":n||(t.state="ID");continue;case"STYLE":n?t.style+=n:(t.style&&(t.onstyle&&t.onstyle(t.style),t.style=""),t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(n)){t.state="NOTE";break}if(/^STYLE($|[ \t])/.test(n)){t.state="STYLE";break}if(!n)continue;if(t.cue=new ti(0,0,""),t.state="CUE",-1===n.indexOf("--\x3e")){t.cue.id=n;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{oi(n,t.cue,t.regionList)}catch(e){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var s=-1!==n.indexOf("--\x3e");if(!n||s&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(null===t.cue)continue;t.cue.text&&(t.cue.text+="\n"),t.cue.text+=n;continue;case"BADCUE":n||(t.state="ID")}}}catch(e){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this},t.flush=function(){try{if((this.cue||"HEADER"===this.state)&&(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state||"BADWEBVTT"===this.state)throw new Error("Malformed WebVTT signature.")}catch(e){this.onparsingerror&&this.onparsingerror(e)}return this.onflush&&this.onflush(),this},e}(),_i=/\r\n|\n\r|\n|\r/g,di=function(e,t,i){return void 0===i&&(i=0),e.substr(i,t.length)===t},ui=function(e){for(var t=5381,i=e.length;i;)t=33*t^e.charCodeAt(--i);return(t>>>0).toString()};function li(e,t,i,n,r,a,s,o){var c,_,d=new ci,u=Object(ei.a)(new Uint8Array(e)).trim().replace(_i,"\n").split("\n"),l=[],h=(void 0===(c=i)&&(c=1),function(e,t,i,n){void 0===i&&(i=1),void 0===n&&(n=!1);var r=e*t*i;return n?Math.round(r):r}(t,Z.h,1/c)),f="",p="00:00.000",m=0,v=0,g=!0,y=!1;d.onstyle=function(e){f+=e},d.oncue=function(e){var t=n[r],i=n.ccOffset,s=(m-h)/Z.h;if(null!=t&&t.new&&(void 0!==v?i=n.ccOffset=t.start:function(e,t,i){var n=e[t],r=e[n.prevCC];if(!r||!r.new&&n.new)return e.ccOffset=e.presentationOffset=n.start,void(n.new=!1);for(;null!=(a=r)&&a.new;){var a;e.ccOffset+=n.start-r.start,n.new=!1,r=e[(n=r).prevCC]}e.presentationOffset=i}(n,r,s)),s&&(i=s-n.presentationOffset),y){var o=e.endTime-e.startTime,c=Object(Bt.a)((e.startTime+i-v)*Z.h,a*Z.h)/Z.h;e.startTime=c,e.endTime=c+o}var _,d,u,f=e.text.trim();e.text=decodeURIComponent(encodeURIComponent(f)),e.id||(e.id=(_=e.startTime,d=e.endTime,u=f,ui(_.toString())+ui(d.toString())+ui(u))),e.endTime>0&&l.push(e)},d.onparsingerror=function(e){_=e},d.onflush=function(){_?o(_):s(l,f)},u.forEach((function(e){if(g){if(di(e,"X-TIMESTAMP-MAP=")){g=!1,y=!0,e.substr(16).split(",").forEach((function(e){di(e,"LOCAL:")?p=e.substr(6):di(e,"MPEGTS:")&&(m=parseInt(e.substr(7)))}));try{v=function(e){var t=parseInt(e.substr(-3)),i=parseInt(e.substr(-6,2)),n=parseInt(e.substr(-9,2)),r=e.length>9?parseInt(e.substr(0,e.indexOf(":"))):0;if(!(Object(ee.a)(t)&&Object(ee.a)(i)&&Object(ee.a)(n)&&Object(ee.a)(r)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+e);return t+=1e3*i,(t+=6e4*n)+36e5*r}(p)/1e3}catch(e){y=!1,_=e}return}""===e&&(g=!1)}d.parse(e+"\n")})),d.flush()}var hi,fi=function(e){function t(t){var i;return(i=e.call(this)||this)._ctx=void 0,i._current=-1,i._list=[],i._listPos=0,i._vttCCs=void 0,i._styleNode=void 0,i._onTextTrackChange=function(){var e=i._list.reduce((function(e,t,i){return"showing"===t.track.mode?i:e}),-1);e!==i._current&&(i._current=e,v.b.i("subtitle","subtitle switching"),i.emit(p.a.SUBTITLE_TRACK_SWITCHED,{level:e}))},i._ctx=t,i._vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},i._ctx.video&&i._ctx.video.textTracks.addEventListener("change",i._onTextTrackChange),i}_()(t,e);var i=t.prototype;return i.addTracks=function(e){var t=this;e.forEach((function(e,i){var n=t._getTextTrack();n&&t._ctx.video&&(e.default?(t._current=i,n.mode="showing"):n.mode="hidden")}))},i.select=function(e){if(this._removeStyle(),e!==this._current){var t=this._list[e],i=this._list[this._current];i&&(i.track.mode="hidden"),t?(this._applyStyle(t.style),t.track.mode="showing",this._current=e):this._current=-1,this.emit(p.a.SUBTITLE_TRACK_SWITCHED,{level:this._current})}},i.reset=function(){v.b.i("subtitle","reset"),this._list.forEach((function(e){!function(e){var t=e.mode;if("disabled"===t&&(e.mode="hidden"),e.cues){for(var i=e.cues.length;i--;)e.removeCue(e.cues[i]);"disabled"===t&&(e.mode=t)}}(e.track),e.track.mode="hidden"})),this._listPos=0,this._current=-1,this._vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._removeStyle()},i.parseVTTs=function(e,t,i){var n=this,r=this._list[this._current];r&&li(e,i,t,this._vttCCs,i,t,(function(e,t){e.forEach((function(e){!function(e,t){var i=e.mode;if("disabled"===i&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw new Error("addCue is failed for: "+t)}catch(i){v.b.d("[texttrack-utils]: "+i);var n=new self.TextTrackCue(t.startTime,t.endTime,t.text);n.id=t.id,e.addCue(n)}"disabled"===i&&(e.mode=i)}(r.track,e)})),t&&(r.style+=t,n._applyStyle(r.style))}),(function(e){}))},i.destroy=function(){this._ctx.video&&this._ctx.video.textTracks.removeEventListener("change",this._onTextTrackChange),this.reset(),this._list=[],this.removeAllListeners()},i._getTextTrack=function(){var e;if(this._listPos<this._list.length)e=this._list[this._listPos].track,this._listPos++;else{var t=this._ctx.video;t&&(e=t.addTextTrack("subtitles"),this._list.push({track:e,style:""}),this._listPos++)}return e},i._applyStyle=function(e){e&&(this._styleNode||(this._styleNode=document.createElement("style"),document.head.appendChild(this._styleNode)),this._styleNode.innerHTML=e)},i._removeStyle=function(){this._styleNode&&(this._styleNode.innerHTML="",document.head.removeChild(this._styleNode),this._styleNode=void 0)},t}(o.EventEmitter),pi=function(){function e(e){this._ctx=void 0,this._ctx=e,v.b.i("auto-lazyload",e.stat.autoLazyLoad,e.stat.lazyLoadMaxDuration,e.stat.lazyLoadRecoverDuration)}var t=e.prototype;return t.update=function(){var e=this._ctx.lctx.current;!this._ctx.stat.isLive&&this._ctx.stat.autoLazyLoad&&e&&(e.maxBitrate||e.bitrate)&&this._checkLazyLoadConf(e,8*this._ctx.loadRec.smoothedDownloadSpeed/1e3)},t._checkLazyLoadConf=function(e,t){var i=0;if(e.maxBitrate)i=t/e.maxBitrate;else{if(!e.bitrate)return;i=t/(1.5*e.bitrate)}(i/=Math.max(1,this._ctx.playbackRate))>5?this._updateLazyloadConf(Math.max(14,this._ctx.stat.lazyLoadMaxDuration-2)):i<3&&this._updateLazyloadConf(Math.min(30,this._ctx.stat.lazyLoadMaxDuration+2))},t._updateLazyloadConf=function(e){this._ctx.stat.lazyLoadMaxDuration=e,this._ctx.stat.lazyLoadRecoverDuration=.8*this._ctx.stat.lazyLoadMaxDuration},e}(),mi=function(){function e(e){this._ctx=void 0,this._config=void 0,this._startDelay=5e3,this._enabled=!1,this._lastTickTime=0,this._ctx=e,this._config=e.config.autoPlaybackRateConf}var t=e.prototype;return t.tick=function(){if(this._enabled&&this._ctx.video&&!this._ctx.video.paused){if(this._startDelay>0){var e=performance.now();return this._startDelay-=e-this._lastTickTime,void(this._lastTickTime=e)}this._nextPlayBackRate(this._ctx.bufferedSec,this._ctx.video)}},t._nextPlayBackRate=function(e,t){if(this._config){var i=1,n=this._config.rule,r=0;for(r=0;r<n.length&&!(t.playbackRate>=n[r].rate);r++);if(n[r]){var a=r<n.length-1?n[r+1]:null,s=r>0?n[r-1]:null;i=n[r].rate,s&&e>s.lower&&(i=s.rate),a&&e<a.upper&&(i=a.rate),t.playbackRate!==i&&(v.b.i("playback-rate-manager","auto change playback rate from "+t.playbackRate+" to "+i),t.playbackRate=i)}}},s()(e,[{key:"enabled",get:function(){return this._enabled},set:function(e){if(e){if(!this._config)return;this._enabled=!0,this._lastTickTime=performance.now(),this._startDelay=this._config.startDelay?1e3*this._config.startDelay:this._startDelay}else this._enabled&&this._ctx.video&&(this._ctx.video.playbackRate=1),this._enabled=!1}}]),e}(),vi=function(){function e(e){this._info=void 0,this._info=e}var t=e.prototype;return t.update=function(e){var t=this;e.forEach((function(e){t._info[e.index]=e}))},t.timeToIndex=function(e){if(this._info.length){if(e<this._info[0].pts)return 0;if(e>this._info[this._info.length-1].pts)return this._info.length-1;for(var t,i,n,r=0,a=this._info.length-1;r<=a;)if(t=(r+a)/2|0,i=this._info[t],(n=this._info[t+1])&&n.pts-.001<e)r=t+1;else{if(!(i&&i.pts-.001>e))return t;a=t-1}}return-1},t.isIndexInRange=function(e){return e>=0&&e<this._info.length},t.indexToTime=function(e){return this._info[e]?this._info[e].pts:-1},t.getNextFramePTSByTime=function(e){var t=this.timeToIndex(e);return t>=0&&this._info[t+1]?this._info[t+1].pts:-1},t.getPrevFramePTSByTime=function(e){var t=this.timeToIndex(e)-1;return t>=0&&this._info[t]?this._info[t].pts:-1},s()(e,[{key:"totalVideoFrames",get:function(){return this._info.length}}]),e}(),gi=function(){function e(e){this._media=void 0,this._lastPlayTime=void 0,this._lastCheckTime=0,this._waiting=!1,this._start=!1,this._media=e}var t=e.prototype;return t.check=function(){var e=this._media,t=performance.now();if(!e.paused&&!e.seeking&&!e.ended&&t-this._lastCheckTime>=100){if(this._lastCheckTime=t,!this._start)return"number"==typeof this._lastPlayTime&&Math.abs(e.currentTime-this._lastPlayTime)>.017&&(this._start=!0),void(this._lastPlayTime=e.currentTime);e.currentTime===this._lastPlayTime?this._waiting||(this._waiting=!0,this._customEvent(e,"waiting")):this._waiting&&(this._waiting=!1,this._customEvent(e,"playing")),this._lastPlayTime=e.currentTime}},t.reset=function(){this._lastPlayTime=void 0,this._start=!1,this._waiting=!1},t._customEvent=function(e,t){if(e&&e.dispatchEvent){var i=document.createEvent("CustomEvent");i.initCustomEvent(t,!0,!0,{}),e.dispatchEvent(i)}},e}(),yi=i(19),Ei=i.n(yi);!function(e){e[e.NONE=0]="NONE",e[e.WAITING=1]="WAITING",e[e.SEEK=2]="SEEK",e[e.SELECT_BITRATE=3]="SELECT_BITRATE",e[e.INIT=4]="INIT",e[e.LOADING=5]="LOADING"}(hi||(hi={}));var bi="kernel-base",Ai=function(e){function t(t){var i;if((i=e.call(this)||this)._video=void 0,i._error=void 0,i._hbTimer=void 0,i._stat=hi.INIT,i._mediaInfo=void 0,i._levelSwitchId=0,i._nextLevel=[],i._nextAudio=void 0,i._playingLevel=0,i._eventHandlers=void 0,!t)throw new Error("video is null");return i._video=t,i._eventHandlers={loadedmetadata:i._onVideoLoadedmetadata.bind(Ei()(i)),loadeddata:i._onVideoLoadeddata.bind(Ei()(i)),canplay:i._onVideoCanplay.bind(Ei()(i)),seeking:i._onVideoSeeking.bind(Ei()(i)),seeked:i._onVideoSeeked.bind(Ei()(i)),waiting:i._onVideoWaiting.bind(Ei()(i)),playing:i._onVideoPlaying.bind(Ei()(i)),pause:i._onVideoPause.bind(Ei()(i)),play:i._onVideoPlay.bind(Ei()(i)),error:i._onVideoError.bind(Ei()(i)),ended:i._onVideoEnded.bind(Ei()(i)),ratechange:i._onVideoRatechange.bind(Ei()(i)),durationchange:i._onVideoDurationchange.bind(Ei()(i)),timeupdate:i._onVideoTimeupdate.bind(Ei()(i)),progress:i._onVideoProgress.bind(Ei()(i)),emptied:i._onVideoEmptied.bind(Ei()(i))},i._bindVideoEvents(),i}_()(t,e);var i=t.prototype;return i.destroy=function(){this._stopHeartbeat(),this._unbindVideoEvents(),this.removeAllListeners()},i.getError=function(){return this._error},i.setAudioTrack=function(e){},i.setSubtitleTrack=function(e){},i.seekToNextFrame=function(){var e=this._getNextFrameTime();e>0&&(this._video.currentTime=e)},i.seekToPrevFrame=function(){var e=this._getPrevFrameTime();e&&(this._video.currentTime=e)},i.getTotalVideoFrames=function(){return-1},i.getCurrentVideoFrame=function(){return-1},i.setCurretVideoFrame=function(e){this._onError({type:f.b.MEDIA_ERROR,details:f.a.CANNOT_SEEK_BY_FRAME_INDEX,fatal:!1,reason:"unsupported"})},i.getTrackBufInfo=function(){},i._getNextFrameTime=function(){var e=this._mediaInfo&&this._mediaInfo.fps?this._mediaInfo.fps:30;return this._video.duration&&!this._video.ended?this._video.currentTime+1/e:-1},i._getPrevFrameTime=function(){var e=this._mediaInfo&&this._mediaInfo.fps?this._mediaInfo.fps:30;return this._video.duration&&this._video.currentTime-1/e>=0?this._video.currentTime-1/e:-1},i._bindVideoEvents=function(){if(this._video)for(var e in this._eventHandlers)this._video.addEventListener(e,this._eventHandlers[e])},i._unbindVideoEvents=function(){if(this._video)for(var e in this._eventHandlers)this._video.removeEventListener(e,this._eventHandlers[e])},i._onVideoLoadedmetadata=function(e){v.b.i(bi,"loadedmetadata")},i._onVideoLoadeddata=function(){v.b.i(bi,"loadeddata"),this.emit(p.a.LOADEDDATA)},i._onVideoCanplay=function(){v.b.i(bi,"canplay "+!!this._stat),this.emit(p.a.CANPLAY)},i._onVideoSeeking=function(){v.b.i(bi,"seeking "+this._video.currentTime),this.emit(p.a.SEEKING)},i._onVideoSeeked=function(){v.b.i(bi,"seeked"),this.emit(p.a.SEEKED)},i._onVideoWaiting=function(){},i._onVideoPlaying=function(){v.b.i(bi,"playing"),this._error||(this._stat=hi.NONE,this._startHeartbeat(),this.emit(p.a.PLAYING))},i._onVideoPause=function(){v.b.i(bi,"pause. seeking: "+this._video.seeking),this._video.ended||this.emit(p.a.PAUSE)},i._onVideoPlay=function(){v.b.i(bi,"play",this._error),this.emit(p.a.PLAY)},i._onVideoError=function(e){},i._onVideoEnded=function(){v.b.i(bi,"ended"),this.emit(p.a.ENDED),this._stopHeartbeat()},i._onVideoRatechange=function(){v.b.v(bi,"ratechange "+this._video.playbackRate),this.emit(p.a.RATE_CHANGE,this._video.playbackRate)},i._onVideoDurationchange=function(){this.emit(p.a.DURATION_CHANGE,this._video.duration)},i._onVideoTimeupdate=function(){this.emit(p.a.TIMEUPDATE)},i._onVideoProgress=function(){this.emit(p.a.PROGRESS)},i._onVideoEmptied=function(){v.b.i(bi,"video emptied")},i._onError=function(e){e.fatal&&(this._error=e.details||f.a.UNKNOWN),v.b.i(bi,"error",this._error,e),this.emit(p.a.ERROR,e)},i._heartbeat=function(){this.emit(p.a.HEARTBEAT)},i._startHeartbeat=function(){this._hbTimer||(this._hbTimer=setInterval(this._heartbeat.bind(this),1e3))},i._stopHeartbeat=function(){this._hbTimer&&(clearInterval(this._hbTimer),this._hbTimer=void 0)},t}(o.EventEmitter),Ti=function(e){function t(t){var i;return(i=e.call(this,t)||this)._decId=1,i._audioSegmentCnt=0,i._state={streamTime:0,stoped:!1,frameBufLen:0,maxFrameBufLen:0},i._onDecVideoReady=function(e){i._waiting=!1,i.emit(p.a.DEC_VIDEO_READY),i._pausedOnWaiting=void 0},i._onDecWaiting=function(e){var t,n;null!=(t=i._ctx.video)&&t.ended||(i._bufRules.onWaiting(),i._waiting=!0,void 0===i._pausedOnWaiting&&(i._pausedOnWaiting=!(null==(n=i._ctx.video)||!n.paused)),i.emit(p.a.DECODER_WAITING,e))},i._onRenBufUpdate=function(e){},i._onRenSeek=function(e){v.b.i("yuv-renderer","renderer seek event",e),e.hitCache?i._waiting=!1:(i._reset(!0),i._updateState()),i._onSeeked(e)},i._onRenError=function(e){i.emit(p.a.ERROR,e)},i._state.maxFrameBufLen=i._bufRules.maxFrameBufLen,i}_()(t,e);var i=t.prototype;return i.init=function(e,t){var i=this,n=this._evt;n.on(p.a.DEC_VIDEO_READY,this._onDecVideoReady),n.on(p.a.STEP,(function(e){return i.emit(p.a.STEP,e)})),n.on(p.a.DECODER_WAITING,this._onDecWaiting),n.on(p.a.RENDERER_BUF_UPDATE,this._onRenBufUpdate),n.on(p.a.RENDERER_SEEK,this._onRenSeek),n.on(p.a.ERROR,this._onRenError),this._r.id=this._decId,this._r.init(!1),this._ready=!0,this.start()},i.setMediaInfo=function(e){this._r.updateMediaInfo(e)},i.appendData=function(e){var t=this;e.samples.forEach((function(e){e.yuv&&t._r.append(e.yuv)}))},i.endOfData=function(){v.b.i("yuv-renderer","endOfData"),this._r.endOfData()},i.seek=function(e){v.b.i("yuv-renderer","seek: "+e+" "+this._seeking),this._r.seek(e),this.start()},i.seekWithLoad=function(e){v.b.i("yuv-renderer","seekWithLoad: "+e),this._reset(!0),this._updateState()},i.flush=function(e){void 0===e&&(e=0),v.b.i("yuv-renderer","flush"),e?this._r.flush(e):this._reset(!1)},i.decoderChange=function(e,t){},i.onParsingData=function(e){var t=this;e.segments.forEach((function(e){e.type===R.l.AUDIO&&t._audioSegmentCnt++}))},i._reset=function(e){void 0===e&&(e=!1),this._decId++,this._audioSegmentCnt=0,e||(this._seeking=!1),this._r.id=this._decId,this._r.reset(e),this._waiting=!0},i._updateState=function(){var e=this._ctx.cOutput.canvas;if(e instanceof HTMLCanvasElement){var t,i=this._ctx.currentTime,n=!(null==(t=this._ctx.video)||!t.ended),r=!1,a=this._checkResize(e),s=this._state;if(0!==i||this._audioSegmentCnt||(i=-1),s.streamTime===i&&s.stoped===n&&s.frameBufLen===this._r.frameBufLen&&s.maxFrameBufLen===this._bufRules.maxFrameBufLen||(s.streamTime=i,s.stoped=n,s.frameBufLen=this._r.frameBufLen,s.maxFrameBufLen=this._bufRules.maxFrameBufLen,r=!0),!r&&!this._waiting&&!a)return;(r||a)&&this._r.update(i,this._size.w,this._size.h,n,R.o.canvas,s.maxFrameBufLen)}},i._onSeeked=function(e){v.b.i("yuv-renderer","seeked"),this._seeking=!1,this.emit(p.a.DECODER_SEEK,e)},s()(t,[{key:"isCanvasRenderer",get:function(){return!0}}]),t}(b),Si="kernel-base-mse",Ri=function(e){function t(t){var i;return(i=e.call(this,t.video)||this)._mse=void 0,i._trans=void 0,i._ctx=void 0,i._seekOnCanplay=!1,i._internalSeekFlag=!1,i._waitingHelper=void 0,i._audioCodecSwap=!1,i._audioCodec="",i._mainTimer=void 0,i._skipSeekEvent=!1,i._subtitle=void 0,i._nextLevelMinBuffer=3,i._seekRollbackTime=0,i._videoDecProxy=void 0,i._recoverMediaErrorTime=0,i._eme=void 0,i._autoLazyload=void 0,i._nativeVideoFunc=void 0,i._internalPauseFlag=!1,i._preloader=void 0,i._playbackRateManager=void 0,i._flvLiveRetry=0,i._flvLiveRetryTimer=void 0,i._liveEnd=!1,i._catchUpLive=!0,i._videoFrameMap=void 0,i._seekWithLoad=function(){var e;if(v.b.i(Si,"seek with load"),!i._ctx.stat.isLive&&i._trans&&i._mse){var t=i._video.currentTime;if(!i._trans.isSeekable()&&t>=Z.i)return v.b.w(Si,"seek disabled, rollback: "+i._seekRollbackTime),void i._internalSeek(i._seekRollbackTime);i._preloader&&i._preloader.active(!1),i._videoDecProxy&&i._videoDecProxy.seekWithLoad(t),i.emit(p.a.SEEK_WITH_LOAD,t),i._stat=hi.SEEK,i._nextLevel.length&&(i._nextLevel=i._nextLevel.slice(i._nextLevel.length-1),i._nextLevel[0].startSec=t),i._mse.flush(),i._mse.setAppendEnabled(!1),null!=(e=i._videoDecProxy)&&e.isCanvasRenderer&&(i._seekOnCanplay=!1),i._trans.seek(t,x.a.msie||i._ctx.config.alwaysSeekKeyframe,!1)}},i._ctx=t,i._autoLazyload=new pi(i._ctx),i._catchUpLive=!!i._ctx.config.catchUpPausedLive,i._eme=new $(i._ctx),i._eme.on(p.a.ERROR,(function(e){i._onError(e)})),t.video instanceof HTMLVideoElement&&x.a.x5&&x.a.android&&(i._waitingHelper=new gi(i._video)),i._initMSE(),i}_()(t,e);var i=t.prototype;return i.load=function(e){this._startHeartbeat(),this._playingLevel=void 0,this._load(e),this._preloader&&(this._preloader.active(!1),this._preloader.clean())},i.stopLoad=function(){v.b.i(Si,"call kernel stopLoad"),this._stopFlvLiveRetryTimer(),this._preloader&&this._preloader.clean(),this._playbackRateManager&&(this._playbackRateManager.enabled=!1),this._videoDecProxy&&this._videoDecProxy.stop(),this._trans&&(this._onLoadEnd(!0),this._destroyTrans(),this._stopHeartbeat(),this.emit(p.a.STOP_LOAD))},i.destroy=function(){var t,i;this._stopFlvLiveRetryTimer(),this._waitingHelper=void 0,this._stopMainTimer(),this._stopVideo(),this._destroyDecoder(),null==(t=this._subtitle)||t.destroy(),this._eme.destory(),this._nativeVideoFunc&&(this._video.play=this._nativeVideoFunc.play,this._video.pause=this._nativeVideoFunc.pause),this._videoFrameMap=void 0,Re(),null==(i=this._preloader)||i.destroy(),e.prototype.destroy.call(this)},i.resume=function(){v.b.i(Si,"call resume"),this._ctx.stat.isLive&&this._liveEnd||(this._trans||this._load(R.f.internal),this._video.paused&&this._video.play())},i.refresh=function(){if(this._ctx.stat.isLive){if(this._liveEnd)return;this._flvLiveRetry=0}this._ctx.stat.startFromSec=this._video.currentTime,this._reload(),this._error=void 0},i.onAbrLevelsUpdated=function(){var e;null==(e=this._trans)||e.onAbrLevelsUpdated()},i.setCurrentLevel=function(e){var t;if(v.b.i(Si,"set currentLevel",e),!this._verifyLevel(e)||e===this._ctx.lctx.currentIdx&&!this._ctx.lctx.abr||this._error)this.emit(p.a.LEVEL_SWITCH_FAILED);else if(e<0)this.setNextLevel(-1);else{if(this._isSwitchLevelByReload())return this._playingLevel=e,void this._reload();this._stat!==hi.INIT&&this._stat!==hi.LOADING&&(this._stat=hi.SELECT_BITRATE,this._seekOnCanplay=!0),this._mse&&(this._mse.flush(),this._checkStreamingMux()),null==(t=this._trans)||t.setCurrentLevel(e),this._videoDecProxy&&this._videoDecProxy.flush(),!this._ctx.stat.isLive&&this._preloader&&this._preloader.active(!1)}},i.setNextLevel=function(e){var t;v.b.i(Si,"set nextLevel",e),this._verifyLevel(e)&&!this._error?this._ctx.bufferedSec<this._nextLevelMinBuffer&&e>=0||e>=0&&this._isSwitchLevelByReload()?this.setCurrentLevel(e):null==(t=this._trans)||t.setNextLevel(e):this.emit(p.a.LEVEL_SWITCH_FAILED)},i.setAudioTrack=function(e){this._trans&&e!==this._ctx.lctx.audioIdx&&this._ctx.lctx.audioTracks.length>1&&(this._trans.setAudioTrack(e),this._stat!==hi.INIT&&this._stat!==hi.LOADING&&(this._stat=hi.SELECT_BITRATE,this._seekOnCanplay=!0),this._mse&&(this._mse.flush(),this._checkStreamingMux()))},i.setSubtitleTrack=function(e){this._trans&&e!==this._ctx.lctx.subtitleIdx&&this._ctx.lctx.subtitleTracks.length>=1&&this._subtitle&&this._subtitle.select(e)},i.liveEnd=function(){v.b.i(Si,"liveEnd",this._ctx.stat.isLive),this._ctx.stat.isLive&&(this._liveEnd=!0,this._stopFlvLiveRetryTimer())},i.getTotalVideoFrames=function(){return this._videoFrameMap?this._videoFrameMap.totalVideoFrames:-1},i.getCurrentVideoFrame=function(){return this._videoFrameMap?this._videoFrameMap.timeToIndex(this._video.currentTime):-1},i.preload=function(e,t){var i=this,n=this._ctx;!this._preloader&&$t&&(this._preloader=new $t(n),this._preloader.on(p.a.PRELOAD_COMPLETE,(function(){return i.emit(p.a.PRELOAD_COMPLETE)})),this._preloader.on(p.a.DOWNLOAD,(function(e){return i.emit(p.a.DOWNLOAD,e)}))),this._preloader&&(this._preloader.add(e,t),this._trans||this._preloader.active(!0))},i.seekToNextFrame=function(){if(!(this.getCurrentVideoFrame()>=this.getTotalVideoFrames()-1))if(this._videoDecProxy)this._videoDecProxy.step(R.j.NEXT);else if(this._videoFrameMap){var t=this._videoFrameMap.getNextFramePTSByTime(this._video.currentTime);t>=0&&(this._video.currentTime=t+.001)}else e.prototype.seekToNextFrame.call(this)},i.seekToPrevFrame=function(){if(0!==this.getCurrentVideoFrame())if(this._videoDecProxy)this._videoDecProxy.step(R.j.PREV);else if(this._videoFrameMap){var t=this._videoFrameMap.getPrevFramePTSByTime(this._video.currentTime);t>=0&&(this._video.currentTime=t+.001)}else e.prototype.seekToPrevFrame.call(this)},i.setCurretVideoFrame=function(t){this._videoFrameMap&&this._videoFrameMap.isIndexInRange(t)?this._videoFrameMap.indexToTime(t)>=0?this._video.currentTime=this._videoFrameMap.indexToTime(t)+.001:this._onError({type:f.b.MEDIA_ERROR,details:f.a.CANNOT_SEEK_BY_FRAME_INDEX,fatal:!1,reason:t+" out of range: [0, "+this.getTotalVideoFrames()+"]"}):e.prototype.setCurretVideoFrame.call(this,t)},i.getTrackBufInfo=function(){var e;return null==(e=this._mse)?void 0:e.trackBufInfo},i._onVideoLoadedmetadata=function(){!this._video.videoWidth&&this._ctx.canCodecFallback&&this.emit(p.a.FALLBACK_H264,{type:R.h.FALLBACK_H264,message:"buildin "+this._ctx.stat.codecType+" dec no width."})},i._onVideoPause=function(){e.prototype._onVideoPause.call(this),this._ctx.config.catchUpPausedLive&&(this._catchUpLive=!0)},i._onVideoPlaying=function(){if(!this._error&&this._ctx.stat.isLive){var t=$e(this._ctx.stat.box)?this._ctx.stat.multipartLiveDelay||0:this._ctx.config.defaultSpts;if(t<0&&this._ctx.bufferedSec>-t/1e3+1&&this._catchUpLive){var i=this._ctx.bufferedEnd+t/1e3;this._ctx.isTimeinBuffered(i)&&this._internalSeek(i)}this._catchUpLive=!1}e.prototype._onVideoPlaying.call(this)},i._onVideoPlay=function(){this._error||this._trans||this.load(),this._videoDecProxy&&(this._videoDecProxy.start(),this._videoDecProxy.waiting&&this._videoDecProxy.isCanvasRenderer&&(this._videoDecProxy.pausedOnWaiting=!1,this._internalPause())),e.prototype._onVideoPlay.call(this)},i._onVideoEnded=function(){this._seekRollbackTime=0,this._internalSeekFlag=!1,this._skipSeekEvent=!1,e.prototype._onVideoEnded.call(this)},i._checkStreamingMux=function(e){void 0===e&&(e=0),this._ctx.stat.streamingMux&&this._trans&&(e>11*Math.max(1,this._ctx.playbackRate)?this._trans.streamingMux(!1):this._trans.streamingMux(!0))},i._initMSE=function(){var e=this;(this._mse&&(this._mse.hasTrackInfo()||this._video.error)||this._eme.isActive)&&(v.b.i(Si,"rebuild mse"),URL.revokeObjectURL(this._video.src),this._destroyMSE(),this._eme.isActive&&(v.b.i(Si,"eme reset src"),this._video.src="",this._eme.reset())),this._mse?this._mse.flush():(this._mse=new te(this._ctx.config,this._ctx.stat),this._mse.attach(this._video),this._ctx.mse=this._mse,this._mse.on(p.a.ERROR,(function(t){e._onError(t)})),this._mse.on(p.a.MSE_BUFFER_FULL,this._onMSEBufferFull.bind(this)),this._mse.on(p.a.MSE_UPDATE,(function(){e.emit(p.a.MSE_UPDATE),e._stat!==hi.NONE&&e._ctx.isTimeinBuffered(e._video.currentTime)&&e._video.readyState>=3?(e._onVideoCanplay(),v.b.v(Si,"canplay polyfill")):e._seekOnCanplay&&e._detectSeekOnCanplay()})),this._mse.on(p.a.MSE_REMOVE,(function(){e.emit(p.a.MSE_REMOVE)})),this._mse.on(p.a.MSE_OPEN,(function(){e.emit(p.a.MSE_OPEN)})))},i._verifyLevel=function(e){return!(!(this._trans&&this._ctx.lctx.levels.length>0&&e<this._ctx.lctx.levels.length&&this._mse&&this._video)||this._video.ended)},i._onMSEBufferFull=function(){this.emit(p.a.MSE_BUFFER_FULL),this._ctx.stat.isLive?this._video.paused&&(this.stopLoad(),this._initMSE()):!this._ctx.stat.isLive&&this._trans&&this._trans.setDownloadEnabled(!1)},i._detectSeekOnCanplay=function(){this._seekOnCanplay&&this._mse&&!this._mse.hasCleanUpTask()&&this._ctx.isTimeinBuffered(this._video.currentTime+.001)&&(v.b.i(Si,"seek on canplay "+this._video.currentTime+" + 0.001"),this._seekOnCanplay=!1,this._internalSeek(this._video.currentTime+.001))},i._internalSeek=function(e){this._internalSeekFlag=!0;try{this._video.currentTime=e}catch(e){}},i._initTrans=function(){this._trans=new Qt(this._ctx),this._trans&&(this._transmuxerEvent(this._trans),this._trans.init()),this._waitingHelper&&this._waitingHelper.reset()},i._transmuxerEvent=function(e){var t=this,i=this._mse,n=this._ctx;e.on(p.a.PARSING_DATA,this._onParsingData.bind(this)),e.on(p.a.PARSING_INIT_SEGMENT,(function(e){var a;if(t._nextLevel.length){var s=t._nextLevel[t._nextLevel.length-1];s.init=!0,t.emit(p.a.LEVEL_SWITCHED,{bitrate:s.bitrate,level:s.level,smooth:s.smooth,auto:s.auto,id:s.id})}if(t._nextAudio){var o=t._nextAudio;t.emit(p.a.AUDIO_TRACK_SWITCHED,{level:o.level,smooth:o.smooth,auto:o.auto,id:o.id})}var c=e.tracks.video,_=e.tracks.rawVideo,d=e.tracks.audio;if(null==(a=e.base)||!a.isFillVideo||!t._mediaInfo){var u,l=r()({hasVideo:!(!_&&!c),hasAudio:!!d},e.base);c&&r()(l,c.metadata),d&&r()(l,d.metadata),_&&r()(l,_.metadata),l.videoCodec=(null==_?void 0:_.codec)||(null==c?void 0:c.codec)||"",l.audioCodec=(null==d?void 0:d.codec)||"",n.stat.codecType=l.videoCodecType=(null==_?void 0:_.codecType)||(null==c?void 0:c.codecType)||R.b.unknown,l.audioCodecType=(null==d?void 0:d.codecType)||R.b.unknown,t._audioCodec=(null==(u=e.base)?void 0:u.manifestAudioCodec)||l.audioCodec,n.lctx.current&&(!n.lctx.current.bitrate&&l.videoBitrate&&l.audioBitrate&&(n.lctx.current.bitrate=l.videoBitrate+l.audioBitrate),!n.lctx.current.maxBitrate&&l.videoMaxBitrate&&l.audioMaxBitrate&&(n.lctx.current.maxBitrate=l.videoMaxBitrate+l.audioMaxBitrate)),l.colorSpace=Object(Wt.e)(l.colorInfo),l.videoDecoder=n.stat.decoder,t._videoDecProxy&&t._videoDecProxy.setMediaInfo(r()({},l)),delete l.colorInfo,t.emit(p.a.PARSING_INIT_SEGMENT,l),t._mediaInfo=l,v.b.i(Si,"mediainfo",l)}i&&i.trackInfo(e),t._startMainTimer()})),e.on(p.a.ERROR,(function(e){t._onError(e)})),e.on(p.a.LOAD_END,this._onLoadEnd.bind(this)),e.on(p.a.SUBTITLE_LOADED,(function(e){t._subtitle&&t._subtitle.parseVTTs(e.data,e.start,e.cc)})),e.on(p.a.LEVEL_SWITCH_FAILED,(function(e){e&&e.smooth?t.setCurrentLevel(e.level):t.emit(p.a.LEVEL_SWITCH_FAILED)})),e.on(p.a.LEVEL_SWITCHING,(function(e){var r;if(e.type!==R.e.SUBTITLE){if(e.id=t._levelSwitchId,t._levelSwitchId++,e.auto=n.lctx.abr,!e.smooth&&i&&(i.flush(),t._checkStreamingMux()),e.type===R.e.AUDIO)return t.emit(p.a.AUDIO_TRACK_SWITCHING,{track:e.level,smooth:e.smooth,auto:e.auto,id:e.id}),void(t._nextAudio=e);"number"==typeof e.level&&(e.bitrate=e.level<0?-1:(null==(r=n.lctx.levels[e.level])?void 0:r.bitrate)||0),t.emit(p.a.LEVEL_SWITCHING,{bitrate:e.bitrate,level:e.level,smooth:e.smooth,auto:e.auto,id:e.id}),-1===e.level?t.emit(p.a.LEVEL_SWITCHED,{bitrate:e.bitrate,level:e.level,smooth:e.smooth,auto:e.auto,id:e.id}):(e.smooth?t._nextLevel=t._nextLevel.sort((function(e,t){return e.startSec-t.startSec})).filter((function(t){return t.startSec<e.startSec-.5})):t._nextLevel=[],t._nextLevel.push(e))}})),e.on(p.a.BUFFER_FLUSHING,(function(e){i&&i.flush(e.startSec,t._video.duration),t._videoDecProxy&&t._videoDecProxy.flush(1e3*e.startSec)})),e.on(p.a.METADATA,this._onMetadata.bind(this)),e.on(p.a.VIDEO_FRAME_INFO,this._onVideoFrameInfo.bind(this)),e.on(p.a.MANIFEST_PARSED,(function(i){if(v.b.i(Si,"manifest parsed"),"number"!=typeof t._playingLevel){var r=n.lctx.startIdx;"number"==typeof r&&(-1===r&&n.lctx.abr||e.setCurrentLevel(r)),t._playingLevel=n.lctx.currentIdx,n.lctx.subtitleTracks.length&&t._initSubtitle(),n.config.emeEnabled&&t._eme.onManifestParsed(n.lctx.levels,n.stat.drm),v.b.i(Si,p.a.MANIFEST_PARSED,i),t.emit(p.a.MANIFEST_PARSED,i)}else e.setCurrentLevel(t._playingLevel)})),e.on(p.a.LEVEL_UPDATED,(function(e){!n.stat.isLive&&e.duration&&i&&i.updateDuration(e.duration),v.b.i(Si,p.a.LEVEL_UPDATED,e),e.type===R.e.AUDIO?t.emit(p.a.AUDIO_TRACK_UPDATED,e):e.type===R.e.MAIN&&t.emit(p.a.LEVEL_UPDATED,e)})),e.on(p.a.VIDEO_SEEK,(function(e){if(e.sec!==n.currentTime){t._skipSeekEvent=!0;try{t._internalSeek(e.sec)}catch(e){}}})),e.on(p.a.PRIV_NAL,(function(e){t.emit(p.a.PRIV_NAL,e)})),e.on(p.a.RAW_DATA,(function(e){t._videoDecProxy&&t._videoDecProxy.appendData(e),t.emit(p.a.RAW_DATA,e)})),e.on(p.a.VIDEO_CODEC_DETECTED,(function(e){if(v.b.i(Si,"video codec detected. dec:"+e.decoder+", codec:"+e.codecType+", bitDepth:"+e.bitDepth+" "+e.timeOffset),e.decoder&&(t._ctx.stat.decoder=e.decoder),t._videoDecProxy&&e.decoder===R.c.buildin)return t._videoDecProxy.decoderChange(R.c.buildin,e.timeOffset||0),void(n.config.ensureVideo||(n.config.ensureVideo=!0,t._reload()));e.decoder===R.c.buildin&&(n.cOutput.updateRendererType(R.o.video),n.cOutput.rendererType===R.o.canvas&&t.emit(p.a.VIDEO_RENDERER_CHANGE,{enabled:!0,canvas:n.cOutput.canvas,type:R.o.canvas})),e.enabled&&e.decoder===R.c.wasm&&Mi?(t._initCanvasRenderer(Mi,e.codecType,e.bitDepth),t._videoDecProxy&&t._videoDecProxy.decoderChange(R.c.wasm,e.timeOffset||0)):e.enabled&&e.decoder===R.c.none&&n.stat.box===R.g.yuv&&Ti&&t._initCanvasRenderer(Ti,e.codecType,e.bitDepth)})),e.on(p.a.LOADER_CHUNK_ARRIVAL,(function(e){t._autoLazyload.update(),t.emit(p.a.LOADER_CHUNK_ARRIVAL,e)})),e.on(p.a.DEMUXER_DETECTED,(function(e){t.emit(p.a.DEMUXER_DETECTED,e)})),e.on(p.a.MEDIA_DEMUX,(function(e){t.emit(p.a.MEDIA_DEMUX,e)})),e.on(p.a.MEDIA_CONNECTED,(function(e){return t.emit(p.a.MEDIA_CONNECTED,e)})),e.on(p.a.KEY_FRAME,(function(e){t.emit(p.a.KEY_FRAME,e)})),e.on(p.a.MUX_INFO,(function(e){t.emit(p.a.MUX_INFO,e)})),e.on(p.a.USE_BACKUP,(function(e){t.emit(p.a.USE_BACKUP,e)})),e.on(p.a.NEW_SOURCE,(function(e){t.emit(p.a.NEW_SOURCE,e)})),e.on(p.a.DISCONTINUITY,(function(e){t.emit(p.a.DISCONTINUITY,e)})),e.on(p.a.DOWNLOAD,(function(e){t.emit(p.a.DOWNLOAD,e)}))},i._initCanvasRenderer=function(e,t,i){var n=this;void 0===i&&(i=8);var r=this._mse,a=this._ctx;if(!this._videoDecProxy){var s;r&&r.setAppendEnabled(!1),a.stat.mainThreadRendering=!!a.cOutput.hasVPP||a.config.mainThreadRendering,a.cOutput.updateRendererType(R.o.canvas);var o=this._videoDecProxy=new e(a);this._injectVideo(),o.on(p.a.ERROR,(function(e){return n._onError(e)})),o.on(p.a.DEC_LIB_LOADED,(function(e){return n.emit(p.a.DEC_LIB_LOADED,e)})),o.on(p.a.DEC_VIDEO_READY,this._videoDecFrameReady.bind(this)),o.on(p.a.STEP,this._videoDecStep.bind(this)),o.on(p.a.DECODER_SEEK,this._h265Seek.bind(this)),o.on(p.a.DECODER_WAITING,this._videoDecWaiting.bind(this)),o.on(p.a.VIDEO_RENDERER_CHANGE,(function(e){a.cOutput.updateRendererType(e.type)&&(e.type=a.cOutput.rendererType,n.emit(p.a.VIDEO_RENDERER_CHANGE,e))})),o.init(t,i),null!=(s=this._mse)&&s.ended()&&o.endOfData(),this.emit(p.a.VIDEO_RENDERER_CHANGE,{enabled:!0,canvas:a.cOutput.canvas,type:R.o.canvas})}},i._videoDecFrameReady=function(){v.b.i(Si,"h265 video ready"),this._customWaitingEnded(),this._ctx.stat.isLive?this._updateBufferControl():this._mse&&this._mse.setAppendEnabled(!0)},i._videoDecStep=function(e){if(v.b.i(Si,"h265 step frame",e),e.type){var t=e.time/1e3;e.type===R.j.NEXT?(t<0&&(t=this._getNextFrameTime()),t!==this._video.currentTime&&(this._skipSeekEvent=!0,this._internalSeek(t))):t>=0?t!==this._video.currentTime&&(this._skipSeekEvent=!0,this._internalSeek(t)):this._video.currentTime=this._getPrevFrameTime()}},i._updateBufferControl=function(){if(this._trans&&this._mse){var e=this._ctx.bufferedSec,t=this._mse.getBufferQueueSec(),i=!0;if(this._checkStreamingMux(e),(e<this._ctx.stat.lazyLoadRecoverDuration||this._ctx.stat.isLive&&!this._mse.getAppendEnabled())&&this._mse.setAppendEnabled(!this._videoDecProxy||!this._videoDecProxy.isCanvasRenderer||!this._videoDecProxy.waiting),this._ctx.stat.lazyLoadMaxDuration>0&&e+t>=("closed"===this._mse.readyState?1:this._ctx.stat.lazyLoadMaxDuration))i=!1;else{if(!(e+t<this._ctx.stat.lazyLoadRecoverDuration))return;i=!0}!this._ctx.stat.isLive&&this._trans&&(v.b.v(Si,"download: "+i+" buffered:"+e+" mse:"+t),this._trans.setDownloadEnabled(i)),this._mse.pendingNum()&&this._mse.refresh()}},i._onVideoSeeking=function(){if(v.b.i(Si,"seek to "+this._video.currentTime+" internal:"+this._internalSeekFlag),this._mediaInfo&&!(this._video&&this._video.currentTime>=this._video.duration&&this._mse&&this._mse.ended())){this._checkStreamingMux();var e=this._internalSeekFlag;if(this._internalSeekFlag=!1,this._skipSeekEvent)this._skipSeekEvent=!1;else{this.emit(p.a.SEEKING,e);var t=this._video.currentTime;if(this._videoDecProxy&&this._videoDecProxy.isCanvasRenderer){if(e)return;this._videoDecProxy.seek(t)}else this._ctx.isTimeinBuffered(t)?e||(x.a.msedge||x.a.msie?(this._seekOnCanplay=!0,this._seekWithLoad()):this._trans&&$e(this._ctx.stat.box)&&this._trans.seek(t,!1,!0)):0===t&&this._video.buffered.length>0&&this._video.buffered.start(0)<1?e||this._internalSeek(this._video.buffered.start(0)):this._seekWithLoad()}}},i._h265Seek=function(e){v.b.i(Si,"h265 seek frame",e),e.hitCache?this._updateBufferControl():this._seekWithLoad()},i._videoDecWaiting=function(e){v.b.i(Si,"h265 render buf empty",e),this._customWaiting()},i._customWaiting=function(){!this._video.ended&&this._videoDecProxy&&this._videoDecProxy.isCanvasRenderer&&(this._video.paused||this._internalPause(),function(e,t,i){if(e&&e.dispatchEvent&&window.CustomEvent){var n=new CustomEvent("waiting",void 0);e.dispatchEvent(n)}}(this._video))},i._customWaitingEnded=function(){this._videoDecProxy&&!1===this._videoDecProxy.pausedOnWaiting&&this._video.play()},i._destroyTrans=function(){this._trans&&(this._trans.destroy(),this._trans.removeAllListeners(),this._trans=void 0)},i._destroyMSE=function(){this._ctx.mse=void 0,this._mse&&(this._mse.removeAllListeners(),this._mse.destroy(),this._mse=void 0)},i._destroyDecoder=function(){this._videoDecProxy&&(this._videoDecProxy.destroy(),this._videoDecProxy=void 0)},i._reload=function(){v.b.i(Si,"reload"),this._ctx.cOutput.reset(),this._ctx.stat.isLive||(this._ctx.stat.startFromSec=this._video.currentTime),this._trans&&(this._ctx.lctx.startIdx=this._ctx.lctx.currentIdx),this._nextLevel=[],this._internalSeekFlag=!1,this._stopVideo(),this._load(R.f.retry),this._video.play()},i._startMainTimer=function(){this._mainTimer||(this._mainTimer=setInterval(this._mainLoop.bind(this),200))},i._stopMainTimer=function(){this._mainTimer&&(clearInterval(this._mainTimer),this._mainTimer=void 0)},i._stopVideo=function(){v.b.i(Si,"stop video"),this._video&&(this._destroyTrans(),this._destroyDecoder(),this._destroyMSE(),URL.revokeObjectURL(this._video.src),this._video.src&&(this._video.src=""))},i._mainLoop=function(){this._ctx.stat.isLive?(!this._playbackRateManager&&this._ctx.config.autoPlaybackRateConf&&(this._playbackRateManager=new mi(this._ctx),this._playbackRateManager.enabled=!0),this._playbackRateManager&&this._playbackRateManager.tick()):this._playbackRateManager&&(this._playbackRateManager.enabled=!1);var e=this._video;if(this._waitingHelper&&this._ctx.stat.firstFrameLoaded&&this._waitingHelper.check(),(this._stat===hi.WAITING&&!e.seeking||this._stat===hi.LOADING||this._stat===hi.INIT||this._stat===hi.SEEK||this._stat===hi.SELECT_BITRATE)&&this._mse&&!this._mse.hasCleanUpTask()&&!e.ended&&this._mse.hasSourceBufferAppendStarted()){var t=e.currentTime,i=this._ctx.currentBuffer(t),n=void 0;if(!i||i.end-t<1){var r=this._ctx.nextBuffer(t);r&&(v.b.i(Si,"try fix block-A"),n=r.start)}else this._video.buffered.length>1&&i.end-t>1&&(v.b.i(Si,"try fix block-B"),n=i.start);n&&(n+=x.a.safari?.3:.001,this._internalSeek(n),v.b.i(Si,"jump to "+n))}this._nextLevel.length&&this._checkLevelChange()},i._checkLevelChange=function(){var e=this._nextLevel[0];e&&this._video.currentTime>=e.startSec&&this._ctx.isTimeinBuffered(this._video.currentTime)&&(e.init||this.emit(p.a.LEVEL_SWITCHED,{bitrate:e.bitrate,level:e.level,smooth:e.smooth,auto:e.auto,id:e.id}),this.emit(p.a.LEVEL_SWITCH_PLAYING,{bitrate:e.bitrate,level:e.level,smooth:e.smooth,auto:e.auto,id:e.id}),this._playingLevel=e.level,this._nextLevel.shift())},i._load=function(e){v.b.i(Si,"_load start sec:",this._ctx.stat.startFromSec),this._mediaInfo=void 0,this._error=void 0,this._internalSeekFlag=!1,this._stat=hi.LOADING,this._nextLevel=[],this._stopMainTimer(),this._videoFrameMap=void 0,this._stopFlvLiveRetryTimer(),this.emit(p.a.LOAD,e),this._subtitle&&this._subtitle.reset(),this._trans&&this._destroyTrans(),this._destroyDecoder(),this._initMSE(),this._ctx.config.startPlayBufferSec&&!e&&this._mse&&this._mse.setStartBufSec(this._ctx.config.startPlayBufferSec),this._startHeartbeat(),this._initTrans(),this._trans&&this._trans.loadSource(),this._ctx.stat.isLive&&(this._liveEnd=!1,this._ctx.config.autoPlaybackRate&&this._playbackRateManager&&(this._playbackRateManager.enabled=!0))},i._onParsingData=function(e){this._ctx.mse&&this._ctx.mse.mediaSegment(e.segments),this.emit(p.a.PARSING_DATA,e),this._videoDecProxy&&this._videoDecProxy.onParsingData(e),this._updateBufferControl()},i._onMetadata=function(e){!this._ctx.stat.isLive&&e.videoFramesInfo&&(this._videoFrameMap=new vi(e.videoFramesInfo)),delete e.videoFramesInfo,"number"==typeof e.duration&&this._mse&&(delete e.keyframes,this._trans&&!this._ctx.stat.multipart&&this._mse.updateDuration(e.duration)),this.emit(p.a.METADATA,e)},i._onVideoFrameInfo=function(e){!this._ctx.stat.isLive&&e.videoFramesInfo&&(this._videoFrameMap?this._videoFrameMap.update(e.videoFramesInfo):this._videoFrameMap=new vi(e.videoFramesInfo))},i._onLoadEnd=function(e){void 0===e&&(e=!1),e||(this._ctx.stat.isLive=!1),this._mse&&this._mse.endOfData(),this._videoDecProxy&&this._videoDecProxy.endOfData(),this.emit(p.a.LOAD_END,{internal:e})},i._onVideoCanplay=function(){e.prototype._onVideoCanplay.call(this),this._stat!==hi.NONE&&(this._stat=hi.NONE,this._detectSeekOnCanplay(),this._checkLevelChange(),this._video.paused||this._onVideoPlaying())},i._onVideoTimeupdate=function(){this._video.seeking||(this._seekRollbackTime=this._video.currentTime),e.prototype._onVideoTimeupdate.call(this)},i._onVideoSeeked=function(){this._mediaInfo&&e.prototype._onVideoSeeked.call(this)},i._onVideoWaiting=function(){if(this._liveEnd&&this._ctx.stat.box===R.g.flv&&this._ctx.stat.isLive)this.stopLoad();else{this._stat=this._stat||hi.WAITING;var e=this._ctx.bufferedSec,t=!this._video.ended&&!this._video.seeking&&this._stat===hi.WAITING;this.emit(p.a.WAITING,t,e)}},i._onVideoError=function(e){var t;if(v.b.e(Si,"video error",e),!this._error&&this._mediaInfo){var i=null==(t=this._video.error)?void 0:t.code;if(4===i){if(this._ctx.canCodecFallback)return void this.emit(p.a.FALLBACK_H264,{type:R.h.FALLBACK_H264,message:"buildin "+this._ctx.stat.codecType+" dec error. video error: "+i});if(Mi&&this._ctx.stat.codecType===R.b.hevc&&this._ctx.stat.decoder===R.c.buildin&&this._ctx.config.wasmDecoderEnabled&&wi.TYPE_SUPPORTED.hevc&&!x.a.mobile)return v.b.i(Si,"buildin hevc dec error"),wi.TYPE_SUPPORTED.hevc=!1,this.emit(p.a.RETRY,{type:R.h.HEVC_DEC,message:"buildin "+(wi.isSupportHW?"hardware":"software")+" hevc dec error. video error: "+i}),void this._reload()}if(3===i){var n=performance.now();if((!this._recoverMediaErrorTime||n-this._recoverMediaErrorTime>3e3)&&this._recoverSwapRemuxType())return void(this._recoverMediaErrorTime=n);if(this._recoverSwapAudioCodec())return}var r="video error";this._video&&this._video.error&&(r+=" code:"+this._video.error.code+" message:"+this._video.error.message),this._onError({type:f.b.MEDIA_ERROR,details:(i?f.c[i]:f.a.VIDEO_ERROR)||f.a.VIDEO_ERROR,fatal:!0,reason:r})}},i._heartbeat=function(){var t;e.prototype._heartbeat.call(this),this._trans&&this._trans.heartbeat(),this._updateBufferControl(),this._trans&&this._preloader&&!this._ctx.stat.isLive&&this._preloader.active(!this._ctx.stat.isNetworkInUse&&"closed"!==(null==(t=this._mse)?void 0:t.readyState))},i._onError=function(t){if(t.type===f.b.NETWORK_ERROR&&this._ctx.stat.isLive&&this._ctx.stat.box===R.g.flv&&this._flvLiveRetry<this._ctx.config.maxRetry)this._startFlvLiveRetryTimer(Math.max(this._ctx.config.retryDelay,1e3*this._ctx.bufferedSec),t);else{if(t.fatal){if(t.details===f.a.REMUX_WORKER_ERROR&&this._ctx.stat.webWorker)return this._ctx.stat.webWorker=!1,this.emit(p.a.RETRY,{type:R.h.REMUX_WORKER,message:"remux worker error"}),void this._reload();this._video.error&&this._destroyMSE(),this._stopMainTimer()}e.prototype._onError.call(this,t)}},i._recoverSwapRemuxType=function(){var e,t=this._ctx.stat.gopRemux,i=this._ctx.stat.streamingMux;return this._ctx.stat.box===R.g.flv&&this._ctx.stat.isLive?this._ctx.stat.gopRemux=!0:this._ctx.stat.streamingMux=!1,(t!==this._ctx.stat.gopRemux||i!==this._ctx.stat.streamingMux)&&(v.b.i(Si,"recover swap remux type"),this.emit(p.a.RETRY,{type:R.h.CODEC_REMUX_TYPE,message:"change remux type. video error: "+(null==(e=this._video.error)?void 0:e.code)}),this._reload(),!0)},i._recoverSwapAudioCodec=function(){var e;return!(this._audioCodecSwap||!this._audioCodec||(-1!==this._audioCodec.indexOf("mp4a.40.5")?this._audioCodec="mp4a.40.2":this._audioCodec="mp4a.40.5",this._ctx.stat.audioCodec=this._audioCodec,this._audioCodecSwap=!0,this.emit(p.a.RETRY,{type:R.h.CODEC_AUDIO,message:"change audio codec: "+this._audioCodec+". video error: "+(null==(e=this._video.error)?void 0:e.code)}),v.b.i(Si,"recover swap audio codec"),this._reload(),0))},i._initSubtitle=function(){var e=this;this._trans&&(!this._subtitle&&fi&&(this._subtitle=new fi(this._ctx),this._subtitle.on(p.a.SUBTITLE_TRACK_SWITCHED,(function(t){e._trans&&(e._trans.setSubtitleTrack(t.level),e.emit(p.a.SUBTITLE_TRACK_SWITCHED,t))}))),this._subtitle&&this._subtitle.addTracks(this._ctx.lctx.subtitleTracks))},i._internalPause=function(){this._internalPauseFlag=!0,this._video.pause()},i._injectVideo=function(){var e=this;!this._nativeVideoFunc&&this._videoDecProxy&&(this._nativeVideoFunc={play:this._video.play,pause:this._video.pause},this._video.pause=function(){e._nativeVideoFunc.pause.call(e._video),e._videoDecProxy&&e._videoDecProxy.waiting&&e._videoDecProxy.isCanvasRenderer&&!e._internalPauseFlag&&(e._videoDecProxy.pausedOnWaiting=!0),e._internalPauseFlag=!1},this._video.play=function(){return e._videoDecProxy&&e._videoDecProxy.waiting&&e._videoDecProxy.isCanvasRenderer?(e._videoDecProxy.pausedOnWaiting=!1,new Promise((function(e,t){return e()}))):e._nativeVideoFunc.play.call(e._video)})},i._startFlvLiveRetryTimer=function(e,t){var i=this;this._flvLiveRetryTimer||(this._flvLiveRetryTimer=setTimeout((function(e){v.b.i(Si,"live retry:"+i._flvLiveRetry),i._flvLiveRetry++,i.emit(p.a.RETRY,{type:R.h.LIVE,message:"reason: "+(null==e?void 0:e.reason)+". retry: "+i._flvLiveRetry}),i._reload()}),e,t))},i._stopFlvLiveRetryTimer=function(){this._flvLiveRetryTimer&&(clearTimeout(this._flvLiveRetryTimer),this._flvLiveRetryTimer=void 0)},i._isSwitchLevelByReload=function(){return this._ctx.stat.box!==R.g.flv&&!$e(this._ctx.stat.box)},s()(t,[{key:"type",get:function(){return R.a.mse}}]),t}(Ai),xi="undefined"==typeof document?void 0:document.createElement("video"),Li={av1:['video/mp4; codecs="av01.0.15M.10,mp4a.40.2"'],hevc:['video/mp4; codecs="hev1.1.6.L150.90,mp4a.40.2"','video/mp4; codecs="hvc1.1.6.L150.90,mp4a.40.2"'],h264:['video/mp4; codecs="avc1.42E01E,mp4a.40.2"'],opus:['video/mp4; codecs="opus"'],mp3:['video/mp4; codecs="mp3"'],aac:['video/mp4; codecs="mp4a.40.2"']},Ci={mp4:["video/mp4","video/quicktime"],flv:["video/x-flv"],ts:["video/mp2t"],matroska:["video/x-matroska","video/webm"],hls:["application/vnd.apple.mpegURL","application/x-mpegURL"],hls_ts:["application/vnd.apple.mpegURL","application/x-mpegURL"],hls_fmp4:["application/vnd.apple.mpegURL","application/x-mpegURL"],aac:["audio/aac"],mp3:["audio/mpeg","audio/mp3"]},Di=function(){function e(){}return e.isMSEAvailable=function(){if(void 0!==e.MSE_AVAILABLE)return e.MSE_AVAILABLE;if(!Ri)return e.MSE_AVAILABLE=!1,!1;var t=G(),i=K();if(e.MSE_API_AVAILABLE=!!(t&&i&&i.prototype&&"function"==typeof i.prototype.appendBuffer&&"function"==typeof i.prototype.remove),t&&x.a.mobile&&e.MSE_API_AVAILABLE)try{var n=new t,r=document.createElement("video");r.src=URL.createObjectURL(n),URL.revokeObjectURL(r.src),e.MSE_AVAILABLE=!0}catch(t){e.MSE_AVAILABLE=!1}else e.MSE_AVAILABLE=e.MSE_API_AVAILABLE;return e.MSE_AVAILABLE},e.isSupported=function(t){return void 0===t&&(t=R.b.h264),e.isMSECodecSupported(t)&&e.isMSEAvailable()},e.isMSECodecSupported=function(t){if(void 0===t&&(t=R.b.h264),x.a.msedge||x.a.msie)return e.isMSEAvailable()&&t===R.b.h264;if(t===R.b.hevc&&!1===e.playHEVCTest)return!1;var i=Li[t];return!!i&&i.reduce((function(t,i){return t||e.isMSECodecStrSupported(i)}),!1)},e.isVideoCodecSupported=function(t){if(void 0===t&&(t=R.b.h264),x.a.msedge||x.a.msie)return t===R.b.h264;if(t===R.b.hevc&&!1===e.playHEVCTest)return!1;var i=Li[t];return!!i&&i.reduce((function(e,t){return e&&!(!xi||!xi.canPlayType(t))}),!0)},e.isVideoBoxSupported=function(e){if(void 0===e&&(e=R.g.mp4),e===R.g.unknown)return!0;var t=Ci[e];return!!t&&t.reduce((function(e,t){return e||!(!xi||!xi.canPlayType(t))}),!1)},e.isVideoCodecStrSupportedInMp4=function(e,t){return void 0===t&&(t=""),!(!xi||!xi.canPlayType((t||"video")+'/mp4;codecs="'+e+'"'))},e.isWebRTCSupported=function(){return"RTCPeerConnection"in window&&"RTCRtpTransceiver"in window},e.isMSECodecStrSupportedInMp4=function(e,t){var i;return void 0===t&&(t=""),!(null==(i=G())||!i.isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"'))},e.isMSECodecStrSupported=function(e){var t=G();return!(!t||"function"!=typeof t.isTypeSupported||!t.isTypeSupported(e))},e.isChangeTypeSupported=function(){if(void 0===e._changeTypeSupported){var t=K();e._changeTypeSupported=!(!t||void 0===t.prototype.changeType)}return e._changeTypeSupported},e.getVideoCodecCompatibilityByCodec=function(t){var i=R.c.unsupported,n=!0;t===R.b.h264?i=e.isMSECodecSupported(R.b.h264)?R.c.buildin:R.c.unsupported:t===R.b.av1?(i=e.isMSECodecSupported(R.b.av1)?R.c.buildin:R.c.unsupported,n=z()>=2):t!==R.b.hevc&&t!==R.b.kvc3&&t!==R.b.kvc4&&t!==R.b.kvc5||((i=t===R.b.hevc&&e.isMSECodecSupported(R.b.hevc)?R.c.buildin:R.c.unsupported)===R.c.unsupported&&"undefined"!=typeof WebAssembly?(i=WebAssembly?R.c.wasm:R.c.unsupported,n=e.wasmSmooth):(x.a.msedge&&(i=R.c.unsupported),n=z()>=2||x.a.safari));var r=!1;return i===R.c.buildin&&(r=e.isChangeTypeSupported(),t===R.b.hevc&&!1===this.playHEVCTest&&(i=R.c.wasm)),{decoder:i,smooth:i!==R.c.unsupported&&n,mix:r}},e._threads=function(){try{return"undefined"!=typeof WebAssembly&&"undefined"!=typeof MessageChannel&&(new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch(e){return!1}},e._simd=function(){return"undefined"!=typeof WebAssembly&&WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]))},s()(e,null,[{key:"isSupportSimd",get:function(){return void 0===e._isSupportSimd&&(e._isSupportSimd=e._simd()),e._isSupportSimd}},{key:"isSupportThreads",get:function(){return void 0===e._isSupportThreads&&(e._isSupportThreads=e._threads()),e._isSupportThreads}},{key:"wasmSmooth",get:function(){if(void 0===e._wasmSmooth){var t=z();e._wasmSmooth=!!(e.isSupportHW&&e.isSupportThreads&&t&&t>=6)}return e._wasmSmooth}},{key:"isSupportHW",get:function(){return!!Object(q.a)().performance}},{key:"playHEVCTest",get:function(){return this._playHEVCTest},set:function(e){this._playHEVCTest=e}}]),e}();Di._changeTypeSupported=void 0,Di.MSE_AVAILABLE=void 0,Di.MSE_API_AVAILABLE=void 0,Di._isSupportSimd=void 0,Di._isSupportThreads=void 0,Di._wasmSmooth=void 0,Di._playHEVCTest=void 0,Di.TYPE_SUPPORTED={mpeg:Di.isMSECodecStrSupported("audio/mpeg"),mp3:Di.isMSECodecSupported(R.b.mp3),opus:Di.isMSECodecSupported(R.b.opus),hevc:Di.isMSECodecSupported(R.b.hevc),av1:Di.isMSECodecSupported(R.b.av1)};var Ii,wi=Di,ki=i(41),Oi=function(){function e(e,t){var i=this;this._evt=void 0,this._ctx=void 0,this._decInline=void 0,this._decW=void 0,this._id=0,this._onWorkMessage=function(e){var t=e.data;i._onMessage(e.data.event,t.data)},this._onMessage=function(e,t){i._decW&&i._evt.emit(e,t)},this._evt=e,this._ctx=t}var t=e.prototype;return t.init=function(e){void 0===e&&(e=!0),v.b.i("dec-wrapper","init worker: "+e),e&&(this._decW=h()(48)),this._decW?this._decW.addEventListener("message",this._onWorkMessage):this._decInline=new ki.a(this._evt)},t.start=function(e,t,i,n,r){v.b.i("dec-wrapper","start"),this._decW?this._decW.postMessage({cmd:m.a.INIT_265,id:this._id,lib:e,config:this._ctx.config,simd:i,threads:t,codecType:n,decoderType:r}):this._decInline&&this._decInline.init(this._id,e,this._ctx.config,i,t,n,r)},t.destroy=function(){this._decW?(this._decW.postMessage({cmd:m.a.DESTROY}),this._decW.removeEventListener("message",this._onWorkMessage),this._decW.terminate()):this._decInline&&(this._decInline.destroy(),this._decInline=void 0)},t.append=function(e){this._decW?this._decW.postMessage({cmd:m.a.APPEND_DATA,data:e}):this._decInline&&this._decInline.appendData(e)},t.endOfData=function(){this._decW?this._decW.postMessage({cmd:m.a.END_OF_DATA}):this._decInline&&this._decInline.endOfData()},t.updateMediaInfo=function(e){this._decW?this._decW.postMessage({cmd:m.a.MEDIA_INFO,mediaInfo:e}):this._decInline&&this._decInline.updateMediaInfo(e)},t.reset=function(e){this._decW?this._decW.postMessage({cmd:m.a.RESET,decId:this._id,seeking:e}):this._decInline&&this._decInline.reset(this._id,e)},t.flush=function(e){this._decW?this._decW.postMessage({cmd:m.a.FLUSH,startTime:e}):this._decInline&&this._decInline.flush(e)},t.seek=function(e){this._decW?this._decW.postMessage({cmd:m.a.SEEK,time:e}):this._decInline&&this._decInline.seek(e)},t.update=function(e,t,i,n,r,a){this._decW?this._decW.postMessage({cmd:m.a.UPDATE_STATE,streamTime:e,output:t,active:i,frameBufLen:n,playbackRate:r,maxFrameBufLen:a}):this._decInline&&this._decInline.updateState(e,t,i,n,r,a)},s()(e,[{key:"id",get:function(){return this._id},set:function(e){this._id=e}},{key:"isUseingWorker",get:function(){return!!this._decW}}]),e}(),Ni=[4,2],Pi=[8,6,4,2];!function(e){e[e.data=0]="data",e[e.end=1]="end"}(Ii||(Ii={}));var Mi=function(e){function t(t){var i;return(i=e.call(this,t)||this)._initCache=[],i._d=void 0,i._audioSegmentCnt=0,i._decAppendActive=!0,i._libCacheHit=!1,i._activeTimes=[],i._state={streamTime:0,stoped:!1,output:R.o.canvas,decAppendActive:!0,frameBufLen:0,maxFrameBufLen:0},i._simdEnabled=void 0,i._threadsEnabled=void 0,i._codecType=R.b.hevc,i._decoderType=R.p.kw265,i._decId=1,i._lastDecoder=void 0,i._nextSeek=-1,i._libLoader=void 0,i._onDecLibLoaded=function(e){v.b.i("v-dec-proxy","dec lib loaded"),i.emit(p.a.DEC_LIB_LOADED,e),i._libCacheHit=e.hitCache,i._initDecoder(e.lib)},i._onDecImg=function(e){i._ctx.updateVideoPlaybackQuality(e.decoded,e.droped),e.decId===i._decId&&i._r.append(e.frame)},i._onDecSeek=function(e){v.b.i("v-dec-proxy","decoder seek event",e),e.hitCache&&(i._waiting=!1),e.hitCache||(i._reset(!0),i._updateState()),i._onSeeked(e)},i._onDecSeekAbort=function(e){if(v.b.i("v-dec-proxy","seek abort"),i._seeking=!1,-1!==i._nextSeek){var t=i._nextSeek;i._nextSeek=-1,i.seek(t)}},i._onDecVideoReady=function(e){i._waiting=!1,i.emit(p.a.DEC_VIDEO_READY),i._pausedOnWaiting=void 0},i._onDecWaiting=function(e){var t,n;null!=(t=i._ctx.video)&&t.ended||(i._bufRules.onWaiting(),i._waiting=!0,void 0===i._pausedOnWaiting&&(i._pausedOnWaiting=!(null==(n=i._ctx.video)||!n.paused)),i.emit(p.a.DECODER_WAITING,e))},i._onDecInitComplete=function(e){for(i._ready=!0,i._updateMediaInfo();i._initCache.length;){var t=i._initCache.shift();t&&(t.type===Ii.data?i._d.append(t.data):t.type===Ii.end&&i._d.endOfData())}i._ctx.stat.wasmSimd=e.simd,i._ctx.stat.wasmThreads=e.threads,i._ctx.stat.wasmDecoder=e.decoderType},i._onDecError=function(e){if(e.details===f.a.DECODER_INIT_ERROR&&(i._libCacheHit||i._threadsEnabled))return i._threadsEnabled&&(i._threadsEnabled=!1),void i._loadLib(!0);i.emit(p.a.ERROR,e)},i._onRenSeek=function(e){v.b.i("v-dec-proxy","renderer seek event",e),e.hitCache?(i._waiting=!1,i._onSeeked(e)):(i._onDecWaiting(),i._d.seek(e.time))},i._onRenExp=function(e){v.b.i("v-dec-proxy","renderer buf expired",e),i._r.flush(0)},i._onRenBufUpdate=function(e){i._decAppendActive=!!e.needMore},i._libLoader=new W(i._ctx.config),i._libLoader.on(p.a.DEC_LIB_LOADED,i._onDecLibLoaded),i._libLoader.on(p.a.ERROR,(function(e){return i.emit(p.a.ERROR,e)})),i._state.maxFrameBufLen=i._bufRules.maxFrameBufLen,i._simdEnabled=wi.isSupportSimd,i._threadsEnabled=!!(wi.isSupportThreads&&i._ctx.config.maxVideoDecThreads>1),i._d=new Oi(i._evt,t),i._d.id=i._r.id=i._decId,i}_()(t,e);var i=t.prototype;return i.init=function(e,t){var i=this;v.b.i("v-dec-proxy","init codecType: "+e+" bitDepth: "+t),e&&(this._codecType=e),e===R.b.kvc3?this._decoderType=R.p.kvc3:e===R.b.kvc4?this._decoderType=R.p.kvc4:e===R.b.kvc5?this._decoderType=R.p.kvc5:e===R.b.hevc&&(this._decoderType=R.p.kw265,t&&t>8&&(this._decoderType=R.p.h265));var n=this._evt;n.on(p.a.DEC_INIT_COMPLETE,this._onDecInitComplete),n.on(p.a.DECODER_IMG,this._onDecImg),n.on(p.a.DEC_VIDEO_READY,this._onDecVideoReady),n.on(p.a.STEP,(function(e){return i.emit(p.a.STEP,e)})),n.on(p.a.DECODER_SEEK,this._onDecSeek),n.on(p.a.DECODER_SEEK_ABORT,this._onDecSeekAbort),n.on(p.a.DECODER_WAITING,this._onDecWaiting),n.on(p.a.DECODER_DATA_END,(function(){return i._r.endOfData()})),n.on(p.a.DECODER_DROP_FRAME,(function(e){return i._r.dropFrame(e)})),n.on(p.a.RENDERER_BUF_UPDATE,this._onRenBufUpdate),n.on(p.a.RENDERER_BUF_EXPIRED,this._onRenExp),n.on(p.a.RENDERER_SEEK,this._onRenSeek),n.on(p.a.ERROR,this._onDecError),this._r.id=this._decId,this._r.init(x.a.chrome&&!1===this._ctx.stat.mainThreadRendering),this._d.init(),this._loadLib()},i.setMediaInfo=function(t){e.prototype.setMediaInfo.call(this,t),this._updateMediaInfo()},i.destroy=function(){this._d.destroy(),e.prototype.destroy.call(this)},i.appendData=function(e){this._ready?this._d.append(e):this._initCache.push({type:Ii.data,data:e})},i.endOfData=function(){v.b.i("v-dec-proxy","endOfData"),this._ready?this._d.endOfData():this._initCache.push({type:Ii.end})},i.decoderChange=function(e,t){v.b.i("v-dec-proxy","decoderChange type: "+e+" time: "+t),this._lastDecoder=e;var i=this._activeTimes;e===R.c.wasm?(!i.length||i.length&&-1!==i[i.length-1].end)&&i.push({start:t,end:-1}):e===R.c.buildin&&i.length&&-1===i[i.length-1].end&&(i[i.length-1].end=t)},i.onParsingData=function(e){var t=this;e.segments.forEach((function(e){e.type===R.l.AUDIO&&t._audioSegmentCnt++}))},i.seek=function(e){v.b.i("v-dec-proxy","seek: "+e+" "+this._seeking),this._seeking?this._nextSeek=e:(this._seeking=!0,this._r.seek(e),this.start())},i.seekWithLoad=function(e){v.b.i("v-dec-proxy","seekWithLoad: "+e),this._ready?(this._reset(!0),this._updateState()):this._initCache=[]},i.flush=function(e){void 0===e&&(e=0),v.b.i("v-dec-proxy","flush"),e?(this._d.flush(e),this._r.flush(e)):this._reset(!1)},i._updateState=function(){var e=this._ctx.cOutput.canvas;if(e instanceof HTMLCanvasElement){var t,i,n=this._ctx.currentTime,r=!(null==(t=this._ctx.video)||!t.ended),a=(null==(i=this._ctx.video)?void 0:i.playbackRate)||1,s=this.isCanvasRenderer?R.o.canvas:R.o.video,o=!1,c=this._checkResize(e),_=this._decAppendActive,d=this._state;if(d.output!==s&&(d.output=s,o=!0,this.emit(p.a.VIDEO_RENDERER_CHANGE,{type:d.output,canvas:e,enabled:!0})),0!==n||this._audioSegmentCnt||(n=-1),d.streamTime===n&&d.stoped===r&&d.decAppendActive===_&&d.frameBufLen===this._r.frameBufLen&&d.maxFrameBufLen===this._bufRules.maxFrameBufLen||(d.streamTime=n,d.stoped=r,d.decAppendActive=_,d.frameBufLen=this._r.frameBufLen,d.maxFrameBufLen=this._bufRules.maxFrameBufLen,o=!0),!o&&!this._waiting&&!c)return;(o||this._waiting)&&this._d.update(n,s,_,this._r.frameBufLen,a,d.maxFrameBufLen),(o||c)&&this._r.update(n,this._size.w,this._size.h,r,s,d.maxFrameBufLen)}},i._updateMediaInfo=function(){if(this._mediaInfo.length&&this._ready){var e=this._mediaInfo.shift();this._d.updateMediaInfo(e),this._r.updateMediaInfo(e)}},i._reset=function(e){void 0===e&&(e=!1),this._decId++,this._decAppendActive=!0,this._audioSegmentCnt=0,this._activeTimes=[],e||(this._seeking=!1,this._nextSeek=-1),this._lastDecoder===R.c.wasm&&this._activeTimes.push({start:0,end:-1}),this._d.id=this._r.id=this._decId,this._d.reset(e),this._r.reset(e),this._waiting=!0},i._loadLib=function(e){void 0===e&&(e=!1),void 0===this._simdEnabled||void 0===this._threadsEnabled?(this._simdEnabled=!!wi.isSupportSimd,this._threadsEnabled=!!(wi.isSupportThreads&&this._ctx.config.maxVideoDecThreads>1),this._libLoader.load(e,this._decoderType,this._simdEnabled,this._threadsEnabled)):this._libLoader.load(e,this._decoderType,this._simdEnabled,this._threadsEnabled)},i._initDecoder=function(e){v.b.i("v-dec-proxy","init dec"),this.start();var t=this._threadsEnabled?this._getThreadNum():1;this._d.id=this._decId,this._d.start(e,t,!!this._simdEnabled,this._codecType,this._decoderType)},i._getThreadNum=function(){var e=Math.min(z(),this._ctx.config.maxVideoDecThreads),t=Pi;this._decoderType===R.p.kw265&&(t=Ni);for(var i=0;i<t.length;i++)if(e>=t[i])return t[i];return t[t.length-1]},i._onSeeked=function(e){if(v.b.i("v-dec-proxy","seeked"),this._seeking=!1,-1===this._nextSeek)this.emit(p.a.DECODER_SEEK,e);else{var t=this._nextSeek;this._nextSeek=-1,this.seek(t)}},s()(t,[{key:"isCanvasRenderer",get:function(){var e=this._activeTimes.length;if(e)for(var t=this._ctx.currentTime,i=e-1;i>=0;i--)if(t>=this._activeTimes[i].start&&(t<this._activeTimes[i].end||-1===this._activeTimes[i].end))return!0;return!1}}]),t}(b),Vi={alwaysSeekKeyframe:!1,lazyLoadMaxDuration:-1,lazyLoadRecoverDuration:20,webWorker:!0,appendErrorMaxRetry:3,credentials:!1,streamingMux:!0,autoPlaybackRate:!0,autoPlaybackRateConf:void 0,enableSoftwareAES:!0,startPlayBufferSec:0,startFromSec:0,startFromKeyframe:!0,defaultSpts:-5e3,kwaiKernelLog:v.a.LEVEL_ERROR,retryWithBackup:!0,resourceBuffer:!0,resourceBufferSize:500,ntp:!0,ensureAudio:!0,ensureVideo:!1,adaptive:!0,abrSpeedTest:!0,httpRangeType:R.d.STANDARD,maxAudioFramesDrift:5,forceKeyFrameOnDiscontinuity:!1,videoDropFramePolicy:R.n.AUTO,videoDecBlockPolicy:R.m.WAITING,videoFrameBufferSize:536870912,maxVideoDecThreads:8,mainThreadRendering:!1,wasmDecoderEnabled:!0,maxRetry:3,connectionTimeout:1e4,transmissionTimeout:3e4,retryDelay:2e3,maxFragFailSec:11,flvLoadEndError:!0,catchUpPausedLive:!0,breakpointContinuation:!0,manifestLoadingMaxRetry:3,manifestConnectionTimeout:1e4,manifestTransmissionTimeout:1e4,manifestLoadingRetryDelay:1,levelLoadingMaxRetry:3,levelConnectionTimeout:1e4,levelTransmissionTimeout:1e4,levelLoadingRetryDelay:100,emeEnabled:!0,widevineLicenseUrl:"",playreadyLicenseUrl:"",fairplayLicenseUrl:"",keyLoadingMaxRetry:3,keyConnectionTimeout:1e4,keyTransmissionTimeout:5e3,keyLoadingRetryDelay:300,sdpConnectionTimeout:1e4,peerConnectionTimeout:1e4,peerConnectionMaxRetry:5,peerConnectionRetryDelay:3e3,decLibLoadingMaxRetry:2,decLibConnectionTimeout:5e3},Fi={maxRetry:1,retryDelay:100,connectionTimeout:1e4,levelConnectionTimeout:1e4,manifestConnectionTimeout:1e4},Ui={startDelay:10,interval:.6,rule:[{rate:1.25,lower:27,upper:Number.MAX_SAFE_INTEGER},{rate:1.1,lower:17,upper:21},{rate:1,lower:5,upper:11}]},Bi=function(){function e(){}return e.isStreamingSupported=function(){return void 0===e._streamingSupported&&(e._streamingSupported=k.isSupported()||!!N.isSupportChunk()),e._streamingSupported},e.processConfig=function(e){if(e){var t=e.src;(e=JSON.parse(JSON.stringify(e))).src=t}e.isLive?Vi.videoFrameBufferSize=104857600:Vi.videoFrameBufferSize=536870912;var i=$e(e.box)?r()({},Vi,Fi):r()({},Vi);return r()(i,e),i.wasmDecoderEnabled=i.wasmDecoderEnabled&&!!Mi,i.startPlayBufferSec=Math.min(5,Math.max(0,i.startPlayBufferSec)),this._initPlayBackRateRule(i),Worker||(i.webWorker=!1),i},e._initPlayBackRateRule=function(e){var t=e.autoPlaybackRateConf;if(t){var i=t.rule;if(i&&Array.isArray(i)&&((i=i.filter((function(e){return e.upper>e.lower&&e.rate>0}))).sort((function(e,t){return t.rate-e.rate})),i.length>1))return t.rule=i,void(e.autoPlaybackRateConf=t)}else{var n=-e.defaultSpts/1e3,r={startDelay:n,interval:.6,rule:[{rate:1.5,lower:n+7,upper:Number.MAX_SAFE_INTEGER},{rate:1.25,lower:n+4,upper:n+6},{rate:1.1,lower:n+1,upper:n+3},{rate:1,lower:0,upper:n}]};e.autoPlaybackRateConf=e.adaptive&&e.box===R.g.flv?r:Ui}},e}();Bi._streamingSupported=void 0;var Hi,ji=function(){function e(){this._lastDroppedFrames=0,this._lastDecodedFrames=0,this._lastTime=0,this._decoded=0,this._dropped=0}var t=e.prototype;return t.reset=function(){this._lastTime=performance.now(),this._lastDroppedFrames=this._lastDecodedFrames=this._decoded=this._dropped=0},t.getFPS=function(e){if(e){var t,i=performance.now(),n=e.totalVideoFrames,r=e.droppedVideoFrames;if(n){n<this._lastDecodedFrames&&(this._lastDecodedFrames=0,this._lastDroppedFrames=0);var a=i-this._lastTime,s=r-this._lastDroppedFrames,o=n-this._lastDecodedFrames,c=0,_=0;this._lastTime&&(c=parseFloat((1e3*s/a).toFixed(2)),_=parseFloat((1e3*o/a).toFixed(2))),this._decoded=this._decoded+=o,this._dropped=this._dropped+=s,this._lastTime=i,this._lastDroppedFrames=r,this._lastDecodedFrames=n,t={decoded:this._decoded,dropped:this._dropped,decodedFPS:_,droppedFPS:c}}return this._lastTime=i,t}},e}(),Wi=function(){function e(){this._traffic=0,this._streams=[],this._download=[],this._speed=0,this._trafficGroupedByVCodecType={},this._trafficGroupedByLevel={},this._currentLoad=void 0,this._contentLen=0}var t=e.prototype;return t.onStreamOpen=function(e,t,i,n){if(this._streams.length>10){var r=this._streams.shift();if(r){this._trafficGroupedByVCodecType[r.vCodecType]=(this._trafficGroupedByVCodecType[r.vCodecType]||0)+r.traffic;var a=r.qualityType||r.bitrate;this._trafficGroupedByLevel[a]=(this._trafficGroupedByLevel[a]||0)+r.traffic}}var s=this._currentLoad?this._currentLoad.index+1:0;this._currentLoad={index:s,startPos:e,url:t,bitrate:i,qualityType:n,traffic:0,loadTimeCost:0,keyFrame:0,videoDataRate:0,audioDataRate:0,speed:0,vCodecType:R.b.unknown,segments:[]},this._streams.push(this._currentLoad)},t.onMediaInfo=function(e){var t=this._streams[this._streams.length-1];t&&(e.videoCodecType&&(t.vCodecType=e.videoCodecType),t.mediaInfo=r()({},e))},t.setRTCStats=function(e){var t=this._currentLoad;t&&(t.traffic=e.totalReceive,t.audioDataRate=e.audioDataRate,t.videoDataRate=e.videoDataRate,t.speed=e.speed,t.keyFrame=e.key,this._traffic=t.traffic,this._speed=e.speed)},t.onDataReceive=function(e){this._traffic+=e.byteLength;var t=this._download;t.length>200&&t.pop(),t.unshift(e);var i=this._currentLoad;i&&(i.traffic+=e.byteLength,i.loadTimeCost+=e.timeCost,i.speed=Math.round(i.traffic/i.loadTimeCost*1e3)||0)},t.onMediaSegment=function(e){this._calculateDataRate(e.type,1e3*(e.endDTS-e.startDTS),e.payload.byteLength)},t.onRaw=function(e){if(e.samples.length){var t=e.samples.reduce((function(e,t){return t.yuv?e+t.yuv.y.bytes.length+t.yuv.u.bytes.length+t.yuv.v.bytes.length:e+t.units.reduce((function(e,t){return e+t.data.byteLength}),0)}),0),i=e.samples[e.samples.length-1].dts-e.samples[0].dts+(e.samples[e.samples.length-1].duration||0);this._calculateDataRate(R.l.VIDEO,i/90,t)}},t.downloadSpeedByRange=function(e){if(void 0===e&&(e=1e3),this._download.length){for(var t=performance.now(),i=0,n=0,r=0;r<this._download.length&&this._download[r].ts>t-e;r++)i+=this._download[r].byteLength,n+=this._download[r].timeCost;this._speed=Math.round(i/n*1e3)||0}return this._speed},t._calculateDataRate=function(e,t,i){var n=this._streams[this._streams.length-1],r=n.segments;r.push({type:e,duration:t,byteLength:i}),r.length>200&&r.shift();for(var a=0,s=0,o=0;o<r.length;o++)r[o].type===e&&(s+=r[o].byteLength,a+=r[o].duration);a>0&&(e===R.l.VIDEO?n.videoDataRate=Math.round(8*s/a):e===R.l.AUDIO&&(n.audioDataRate=Math.round(8*s/a)))},s()(e,[{key:"smoothedDownloadSpeed",get:function(){return 1e3*this._download.reduceRight((function(e,t){var i=t.byteLength/t.timeCost;return e>0?i*(1-.9)+.9*e:i}),0)}},{key:"trafficGroupedByVCodecType",get:function(){var e=r()({},this._trafficGroupedByVCodecType);return e.total=this._traffic,this._streams.forEach((function(t){e[t.vCodecType]=(e[t.vCodecType]||0)+t.traffic})),e}},{key:"trafficGroupedByLevel",get:function(){var e=r()({},this._trafficGroupedByLevel);return e.total=this._traffic,this._streams.forEach((function(t){var i=t.qualityType||t.bitrate;e[i]=(e[i]||0)+t.traffic})),e}},{key:"traffic",get:function(){return this._traffic}},{key:"speed",get:function(){return this._speed}},{key:"currentLoad",get:function(){return this._currentLoad}},{key:"streams",get:function(){return this._streams}},{key:"contentLen",get:function(){return this._contentLen},set:function(e){this._contentLen=e}}]),e}(),zi=i(21),Gi=new RegExp("_([0-9]+)x([0-9]+)(_([0-9]+))?(_([0-9]+))?(_(420|422|444|mono))?"),Ki=["mono","420","422","444"],Yi=i(32),Xi=function(){function e(e){this._abr=!1,this._startIdx=0,this._currentIdx=0,this._nextIdx=0,this._levels=[],this._audioIdx=0,this._audioTracks=[],this._subtitleIdx=0,this._subtitleTracks=[],this._abrLevels=[],this._default=void 0,this._availableList=void 0,this._startIdx=e?-1:0,this._abr=e}var t=e.prototype;return t.getLevel=function(e){return void 0===e&&(e=R.e.MAIN),e===R.e.MAIN?this._levels[this._currentIdx]:e===R.e.AUDIO?this._audioTracks[this._audioIdx]:e===R.e.SUBTITLE?this._subtitleTracks[this._subtitleIdx]:void 0},t.setLevelIdx=function(e,t){void 0===t&&(t=R.e.MAIN),t===R.e.MAIN?this.currentIdx=e:t===R.e.AUDIO?this.audioIdx=e:t===R.e.SUBTITLE&&(this.subtitleIdx=e)},t.getLevelIdx=function(e){return void 0===e&&(e=R.e.MAIN),e===R.e.MAIN?this._currentIdx:e===R.e.AUDIO?this._audioIdx:e===R.e.SUBTITLE?this._subtitleIdx:-1},t.setNextIdx=function(e,t){void 0===t&&(t=R.e.MAIN),t===R.e.MAIN&&(this.nextIdx=e)},t.getNextIdx=function(e){return void 0===e&&(e=R.e.MAIN),e===R.e.MAIN?this._nextIdx:-1},t.abrIndexToOrign=function(e){var t=this._abrLevels[e];return t?t.index:0},t.orignIndexToAbr=function(e){var t=0;return this._abrLevels.forEach((function(i,n){i.index!==e||(t=n)})),t},t._generateAbrList=function(){var e=this,t=this._availableList;this._default=0,this._abrLevels=[],this._levels.forEach((function(i,n){i.default&&!t&&(e._default=n),i.enableAdaptive&&(!t||t&&-1!==t.indexOf(n))&&e._abrLevels.push(i)})),this._abrLevels.sort((function(e,t){return e.bitrate-t.bitrate}))},s()(e,[{key:"abr",get:function(){return this._abr},set:function(e){this._abr=e}},{key:"startIdx",get:function(){return this._startIdx},set:function(e){this._startIdx=e}},{key:"currentIdx",get:function(){return this._currentIdx},set:function(e){e>=0&&(this._currentIdx=e)}},{key:"nextIdx",get:function(){return this._nextIdx},set:function(e){e>=0&&(this._nextIdx=e)}},{key:"levels",get:function(){return this._levels},set:function(e){this._levels=e,this._generateAbrList()}},{key:"current",get:function(){return this._levels[this._currentIdx]}},{key:"currentUrl",get:function(){var e=this._levels[this._currentIdx];return e?e.url[e.urlId]:""}},{key:"audioIdx",get:function(){return this._audioIdx},set:function(e){e>=0&&(this._audioIdx=e)}},{key:"audioTracks",get:function(){return this._audioTracks},set:function(e){this._audioTracks=e}},{key:"audio",get:function(){return this._audioTracks[this._audioIdx]}},{key:"subtitleIdx",get:function(){return this._subtitleIdx},set:function(e){e>=0&&(this._subtitleIdx=e)}},{key:"subtitleTracks",get:function(){return this._subtitleTracks},set:function(e){this._subtitleTracks=e}},{key:"subtitle",get:function(){return this._subtitleTracks[this._subtitleIdx]}},{key:"abrLevels",get:function(){return this._abrLevels}},{key:"availableList",set:function(e){this._availableList=e,this._generateAbrList()}},{key:"default",get:function(){return this._default||0},set:function(e){this._default=e}},{key:"abrDefault",get:function(){var e=0;return this._abrLevels.forEach((function(t,i){t.default&&(e=i)})),e}}]),e}(),qi=function(){function e(e,t){this.video=void 0,this.mse=void 0,this.stat=void 0,this.loadRec=void 0,this.lctx=void 0,this.localTimeOffset=void 0,this._src=void 0,this._originSrc=void 0,this._config=void 0,this._cOutput=void 0,this._liveDelay=new vt,this._fps=new ji,this._yuvParams=void 0,this.video=t,this.lctx=new Xi(!0),this._setConfig(Bi.processConfig(e))}var t=e.prototype;return t.destroy=function(){v.b.i("av-ctx","destroy"),this._destroyLevels(),this._destroyCanvasOutput(),this._liveDelay.destroy()},t.getNewCtx=function(){return new e(this._config)},t.updateVideoPlaybackQuality=function(e,t){this.stat.videoPlaybackQuality?(this.stat.videoPlaybackQuality.droppedVideoFrames=t,this.stat.videoPlaybackQuality.totalVideoFrames=e):this.stat.videoPlaybackQuality={corruptedVideoFrames:0,creationTime:0,droppedVideoFrames:t,totalVideoFrames:e}},t.isTimeinBuffered=function(e){if(this.video)for(var t=this.video.buffered,i=0;i<t.length;i++)if(e>=t.start(i)&&e<t.end(i))return!0;return!1},t.currentBuffer=function(e){if(this.video)for(var t=this.video.buffered,i=0;i<t.length;i++){var n=t.start(i),r=t.end(i);if(n<=e&&e<r)return{start:n,end:r}}},t.nextBuffer=function(e){if(this.video)for(var t=this.video.buffered,i=0;i<t.length;i++){var n=t.start(i),r=t.end(i);if(n>e)return{start:n,end:r}}},t.getLocalTime=function(e){return"number"==typeof this.localTimeOffset?e-this.localTimeOffset:void 0},t.getStreamTime=function(e){return"number"==typeof this.localTimeOffset?e+this.localTimeOffset:void 0},t.getRemuxConfig=function(){return{kwaiKernelLog:this._config.kwaiKernelLog,enableSoftwareAES:this._config.enableSoftwareAES,gopRemux:this.stat.gopRemux,preferDecoder:this.config.preferDecoder,streamingMux:this.stat.streamingMux,ensureAudio:this.config.ensureAudio,ensureVideo:this.config.ensureVideo,maxAudioFramesDrift:this.config.maxAudioFramesDrift,forceKeyFrameOnDiscontinuity:this.config.forceKeyFrameOnDiscontinuity,wasmDecoderEnabled:this.config.wasmDecoderEnabled}},t.getRetryCnt=function(e){return this.stat.retryInfos.reduce((function(t,i){return Array.isArray(e)?t+(e.indexOf(i.type)>=0?1:0):t+(i.type===e?1:0)}),0)},t.setSrc=function(e,t){e&&(this._resetStat(),this._yuvParams=void 0,this.loadRec=new Wi),this._processSrc(e,t)},t.reProcessSrc=function(e){this._originSrc&&this._processSrc(this._originSrc,e)},t._setConfig=function(e){this._config=e,this._resetStat(),this._yuvParams=void 0,this.stat.startFromSec=e.startFromSec||(e.startFrom||0)/1e3,this.stat.webWorker=e.webWorker,e.lazyLoadMaxDuration>0&&e.lazyLoadRecoverDuration>0&&e.lazyLoadMaxDuration>=e.lazyLoadRecoverDuration&&(this.stat.lazyLoadMaxDuration=e.lazyLoadMaxDuration,this.stat.lazyLoadRecoverDuration=e.lazyLoadRecoverDuration),this.loadRec=new Wi,e.src&&this._processSrc(e.src)},t._resetStat=function(){v.b.i("av-ctx","reset stat");var e=this._config,t=this.stat||{},i=x.a.safari&&!e.isLive||x.a.opera&&x.a.version.major<37,n=!(!e.streamingMux||!Bi.isStreamingSupported()||x.a.msie||x.a.safari&&e.isLive||x.a.msedge&&e.isLive);t.isLive=e.isLive,t.native=e.nativeFirst,t.coreType=R.a.unknown,t.codecType=R.b.unknown,t.streamingMux=n,t.gopRemux=i,t.audioCodec="",t.box=R.g.unknown,t.autoLazyLoad=!0,t.firstFrameLoaded=!1,t.isNetworkInUse=!1,t.srcType=R.i.OTHERS,t.retryInfos=[],t.decoder=R.c.buildin,t.lazyLoadMaxDuration=14,t.lazyLoadRecoverDuration=.8*t.lazyLoadMaxDuration,t.drm=t.hasVideo=t.hasAudio=t.isPreload=t.videoPlaybackQuality=t.mixContainerInput=t.mixCodecInput=t.mixCodecAvailable=t.mixQualityList=t.multipart=t.stereoType=t.mainThreadRendering=t.wasmDecoder=t.wasmSimd=t.wasmThreads=t.fallback264=void 0,this.stat=t},t._processSrc=function(e,t){var i;e&&(this._originSrc=this._src=e);var n=this.config,r=this.stat,a=ct.preParse(this._src,n.mixManifestEnabled,n.nativeFirst,t);this._src=a.src,this._src&&(this._cOutput&&this._cOutput.reset(),this.stat.srcType===R.i.FILE&&this._destroyLevels(),this.lctx=new Xi(n.adaptive),r.codecType=a.codecType?a.codecType:R.b.unknown,r.box=n.box||a.box||R.g.unknown,r.srcType=a.srcType,r.mixContainerInput=a.mixContainerInput,r.mixCodecInput=a.mixCodecInput,r.mixCodecAvailable=a.mixCodecAvailable,r.mixQualityList=a.mixQualityList,r.multipart=a.multipart,r.stereoType=null==(i=a.mediaLevels)?void 0:i.stereoType,n.liveDelayFragNum&&n.liveDelayFragNum>0&&(r.multipartLiveDelay=-1e4*n.liveDelayFragNum),void 0!==a.nativeFirst&&(r.native=a.nativeFirst),"boolean"==typeof a.isLive&&(r.isLive=a.isLive),!a.mediaLevels||a.srcType===R.i.OTHERS&&$e(r.box)&&!r.native||(r.hasAudio=a.mediaLevels.hasAudio,r.hasVideo=a.mediaLevels.hasVideo,r.drm=a.mediaLevels.drm,this.lctx.levels=a.mediaLevels.levels,this.lctx.default=this.lctx.currentIdx=a.mediaLevels.def,a.mediaLevels.audioTracks&&(this.lctx.audioTracks=a.mediaLevels.audioTracks,this.lctx.audioIdx=a.mediaLevels.defAudio||0),a.mediaLevels.subtitleTracks&&(this.lctx.subtitleTracks=a.mediaLevels.subtitleTracks,this.lctx.subtitleIdx=a.mediaLevels.defSubtitle||0)),a.box===R.g.yuv&&(this._yuvParams=function(e){if(e){var t=e.match(Gi);if(t&&t.length>2){var i=parseInt(t[1]),n=parseInt(t[2]),r=t[4]?parseInt(t[4]):Z.d,a=t[6]?parseInt(t[6]):8,s=zi.a.AV_PIX_FMT_YUV420P;if(t[8]){var o=Ki.indexOf(t[8]);-1!==o&&(s=o)}var c=-1===[zi.a.AV_PIX_FMT_YUV420P,zi.a.AV_PIX_FMT_YUV422P].indexOf(s)?i:i/2,_=s===zi.a.AV_PIX_FMT_YUV420P?n/2:n;return{width:i,height:n,chroma:zi.a.AV_PIX_FMT_YUV420P,chromaWidth:c,chromaHeight:_,cropLeft:0,cropTop:0,cropWidth:i,cropHeight:n,displayWidth:i,displayHeight:n,pts:0,fps:r,bpp:a,dataSize:(i*n+c*_*2)*(a>8?2:1)}}}}(a.src instanceof File?a.src.name:this.lctx.currentUrl)),v.b.i("av-ctx","set src:"+r.box+" live: "+r.isLive+" mobile: "+!!x.a.mobile+" gopRemux: "+r.gopRemux+" streamingMux "+r.streamingMux))},t._destroyLevels=function(){this.lctx&&this.lctx.levels.forEach((function(e){e.url.forEach((function(e){0===e.indexOf("blob:")&&URL.revokeObjectURL(e)}))}))},t._destroyCanvasOutput=function(){this._cOutput&&(this._cOutput.destroy(),this._cOutput=void 0)},s()(e,[{key:"yuvParams",get:function(){return this._yuvParams}},{key:"canCodecFallback",get:function(){return!(!this.stat.mixCodecInput||this.stat.codecType===R.b.h264||-1===this.stat.mixCodecInput.indexOf(R.b.h264)||this.stat.decoder!==R.c.buildin)}},{key:"fps",get:function(){return this._fps}},{key:"liveDelay",get:function(){return this._liveDelay}},{key:"cOutput",get:function(){return this._cOutput||(this._cOutput=new Yi.a),this._cOutput}},{key:"isAbrAvailable",get:function(){return this._config.adaptive&&this.lctx.levels.length>1&&!this.stat.isPreload}},{key:"mediaBufferedSec",get:function(){return this.video&&this.video.buffered&&this.video.buffered.length?{start:this.video.buffered.start(0),end:this.video.buffered.end(this.video.buffered.length-1)}:{start:0,end:0}}},{key:"bufferedEnd",get:function(){return this.video&&this.video.buffered.length?this.video.buffered.end(this.video.buffered.length-1):0}},{key:"bufferedSec",get:function(){return this.video&&this.video.buffered.length>0?Math.max(0,this.video.buffered.end(this.video.buffered.length-1)-this.video.currentTime):0}},{key:"bufferSliceNum",get:function(){return this.video?this.video.buffered.length:0}},{key:"currentTime",get:function(){return this.video?this.video.currentTime:0}},{key:"playbackRate",get:function(){return this.video?this.video.playbackRate:1}},{key:"config",get:function(){return this._config}},{key:"src",get:function(){return this._src}},{key:"originSrc",get:function(){return this._originSrc}},{key:"videoPlaybackQuality",get:function(){return this.stat.videoPlaybackQuality?this.stat.videoPlaybackQuality:this.video?void 0!==this.video.getVideoPlaybackQuality?this.video.getVideoPlaybackQuality():{corruptedVideoFrames:0,creationTime:0,droppedVideoFrames:this.video.webkitDecodedFrameCount||0,totalVideoFrames:this.video.webkitDroppedFrameCount||0}:void 0}},{key:"demuxerType",get:function(){return this.stat.demuxerType},set:function(e){var t=this.stat;if(e!==t.demuxerType){var i=void 0===t.box||t.box===R.g.unknown;e===Ht.b.RAW?(t.box=R.g.raw,t.isLive=!1):e===Ht.b.FLV?(t.box=R.g.flv,t.multipart&&(t.isLive=!1)):e===Ht.b.MP4||e===Ht.b.FMP4?(i&&(t.box=R.g.mp4),t.multipart||(t.isLive=!1)):e===Ht.b.TS?i&&(t.box=R.g.ts):e===Ht.b.IVF&&(t.box=R.g.ivf,t.isLive=!1),t.demuxerType=e}}}],[{key:"packName",get:function(){return"es"}},{key:"version",get:function(){return"3.2.29-alpha.1"}}]),e}();!function(e){e.METADATA="metadata",e.MEDIA_INFO="mediaInfo",e.HEARTBEAT="heartbeat",e.DOWNLOAD="download",e.REALTIME_BEACON="realtimeBeacon",e.DISCONTINUITY="discontinuity"}(Hi||(Hi={}));var Zi,Qi=i(30),Ji=i.n(Qi);function $i(){for(var e=document,t=0,i=["hidden","webkitHidden","mozHidden"];t<i.length;t++){var n=i[t];if(n in e)return e[n]}return null}var en=new Uint8Array(16);function tn(){if(!Zi&&!(Zi="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Zi(en)}for(var nn=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,rn=function(e){return"string"==typeof e&&nn.test(e)},an=[],sn=0;sn<256;++sn)an.push((sn+256).toString(16).substr(1));var on,cn,_n,dn,un=function(e,t,i){var n=(e=e||{}).random||(e.rng||tn)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){i=i||0;for(var r=0;r<16;++r)t[i+r]=n[r];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=(an[e[t+0]]+an[e[t+1]]+an[e[t+2]]+an[e[t+3]]+"-"+an[e[t+4]]+an[e[t+5]]+"-"+an[e[t+6]]+an[e[t+7]]+"-"+an[e[t+8]]+an[e[t+9]]+"-"+an[e[t+10]]+an[e[t+11]]+an[e[t+12]]+an[e[t+13]]+an[e[t+14]]+an[e[t+15]]).toLowerCase();if(!rn(i))throw TypeError("Stringified UUID is invalid");return i}(n)},ln=/\/([A-Za-z0-9]+)[_A-Za-z0-9]*.flv/,hn="",fn="";function pn(){return on||(on={support_mse:wi.isMSEAvailable()?1:0,support_aac:wi.isVideoCodecSupported(R.b.aac)?1:0,support_h264:wi.isVideoCodecSupported(R.b.h264)?1:0,support_h265_mse:wi.isMSECodecSupported(R.b.hevc)?1:0,support_h265:wi.isVideoCodecSupported(R.b.hevc)?1:0,support_av1_mse:wi.isMSECodecSupported(R.b.av1)?1:0,support_simd:wi.isSupportSimd?1:0,support_thread:wi.isSupportThreads?1:0,support_hw:wi.isSupportHW?1:0,support_change_type:wi.isChangeTypeSupported()?1:0,support_streaming:Bi.isStreamingSupported()?1:0,hardware_concurrency:z()||0,wasm_dec_smooth:wi.wasmSmooth?1:0}),on}function mn(e){return{session_id:e.sessionId,kernel_version:qi.version,pack_name:qi.packName}}function vn(e,t){var i,n,a,s,o=null==(i=e.video)?void 0:i.duration,c=e.lctx.current,_=(null==c?void 0:c.currentUrl)||"",d=r()({play_url:_,url_id:(null==c?void 0:c.urlId)||0,stream_host:_?new S.a(_).host:"",reuse:t.reuse,load_start_time:t.loadStartTime,play_start_time:t.playStartTime,stream_duration:Math.round(1e3*(o&&Object(ee.a)(o)?o:0)),max_bitrate:(null==c?void 0:c.maxBitrate)||0,codec:t.codecs,play_pos:t.playPos||0,v_data_rate:Math.round((null==(n=e.loadRec.currentLoad)?void 0:n.audioDataRate)||0),a_data_rate:Math.round((null==(a=e.loadRec.currentLoad)?void 0:a.videoDataRate)||0),drm:e.stat.drm?1:0,adaptive_multi_rate:e.lctx.abr?1:0,use_backup:t.useBackup,play_to_end:t.playToEnd,v_decoder:e.stat.decoder,video_codec_type:e.stat.codecType||R.b.unknown,start_codec:t.startCodec,demuxer:e.stat.demuxerType||Ht.b.UNKNOWN,core_type:e.stat.coreType,box:e.stat.box},mn(t),(s=e.video)?{elem_crossorigin:s.crossOrigin,elem_autoplay:s.autoplay?1:0,elem_loop:s.loop?1:0,elem_volume:s.volume,elem_muted:s.muted?1:0,elem_preload:s.preload,elem_controls:s.controls?1:0,elem_ready_state:s.readyState,elem_network_state:s.networkState}:{});"boolean"==typeof wi.playHEVCTest&&(d.play_hevc_test=wi.playHEVCTest?1:0),void 0!==e.stat.isLive&&(d.live=e.stat.isLive?1:0),e.stat.box===R.g.flv&&!1!==e.stat.isLive&&(d.stream_id=function(e){if("string"!=typeof e)return"";if(e!==hn){hn=e;var t=e.match(ln);fn=t&&t.length>1?t[1]:""}return fn}(_)),t.customeHttpHeader&&(d.custom_http_header=t.customeHttpHeader),null!=c&&c.bitrate&&(d.bitrate=c.bitrate),null!=c&&c.qualityType&&(d.quality_type=c.qualityType),null!=c&&c.qualityLabel&&(d.quality_label=c.qualityLabel),t.startQualityType&&(d.start_quality_type=t.startQualityType);var u=we(_);u&&(d.transcoding_template=u),"undefined"!=typeof navigator&&(navigator.webdriver&&(d.webdriver=navigator.webdriver),navigator.deviceMemory&&(d.device_memory=navigator.deviceMemory));var l=Object(q.a)();return l.renderer&&(d.gpu_renderer=l.renderer),e.stat.wasmDecoder&&(d.wasm_dec=e.stat.wasmDecoder,d.wasm_dec_simd=e.stat.wasmSimd?1:0,d.wasm_dec_threads=e.stat.wasmThreads||0),d}function gn(){var e={};return"undefined"!=typeof window&&window.screen&&(window.screen.width&&(e.screen_w=window.screen.width),window.screen.height&&(e.screen_h=window.screen.height),window.screen.colorDepth&&(e.screen_color_depth=window.screen.colorDepth)),e}function yn(e){var t={src_type:e.stat.srcType};return e.stat.stereoType&&(t.stereo_type=e.stat.stereoType),e.stat.mixCodecInput&&e.stat.mixCodecInput.length&&(t.mix_codec_input=e.stat.mixCodecInput),e.stat.mixContainerInput&&e.stat.mixContainerInput.length&&(t.mix_container_input=e.stat.mixContainerInput),e.stat.mixCodecAvailable&&(t.mix_codec_available=e.stat.mixCodecAvailable),e.stat.mixQualityList&&(t.mix_codec_available=e.stat.mixQualityList),e.stat.fallback264&&(t.fallback_264=1),t}function En(e){var t=performance.now();return{play:Math.round(e.playDuration+(e.playStartMS?t-e.playStartMS:0)),actualPlay:Math.round(e.actualPlayDuration+(e.actualPlayStartMS?t-e.actualPlayStartMS:0)),pause:Math.round(e.pauseDuration+(e.pauseStartMS?t-e.pauseStartMS:0)),buffer:Math.round(e.bufferTime+(e.bufferingStartMS?t-e.bufferingStartMS:0))}}!function(e){e.PLAY="PLAY",e.END="END",e.PAUSE="PAUSE",e.LOAD="LOAD",e.BLOCK_START="BLOCK_START",e.BLOCK_END="BLOCK_END",e.SEEK_START="SEEK_START",e.SEEK_END="SEEK_END",e.LIVE_STOP="LIVE_STOP",e.STOP="STOP",e.ERROR="ERROR",e.DESTORY="DESTORY",e.QUALITY_CHANGE="QUALITY_CHANGE",e.QUALITY_CHANGE_DATA="QUALITY_CHANGE_DATA",e.QUALITY_CHANGE_RENDER="QUALITY_CHANGE_RENDER",e.SPEED_CHANGE="SPEED_CHANGE",e.RETRY="RETRY",e.AUDIO_OUTPUT_DEVICE_CHANGE="AUDIO_OUTPUT_DEVICE_CHANGE",e.NETWORK_CHANGE="NETWORK_CHANGE",e.VIDEO_DOM_EVENT="VIDEO_DOM_EVENT",e.FIRST_SCREEN_RENDER="FIRST_SCREEN_RENDER",e.PREPARED="PREPARED",e.METADATA_LOAD="METADATA_LOAD"}(cn||(cn={})),function(e){e.FIRST_FRAME="normal",e.FIRST_FRAME_SEEK="seek",e.FIRST_FRAME_SELECT_BITRATE="select_bitrate"}(_n||(_n={})),function(e){e.START="start",e.MANIFEST="manifest",e.LEVEL="level",e.DATA="data",e.DEMUX="demux",e.SEGMENT="segment",e.CANPLAY="canplay",e.LOADEDDATA="loadeddata",e.SEEKED="seeked"}(dn||(dn={}));var bn,An=[{event:dn.START,detailName:"first-loader-open"},{event:dn.MANIFEST,detailName:"manifest-duration"},{event:dn.LEVEL,detailName:"level-duration"},{event:dn.DATA,detailName:"first-package-duration"},{event:dn.DEMUX,detailName:"first-remux-duration"},{event:dn.SEGMENT,detailName:"first-segment-duration"},{event:[dn.LOADEDDATA,dn.CANPLAY,dn.SEEKED],detailName:"first-frame-duration"}],Tn=function(){function e(e){this._complete=0,this._duration=0,this._events=void 0,this._start=0,this._lastEventTime=0,this._details={},this._ctx=void 0,this._type=_n.FIRST_FRAME,this._events=An.slice(0),this._ctx=e}var t=e.prototype;return t.start=function(e){v.b.i("first-frame","start type: "+e),this._complete=0,this._start=performance.now(),this._duration=0,this._events=An.slice(0),this._lastEventTime=0,this._type=e,this._details={type:e},this.process(dn.START,this._start)},t.process=function(e,t){var i;if(void 0===t&&(t=0),v.b.i("first-frame","process type: "+e+" "+t+" complete: "+this._complete),this._complete)return!1;var n=this._events,r=-1;t=t||performance.now();for(var a=0;a<n.length;a++){var s=n[a];if(Array.isArray(s.event)){if(-1!==s.event.indexOf(e)){r=a;break}}else if(s.event===e){r=a;break}}if(-1===r)return!1;var o=n.splice(0,r+1).pop(),c="closed"===(null==(i=this._ctx.mse)?void 0:i.readyState);if((0===n.length||c&&e===dn.SEGMENT)&&(this._duration=t-this._start,this._complete=Date.now(),v.b.i("first-frame","complete "+this._duration+" "+this._complete)),o){var _=Math.round(t-this._lastEventTime);0===this._lastEventTime&&(_=Date.now()),this._lastEventTime=t,this._details[o.detailName]=_}return!!this._complete},t.onDownloadError=function(){this._details.download_retry?this._details.download_retry++:this._details.download_retry=1},t.onRetry=function(){this._details.retry?this._details.retry++:this._details.retry=1},s()(e,[{key:"type",get:function(){return this._type}},{key:"complete",get:function(){return this._complete}},{key:"duration",get:function(){return this._duration}},{key:"details",get:function(){return this._details}}]),e}(),Sn=function(){function e(e,t){this._data=void 0,this._ctx=void 0,this._snapshot=void 0,this._tickIndex=1,this._statTimestampMillis=0,this._statTimestampMillisUTC=0,this._firstScreen=!0,this._firstScreenDetails=void 0,this._firstScreenDuration=null,this._clickToFirstFrame=0,this._errorCode=0,this._errorMessage="",this._data=e,this._ctx=t,this._tickIndex=1,this._snapshot={play:0,actualPlay:0,pause:0,buffer:0,blockCount:0,pauseCnt:0,renderBlockCount:0,seekCnt:0,seekLoadCnt:0,decodedFrames:0,droppedFrames:0,traffic:0,download:0,mseUpdate:0,mseRemove:0,segment:0,preloadCount:0,fillA:0,fillV:0,keyFrame:0},this._resetForNewInterval()}var t=e.prototype;return t._updateSnapshot=function(e,t){var i={};for(var n in t)"number"==typeof e[n]&&(i[n]=e[n]-t[n],t[n]=e[n]);return i},t._resetForNewInterval=function(){this._statTimestampMillis=performance.now(),this._statTimestampMillisUTC=Date.now(),this._firstScreenDuration=null,this._firstScreenDetails=void 0,this._errorCode=0,this._errorMessage=""},t.setFirstScreenDuration=function(e,t,i){this._firstScreenDuration=Math.round(e),this._firstScreenDetails=t,this._firstScreen=!0,this._clickToFirstFrame=i},t.setError=function(e,t){this._errorCode=e,this._errorMessage=t},t.buildAndStartNewInterval=function(){var e,t,i,n,a,s,o=this._data,c=(this._ctx.stat,this._updateSnapshot(o,this._snapshot)),_=this._updateSnapshot(En(this._data),this._snapshot),d=this._updateSnapshot(this._ctx.loadRec,this._snapshot),u=performance.now(),l={tick_index:this._tickIndex,tick_start:this._statTimestampMillisUTC,tick_duration:Math.round(u-this._statTimestampMillis),error_code:this._errorCode,error_message:this._errorMessage,block_cnt:c.blockCount||0,render_block_cnt:c.renderBlockCount||0,decoded_video_frames:c.decodedFrames||0,dropped_video_frames:c.droppedFrames||0,segment_cnt:c.segment||0,play_duration:_.play||0,buffer_time:_.buffer||0,actual_play_duration:_.actualPlay||0,played_video_duration:_.play||0,traffic:d.traffic>>10,hidden:$i()?1:0,load_cnt:c.download,seek_cnt:c.seekCnt,seek_load_cnt:c.seekLoadCnt,pause_duration:_.pause,pause_cnt:c.pauseCnt,preload_cnt:c.preloadCount};return r()(l,vn(this._ctx,o),((e=this._ctx).mse?(a=e.mse.bufferedByType(R.l.VIDEO),s=e.mse.bufferedByType(R.l.AUDIO)):a=s=e.mediaBufferedSec,{a_buf_start:Math.round(1e3*s.start)||0,a_buf_end:Math.round(1e3*s.end)||0,a_buf_len:Math.round(1e3*Math.max(0,s.end-e.currentTime))||0,a_buf_slices:(null==(t=e.mse)?void 0:t.bufferSliceNumByType(R.l.AUDIO))||e.bufferSliceNum||0,v_buf_start:Math.round(1e3*a.start)||0,v_buf_end:Math.round(1e3*a.end)||0,v_buf_len:Math.round(1e3*Math.max(0,a.end-e.currentTime))||0,v_buf_slices:(null==(i=e.mse)?void 0:i.bufferSliceNumByType(R.l.VIDEO))||e.bufferSliceNum||0,buffer_queue_cnt:(null==(n=e.mse)?void 0:n.pendingNum())||0}),function(e){if(e.stat.isLive&&e.stat.box===R.g.flv){var t=e.liveDelay.getDisplayDelay(e.currentTime);if(t)return{v_rec_delay:e.liveDelay.getRecDelay(),v_render_delay:t||0,a_render_delay:e.liveDelay.getAudioRenderDelay(e.currentTime)||0}}return{}}(this._ctx)),c.fillA&&(l.fill_a=c.fillA),c.fillV&&(l.fill_v=c.fillV),o.mse&&(l.mse_update_cnt=c.mseUpdate||0,l.mse_remove_cnt=c.mseRemove||0,l.key_frame_cnt=c.keyFrame),this._firstScreen&&(null===this._firstScreenDuration?l.first_screen_total_duration=0:(l.first_screen_total_duration=this._firstScreenDuration,l.first_screen_details=this._firstScreenDetails,this._firstScreenDetails=null,this._firstScreenDuration=null,this._firstScreen=!1)),"number"==typeof this._clickToFirstFrame&&o.playStartTime&&(l.click_to_first_frame=this._clickToFirstFrame,this._clickToFirstFrame>0&&(this._clickToFirstFrame=void 0)),1===this._tickIndex&&r()(l,pn(),yn(this._ctx),gn()),this._resetForNewInterval(),this._tickIndex++,l},e}();function Rn(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function xn(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Rn(Object(i),!0).forEach((function(t){Ji()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Rn(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}!function(e){e.NORMEL="normal",e.SEEK="seek",e.END="end",e.LEVEL_SWITCH="levelSwitch"}(bn||(bn={}));var Ln=function(e){function t(t){var i;return(i=e.call(this)||this)._beaconTimer=void 0,i._runningStartTime=void 0,i._ctx=void 0,i._firstFrame=void 0,i._data=void 0,i._realtimeBeacon=void 0,i._hiddenStart=!1,i._playing=!1,i._seeking=!1,i._seekLoadFlag=!1,i._seekingThrottle=null,i._seekedDebounce=null,i._onOnlineChange=function(){i.triggerEventReport(cn.NETWORK_CHANGE,{online:void 0!==navigator.onLine?navigator.onLine?1:0:null})},i._sendRealtimeBeacon=function(e){void 0===e&&(e=bn.NORMEL);var t=i._getRealtimeBeacon();t&&(t.type=e,i._ctx.stat.isLive||(t.seek_record=i._data.seekRecord.slice(0),i._data.seekRecord=[]),v.b.i("monitor","realtime beacon",t),i.emit(p.a.REPORT,{type:Hi.REALTIME_BEACON,value:t}))},i._beaconTimer=null,i._runningStartTime=performance.now(),i._firstFrame=new Tn(t),i._ctx=t,i._reset(),window.addEventListener("online",i._onOnlineChange),window.addEventListener("offline",i._onOnlineChange),i}_()(t,e);var i=t.prototype;return i._reset=function(){this._playing=!1,this._seeking=!1,this._seekLoadFlag=!1,this._seekedDebounce&&clearTimeout(this._seekedDebounce),this._seekingThrottle&&clearTimeout(this._seekingThrottle),this._data={decodedFrames:0,droppedFrames:0,sessionId:un(),startTime:0,loadStartTime:0,playStartTime:0,playDuration:0,actualPlayDuration:0,pauseDuration:0,pauseCnt:0,bufferTime:0,blockCount:0,renderBlockCount:0,seekCnt:0,seekDuration:0,seekLoadCnt:0,seekLoadDuration:0,seekStartTime:0,unknownTSPacketCount:0,audioNonMonotonous:0,startBitrate:0,smoothBitrate:-1,useBackup:0,mseBufferFull:0,aacOverhead:0,errorCode:0,errorMessage:"",download:0,mseUpdate:0,segment:0,mseRemove:0,preloadCount:0,reuse:0,playPos:0,seekRecord:[],codecs:"",mse:!1,firstScreenTotalDuration:0,clickToFirstFrame:0,playToEnd:0,fillA:0,fillV:0,keyFrame:0},v.b.i("monitor","reset",this._data.sessionId),this._ctx.fps.reset(),this._ctx.fps.getFPS(this._ctx.videoPlaybackQuality)},i.onLoaderChunkArrival=function(e){e.ts=e.ts||performance.now(),this._ctx.loadRec.onDataReceive(e),this._processFirstFrame(dn.DATA,e.ts)},i.onMediaConnect=function(e){e.headers&&(this._data.customeHttpHeader=D(e.headers))},i.onMediaDemux=function(e){this._processFirstFrame(dn.DEMUX,performance.now())},i.onKeyFrame=function(){this._ctx.loadRec.currentLoad&&this._ctx.loadRec.currentLoad.keyFrame++,this.data.keyFrame++},i.onMuxInfo=function(e){var t=this._data;t.unknownTSPacketCount=t.unknownTSPacketCount||e.unknownTSPacketCount||0,t.audioNonMonotonous=t.audioNonMonotonous||e.audioNonMonotonous||0,t.aacOverhead=t.aacOverhead||e.aacOverhead||0},i.onDecLibLoaded=function(e){this._data.decLibLoadDuration=e.duration,this._data.decLibCacheHit=e.hitCache},i.onUseBackup=function(){this._data.useBackup=1},i.onNewSource=function(e){var t=this._data,i=this._ctx.lctx.current;i?(this._ctx.loadRec.onStreamOpen(e.sync,i.currentUrl,i.bitrate,i.qualityType),t.level=this._ctx.lctx.currentIdx,t.startQualityType||(t.startQualityType=i.qualityType)):this._ctx.loadRec.onStreamOpen(e.sync,"",0,"unknown")},i.onDiscontinuity=function(e){this.emit(p.a.REPORT,{type:Hi.DISCONTINUITY,value:e})},i.onDownload=function(e){var t=this,i=this._data;e.error_code&&!this._firstFrame.complete&&this._firstFrame.onDownloadError(),i.download++;var n=r()({load_start_time:i.loadStartTime||0,use_backup:i.useBackup,first_screen:i.firstScreenTotalDuration?1:0},mn(i),e);1009===e.error_code?setTimeout((function(){t.emit(p.a.REPORT,{type:Hi.DOWNLOAD,value:n})}),0):this.emit(p.a.REPORT,{type:Hi.DOWNLOAD,value:n})},i.heartbeat=function(e){var t,i,n=this._data,r=this._ctx,a=r.fps.getFPS(this._ctx.videoPlaybackQuality),s={},o=r.loadRec;e&&o.setRTCStats(e),(n.mse||e)&&(s.totalReceive=o.traffic,s.speed=o.downloadSpeedByRange(),s.videoDataRate=(null==(t=o.currentLoad)?void 0:t.videoDataRate)||0,s.audioDataRate=(null==(i=o.currentLoad)?void 0:i.audioDataRate)||0),r.mse&&(s.videoBuffered=Math.round(Math.max(0,1e3*(r.mse.bufferedEndByType(R.l.VIDEO)-r.currentTime))),s.audioBuffered=Math.round(Math.max(0,1e3*(r.mse.bufferedEndByType(R.l.AUDIO)-r.currentTime))),s.fillAudio=n.fillA,s.fillVideo=n.fillV,s.keyFrame=n.keyFrame),s.buffered=Math.round(1e3*r.bufferedSec),s.decodedFPS=(null==a?void 0:a.decodedFPS)||0,s.droppedFPS=(null==a?void 0:a.droppedFPS)||0,n.decodedFrames=s.decodedFrames=(null==a?void 0:a.decoded)||0,n.droppedFrames=s.droppedFrames=(null==a?void 0:a.dropped)||0,e&&(s.audioAvgJitterBufferDelay=e.audioAvgJitterBufferDelay,s.videoAvgJitterBufferDelay=e.videoAvgJitterBufferDelay,s.audioPacketsLost=e.audioPacketsLost,s.videoPacketsLost=e.videoPacketsLost),r.stat.isLive&&r.stat.box===R.g.flv&&(s.audioRenderDelay=r.liveDelay.getAudioRenderDelay(r.currentTime),s.displayDelay=r.liveDelay.getDisplayDelay(r.currentTime),s.recDelay=r.liveDelay.getRecDelay()),this.emit(p.a.REPORT,{type:Hi.HEARTBEAT,value:s})},i.destroy=function(){v.b.i("monitor","destroy"),this.triggerEventReport(cn.DESTORY),this._sendRealtimeBeacon(bn.END),this._stopBeaconTimer(),window.removeEventListener("online",this._onOnlineChange),window.removeEventListener("offline",this._onOnlineChange),this._seekedDebounce&&clearTimeout(this._seekedDebounce),this._seekingThrottle&&clearTimeout(this._seekingThrottle),this.removeAllListeners()},i.onPreload=function(){this._data.preloadCount++},i.onLoad=function(e){v.b.i("monitor","on load: "+e),e?(e!==R.f.internal||this._firstFrame.complete||this._firstFrame.start(_n.FIRST_FRAME),this._data.errorCode=0,this._data.errorMessage=""):this._onLoad()},i.onStopLoad=function(){this._sendRealtimeBeacon(bn.END),this._stopBeaconTimer(),this._waitingEnd(),this._ctx.stat.isLive&&this.triggerEventReport(cn.LIVE_STOP)},i.onManifest=function(e){var t=this._ctx.lctx.current;t&&(this._data.startBitrate||(this._data.startBitrate=t.bitrate)),this._processFirstFrame(dn.MANIFEST)},i.onLevel=function(e){void 0===e&&(e=0),this._processFirstFrame(dn.LEVEL,e)},i.onAudioTrack=function(){},i.onSegmentInit=function(e){var t=this._ctx;e.box=t.stat.box,e.isLive=t.stat.isLive,e.packName=qi.packName,t.loadRec.onMediaInfo(e);var i=[];e.videoCodec&&i.push(e.videoCodec),e.audioCodec&&i.push(e.audioCodec),this._data.codecs=i.join(","),this._data.startCodec||(this._data.startCodec=this._data.codecs),e.sid=this._data.sessionId,e.hardwareAccelerated=wi.isSupportHW,e.coreType=t.stat.coreType,!e.streamHost&&t.lctx.currentUrl&&(e.streamHost=new S.a(t.lctx.currentUrl).host);var n=Object(q.a)();n.renderer&&(e.gpu=n.renderer),t.loadRec.currentLoad&&(t.loadRec.currentLoad.mediaInfo=e),t.stat.isLive&&t.stat.box===R.g.flv&&t.config.ntp&&t.liveDelay.init(),v.b.i("monitor","mediainfo",JSON.stringify(e)),this.emit(p.a.REPORT,{type:Hi.MEDIA_INFO,value:e})},i.onSegment=function(e){var t=this;this._ctx.liveDelay.onParsing(e),e.segments.forEach((function(e){e.type===R.l.VIDEO&&e.fillDuration&&(t._data.fillV+=Math.round(1e3*e.fillDuration)),e.type===R.l.AUDIO&&e.fillDuration&&(t._data.fillA+=Math.round(1e3*e.fillDuration)),t._ctx.loadRec.onMediaSegment(e)})),this._processFirstFrame(dn.SEGMENT),this._data.segment++},i.onRaw=function(e){this._ctx.loadRec.onRaw(e)},i.onPrivNal=function(e){this._ctx.liveDelay.onPrivNal(e)},i.onPlay=function(){this._data.playStartTime||(this._data.playStartTime=Date.now()),this._startBeaconTimer()},i.onLoadeddata=function(){this._processFirstFrame(dn.LOADEDDATA),this._waitingEnd()},i.onCanplay=function(){this._processFirstFrame(dn.CANPLAY),x.a.safari&&!this._data.mse||this._waitingEnd()},i.onPlaying=function(){var e;x.a.ios&&4!==(null==(e=this._ctx.video)?void 0:e.readyState)||(this._playing||(this._playing=!0,this.triggerEventReport(cn.PLAY)),this._playStart(),this._pauseEnd(),this._waitingEnd())},i.onPause=function(){var e;null!=(e=this._ctx.video)&&e.seeking||!this._playing||(this._playEnd(),this._pauseStart(),this.triggerEventReport(cn.PAUSE),this._playing=!1)},i.onEnd=function(){this._data.playToEnd++,this._playing=!1,this._playEnd(),this._pauseEnd(),this._waitingEnd(),this._sendRealtimeBeacon(bn.END),this._stopBeaconTimer(),this.triggerEventReport(cn.END)},i.onWaiting=function(e,t){this._data.playPos=Math.round(1e3*this._ctx.currentTime),this._playing&&this._firstFrame.complete&&e&&(this._waitingStart(t),this.triggerEventReport(cn.BLOCK_START))},i.mseOpen=function(){this._data.mse=!0,this._ctx&&this._ctx.video&&!this._ctx.video.paused&&this.onPlay()},i.mseUpdate=function(){this._data.mseUpdate++},i.mseRemove=function(){this._data.mseRemove++},i.onSeek=function(e){var t,i,n=this;void 0===e&&(e=!1),this._data.seekRecord.push({from:this._data.playPos,to:Math.round(1e3*this._ctx.currentTime),time:Date.now()}),this._data.seekRecord.length>50&&this._data.seekRecord.shift(),this._ctx.stat.isLive||e||(this._data.seekStartTime=performance.now(),this._seeking?!this._seekingThrottle&&this._seeking&&(this._seekingThrottle=+setTimeout((function(e){var t,i;n.triggerEventReport(cn.SEEK_START,{paused:null==(t=n._ctx.video)?void 0:t.paused,seeking:null==(i=n._ctx.video)?void 0:i.seeking,position:e}),n._seekingThrottle=null}),500,this._data.playPos/1e3)):(this.triggerEventReport(cn.SEEK_START,{paused:null==(t=this._ctx.video)?void 0:t.paused,seeking:null==(i=this._ctx.video)?void 0:i.seeking,position:this._data.playPos/1e3}),this._seeking=!0))},i.onSeekWithLoad=function(e){this._firstFrame.complete&&(this._sendRealtimeBeacon(bn.SEEK),this._resetBeaconTimer(),this._firstFrame.start(_n.FIRST_FRAME_SEEK),this._seekLoadFlag=!0)},i.onSeeked=function(){var e=this;if(this._ctx.fps.getFPS(this._ctx.videoPlaybackQuality),this._data.seekStartTime){var t;this._data.seekCnt++;var i=Math.round(performance.now()-this._data.seekStartTime);this._data.seekDuration+=i,this._data.seekStartTime=0,this._seekLoadFlag&&(this._data.seekLoadCnt++,this._data.seekLoadDuration+=i),this._seekedDebounce&&clearTimeout(this._seekedDebounce),this._seekedDebounce=+setTimeout((function(t){var i,n,r;null!=(i=e._ctx.video)&&i.seeking||(e._seeking=!1,e.triggerEventReport(cn.SEEK_END,{paused:null==(n=e._ctx.video)?void 0:n.paused,seeking:null==(r=e._ctx.video)?void 0:r.seeking,position:t}))}),500,null==(t=this._ctx.video)?void 0:t.currentTime)}this._seekLoadFlag=!1,this._firstFrame.complete||this._data.mse||!x.a.safari&&!x.a.msie||this._processFirstFrame(dn.SEEKED)},i.onMSEBufferFull=function(){this._data.mseBufferFull++},i.onTimeupdate=function(){var e,t,i=this._ctx,n=i.video;if(n){n.loop&&!i.stat.isLive&&0===i.currentTime&&Object(ee.a)(n.duration)&&n.duration>0&&n.duration-this._data.playPos/1e3<1&&this._data.playToEnd++;var r=Math.round(1e3*i.currentTime);x.a.msie&&!this._data.mse&&this._data.bufferingStartMS&&this._data.playPos!==r&&this.onPlaying(),this._data.playPos=r,!x.a.ios||"number"!=typeof this._data.bufferingStartMS||4!==(null==(e=this._ctx.video)?void 0:e.readyState)||null!=(t=this._ctx.video)&&t.paused||this.onPlaying()}},i.onProgress=function(){var e;x.a.safari&&!this._data.mse&&this._data.bufferingStartMS&&4===(null==(e=this._ctx.video)?void 0:e.readyState)&&this._waitingEnd()},i.mediaCapabilities=function(e){this._data.smoothBitrate=e},i.levelSwitching=function(e){e.smooth||(this._sendRealtimeBeacon(bn.LEVEL_SWITCH),this._resetBeaconTimer(),this._firstFrame.start(_n.FIRST_FRAME_SELECT_BITRATE));var t=this._ctx.lctx.current;t&&this.triggerEventReport(cn.QUALITY_CHANGE,{quality_type:t.qualityType,trigger_mode:e.auto?"abr":"user",play_url:t.currentUrl,is_smooth:e.smooth?1:0})},i.levelSwitched=function(){this.triggerEventReport(cn.QUALITY_CHANGE_DATA)},i.levelSwitchPlaying=function(){this.triggerEventReport(cn.QUALITY_CHANGE_RENDER)},i.onAudioSwitching=function(){},i.onAudioSwitched=function(){},i.onRetry=function(e){this._firstFrame.onRetry(),this.triggerEventReport(cn.RETRY,{retry_type:e.type,retry_message:e.message})},i.onMetaData=function(e){this.emit(p.a.REPORT,{type:Hi.METADATA,value:e}),this.triggerEventReport(cn.METADATA_LOAD,xn({},e))},i.triggerEventReport=function(e,t){this.emit("report",{type:"event",value:r()(xn({type:e,position:this._ctx.currentTime},t),mn(this._data))})},i.onRateChange=function(e){var t;null!=(t=this._ctx.video)&&t.seeking||this.triggerEventReport(cn.SPEED_CHANGE,{speed:e})},i.onError=function(e,t){this._data.errorCode=e,this._data.errorMessage=t,this.triggerEventReport(cn.ERROR,{error_message:t,error_type:e}),this._realtimeBeacon&&this._realtimeBeacon.setError(e,t),this._playEnd(),this._pauseEnd(),this._waitingEnd()},i._getRealtimeBeacon=function(){return this._realtimeBeacon?this._realtimeBeacon.buildAndStartNewInterval():null},i._processFirstFrame=function(e,t){void 0===t&&(t=0),!this._firstFrame.complete&&this._firstFrame.process(e,t)&&this._onFirstFrame()},i._playStart=function(){this._data.playStartMS=this._data.playStartMS||performance.now(),this._data.actualPlayStartMS=this._data.actualPlayStartMS||performance.now()},i._playEnd=function(){this._data.playStartMS&&(this._data.playDuration+=performance.now()-this._data.playStartMS),this._data.actualPlayStartMS&&(this._data.actualPlayDuration+=performance.now()-this._data.actualPlayStartMS),this._data.playStartMS=void 0,this._data.actualPlayStartMS=void 0},i._pauseStart=function(){this._data.pauseCnt++,this._data.pauseStartMS=this._data.pauseStartMS||performance.now()},i._pauseEnd=function(){this._data.pauseStartMS&&(this._data.pauseDuration+=performance.now()-this._data.pauseStartMS),this._data.pauseStartMS=void 0},i._waitingStart=function(e){this._data.bufferingStartMS||(this._data.blockCount++,this._data.bufferingStartMS=performance.now(),e>.6&&this._data.renderBlockCount++),this._data.actualPlayStartMS&&(this._data.actualPlayDuration+=performance.now()-this._data.actualPlayStartMS),this._data.actualPlayStartMS=void 0},i._waitingEnd=function(){this._data.bufferingStartMS&&(this._data.bufferTime+=performance.now()-this._data.bufferingStartMS,this._data.bufferingStartMS=void 0,this.triggerEventReport(cn.BLOCK_END))},i._onFirstFrame=function(){var e,t,i,n,r,a;v.b.i("monitor","first frame"),this._ctx.stat.firstFrameLoaded=!0;var s=this._data,o=this._ctx.loadRec.currentLoad;s.firstScreenTotalDuration=s.firstScreenTotalDuration||Math.round(this._firstFrame.duration),s.firstScreenDetails=s.firstScreenDetails||this._firstFrame.details,this.triggerEventReport(cn.FIRST_SCREEN_RENDER,{initial_rate:Math.round((null==(e=this._ctx.loadRec.currentLoad)?void 0:e.videoDataRate)||0),inital_quality_type:this._data.startQualityType,fps:null==o||null==(t=o.mediaInfo)?void 0:t.fps,a_codec:null==o||null==(i=o.mediaInfo)?void 0:i.audioCodec,v_codec:null==o||null==(n=o.mediaInfo)?void 0:n.videoCodec,channels:null==o||null==(r=o.mediaInfo)?void 0:r.channelCount,sample_rate:null==o||null==(a=o.mediaInfo)?void 0:a.audioSampleRate}),s.playStartTime&&this._firstFrame.complete?s.clickToFirstFrame=s.clickToFirstFrame||Math.max(1,this._firstFrame.complete-s.playStartTime):s.clickToFirstFrame=1,this._realtimeBeacon&&this._realtimeBeacon.setFirstScreenDuration(this._firstFrame.duration,this._firstFrame.details,s.clickToFirstFrame),this._ctx.video&&!this._ctx.video.paused&&this._firstFrame.type===_n.FIRST_FRAME&&this._playStart()},i._startBeaconTimer=function(){null===this._beaconTimer&&(this._beaconTimer=setInterval(this._sendRealtimeBeacon,1e4))},i._stopBeaconTimer=function(){this._beaconTimer&&(clearTimeout(this._beaconTimer),this._beaconTimer=null)},i._resetBeaconTimer=function(){this._stopBeaconTimer(),this._startBeaconTimer()},i._onLoad=function(e){var t,i=(null==(t=this._ctx.lctx.current)?void 0:t.currentUrl)||"";if(this._data.startTime){var n=this._data.reuse;this._reset(),this._data.reuse=n+1}this.triggerEventReport(cn.LOAD,{url:i,protocol:this._ctx.stat.box,initial_speed:String(this._ctx.video&&this._ctx.video.playbackRate)}),this._data.startTime=performance.now(),this._data.loadStartTime=Date.now(),this._firstFrame.start(_n.FIRST_FRAME),this._hiddenStart=$i(),this._stopBeaconTimer(),this._realtimeBeacon=new Sn(this._data,this._ctx)},s()(t,[{key:"runningStartTime",get:function(){return this._runningStartTime}},{key:"sid",get:function(){return this._data.sessionId}},{key:"snapshot",get:function(){var e=this._ctx.loadRec;return r()({streams:e.streams,live:this._ctx.stat.isLive,demuxer:this._ctx.stat.demuxerType,decSimd:this._ctx.stat.wasmSimd,decThreads:this._ctx.stat.wasmThreads,decoderType:this._ctx.stat.wasmDecoder},this._data)}},{key:"data",get:function(){return this._data}},{key:"audienceStat",get:function(){var e,t,i,n=this._data,a=En(n),s=this._ctx.stat,o=this._ctx.loadRec,c={play_duration:a.play,actual_play_duration:a.actualPlay,traffic:o.traffic>>10,buffer_time:a.buffer,block_cnt:n.blockCount,render_block_cnt:n.renderBlockCount,click_to_first_frame:n.playStartTime&&n.clickToFirstFrame||0,first_screen_total_duration:Math.round(n.firstScreenTotalDuration)||0,first_screen_details:n.firstScreenDetails||this._firstFrame.details||null,error_code:n.errorCode||0,error_message:n.errorMessage||"",remux_process_type:(s.streamingMux?1:0)+(s.gopRemux?1:0),hidden_start:this._hiddenStart?1:0,current_running_time:Math.round(performance.now()-n.startTime),running_time:Math.round(performance.now()-this._runningStartTime),smooth_bitrate:n.smoothBitrate,start_bitrate:n.startBitrate||0,abr:this._ctx.config.adaptive?1:0,pause_cnt:n.pauseCnt,preload_cnt:n.preloadCount,retry_record:s.retryInfos,traffic_vcodec:o.trafficGroupedByVCodecType,traffic_level:o.trafficGroupedByLevel,decoded_video_frames:n.decodedFrames||0,dropped_video_frames:n.droppedFrames||0,pause_duration:a.pause,seek_cnt:n.seekCnt,seek_duration:n.seekDuration,seek_load_cnt:n.seekLoadCnt,seek_load_duration:n.seekLoadDuration,start_sec:this._ctx.stat.isLive?0:Math.round(this._ctx.config.startFromSec||0)};return x.a.version&&(c.browser_name=x.a.name||"",c.browser_major=x.a.version.major||0),r()(c,pn(),vn(this._ctx,n),(i={},(t=null==(e=this._ctx.loadRec.currentLoad)?void 0:e.mediaInfo)&&(t.fps&&(i.fps=t.fps),t.width&&(i.width=t.width),t.height&&(i.height=t.height)),i),yn(this._ctx),gn()),n.mse&&(c.mse_buffer_full=n.mseBufferFull,c.mse_remove=n.mseRemove,c.key_frame_cnt=n.keyFrame),n.fillA&&(c.fill_a=n.fillA),n.fillV&&(c.fill_v=n.fillV),$e(s.box)&&(c.unknown_ts_packet_count=n.unknownTSPacketCount,c.audio_non_monotonous=n.audioNonMonotonous,c.aac_overhead=n.aacOverhead),"number"==typeof n.decLibLoadDuration&&(c.dec_lib_load_duration=Math.round(n.decLibLoadDuration),c.dec_lib_hit=n.decLibCacheHit?1:0),c}}]),t}(o.EventEmitter),Cn=function(){function e(){var e=this;this._timer=void 0,this._xhr=void 0,this._callbackFunc=void 0,this._onEnd=function(){e._detectEnd()},this._onReadystatechange=function(){e._xhr&&e._xhr.readyState>=2&&e._detectEnd()},this._detectEnd=function(){e._xhr&&e._callbackFunc&&e._callbackFunc(e._xhr.status),e.stop()}}var t=e.prototype;return t.start=function(e,t){this._callbackFunc=t,this._xhr&&this.stop();var i=this._xhr=new XMLHttpRequest;i.open("GET",e,!0),i.onreadystatechange=this._onReadystatechange,i.onerror=this._onEnd,i.onload=this._onEnd,i.send(),this._timer=setTimeout(this._detectEnd,1e3)},t.stop=function(){this._timer&&(clearTimeout(this._timer),this._timer=void 0),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=void 0),this._callbackFunc=void 0},e}(),Dn=function(e){function t(t){var i;return(i=e.call(this,t.video)||this)._ctx=void 0,i._httpStatusDetector=void 0,i._setStartFromOnTimeupdate=!1,i._ctx=t,i}_()(t,e);var i=t.prototype;return i.load=function(e){var t;v.b.i("kernel-native","load",this._ctx.stat.startFromSec);var i=this._ctx.lctx.levels;i.length||this._onError({type:f.b.OTHER_ERROR,details:f.a.MANIFEST_PARSING_ERROR,fatal:!0,reason:"manifest parse error."});var n=0,r=this._ctx.lctx.startIdx;"number"==typeof r&&r>=0&&r<i.length&&(n=r),v.b.i("kernel-native","level: "+n+" "+(null==(t=i[n])?void 0:t.qualityType)),this._ctx.lctx.currentIdx=this._ctx.lctx.nextIdx=n,this._ctx.lctx.abr=!1,this.emit(p.a.MANIFEST_PARSED,{}),this._load(e)},i.onAbrLevelsUpdated=function(){},i.resume=function(){},i.refresh=function(){this._ctx.stat.startFromSec=this._video.currentTime,this._load(R.f.retry),this._video.play()},i.stopLoad=function(){this.emit(p.a.STOP_LOAD),this._stopHeartbeat()},i.setCurrentLevel=function(e){v.b.i("kernel-native","set current level: "+e+" @ "+this._video.currentTime);var t=this._ctx;if(t.lctx.levels.length){if(e>=0&&e<t.lctx.levels.length&&t.lctx.currentIdx!==e){t.lctx.currentIdx=t.lctx.nextIdx=e;var i=t.lctx.current;if(i){this._stat=hi.SELECT_BITRATE;var n=i.currentUrl;return t.stat.startFromSec=this._video.currentTime,this._levelSwitchId++,this.emit(p.a.LEVEL_SWITCHING,{url:n,bitrate:i.bitrate,level:e,smooth:!1,auto:!1,id:this._levelSwitchId}),this._startLoadLevel(t.lctx.currentIdx),this._video.paused||this._video.play(),void this.emit(p.a.LEVEL_SWITCHED,{bitrate:i.bitrate,level:e,smooth:!1,auto:!1,id:this._levelSwitchId})}}this.emit(p.a.LEVEL_SWITCH_FAILED)}else t.lctx.currentIdx=t.lctx.nextIdx=e},i.setNextLevel=function(e){this.setCurrentLevel(e)},i.preload=function(e){},i.getTotalVideoFrames=function(){return 0},i.getCurrentVideoFrame=function(){return 0},i.setCurretVideoFrame=function(e){},i.seekToNextFrame=function(){},i.seekToPrevFrame=function(){},i.destroy=function(){this._httpStatusDetector&&(this._httpStatusDetector.stop(),this._httpStatusDetector=void 0),e.prototype.destroy.call(this),this._video.hasOwnProperty("src")&&(this._video.src=""),this._video.removeAttribute("src")},i._onVideoPlay=function(){this._error||this._video.src||this.load(),e.prototype._onVideoPlay.call(this)},i._onVideoCanplay=function(){var t=this._ctx,i=t.lctx.current;i&&this._stat===hi.SELECT_BITRATE&&this.emit(p.a.LEVEL_SWITCH_PLAYING,{bitrate:i.bitrate,level:t.lctx.currentIdx,smooth:!1,auto:!1,id:this._levelSwitchId}),this._stat!==hi.NONE&&(this._stat=hi.NONE),e.prototype._onVideoCanplay.call(this)},i._onVideoTimeupdate=function(){var t=this._ctx;e.prototype._onVideoTimeupdate.call(this),this._setStartFromOnTimeupdate&&(v.b.i("kernel-native","timeupdate start from: "+t.stat.startFromSec),this._applyStartFrom(),this._setStartFromOnTimeupdate=!1)},i._onVideoWaiting=function(){v.b.i("kernel-native","video waiting"),this._stat=this._stat||hi.WAITING;var e=this._ctx.bufferedSec,t=!this._video.ended&&!this._video.seeking&&this._stat===hi.WAITING;this.emit(p.a.WAITING,t,e)},i._onVideoLoadeddata=function(){if(v.b.i("kernel-native","video loadeddata"),this._video.videoWidth||!this._ctx.canCodecFallback){this._mediaInfo={width:this._video.videoWidth,height:this._video.videoHeight};var e=this._ctx,t=e.lctx.current;if(e.cOutput.updateRendererType(R.o.video),e.cOutput.rendererType===R.o.canvas&&this.emit(p.a.VIDEO_RENDERER_CHANGE,{enabled:!0,canvas:e.cOutput.canvas,type:R.o.canvas}),t&&t.codec){var i=ue(t.codec);this._mediaInfo.audioCodec=i.audio,this._mediaInfo.videoCodec=i.video,i.video&&(0===i.video.indexOf("avc1")&&(this._mediaInfo.videoCodecType=R.b.h264),0!==i.video.indexOf("hev1")&&0!==i.video.indexOf("hvc1")||(this._mediaInfo.videoCodecType=R.b.hevc),0===i.video.indexOf("av01")&&(this._mediaInfo.videoCodecType=R.b.av1),e.stat.codecType=this._mediaInfo.videoCodecType)}this._mediaInfo.videoCodecType=e.stat.codecType,x.a.android?e.stat.startFromSec&&(this._setStartFromOnTimeupdate=!0):this._applyStartFrom(),this.emit(p.a.PARSING_INIT_SEGMENT,this._mediaInfo)}else this.emit(p.a.FALLBACK_H264,{type:R.h.FALLBACK_H264,message:"buildin "+this._ctx.stat.codecType+" dec no width."})},i._onVideoSeeking=function(){v.b.i("kernel-native","seeking "+this._video.currentTime);var e=this._video.currentTime;this.emit(p.a.SEEKING),this._ctx.isTimeinBuffered(e)||this.emit(p.a.SEEK_WITH_LOAD,e)},i._onVideoError=function(e){var t,i=this,n=null==(t=this._video.error)?void 0:t.code;if(4===n&&this._ctx.canCodecFallback)this.emit(p.a.FALLBACK_H264,{type:R.h.FALLBACK_H264,message:"buildin "+this._ctx.stat.codecType+" dec error. video error: "+n});else{var r=this._ctx.lctx.current;if(r&&r.urlId<r.url.length-1)return r.urlId++,void this._load(R.f.retry);var a="video error";this._video&&this._video.error&&(a+=" code:"+n+" message:"+this._video.error.message);var s={type:f.b.MEDIA_ERROR,details:(n?f.c[n]:f.a.VIDEO_ERROR)||f.a.VIDEO_ERROR,fatal:!0,url:this._video.src,reason:a};2===n||4===n?(this._httpStatusDetector||(this._httpStatusDetector=new Cn),this._httpStatusDetector.start(this._video.src,(function(e){v.b.i("kernel-native","video error check http status code:",e),(2===n||4===n&&e>0)&&(e<200||e>299)?i._onError({type:f.b.NETWORK_ERROR,details:f.a.LOAD_ERROR,fatal:!0,url:i._video.src,statusCode:e,reason:a}):i._onError(s)}))):this._onError(s)}},i._load=function(e){v.b.i("kernel-native","_load"),this._mediaInfo=void 0,this._error=void 0,this._stat=hi.LOADING,this.emit(p.a.LOAD,e),this._startLoadLevel(this._ctx.lctx.currentIdx),this._startHeartbeat()},i._startLoadLevel=function(e){var t=this._ctx,i=t.lctx.current;if(i){v.b.i("kernel-native","level",e);var n=i.currentUrl;this.emit(p.a.NEW_SOURCE,{sync:t.stat.startFromSec||0,index:e}),this._video.src=n}},i._applyStartFrom=function(){var e=this._ctx;e.stat.startFromSec>0&&(v.b.i("kernel-native","start from: "+e.stat.startFromSec),this._video.currentTime=e.stat.startFromSec,e.stat.startFromSec=0)},s()(t,[{key:"type",get:function(){return R.a.native}}]),t}(Ai),In=function(){function e(){this._prevVideoTimestamp=0,this._prevAudioTimestamp=0,this._prevVideoReceived=0,this._prevAudioReceived=0,this._result=void 0,this._result=this._newInfo()}var t=e.prototype;return t.reset=function(){this._result=this._newInfo(),this._prevVideoTimestamp=0,this._prevAudioTimestamp=0,this._prevVideoReceived=0,this._prevAudioReceived=0},t.parse=function(e){var t=this,i=this._result,n=0,r=0,a="",s="",o="",c="";i.totalReceive=0,e.forEach((function(e){if("inbound-rtp"===e.type){if("video"===e.mediaType){var _=e.timestamp-t._prevVideoTimestamp;t._prevVideoTimestamp&&(n=(e.bytesReceived-t._prevVideoReceived)/_),t._prevVideoReceived=e.bytesReceived,t._prevVideoTimestamp=e.timestamp,i.key=e.keyFramesDecoded,i.videoPacketsLost=e.packetsLost,s=e.codecId,c=e.trackId}else if("audio"===e.mediaType){var d=e.timestamp-t._prevAudioTimestamp;t._prevAudioReceived&&(r=(e.bytesReceived-t._prevAudioReceived)/d),t._prevAudioReceived=e.bytesReceived,i.audioPacketsLost=e.packetsLost,a=e.codecId,o=e.trackId}i.totalReceive+=e.bytesReceived,t._prevAudioTimestamp=e.timestamp}})),i.audioDataRate=Math.round(7.8125*r),i.videoDataRate=Math.round(7.8125*n),i.speed=1e3*(n+r),e.forEach((function(e){"codec"===e.type?e.id===s?i.videoCodec=e.mimeType:e.id===a&&(i.audioCodec=e.mimeType,i.audioChannelCount=e.channels,i.audioSampleRate=e.clockRate):"track"===e.type&&(e.id===c?(i.width=e.frameWidth,i.height=e.frameHeight,i.videoAvgJitterBufferDelay=e.jitterBufferDelay/e.jitterBufferEmittedCount):e.id===o&&(i.audioAvgJitterBufferDelay=e.jitterBufferDelay/e.jitterBufferEmittedCount))}));var _=null,d=null;return e.forEach((function(t){"transport"===t.type&&(_=null==e?void 0:e.get(t.selectedCandidatePairId))})),_||e.forEach((function(e){"candidate-pair"===e.type&&e.selected&&(_=e)})),_&&_.remoteCandidateId&&(d=null==e?void 0:e.get(_.remoteCandidateId)),d&&(i.rtcRemoteAddress=d.address||d.ip||d.ipAddress,i.rtcRemotePort=d.port||d.portNumber),this._result=i,i},t._newInfo=function(){return{totalReceive:0,speed:0,rtcRemoteAddress:"",rtcRemotePort:0,width:0,height:0,audioCodec:"",videoCodec:"",audioChannelCount:0,audioSampleRate:0,videoDataRate:0,audioDataRate:0,key:0,audioPacketsLost:0,videoPacketsLost:0,audioAvgJitterBufferDelay:0,videoAvgJitterBufferDelay:0}},s()(e,[{key:"result",get:function(){return this._result}}]),e}();function wn(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function kn(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?wn(Object(i),!0).forEach((function(t){Ji()(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):wn(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var On,Nn=function(e){function t(t){var i;return(i=e.call(this,t.video)||this)._ctx=void 0,i._loader=void 0,i._pc=void 0,i._loaderConfig=void 0,i._stream=void 0,i._src="",i._rtcStatParser=void 0,i._retrying=!1,i._retryTimer=null,i._retryCount=0,i.transmissionTimeoutTimer=null,i.transmissionTimeout=void 0,i.peerConnectionTimeout=void 0,i.peerConnectionMaxRetry=void 0,i.peerConnectionRetryDelay=void 0,i._parseStats=function(e){i._pc&&i._pc.getStats(null).then((function(t){var n=i._rtcStatParser.parse(t);e(n)}),(function(e){return console.log(e)}))},i._ctx=t,i._loaderConfig={useFetch:!0,connectionTimeout:i._ctx.config.sdpConnectionTimeout||1e4,maxRetry:0,retryDelay:i._ctx.config.retryDelay||1e3},i.transmissionTimeout=i._ctx.config.transmissionTimeout||1e4,i.peerConnectionTimeout=i._ctx.config.peerConnectionTimeout||1e5,i.peerConnectionMaxRetry=i._ctx.config.peerConnectionMaxRetry||5,i.peerConnectionRetryDelay=i._ctx.config.peerConnectionRetryDelay||3e3,i._rtcStatParser=new In,i}_()(t,e);var i=t.prototype;return i.load=function(e){v.b.i("kernel-rtc","load");var t=this._ctx.lctx.current;t&&(this._src=t.url[t.urlId]),this._load(e)},i.onAbrLevelsUpdated=function(){},i.resume=function(){},i.destroy=function(){e.prototype.destroy.call(this),this._stopRetry(),this._disposeLoader(),this._video&&(this._video.srcObject=null),this._disconnect(),this._stream=void 0,this._stopVideo()},i.refresh=function(){this._disconnect(),this._load(R.f.retry)},i.stopLoad=function(){this.emit(p.a.STOP_LOAD),this._pc&&(this._pc.close(),this._pc=null),this._stopRetry(),this._stopHeartbeat()},i.setCurrentLevel=function(e){},i.setNextLevel=function(e){},i.liveEnd=function(){},i.getTotalVideoFrames=function(){return 0},i.getCurrentVideoFrame=function(){return 0},i.setCurretVideoFrame=function(e){},i.seekToNextFrame=function(){},i.seekToPrevFrame=function(){},i._onVideoLoadedmetadata=function(){var e=this;this._ctx.cOutput.updateRendererType(R.o.video),this._ctx.cOutput.rendererType===R.o.canvas&&this.emit(p.a.VIDEO_RENDERER_CHANGE,{enabled:!0,canvas:this._ctx.cOutput.canvas,type:R.o.canvas}),this._parseStats((function(t){e._mediaInfo.width=t.width,e._mediaInfo.height=t.height,e._mediaInfo.audioCodec=t.audioCodec,e._mediaInfo.audioSampleRate=t.audioSampleRate,e._mediaInfo.channelCount=t.audioChannelCount,e._mediaInfo.videoCodec=t.videoCodec,e._mediaInfo.hasVideo=!!t.videoCodec,e._mediaInfo.hasAudio=!!t.audioCodec,e._mediaInfo.streamHost=t.rtcRemoteAddress,e._mediaInfo.streamPort=t.rtcRemotePort;var i=r()({},e._mediaInfo);e.emit(p.a.PARSING_INIT_SEGMENT,i)}))},i._heartbeat=function(){var e=this;this._parseStats((function(t){var i;t.speed||e.transmissionTimeoutTimer||"connected"!==(null==(i=e._pc)?void 0:i.connectionState)?t.speed&&(e.transmissionTimeoutTimer&&clearTimeout(e.transmissionTimeoutTimer),e.transmissionTimeoutTimer=null):e.transmissionTimeoutTimer=+setTimeout((function(){var t={type:f.b.NETWORK_ERROR,details:f.a.WEBRTC_TRANSMISSION_DATA_NULL,reason:"transmission timeout "+e.transmissionTimeout,fatal:!1,url:e._src};e._onError(t),e._retry(t.reason)}),e.transmissionTimeout),e.emit(p.a.HEARTBEAT,t)}))},i._onVideoCanplay=function(){this._stat!==hi.NONE&&(this._stat=hi.NONE),e.prototype._onVideoCanplay.call(this)},i._load=function(e){var t=this;this._rtcStatParser.reset(),this._stat=hi.LOADING,this.emit(p.a.LOAD,e),this.emit(p.a.NEW_SOURCE,{sync:0}),this._pc&&this._pc.close(),this._createPeerConnection(),this._connect().catch((function(e){t._retry(null==e?void 0:e.reason)}))},i._stopVideo=function(){this._video&&(this._video.srcObject=null)},i._retry=function(e){var t=this;this._retrying=!0,this._pc&&this._pc.close(),this._stopRetry(),this._retryCount<this.peerConnectionMaxRetry&&(this.transmissionTimeoutTimer&&clearTimeout(this.transmissionTimeoutTimer),this._retryTimer&&clearTimeout(this._retryTimer),this._retryTimer=+setTimeout((function(){t._retryCount++,v.b.i("kernel-rtc","retry",t._retryCount,e,t._src),t.emit(p.a.RETRY,{type:R.h.RTC,message:"reason: "+e+". retry: "+t._retryCount}),t._retryTimer=null,t._createPeerConnection(),t._connect().then((function(){t._retryCount=0,t._retrying=!1}),(function(i){t._retryCount<t.peerConnectionMaxRetry?t._retry(e):t._onError(kn(kn({},i),{},{fatal:!0,url:t._src}))}))}),this.peerConnectionRetryDelay))},i._stopRetry=function(){this._retryTimer&&(clearTimeout(this._retryTimer),this._retryTimer=null)},i.fetchAnwserSdp=function(e){var t=this;this._disposeLoader();var i=this._loader=new M,n={url:this._src,responseType:"text",requestBody:e,requestMethod:"POST",headers:[{header:"Content-type",value:"application/json"}]};return new Promise((function(e,r){i.load(n,{onEnd:function(i,n){if(t._disposeLoader(),"string"==typeof n){var r=JSON.parse(n);t.emit(p.a.LEVEL_UPDATED),e(r.sdp)}},onError:function(e,i){if(v.b.e("kernel-rtc","loadSdp",i),i.fatal){var n={type:f.b.NETWORK_ERROR,details:f.a.RTC_SDP_LOAD_ERROR,reason:i.text,fatal:i.fatal,url:t._src};t._disposeLoader(),r(n)}},onAbort:function(){t._disposeLoader(),r()}},t._loaderConfig)})).catch((function(e){return Promise.reject(e)}))},i._createPeerConnection=function(){var e=this,t=this._pc=new RTCPeerConnection;return t.addEventListener("track",(function(t){return e._onPCTrack(t)})),t.addEventListener("connectionstatechange",(function(t){return e._onPCConnectionStateChange(t)})),t.addEventListener("icecandidateerror",(function(t){return e._onPCIceCandidateError(t)})),t.addEventListener("signalingstatechange",(function(t){return e._onPCSignalingStateChange(t)})),t.addEventListener("iceconnectionstatechange",(function(t){return e._onPCIceConnecttionStateChange(t)})),t.addEventListener("icegatheringstatechange",(function(t){return e._onIceGatheringStateChange(t)})),t.addTransceiver("audio",{direction:"recvonly"}),t.addTransceiver("video",{direction:"recvonly"}),t},i._disconnect=function(){this._pc&&this._pc.close(),this._pc=null},i._connect=function(){var e=this,t=this._pc;return t||Promise.reject("PeerConnection isn't exist"),this._createOffer().then((function(t){return e.fetchAnwserSdp(JSON.stringify({sdp:t.sdp}))})).then((function(t){return e._setAnwser(t)})).then((function(){return t?new Promise((function(i,n){var r=setTimeout((function(){var t={type:f.b.NETWORK_ERROR,details:f.a.WEBRTC_CONNECT_TIMEOUT,fatal:!1,reason:"webrtc connect timeout",url:e._src};e._onError(t),n(t)}),e.peerConnectionTimeout);t.addEventListener("connectionstatechange",(function e(){switch(t.connectionState){case"connected":i(void 0),clearTimeout(r),t.removeEventListener("connectionstatechange",e);break;case"closed":case"disconnected":case"failed":clearTimeout(r),t.removeEventListener("connectionstatechange",e),n({type:f.b.NETWORK_ERROR,details:f.a.WEBRTC_CONNECT_FAILED,fatal:!1,reason:t.onconnectionstatechange})}}))})):Promise.reject("PeerConnection isn't exist")})).catch((function(e){return v.b.e("kernel-rtc",e),Promise.reject(e)}))},i._createOffer=function(){var e=this,t=this._pc;return t?t.createOffer().then((function(e){return v.b.i("kernel-rtc","offer",e),t.setLocalDescription(e).then((function(){return e}))}),(function(t){v.b.e("kernel-rtc","offer",t);var i={type:f.b.NETWORK_ERROR,details:f.a.WEBRTC_OFFER_ERROR,fatal:!1,url:e._src,reason:"webrtc createoffer error"+t};return e._onError(i),Promise.reject(i)})):Promise.reject()},i._setAnwser=function(e){var t=this,i=this._pc;if(!i||"closed"===i.signalingState)return Promise.reject();var n=new RTCSessionDescription({type:"answer",sdp:e});return i.setRemoteDescription(n).then((function(e){v.b.i("kernel-rtc","answer",n)}),(function(e){v.b.e("kernel-rtc","answer",e);var i={type:f.b.NETWORK_ERROR,details:f.a.WEBRTC_ANSWER_ERROR,fatal:!1,url:t._src,reason:"webrtc answer error"};return t._onError(i),Promise.reject(i)}))},i._onPCTrack=function(e){var t=this;if(this._ctx.video&&e.streams&&this._stream!==e.streams[0]){var i=this._stream=e.streams[0];this._ctx.video.srcObject=i,this._mediaInfo={},e.streams[0].getTracks().forEach((function(e){var i=e.getSettings();t._mediaInfo.width=i.width||t._mediaInfo.width,t._mediaInfo.height=i.height||t._mediaInfo.height,t._mediaInfo.fps=i.frameRate||t._mediaInfo.fps}))}},i._onPCConnectionStateChange=function(e){var t=this._pc;if(t)switch(v.b.i("kernel-rtc","pcConnectionStateChange",t.connectionState),t.connectionState){case"connecting":case"connected":break;case"disconnected":case"failed":case"closed":this._onError({type:f.b.NETWORK_ERROR,details:f.a.WEBRTC_DISCONNECTED_ERROR,reason:t.connectionState,fatal:!1,url:this._src}),!this._retrying&&this._retry("PeerConnection state is "+t.connectionState)}},i._onPCIceCandidateError=function(e){var t;v.b.i("kernel-rtc","iceCandidateError",e),this._onError({type:f.b.NETWORK_ERROR,details:f.a.WEBRTC_ICE_CANDIDATE_ERROR,fatal:!1,reason:(null==(t=this._pc)?void 0:t.iceConnectionState)||""}),!this._retrying&&this._retry("iceCandidateError")},i._onPCSignalingStateChange=function(e){var t;v.b.i("kernel-rtc","signalingStateChange",null==(t=this._pc)?void 0:t.signalingState)},i._onPCIceConnecttionStateChange=function(e){var t;v.b.i("kernel-rtc","iceConnecttionStateChange",null==(t=this._pc)?void 0:t.iceConnectionState)},i._onIceGatheringStateChange=function(e){var t;v.b.i("kernel-rtc","iceGatheringStateChange",null==(t=this._pc)?void 0:t.iceGatheringState)},i._onIcecandidate=function(e){var t;v.b.i("kernel-rtc","icecandidate",e.candidate),e.candidate&&(null==(t=this._pc)||t.addIceCandidate(new RTCIceCandidate({sdpMLineIndex:0,sdpMid:"0",candidate:e.candidate})).then((function(){return v.b.i("kernel-rtc","addIceCandidate success")}),(function(e){return v.b.e("kernel-rtc","addIceCandidate failed",e)})))},i._disposeLoader=function(){this._loader&&(this._loader.destroy(),this._loader=void 0)},s()(t,[{key:"type",get:function(){return R.a.rtc}}]),t}(Ai),Pn=function(){function e(){var e=this;this._ls=new F,this._timeout=void 0,this._onVideoEvent=function(){var t,i;v.b.i("play-hevc-test","on video event. "+(null==(t=On)?void 0:t.videoWidth)+" "+(null==(i=On)?void 0:i.error)),e._onComplete(!!On&&On.videoWidth>0&&!On.error)};var t=this._ls.read("kwai-kernel-hevc",864e5);void 0!==t&&(wi.playHEVCTest=!!t),v.b.i("play-hevc-test",t)}var t=e.prototype;return t.start=function(){var e;void 0===wi.playHEVCTest&&(null!=(e=On)&&e.src||this._startVideoTest())},t.destroy=function(){this._stopTimer(),this._clearTestVideo()},t._onComplete=function(e){v.b.i("play-hevc-test","complete result: "+e+" "+performance.now()),this._stopTimer(),this._clearTestVideo(),wi.playHEVCTest=e,this._ls.write("kwai-kernel-hevc",e)},t._startVideoTest=function(){v.b.i("play-hevc-test","start video test"),"undefined"!=typeof document?(On||(On=document.createElement("video")),On.preload="metadata",On.addEventListener("error",this._onVideoEvent),On.addEventListener("loadeddata",this._onVideoEvent),On.addEventListener("loadedmetadata",this._onVideoEvent),this._startTimer(),On.src="data:video/mp4;base64,AAAAHGZ0eXBpc29tAAACAGlzb21pc28ybXA0MQAAA01tb292AAAAbG12aGQAAAAAAAAAAAAAAAAAAAPoAAAD6AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAACd3RyYWsAAABcdGtoZAAAAAMAAAAAAAAAAAAAAAEAAAAAAAAD6AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAFAAAAAtAAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAA+gAAAAAAAEAAAAAAe9tZGlhAAAAIG1kaGQAAAAAAAAAAAAAAAAAEk+AABJPgFXEAAAAAAAhaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAAAAAAGmbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAABZnN0YmwAAAECc3RzZAAAAAAAAAABAAAA8mh2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAFAALQAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAB4aHZjQwEBYAAAAJAAAAAAAF3wAPz9+PgAAA8DoAABABhAAQwB//8BYAAAAwCQAAADAAADAF2VmAmhAAEAK0IBAQFgAAADAJAAAAMAAAMAXaACgIAtFllZpJMrwFoCAAADAAIAAAMAAhCiAAEAB0QBwXK0YkAAAAAQcGFzcAAAAAEAAAABAAAAFGJ0cnQAAAAAAAALyAAAC8gAAAAYc3R0cwAAAAAAAAABAAAAAQAST4AAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAABeQAAAAEAAAAUc3RjbwAAAAAAAAABAAADeQAAAGJ1ZHRhAAAAWm1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAALWlsc3QAAAAlqXRvbwAAAB1kYXRhAAAAAQAAAABMYXZmNTkuMjcuMTAwAAAACGZyZWUAAAGBbWRhdAAAABhAAQwB//8BYAAAAwCQAAADAAADAF2VmAkAAAArQgEBAWAAAAMAkAAAAwAAAwBdoAKAgC0WWVmkkyvAWgIAAAMAAgAAAwACEAAAAAdEAcFytGJAAAABHygBrxMYaRpdZVRRRNJK5mjj//0Xz8f2QC1YmO2u+AJADNDyAAADAAADAAADAAADAAAMqKXvcrgFwB8iYAAAAwAAAwAAAwAAAwAAAwAHnJMChCpAAAADAAADAAADAAADAAADAAAgIIcAAAMAAAMAAAMAAAMAAAMAAAMAABEwAAADAAADAAADAAADAAADAAADAAAYsAAAAwAAAwAAAwAAAwAAAwAAAwAEpAAAAwAAAwAAAwAAAwAAAwAAAwAwYAAAAwAAAwAAAwAAAwAAAwAAAwDggAAAAwAAAwAAAwAAAwAAAwAAAwKyAAADAAADAAADAAADAAADAAAEZAAAAwAAAwAAAwAAAwAAAwAAB8QAAAMAAAMAAAMAAAMAAAMAACeg",On.play()):this._onComplete(!1)},t._clearTestVideo=function(){On&&(On.removeEventListener("error",this._onVideoEvent),On.removeEventListener("loadeddata",this._onVideoEvent),On.removeEventListener("loadedmetadata",this._onVideoEvent),On.src="")},t._startTimer=function(){var e=this;this._stopTimer(),this._timeout=setTimeout((function(){v.b.i("play-hevc-test","timeout"),e._onComplete(!1)}),1e3)},t._stopTimer=function(){this._timeout&&(clearTimeout(this._timeout),this._timeout=void 0)},e}(),Mn="kernel",Vn=function(){function e(e,t){var i=this;this._video=void 0,this._ctx=void 0,this._monitor=void 0,this._error=void 0,this._evt=new o.EventEmitter,this._hevcTest=void 0,this._avcore=void 0;var n=this._parseUrlConfig();n&&v.b.level(n),v.b.i(Mn,qi.packName+", "+qi.version+" cors: "+e.crossOrigin+" autoplay: "+e.autoplay,t),this._video=e,this._hevcTest=new Pn,this._ctx=new qi(t||{},this._video),this._ctx.cOutput.setVideo(e),this._ctx.config||setTimeout((function(){i._onError({type:f.b.OTHER_ERROR,details:f.a.CONFIG_ERROR,fatal:!0,reason:"config data error"})}),0),n&&(this._ctx.config.kwaiKernelLog=n),this._monitor=this._initLogger(),this._ctx.config.src&&(this._avcore=this._initAVCore()),v.b.i(Mn,"config",this._ctx.config)}e.isSupport=function(e){if(R.g.webrtc===(null==e?void 0:e.box))return wi.isWebRTCSupported();if(null!=e&&e.nativeFirst)return wi.isVideoBoxSupported(null==e?void 0:e.box);var t=wi.isSupported();if(t){var i=!0;e&&(i=!(!e.isLive||e.box!==R.g.flv));var n=!i||Bi.isStreamingSupported();return t&&!!n}return wi.isVideoBoxSupported(null==e?void 0:e.box)},e.videoCodecCapabilities=function(e){return wi.getVideoCodecCompatibilityByCodec(e)};var t=e.prototype;return t.on=function(e,t){v.b.i(Mn,"call on "+e),this._evt.on(e,t)},t.once=function(e,t){v.b.i(Mn,"call once "+e),this._evt.once(e,t)},t.removeAllListeners=function(e){v.b.i(Mn,"call removeAllListeners"),this._evt.removeAllListeners(e)},t.off=function(e,t){v.b.i(Mn,"call off "+e),this._evt.off(e,t)},t.listeners=function(e){return this._evt.listeners(e)},t.emit=function(e,t){return this._evt.emit(e,t)},t.listenerCount=function(e){return this._evt.listenerCount(e)},t.load=function(t,i){var n,r,a,s=this;(v.b.i(Mn,"call kernel load",t),t&&this._ctx.setSrc(t),this._ctx.src)?(e.isSupport({box:this._ctx.stat.box,isLive:this._ctx.stat.isLive,nativeFirst:this._ctx.stat.native})||setTimeout((function(){s._onError({type:f.b.OTHER_ERROR,details:f.a.UNSUPPORTED,fatal:!0,reason:"unsupported: "+s._ctx.stat.box+" live: "+s._ctx.stat.isLive+" native: "+s._ctx.stat.native})}),0),"number"==typeof(null==i?void 0:i.startFromSec)?this._ctx.stat.startFromSec=i.startFromSec:t&&(this._ctx.stat.startFromSec=0),this._ctx.stat.multipart&&this._ctx.config.resourceBuffer&&function(e){var t;t=e,performance&&("function"==typeof performance.setResourceTimingBufferSize?performance.setResourceTimingBufferSize(t):"function"==typeof performance.webkitSetResourceTimingBufferSize&&performance.webkitSetResourceTimingBufferSize(t)),performance.addEventListener("resourcetimingbufferfull",Ce)}(this._ctx.config.resourceBufferSize),t&&(null==(n=this._avcore)?void 0:n.type)!==((a=this._ctx).stat.box===R.g.webrtc?R.a.rtc:a.stat.native?R.a.native:R.a.mse)&&(null==(r=this._avcore)||r.destroy(),this._avcore=void 0),this._load()):this._onError({type:f.b.OTHER_ERROR,details:f.a.SRC_EMPTY,fatal:!0,reason:"url empty"})},t.getTimeNow=function(){return pt.serverNowMs},t.setAvailableAbrLevels=function(e){var t;v.b.i(Mn,"setAvailableAbrLevels",e),this._ctx.lctx.availableList=e.splice(0),null==(t=this._avcore)||t.onAbrLevelsUpdated()},t.preload=function(e,t){v.b.i(Mn,"call preload"),this._avcore&&"preload"in this._avcore&&this._avcore.preload(e,t)},t.isTimeinBuffered=function(e){return this._ctx.stat.box!==R.g.webrtc&&this._ctx.isTimeinBuffered(e)},t.resume=function(){var e;v.b.i(Mn,"call resume"),null==(e=this._avcore)||e.resume(),this._video.paused&&this._video.play()},t.destroy=function(){var e,t;v.b.i(Mn,"call kernel destroy"),Re(),this._ctx.destroy(),null==(e=this._avcore)||e.destroy(),null==(t=this._monitor)||t.destroy(),this._hevcTest.destroy(),this.removeAllListeners()},t.refresh=function(){var e;v.b.i(Mn,"call kernel refresh"),this._ctx.cOutput.reset(),null==(e=this._avcore)||e.refresh()},t.stopLoad=function(){var e;v.b.i(Mn,"call kernel stopLoad"),null==(e=this._avcore)||e.stopLoad()},t.getStreamTime=function(e){var t=this._ctx.getStreamTime(e/1e3);return t?1e3*t:NaN},t.getAudienceStat=function(){return this._monitor.audienceStat},t.getMediaInfo=function(){var e;return r()({},null==(e=this._ctx.loadRec.currentLoad)?void 0:e.mediaInfo)},t.experiment=function(e){e&&null!=typeof e.startBitrateLimit&&(this._ctx.config.hlsAdaptiveConfig?this._ctx.config.hlsAdaptiveConfig.startBitrateLimit=e.startBitrateLimit:this._ctx.config.hlsAdaptiveConfig={startBitrateLimit:e.startBitrateLimit})},t.liveEnd=function(){v.b.i(Mn,"call liveEnd"),this._avcore&&"liveEnd"in this._avcore&&this._avcore.liveEnd()},t.seekToNextFrame=function(){var e;v.b.i(Mn,"call seekToNextFrame"),null==(e=this._avcore)||e.seekToNextFrame()},t.seekToPrevFrame=function(){var e;v.b.i(Mn,"call seekToPrevFrame"),null==(e=this._avcore)||e.seekToPrevFrame()},t.seekByFrameIndex=function(e){var t;return v.b.i(Mn,"call seekByFrameIndex",e),null==(t=this._avcore)?void 0:t.setCurretVideoFrame(e)},t.bindVPP=function(e){return v.b.i(Mn,"bind vpp. config.mainThreadRendering: "+this._ctx.stat.mainThreadRendering),!1!==this._ctx.stat.mainThreadRendering?(this._ctx.cOutput.bindVPP(e)&&this._rendererChanged(),!0):(v.b.w(Mn,"offscreen causes binding failure. set config.mainThreadRendering=true or bindVpp before play."),!1)},t.unbindVPP=function(e){this._ctx.cOutput.unbindVPP(e)&&this._rendererChanged()},t._load=function(e){var t;this._error=void 0,this._avcore||(this._avcore=this._initAVCore()),null==(t=this._avcore)||t.load(e)},t._initAVCore=function(){var e,t=this,i=this._ctx,n=(e=i).stat.native?new Dn(e):e.stat.box!==R.g.webrtc&&Ri?new Ri(e):e.stat.box===R.g.webrtc&&Nn?new Nn(e):void 0;if(n)return i.stat.coreType=n.type,n.on(p.a.ERROR,(function(e){t._onError(e)})),n.on(p.a.MANIFEST_PARSED,(function(e){e.levels=i.lctx.levels.map((function(e){return e.getKLevel()}));var n=i.lctx.audioTracks;n&&n.length&&(e.audioTrack=i.lctx.audioIdx,e.audioTracks=n.map((function(e){return{lang:e.lang,qualityLabel:e.qualityLabel,qualityType:e.qualityType,bitrate:e.bitrate,groupId:e.groupId}})));var r=i.lctx.subtitleTracks;r&&r.length&&(e.subtitleTrack=i.lctx.subtitleIdx,e.subtitleTracks=r.map((function(e){return{lang:e.lang,name:e.name,groupId:e.groupId}}))),e.currentLevel=i.lctx.currentIdx,e.auto=i.lctx.abr,void 0!==i.stat.stereoType&&(e.stereoType=i.stat.stereoType),t._monitor.onManifest(e),t.emit(p.a.MANIFEST_PARSED,e)})),n.on(p.a.LEVEL_SWITCHING,(function(e){t._monitor.levelSwitching(e),t.emit(p.a.LEVEL_SWITCHING,e)})),n.on(p.a.LEVEL_SWITCHED,(function(e){t._monitor.levelSwitched(),t.emit(p.a.LEVEL_SWITCHED,e)})),n.on(p.a.LEVEL_SWITCH_PLAYING,(function(e){t._monitor.levelSwitchPlaying(),t.emit(p.a.LEVEL_SWITCH_PLAYING,e)})),n.on(p.a.AUDIO_TRACK_SWITCHING,(function(e){t._monitor.onAudioSwitching(),t.emit(p.a.AUDIO_TRACK_SWITCHING,e)})),n.on(p.a.AUDIO_TRACK_SWITCHED,(function(e){t._monitor.onAudioSwitched(),t.emit(p.a.AUDIO_TRACK_SWITCHED,e)})),n.on(p.a.LEVEL_SWITCH_FAILED,(function(e){return t.emit(p.a.LEVEL_SWITCH_FAILED)})),n.on(p.a.STOP_LOAD,(function(e){t._monitor.onStopLoad()})),n.on(p.a.LOAD_END,(function(e){return t.emit(p.a.LOAD_END)})),n.on(p.a.LEVEL_UPDATED,(function(e){t._monitor.onLevel(),t.emit(p.a.LEVEL_UPDATED,e)})),n.on(p.a.AUDIO_TRACK_UPDATED,(function(e){t._monitor.onAudioTrack(),t.emit(p.a.AUDIO_TRACK_UPDATED,e)})),n.on(p.a.SUBTITLE_TRACK_SWITCHED,(function(e){t.emit(p.a.SUBTITLE_TRACK_SWITCHED,e)})),n.on(p.a.PRELOAD_COMPLETE,(function(e){t._monitor.onPreload()})),n.on(p.a.VIDEO_RENDERER_CHANGE,(function(e){t._rendererChanged(e)})),n.on(p.a.DEC_LIB_LOADED,(function(e){t._monitor.onDecLibLoaded(e)})),n.on(p.a.PRIV_NAL,(function(e){return t._monitor.onPrivNal(e)})),n.on(p.a.LOAD,(function(e){return t._monitor.onLoad(e)})),n.on(p.a.PARSING_DATA,(function(e){return t._monitor.onSegment(e)})),n.on(p.a.RAW_DATA,(function(e){return t._monitor.onRaw(e)})),n.on(p.a.WAITING,(function(e,i){return t._monitor.onWaiting(e,i)})),n.on(p.a.LOADEDDATA,(function(){return t._monitor.onLoadeddata()})),n.on(p.a.CANPLAY,(function(){return t._monitor.onCanplay()})),n.on(p.a.SEEKING,(function(e){return t._monitor.onSeek(e)})),n.on(p.a.SEEKED,(function(){return t._monitor.onSeeked()})),n.on(p.a.SEEK_WITH_LOAD,(function(e){return t._monitor.onSeekWithLoad(e)})),n.on(p.a.PLAYING,(function(){return t._monitor.onPlaying()})),n.on(p.a.PAUSE,(function(){return t._monitor.onPause()})),n.on(p.a.PLAY,(function(){return t._monitor.onPlay()})),n.on(p.a.ENDED,(function(){return t._monitor.onEnd()})),n.on(p.a.RATE_CHANGE,(function(e){return t._monitor.onRateChange(e)})),n.on(p.a.PARSING_INIT_SEGMENT,(function(e){return t._monitor.onSegmentInit(e)})),n.on(p.a.TIMEUPDATE,(function(){return t._monitor.onTimeupdate()})),n.on(p.a.PROGRESS,(function(){return t._monitor.onProgress()})),n.on(p.a.HEARTBEAT,(function(e){return t._monitor.heartbeat(e)})),n.on(p.a.MSE_BUFFER_FULL,(function(){return t._monitor.onMSEBufferFull()})),n.on(p.a.MSE_UPDATE,(function(){return t._monitor.mseUpdate()})),n.on(p.a.MSE_REMOVE,(function(){return t._monitor.mseRemove()})),n.on(p.a.MSE_OPEN,(function(){return t._monitor.mseOpen()})),n.on(p.a.LOADER_CHUNK_ARRIVAL,(function(e){return t._monitor.onLoaderChunkArrival(e)})),n.on(p.a.MEDIA_DEMUX,(function(e){return t._monitor.onMediaDemux(e)})),n.on(p.a.MEDIA_CONNECTED,(function(e){return t._monitor.onMediaConnect(e)})),n.on(p.a.KEY_FRAME,(function(){return t._monitor.onKeyFrame()})),n.on(p.a.MUX_INFO,(function(e){return t._monitor.onMuxInfo(e)})),n.on(p.a.USE_BACKUP,(function(){return t._monitor.onUseBackup()})),n.on(p.a.NEW_SOURCE,(function(e){return t._monitor.onNewSource(e)})),n.on(p.a.DISCONTINUITY,(function(e){return t._monitor.onDiscontinuity(e)})),n.on(p.a.METADATA,(function(e){return t._monitor.onMetaData(e)})),n.on(p.a.DOWNLOAD,(function(e){return t._monitor.onDownload(e)})),n.on(p.a.FALLBACK_H264,(function(e){v.b.i(Mn,"fallback h264"),i.canCodecFallback&&(i.stat.fallback264=!0,i.reProcessSrc(R.b.h264),t._recover(e.type,e.message,!1),void 0===wi.playHEVCTest&&(v.b.i(Mn,"play hevc test start"),t._hevcTest.start()))})),n.on(p.a.RETRY,(function(e){return t._recodeRetry(e.type,e.message)})),n},t._initLogger=function(){var e=this,t=new Ln(this._ctx);return t.on(p.a.REPORT,(function(t){e.emit(p.a.REPORT,t)})),t},t._recover=function(e,t,i){var n;void 0===i&&(i=!0),v.b.i(Mn,"recover: "+e+" native:"+this._ctx.stat.native),null==(n=this._avcore)||n.destroy(),this._avcore=void 0,this._recodeRetry(e,t),i&&(this._ctx.stat.native=!this._ctx.stat.native),this._load(R.f.retry),this._video.play()},t._recodeRetry=function(e,t){var i={type:e,message:t,pos:Math.floor(this._video.currentTime),ts:Math.floor(performance.now())};this._monitor.onRetry(i),this._ctx.stat.retryInfos.push(i)},t._onError=function(e){v.b.i(Mn,"on error",e);var t=0===this._ctx.getRetryCnt([R.h.CORE_MSE,R.h.CORE_NATIVE]);if(t&&!this._ctx.stat.native){if(e.details===f.a.DEMUX_NOT_FOUND)return v.b.i(Mn,"demux not found. switch to native"),void this._recover(R.h.CORE_NATIVE,"demux not found");if(this._ctx.stat.box===R.g.mp4&&this._ctx.stat.decoder===R.c.buildin&&(e.details===f.a.SOURCEBUFFER_ERROR||e.details===f.a.MEDIASOURCE_ERROR))return v.b.i(Mn,"mse error. switch to native",this._ctx.stat.box),void this._recover(R.h.CORE_NATIVE,e.reason)}if(t&&$e(this._ctx.stat.box)&&this._ctx.stat.native&&this._video.readyState>=2&&wi.isMSEAvailable())return v.b.i(Mn,"hls native startup failed. switch to mse"),void this._recover(R.h.CORE_MSE,"hls native startup failed");var i=r()({},e);if(i.details===f.a.MANIFEST_PARSING_ERROR)try{ct.isSrcEmpty(this._ctx.src)&&(v.b.i(Mn,"src empty",this._ctx.src),i.details=f.a.SRC_EMPTY),this._ctx.src?"string"==typeof this._ctx.src?i.reason+="src str:"+this._ctx.src.slice(0,1024):this._ctx.src instanceof Blob?i.reason+="src: blob":i.reason+="src other:"+JSON.stringify(this._ctx.src).slice(0,1024):i.reason+="src:"+this._ctx.src}catch(e){i.reason+=e.message}if(i.fatal){var n=Se(i.details,i.reason,i.statusCode||0);if(this.stopLoad(),i.code=n,!this._error){this._monitor.onError(n,i.reason),this._error=i.details;try{this.emit(p.a.ERROR,i)}catch(e){}}}},t._parseUrlConfig=function(){if(location.href){var e=location.href.match(/kwaiKernelLog=([a-z]{1})/);if(e&&e.length>1)return e[1]}return(new F).read("kwai-kernel-log")},t._rendererChanged=function(e){var t=this._ctx.cOutput;void 0===e&&(e={enabled:!0,type:t.rendererType,canvas:t.rendererType===R.o.canvas&&t.canvas?t.canvas:void 0}),v.b.i(Mn,"video renderer change",e),this.emit(p.a.VIDEO_RENDERER_CHANGE,e),e.canvas&&this.emit(p.a.H265_DETECTED,e)},s()(e,[{key:"currentVideoFrame",get:function(){var e;return(null==(e=this._avcore)?void 0:e.getCurrentVideoFrame())||0},set:function(e){var t;v.b.i(Mn,"call set currentVideoFrame",e),null==(t=this._avcore)||t.setCurretVideoFrame(e)}},{key:"totalVideoFrames",get:function(){var e;return(null==(e=this._avcore)?void 0:e.getTotalVideoFrames())||0}},{key:"audioTrack",get:function(){return this._ctx.lctx.audioIdx||0},set:function(e){var t;v.b.i(Mn,"call set audioTrack",e),null==(t=this._avcore)||t.setAudioTrack(e)}},{key:"subtitleTrack",get:function(){return this._ctx.lctx.subtitleIdx||0},set:function(e){var t;v.b.i(Mn,"call set subtitleTrack",e),null==(t=this._avcore)||t.setSubtitleTrack(e)}},{key:"currentLevel",get:function(){return this._ctx.lctx.currentIdx||0},set:function(e){var t;v.b.i(Mn,"call set currentLevel",e),null==(t=this._avcore)||t.setCurrentLevel(e)}},{key:"nextLevel",get:function(){return this._ctx.lctx.nextIdx||0},set:function(e){var t;v.b.i(Mn,"call set nextLevel",e),null==(t=this._avcore)||t.setNextLevel(e)}},{key:"startLevel",get:function(){return this._ctx.lctx.startIdx||0},set:function(e){v.b.i(Mn,"call set startLevel",e),this._ctx.lctx.startIdx=e}},{key:"autoLevelEnabled",get:function(){return this._ctx.lctx.abr}},{key:"monitorData",get:function(){return this._monitor&&this._avcore?r()(this._monitor.snapshot,{trackBufInfo:this._avcore.getTrackBufInfo()}):null}}],[{key:"version",get:function(){return qi.version}},{key:"MediaBox",get:function(){return R.g}},{key:"Events",get:function(){return{REPORT:p.a.REPORT,ERROR:p.a.ERROR,LEVEL_SWITCHING:p.a.LEVEL_SWITCHING,LEVEL_SWITCHED:p.a.LEVEL_SWITCHED,LEVEL_SWITCH_PLAYING:p.a.LEVEL_SWITCH_PLAYING,LEVEL_SWITCH_FAILED:p.a.LEVEL_SWITCH_FAILED,AUDIO_TRACK_SWITCHING:p.a.AUDIO_TRACK_SWITCHING,AUDIO_TRACK_SWITCHED:p.a.AUDIO_TRACK_SWITCHED,AUDIO_TRACK_UPDATED:p.a.AUDIO_TRACK_UPDATED,SUBTITLE_TRACK_SWITCHED:p.a.SUBTITLE_TRACK_SWITCHED,MANIFEST_PARSED:p.a.MANIFEST_PARSED,LEVEL_UPDATED:p.a.LEVEL_UPDATED,LOAD_END:p.a.LOAD_END,VIDEO_RENDERER_CHANGE:p.a.VIDEO_RENDERER_CHANGE}}},{key:"Reports",get:function(){return{METADATA:Hi.METADATA,MEDIA_INFO:Hi.MEDIA_INFO,HEARTBEAT:Hi.HEARTBEAT,DOWNLOAD:Hi.DOWNLOAD,REALTIME_BEACON:Hi.REALTIME_BEACON,DISCONTINUITY:Hi.DISCONTINUITY}}}]),e}();function Fn(e,t){return new Vn(e,t)}}]);void 0===F&&console.error("esm-webpack-plugin: nothing exported!");var U=F.default;F.createKernel,F.DownloadStatus,F.LOG_LEVEL;var B=F.KEvents;F.REPORT_TYPES,F.CodecType,F.Decoder,F.DemuxerType,F.HttpRangeType,F.MediaBox,F.VideoDecBlockPolicy,F.VideoDropFramePolicy,F.VideoRendererType,F.WasmDecoder,F.StereoType;var H,j="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==i.g?i.g:"undefined"!=typeof self?self:{},W={exports:{}},z="object"==typeof Reflect?Reflect:null,G=z&&"function"==typeof z.apply?z.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};H=z&&"function"==typeof z.ownKeys?z.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var K=Number.isNaN||function(e){return e!=e};function Y(){Y.init.call(this)}W.exports=Y,W.exports.once=function(e,t){return new Promise((function(i,n){function r(i){e.removeListener(t,a),n(i)}function a(){"function"==typeof e.removeListener&&e.removeListener("error",r),i([].slice.call(arguments))}ne(e,t,a,{once:!0}),"error"!==t&&function(e,t,i){"function"==typeof e.on&&ne(e,"error",t,i)}(e,r,{once:!0})}))},Y.EventEmitter=Y,Y.prototype._events=void 0,Y.prototype._eventsCount=0,Y.prototype._maxListeners=void 0;var X=10;function q(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function Z(e){return void 0===e._maxListeners?Y.defaultMaxListeners:e._maxListeners}function Q(e,t,i,n){var r,a,s,o;if(q(i),void 0===(a=e._events)?(a=e._events=Object.create(null),e._eventsCount=0):(void 0!==a.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),a=e._events),s=a[t]),void 0===s)s=a[t]=i,++e._eventsCount;else if("function"==typeof s?s=a[t]=n?[i,s]:[s,i]:n?s.unshift(i):s.push(i),(r=Z(e))>0&&s.length>r&&!s.warned){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,o=c,console&&console.warn&&console.warn(o)}return e}function J(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function $(e,t,i){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},r=J.bind(n);return r.listener=i,n.wrapFn=r,r}function ee(e,t,i){var n=e._events;if(void 0===n)return[];var r=n[t];return void 0===r?[]:"function"==typeof r?i?[r.listener||r]:[r]:i?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(r):ie(r,r.length)}function te(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function ie(e,t){for(var i=new Array(t),n=0;n<t;++n)i[n]=e[n];return i}function ne(e,t,i,n){if("function"==typeof e.on)n.once?e.once(t,i):e.on(t,i);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function r(a){n.once&&e.removeEventListener(t,r),i(a)}))}}Object.defineProperty(Y,"defaultMaxListeners",{enumerable:!0,get:function(){return X},set:function(e){if("number"!=typeof e||e<0||K(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");X=e}}),Y.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Y.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||K(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},Y.prototype.getMaxListeners=function(){return Z(this)},Y.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var n="error"===e,r=this._events;if(void 0!==r)n=n&&void 0===r.error;else if(!n)return!1;if(n){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var o=r[e];if(void 0===o)return!1;if("function"==typeof o)G(o,this,t);else{var c=o.length,_=ie(o,c);for(i=0;i<c;++i)G(_[i],this,t)}return!0},Y.prototype.addListener=function(e,t){return Q(this,e,t,!1)},Y.prototype.on=Y.prototype.addListener,Y.prototype.prependListener=function(e,t){return Q(this,e,t,!0)},Y.prototype.once=function(e,t){return q(t),this.on(e,$(this,e,t)),this},Y.prototype.prependOnceListener=function(e,t){return q(t),this.prependListener(e,$(this,e,t)),this},Y.prototype.removeListener=function(e,t){var i,n,r,a,s;if(q(t),void 0===(n=this._events))return this;if(void 0===(i=n[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(r=-1,a=i.length-1;a>=0;a--)if(i[a]===t||i[a].listener===t){s=i[a].listener,r=a;break}if(r<0)return this;0===r?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,r),1===i.length&&(n[e]=i[0]),void 0!==n.removeListener&&this.emit("removeListener",e,s||t)}return this},Y.prototype.off=Y.prototype.removeListener,Y.prototype.removeAllListeners=function(e){var t,i,n;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var r,a=Object.keys(i);for(n=0;n<a.length;++n)"removeListener"!==(r=a[n])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},Y.prototype.listeners=function(e){return ee(this,e,!0)},Y.prototype.rawListeners=function(e){return ee(this,e,!1)},Y.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):te.call(e,t)},Y.prototype.listenerCount=te,Y.prototype.eventNames=function(){return this._eventsCount>0?H(this._events):[]};var re,ae,se=W.exports,oe={exports:{}};re=oe,ae=oe.exports,function(e,t){var i="function",n="undefined",r="object",a="string",s="model",o="name",c="type",_="vendor",d="version",u="architecture",l="console",h="mobile",f="tablet",p="smarttv",m="wearable",v="embedded",g="Amazon",y="Apple",E="ASUS",b="BlackBerry",A="Firefox",T="Google",S="Huawei",R="LG",x="Microsoft",L="Motorola",C="Opera",D="Samsung",I="Sony",w="Xiaomi",k="Zebra",O="Facebook",N=function(e){for(var t={},i=0;i<e.length;i++)t[e[i].toUpperCase()]=e[i];return t},P=function(e,t){return typeof e===a&&-1!==M(t).indexOf(M(e))},M=function(e){return e.toLowerCase()},V=function(e,t){if(typeof e===a)return e=e.replace(/^\s\s*/,"").replace(/\s\s*$/,""),typeof t===n?e:e.substring(0,255)},F=function(e,n){for(var a,s,o,c,_,d,u=0;u<n.length&&!_;){var l=n[u],h=n[u+1];for(a=s=0;a<l.length&&!_;)if(_=l[a++].exec(e))for(o=0;o<h.length;o++)d=_[++s],typeof(c=h[o])===r&&c.length>0?2===c.length?typeof c[1]==i?this[c[0]]=c[1].call(this,d):this[c[0]]=c[1]:3===c.length?typeof c[1]!==i||c[1].exec&&c[1].test?this[c[0]]=d?d.replace(c[1],c[2]):t:this[c[0]]=d?c[1].call(this,d,c[2]):t:4===c.length&&(this[c[0]]=d?c[3].call(this,d.replace(c[1],c[2])):t):this[c]=d||t;u+=2}},U=function(e,i){for(var n in i)if(typeof i[n]===r&&i[n].length>0){for(var a=0;a<i[n].length;a++)if(P(i[n][a],e))return"?"===n?t:n}else if(P(i[n],e))return"?"===n?t:n;return e},B={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},H={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[d,[o,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[d,[o,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[o,d],[/opios[\/ ]+([\w\.]+)/i],[d,[o,"Opera Mini"]],[/\bopr\/([\w\.]+)/i],[d,[o,C]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[o,d],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[d,[o,"UCBrowser"]],[/\bqbcore\/([\w\.]+)/i],[d,[o,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[d,[o,"WeChat"]],[/konqueror\/([\w\.]+)/i],[d,[o,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[d,[o,"IE"]],[/yabrowser\/([\w\.]+)/i],[d,[o,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[o,/(.+)/,"$1 Secure Browser"],d],[/\bfocus\/([\w\.]+)/i],[d,[o,"Firefox Focus"]],[/\bopt\/([\w\.]+)/i],[d,[o,"Opera Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[d,[o,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[d,[o,"Dolphin"]],[/coast\/([\w\.]+)/i],[d,[o,"Opera Coast"]],[/miuibrowser\/([\w\.]+)/i],[d,[o,"MIUI Browser"]],[/fxios\/([-\w\.]+)/i],[d,[o,A]],[/\bqihu|(qi?ho?o?|360)browser/i],[[o,"360 Browser"]],[/(oculus|samsung|sailfish)browser\/([\w\.]+)/i],[[o,/(.+)/,"$1 Browser"],d],[/(comodo_dragon)\/([\w\.]+)/i],[[o,/_/g," "],d],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[o,d],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i],[o],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[o,O],d],[/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[o,d],[/\bgsa\/([\w\.]+) .*safari\//i],[d,[o,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[d,[o,"Chrome Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[o,"Chrome WebView"],d],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[d,[o,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[o,d],[/version\/([\w\.]+) .*mobile\/\w+ (safari)/i],[d,[o,"Mobile Safari"]],[/version\/([\w\.]+) .*(mobile ?safari|safari)/i],[d,o],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[o,[d,U,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[o,d],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[o,"Netscape"],d],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[d,[o,"Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[o,d]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[u,"amd64"]],[/(ia32(?=;))/i],[[u,M]],[/((?:i[346]|x)86)[;\)]/i],[[u,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[u,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[u,"armhf"]],[/windows (ce|mobile); ppc;/i],[[u,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[u,/ower/,"",M]],[/(sun4\w)[;\)]/i],[[u,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[u,M]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[pt]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[s,[_,D],[c,f]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[s,[_,D],[c,h]],[/\((ip(?:hone|od)[\w ]*);/i],[s,[_,y],[c,h]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[s,[_,y],[c,f]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[s,[_,S],[c,f]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}-[atu]?[ln][01259x][012359][an]?)\b(?!.+d\/s)/i],[s,[_,S],[c,h]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[s,/_/g," "],[_,w],[c,h]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[s,/_/g," "],[_,w],[c,f]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[s,[_,"OPPO"],[c,h]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[s,[_,"Vivo"],[c,h]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[s,[_,"Realme"],[c,h]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[s,[_,L],[c,h]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[s,[_,L],[c,f]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[s,[_,R],[c,f]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[s,[_,R],[c,h]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[s,[_,"Lenovo"],[c,f]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[s,/_/g," "],[_,"Nokia"],[c,h]],[/(pixel c)\b/i],[s,[_,T],[c,f]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[s,[_,T],[c,h]],[/droid.+ ([c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[s,[_,I],[c,h]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[s,"Xperia Tablet"],[_,I],[c,f]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[s,[_,"OnePlus"],[c,h]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[s,[_,g],[c,f]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[s,/(.+)/g,"Fire Phone $1"],[_,g],[c,h]],[/(playbook);[-\w\),; ]+(rim)/i],[s,_,[c,f]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[s,[_,b],[c,h]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[s,[_,E],[c,f]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[s,[_,E],[c,h]],[/(nexus 9)/i],[s,[_,"HTC"],[c,f]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic|sony)[-_ ]?([-\w]*)/i],[_,[s,/_/g," "],[c,h]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[s,[_,"Acer"],[c,f]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[s,[_,"Meizu"],[c,h]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[s,[_,"Sharp"],[c,h]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[_,s,[c,h]],[/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[_,s,[c,f]],[/(surface duo)/i],[s,[_,x],[c,f]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[s,[_,"Fairphone"],[c,h]],[/(u304aa)/i],[s,[_,"AT&T"],[c,h]],[/\bsie-(\w*)/i],[s,[_,"Siemens"],[c,h]],[/\b(rct\w+) b/i],[s,[_,"RCA"],[c,f]],[/\b(venue[\d ]{2,7}) b/i],[s,[_,"Dell"],[c,f]],[/\b(q(?:mv|ta)\w+) b/i],[s,[_,"Verizon"],[c,f]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[s,[_,"Barnes & Noble"],[c,f]],[/\b(tm\d{3}\w+) b/i],[s,[_,"NuVision"],[c,f]],[/\b(k88) b/i],[s,[_,"ZTE"],[c,f]],[/\b(nx\d{3}j) b/i],[s,[_,"ZTE"],[c,h]],[/\b(gen\d{3}) b.+49h/i],[s,[_,"Swiss"],[c,h]],[/\b(zur\d{3}) b/i],[s,[_,"Swiss"],[c,f]],[/\b((zeki)?tb.*\b) b/i],[s,[_,"Zeki"],[c,f]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[_,"Dragon Touch"],s,[c,f]],[/\b(ns-?\w{0,9}) b/i],[s,[_,"Insignia"],[c,f]],[/\b((nxa|next)-?\w{0,9}) b/i],[s,[_,"NextBook"],[c,f]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[_,"Voice"],s,[c,h]],[/\b(lvtel\-)?(v1[12]) b/i],[[_,"LvTel"],s,[c,h]],[/\b(ph-1) /i],[s,[_,"Essential"],[c,h]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[s,[_,"Envizen"],[c,f]],[/\b(trio[-\w\. ]+) b/i],[s,[_,"MachSpeed"],[c,f]],[/\btu_(1491) b/i],[s,[_,"Rotor"],[c,f]],[/(shield[\w ]+) b/i],[s,[_,"Nvidia"],[c,f]],[/(sprint) (\w+)/i],[_,s,[c,h]],[/(kin\.[onetw]{3})/i],[[s,/\./g," "],[_,x],[c,h]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[s,[_,k],[c,f]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[s,[_,k],[c,h]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[_,s,[c,l]],[/droid.+; (shield) bui/i],[s,[_,"Nvidia"],[c,l]],[/(playstation [345portablevi]+)/i],[s,[_,I],[c,l]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[s,[_,x],[c,l]],[/smart-tv.+(samsung)/i],[_,[c,p]],[/hbbtv.+maple;(\d+)/i],[[s,/^/,"SmartTV"],[_,D],[c,p]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[_,R],[c,p]],[/(apple) ?tv/i],[_,[s,"Apple TV"],[c,p]],[/crkey/i],[[s,"Chromecast"],[_,T],[c,p]],[/droid.+aft(\w)( bui|\))/i],[s,[_,g],[c,p]],[/\(dtv[\);].+(aquos)/i],[s,[_,"Sharp"],[c,p]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w ]*; *(\w[^;]*);([^;]*)/i],[[_,V],[s,V],[c,p]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[c,p]],[/((pebble))app/i],[_,s,[c,m]],[/droid.+; (glass) \d/i],[s,[_,T],[c,m]],[/droid.+; (wt63?0{2,3})\)/i],[s,[_,k],[c,m]],[/(quest( 2)?)/i],[s,[_,O],[c,m]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[_,[c,v]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[s,[c,h]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[s,[c,f]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[c,f]],[/(phone|mobile(?:[;\/]| safari)|pda(?=.+windows ce))/i],[[c,h]],[/(android[-\w\. ]{0,9});.+buil/i],[s,[_,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[d,[o,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[d,[o,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[o,d],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[d,o]],os:[[/microsoft (windows) (vista|xp)/i],[o,d],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[o,[d,U,B]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[o,"Windows"],[d,U,B]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[d,/_/g,"."],[o,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[o,"Mac OS"],[d,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86)/i],[d,o],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[o,d],[/\(bb(10);/i],[d,[o,b]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[d,[o,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[d,[o,"Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[d,[o,"webOS"]],[/crkey\/([\d\.]+)/i],[d,[o,"Chromecast"]],[/(cros) [\w]+ ([\w\.]+\w)/i],[[o,"Chromium OS"],d],[/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[o,d],[/(sunos) ?([\w\.\d]*)/i],[[o,"Solaris"],d],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[o,d]]},j=function i(s,o){if(typeof s===r&&(o=s,s=t),!(this instanceof i))return new i(s,o).getResult();var c=s||(typeof e!==n&&e.navigator&&e.navigator.userAgent?e.navigator.userAgent:""),_=o?function(e,t){var i={};for(var n in e)t[n]&&t[n].length%2==0?i[n]=t[n].concat(e[n]):i[n]=e[n];return i}(H,o):H;return this.getBrowser=function(){var e,i={};return i.name=t,i.version=t,F.call(i,c,_.browser),i.major=typeof(e=i.version)===a?e.replace(/[^\d\.]/g,"").split(".")[0]:t,i},this.getCPU=function(){var e={};return e.architecture=t,F.call(e,c,_.cpu),e},this.getDevice=function(){var e={};return e.vendor=t,e.model=t,e.type=t,F.call(e,c,_.device),e},this.getEngine=function(){var e={};return e.name=t,e.version=t,F.call(e,c,_.engine),e},this.getOS=function(){var e={};return e.name=t,e.version=t,F.call(e,c,_.os),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return c},this.setUA=function(e){return c=typeof e===a&&e.length>255?V(e,255):e,this},this.setUA(c),this};j.VERSION="1.0.2",j.BROWSER=N([o,d,"major"]),j.CPU=N([u]),j.DEVICE=N([s,_,c,l,h,p,f,m,v]),j.ENGINE=j.OS=N([o,d]),re.exports&&(ae=re.exports=j),ae.UAParser=j;var W=typeof e!==n&&(e.jQuery||e.Zepto);if(W&&!W.ua){var z=new j;W.ua=z.getResult(),W.ua.get=function(){return z.getUA()},W.ua.set=function(e){z.setUA(e);var t=z.getResult();for(var i in t)W.ua[i]=t[i]}}}("object"==typeof window?window:j);var ce=new(0,oe.exports),_e=function(e){return e.ERROR="error",e.MANIFEST_PARSED="manifestparsed",e.LEVEL_SWITCHING="levelswitching",e.LEVEL_SWITCHED="levelswitched",e.LEVEL_SWITCH_PLAYING="levelswitchplaying",e.LEVEL_SWITCH_FAILED="levelswitchfailed",e.AUDIO_TRACKS_SWITCHING="audiotrackswitching",e.AUDIO_TRACKS_SWITCHED="audiotrackswitched",e.LOADSTART="loadstart",e.PROGRESS="progress",e.SUSPEND="suspend",e.ABORT="abort",e.EMPTIED="emptied",e.STALLED="stalled",e.LOADEDMETADATA="loadedmetadata",e.LOADEDDATA="loadeddata",e.CANPLAY="canplay",e.CANPLAYTHROUGH="canplaythrough",e.PLAYING="playing",e.WAITING="waiting",e.SEEKING="seeking",e.SEEKED="seeked",e.ENDED="ended",e.DURATIONCHANGE="durationchange",e.TIMEUPDATE="timeupdate",e.PLAY="play",e.PAUSE="pause",e.RATECHANGE="ratechange",e.RESIZE="resize",e.VOLUMECHANGE="volumechange",e.ENTER_PICTURE_IN_PICTURE="enterpictureinpicture",e.LEAVE_PICTURE_IN_PICTURE="leavepictureinpicture",e.REPORT="report",e.VIDEO_RENDERER_CHANGE="videorendererchange",e.FULLSCREEN_CHANGE="fullscreenchange",e.ATTRIBUTE_CHANGE_SRC="attribute:change:src",e.ATTRIBUTE_CHANGE_CONTROLS="attribute:change:controls",e.ATTRIBUTE_CHANGE_CONFIG="attribute:change:config",e}(_e||{}),de="kwai-player",ue="pluginBase",le=function(e){l()(i,e);var t=L(i);function i(){var e;return g()(this,i),e=t.call(this),D(d()(e),"plugins",[]),e}return E()(i,[{key:"register",value:function(e){if(N.i(ue,"register",e.name),-1!==this.plugins.indexOf(e))throw new Error("plugin registered");this.plugins.push(e)}},{key:"deregister",value:function(e){if(N.i(ue,"deregister",e.name),-1===this.plugins.indexOf(e))throw new Error("plugin unregistered");this.plugins=this.plugins.filter((function(t){return t!=e}))}},{key:"initialize",value:function(e){var t,i=[],n=R(this.plugins,!0);try{for(n.s();!(t=n.n()).done;){var r=t.value;try{if(e&&!1===e[r.name])continue;var a=new r;i.push(a)}catch(e){console.error("plugin initialize error",e)}}}catch(e){n.e(e)}finally{n.f()}return i}},{key:"beforeInstallPlugins",value:function(e,t,i){N.i(ue,"beforeInstallPlugins",i);var n,r=R(t,!0);try{for(r.s();!(n=r.n()).done;){var a=n.value;try{if(!a.beforeInstall)continue;void 0!==i&&"object"==typeof i[a.name]?a.beforeInstall(e,i[a.name]):void 0!==i&&!0!==i[a.name]&&void 0!==i[a.name]||a.beforeInstall(e)}catch(e){console.error("beforeInstallPlugins error",e)}}}catch(e){r.e(e)}finally{r.f()}return t}},{key:"afterInstallPlugins",value:function(e,t,i){N.i(ue,"afterInstallPlugins",i);var n,r=R(t,!0);try{for(r.s();!(n=r.n()).done;){var a=n.value;try{if(!a.afterInstall)continue;void 0!==i&&"object"==typeof i[a.name]?a.afterInstall(e,i[a.name]):void 0!==i&&!0!==i[a.name]&&void 0!==i[a.name]||a.afterInstall(e)}catch(e){console.error("afterInstallPlugins error",e)}}}catch(e){r.e(e)}finally{r.f()}return t}},{key:"beforeUninstallPlugins",value:function(e){N.i(ue,"beforeUninstallPlugins",e);var t,i=R(e._plugins,!0);try{for(i.s();!(t=i.n()).done;){var n=t.value;try{if(!n.beforeUninstall)continue;n.beforeUninstall.call(n,e)}catch(e){console.error("plugin beforeUninstall error",e)}}}catch(e){i.e(e)}finally{i.f()}}},{key:"afterUninstallPlugins",value:function(e){N.i(ue,"afterUninstallPlugins",e);var t,i=R(e._plugins,!0);try{for(i.s();!(t=i.n()).done;){var n=t.value;try{if(!n.afterUninstall)continue;n.afterUninstall.call(n,e)}catch(e){console.error("plugin afterUninstall error",e)}}}catch(e){i.e(e)}finally{i.f()}e._plugins=[]}}]),i}(W.exports.EventEmitter),he=function(e){l()(i,e);var t=L(i);function i(){return g()(this,i),t.apply(this,arguments)}return i}(W.exports.EventEmitter);V();var fe=function(){function e(t){var i=this;g()(this,e),D(this,"_evt"),D(this,"_element"),D(this,"_isFillWindow",!1),D(this,"_originStyle"),D(this,"_isSupportFullscreen",!0),D(this,"_onFullscreenChange",(function(){N.i("fullscreen","_onFullscreenChange",i.isFull()),i.isFull()||i._recoverStyle(),i._isFillWindow=!1,i._evt.emit("fullChange",{type:"system",isFull:i.isFull()})})),this._evt=t,this._isSupportFullscreen=void 0!==this._getExitFullscreenFunc()&&!("iOS"===ce.getOS().name&&"mobile"===ce.getDevice().type),"onfullscreenchange"in document?(document.addEventListener("fullscreenchange",this._onFullscreenChange),document.addEventListener("fullscreenerror",this._onFullscreenChange)):"onwebkitfullscreenchange"in document&&(document.addEventListener("webkitfullscreenchange",this._onFullscreenChange),document.addEventListener("webkitfullscreenerror",this._onFullscreenChange))}return E()(e,[{key:"destroy",value:function(){document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("fullscreenerror",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenerror",this._onFullscreenChange)}},{key:"requestFull",value:function(e,t){"system"===t?this.requestFullscreen(e):"window"===t?this.requestFillWindow(e):this._isSupportFullscreen?this.requestFullscreen(e):this.requestFillWindow(e)}},{key:"exitFull",value:function(e){return"system"===e?this.exitFullscreen():"window"===e?this.exitFillWindow():void(this.isFull("system")?this.exitFullscreen():this.exitFillWindow())}},{key:"isFull",value:function(e){return"system"===e?this.isFullScreen():"window"===e?this.isFillWindow():this.isFullScreen()||this.isFillWindow()}},{key:"requestFullscreen",value:function(e){this._element=e,this._originStyle||this._saveOriginStyle(e),("Mac OS"===ce.getOS().name||"IE"===ce.getBrowser().name||"iOS"===ce.getOS().name&&"mobile"!==ce.getDevice().type)&&(e.style.width="100%",e.style.height="100%",e.style.background="black");var t,i=e;i.requestFullscreen?t=i.requestFullscreen():i.mozRequestFullScreen?t=i.mozRequestFullScreen():i.webkitRequestFullScreen?t=i.webkitRequestFullscreen():i.msRequestFullscreen&&(t=i.msRequestFullscreen()),t instanceof Promise&&t.catch((function(e){return N.e(e)}))}},{key:"exitFullscreen",value:function(){this._recoverStyle(),this._element=void 0;var e=document;e.exitFullscreen?e.exitFullscreen():e.webkitCancelFullScreen?e.webkitCancelFullScreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.msExitFullscreen&&e.msExitFullscreen()}},{key:"isFullScreen",value:function(){var e=document;return!!(e.fullscreen||e.fullscreenElement||e.isFullScreen||e.webkitIsFullScreen||e.mozFullScreen||e.msFullscreenElement)}},{key:"requestFillWindow",value:function(e){this._element=e,this._originStyle||this._saveOriginStyle(e),e.style.width="100%",e.style.height="100%",e.style.background="black",e.style.position="fixed",e.style.left="0",e.style.top="0",this._isFillWindow=!0,this._evt.emit("fullChange",{type:"window",isFull:!0})}},{key:"exitFillWindow",value:function(){this._recoverStyle(),this._isFillWindow=!1,this._element=void 0,this._evt.emit("fullChange",{type:"window",isFull:!1})}},{key:"isFillWindow",value:function(){return this._isFillWindow}},{key:"_getExitFullscreenFunc",value:function(){var e=document;return e.exitFullscreen||e.webkitCancelFullScreen||e.mozCancelFullScreen||e.msExitFullscreen}},{key:"_saveOriginStyle",value:function(e){this._originStyle={position:e.style.position,background:e.style.background,width:e.style.width,height:e.style.height,left:e.style.left,right:e.style.right}}},{key:"_recoverStyle",value:function(){if(this._element)for(var e in this._originStyle)this._element.style[e]=this._originStyle[e];this._originStyle=void 0}}]),e}(),pe="native";V();var me=function(e){l()(i,e);var t=L(i);function i(e,n){var r,a;if(g()(this,i),r=t.call(this),D(d()(r),"_eventHandlers"),D(d()(r),"_evt"),D(d()(r),"_mainDom"),D(d()(r),"_playerControls"),D(d()(r),"_video"),D(d()(r),"_kernel"),D(d()(r),"_error"),D(d()(r),"_config"),D(d()(r),"_src",""),D(d()(r),"_autoplay",!1),D(d()(r),"_preload","none"),D(d()(r),"_poster",""),D(d()(r),"_disableDownload",!1),D(d()(r),"_disableAdaptive",!0),D(d()(r),"_controls","default"),D(d()(r),"_videoWidth",0),D(d()(r),"_videoHeight",0),D(d()(r),"_canvas"),D(d()(r),"_mediaInfo"),D(d()(r),"_full"),D(d()(r),"subContainerNumber",0),D(d()(r),"_plugins",[]),D(d()(r),"_data"),D(d()(r),"requestFullscreen",(function(e){N.i(pe,"requestFullscreen"),r._mainDom&&(r._full.isFull(e)||r._full.requestFull(r._mainDom,e))})),D(d()(r),"exitFullscreen",(function(e){N.i(pe,"exitFullscreen"),r._mainDom&&r._full.isFull(e)&&r._full.exitFull(e)})),D(d()(r),"_onFullscreenchange",(function(e){r._updateCanvasSize(e.isFull),r.emit(_e.FULLSCREEN_CHANGE,e)})),D(d()(r),"_onMutedChange",(function(e){r._video&&(r._video.muted=e)})),D(d()(r),"_onVideoLoadstart",(function(){r.emit(_e.LOADSTART)})),D(d()(r),"_onVideoProgress",(function(){r.emit(_e.PROGRESS)})),D(d()(r),"_onVideoSuspend",(function(){r.emit(_e.SUSPEND)})),D(d()(r),"_onVideoAbort",(function(){r.emit(_e.ABORT)})),D(d()(r),"_onVideoEmptied",(function(){r.emit(_e.EMPTIED)})),D(d()(r),"_onVideoStalled",(function(){r.emit(_e.STALLED)})),D(d()(r),"_onVideoLoadedmetadata",(function(){r.emit(_e.LOADEDMETADATA)})),D(d()(r),"_onVideoLoadeddata",(function(){r.emit(_e.LOADEDDATA)})),D(d()(r),"_onVideoCanplay",(function(){r.emit(_e.CANPLAY)})),D(d()(r),"_onVideoCanplaythrough",(function(){r.emit(_e.CANPLAYTHROUGH)})),D(d()(r),"_onVideoPlaying",(function(){r.emit(_e.PLAYING)})),D(d()(r),"_onVideoWaiting",(function(){r.emit(_e.WAITING)})),D(d()(r),"_onVideoSeeking",(function(){r.emit(_e.SEEKING)})),D(d()(r),"_onVideoSeeked",(function(){r.emit(_e.SEEKED)})),D(d()(r),"_onVideoEnded",(function(){r.emit(_e.ENDED)})),D(d()(r),"_onVideoDurationchange",(function(){r.emit(_e.DURATIONCHANGE)})),D(d()(r),"_onVideoTimeupdate",(function(){r._playerControls&&(r._playerControls.currentTime=r.currentTime),r.emit(_e.TIMEUPDATE)})),D(d()(r),"_onVideoPlay",(function(){r.emit(_e.PLAY)})),D(d()(r),"_onVideoPause",(function(){r.emit(_e.PAUSE)})),D(d()(r),"_onVideoRatechange",(function(){r.emit(_e.RATECHANGE)})),D(d()(r),"_onVideoResize",(function(){r.emit(_e.RESIZE)})),D(d()(r),"_onVideoVolumechange",(function(){r.emit(_e.VOLUMECHANGE)})),D(d()(r),"_onVideoEnterpictureinpicture",(function(){r.emit(_e.ENTER_PICTURE_IN_PICTURE)})),D(d()(r),"_onVideoLeavepictureinpicture",(function(){r.emit(_e.LEAVE_PICTURE_IN_PICTURE)})),N.i(pe,"1.0.6-alpha.5",e,n,document),r.off||(r.off=r.removeListener),r._data=n,r._mainDom=document.querySelector(e),!r._mainDom)throw new Error("Container not found.");return r._mainDom.className=r._mainDom.className?r._mainDom.className+" "+de:de,r._mainDom.setAttribute("role","player"),r._evt=new se,r._full=new fe(r._evt),r._evt.on("fullChange",r._onFullscreenchange),r._eventHandlers={loadstart:r._onVideoLoadstart,progress:r._onVideoProgress,suspend:r._onVideoSuspend,abort:r._onVideoAbort,emptied:r._onVideoEmptied,stalled:r._onVideoStalled,loadedmetadata:r._onVideoLoadedmetadata,loadeddata:r._onVideoLoadeddata,canplay:r._onVideoCanplay,canplaythrough:r._onVideoCanplaythrough,playing:r._onVideoPlaying,waiting:r._onVideoWaiting,seeking:r._onVideoSeeking,seeked:r._onVideoSeeked,ended:r._onVideoEnded,durationchange:r._onVideoDurationchange,timeupdate:r._onVideoTimeupdate,play:r._onVideoPlay,pause:r._onVideoPause,ratechange:r._onVideoRatechange,resize:r._onVideoResize,volumechange:r._onVideoVolumechange,enterpictureinpicture:r._onVideoEnterpictureinpicture,leavepictureinpicture:r._onVideoLeavepictureinpicture},n&&void 0!==n.controls&&(r.controls=n.controls),r._plugins=i.pluginBase.initialize(null==n?void 0:n.plugins),i.pluginBase.beforeInstallPlugins(d()(r),r._plugins,null==n?void 0:n.plugins),r._initDom(),n&&r._parseData(n),((null==(a=r._config)?void 0:a.src)||r._src)&&r._initKernel(),i.pluginBase.afterInstallPlugins(d()(r),r._plugins,null==n?void 0:n.plugins),r}return E()(i,[{key:"config",get:function(){return this._config},set:function(e){N.i(pe,"call set config",e),this._config=e,this._initKernel(),this.emit(_e.ATTRIBUTE_CHANGE_CONFIG,e)}},{key:"error",get:function(){return this._error}},{key:"src",get:function(){return this._src},set:function(e){N.i(pe,"call set src",e),this._src=e,this._initKernel(),this.emit(_e.ATTRIBUTE_CHANGE_SRC,e)}},{key:"crossOrigin",get:function(){return this._video?this._video.crossOrigin:null},set:function(e){N.i(pe,"call set crossOrigin",e),this._video&&(this._video.crossOrigin=e)}},{key:"networkState",get:function(){return this._video?this._video.networkState:0}},{key:"preload",get:function(){return this._preload},set:function(e){N.i(pe,"call set preload",e),this._preload=e}},{key:"buffered",get:function(){var e;return null==(e=this._video)?void 0:e.buffered}},{key:"readyState",get:function(){return this._video?this._video.readyState:0}},{key:"seeking",get:function(){var e;return!!(null==(e=this._video)?void 0:e.seeking)}},{key:"currentTime",get:function(){return this._video?this._video.currentTime:0},set:function(e){this._video&&(this._video.currentTime=e)}},{key:"duration",get:function(){return this._video?this._video.duration:NaN}},{key:"paused",get:function(){return!this._video||this._video.paused}},{key:"defaultPlaybackRate",get:function(){return this._video?this._video.defaultPlaybackRate:1},set:function(e){N.i(pe,"call set defaultPlaybackRate",e),this._video&&(this._video.defaultPlaybackRate=e)}},{key:"playbackRate",get:function(){return this._video?this._video.playbackRate:1},set:function(e){N.i(pe,"call set playbackRate",e),this._video&&(this._video.playbackRate=e)}},{key:"played",get:function(){var e;return null==(e=this._video)?void 0:e.played}},{key:"seekable",get:function(){var e;return null==(e=this._video)?void 0:e.seekable}},{key:"ended",get:function(){return!!this._video&&this._video.ended}},{key:"autoplay",get:function(){return this._autoplay},set:function(e){N.i(pe,"call set autoplay",e),this._autoplay=e}},{key:"loop",get:function(){return!!this._video&&this._video.loop},set:function(e){N.i(pe,"call set loop",e),this._video&&(this._video.loop=e)}},{key:"controls",get:function(){return this._controls},set:function(e){N.i(pe,"call set controls",e),e!==this._controls&&(this._controls=e),this.emit(_e.ATTRIBUTE_CHANGE_CONTROLS,e)}},{key:"volume",get:function(){return this._video?this._video.volume:1},set:function(e){this._video&&(this._video.volume=e)}},{key:"muted",get:function(){return!!this._video&&this._video.muted},set:function(e){N.i(pe,"call set muted",e),this._video&&(this._video.muted=e)}},{key:"defaultMuted",get:function(){return!!this._video&&this._video.defaultMuted},set:function(e){N.i(pe,"call set defaultMuted",e),this._video&&(this._video.defaultMuted=e)}},{key:"videoWidth",get:function(){var e;return this._videoWidth||(null==(e=this._video)?void 0:e.videoWidth)}},{key:"videoHeight",get:function(){var e;return this._videoHeight||(null==(e=this._video)?void 0:e.videoHeight)}},{key:"poster",get:function(){return this._poster},set:function(e){N.i(pe,"call set poster",e),this._poster=e}},{key:"disablePictureInPicture",get:function(){var e;return!!(null==(e=this._video)?void 0:e.disablePictureInPicture)},set:function(e){this._video&&(this._video.disablePictureInPicture=e)}},{key:"playsinline",get:function(){var e;return!!(null==(e=this._video)?void 0:e.hasAttribute("playsinline"))},set:function(e){this._video&&(this._video.playsinline=e,this._video.WebKitPlaysInline=e,e?(this._video.setAttribute("playsinline","playsinline"),this._video.setAttribute("webkit-playsinline","webkit-playsinline"),this._video.setAttribute("x5-playsinline","x5-playsinline")):(this._video.removeAttribute("playsinline"),this._video.removeAttribute("webkit-playsinline"),this._video.removeAttribute("x5-playsinline")))}},{key:"disableDownload",get:function(){return this._disableDownload},set:function(e){this._disableDownload=e}},{key:"disableAdaptive",get:function(){return this._disableAdaptive},set:function(e){this._disableAdaptive=e}},{key:"currentLevel",get:function(){var e;return(null==(e=this._kernel)?void 0:e.currentLevel)||0},set:function(e){this._kernel&&(this._kernel.currentLevel=e)}},{key:"nextLevel",get:function(){var e;return(null==(e=this._kernel)?void 0:e.nextLevel)||0},set:function(e){this._kernel&&(this._kernel.nextLevel=e)}},{key:"currentVideoFrame",get:function(){var e;return(null==(e=this._kernel)?void 0:e.currentVideoFrame)||0},set:function(e){this._kernel&&(this._kernel.currentVideoFrame=e)}},{key:"totalVideoFrames",get:function(){var e;return(null==(e=this._kernel)?void 0:e.totalVideoFrames)||0}},{key:"canvas",get:function(){return this._canvas}},{key:"audioTracks",get:function(){return this._kernel?this._kernel.audioTrack:-1},set:function(e){this._kernel&&(this._kernel.audioTrack=e)}},{key:"showProgress",get:function(){var e=this.getPluginInstance("ChromeControlsPlugin");if(e)return e.showProgress;throw new Error("Not exist ChromeControlsPlugin")},set:function(e){var t=this.getPluginInstance("ChromeControlsPlugin");if(!t)throw new Error("Not exist ChromeControlsPlugin");t.showProgress=e}},{key:"showTime",get:function(){var e=this.getPluginInstance("ChromeControlsPlugin");if(e)return e.showTime;throw new Error("Not exist ChromeControlsPlugin")},set:function(e){var t=this.getPluginInstance("ChromeControlsPlugin");if(!t)throw new Error("Not exist ChromeControlsPlugin");t.showTime=e}},{key:"data",get:function(){return this._data}},{key:"load",value:function(){var e;return N.i(pe,"call load"),null==(e=this._video)?void 0:e.load()}},{key:"play",value:function(){var e;return N.i(pe,"call play"),null==(e=this._video)?void 0:e.play()}},{key:"pause",value:function(){var e;return N.i(pe,"call pause"),null==(e=this._video)?void 0:e.pause()}},{key:"requestPictureInPicture",value:function(){var e;return N.i(pe,"call requestPictureInPicture"),null==(e=this._video)?void 0:e.requestPictureInPicture()}},{key:"destroy",value:function(){var e;N.i(pe,"call destroy"),i.pluginBase.beforeUninstallPlugins(this),this._evt.removeAllListeners(),this._destroyKernel(),this._unbindVideo(),this._video&&(null==(e=this._video.parentElement)||e.removeChild(this._video)),this.removeAllListeners(),i.pluginBase.afterUninstallPlugins(this)}},{key:"refresh",value:function(){var e;N.i(pe,"call refresh"),null==(e=this._kernel)||e.refresh()}},{key:"getPluginInstance",value:function(e){return this._plugins.find((function(t){return t.name===e}))}},{key:"createSubContainer",value:function(){var e,t,i=document.createElement("div");return i.id="container-"+Math.round(this.subContainerNumber++),null==(t=this._mainDom)||t.children[(null==(e=this._mainDom)?void 0:e.children.length)-1].insertAdjacentElement("afterend",i),i}},{key:"isFullscreen",value:function(){return this._full.isFull()}},{key:"removeSubContainer",value:function(e){var t;null==(t=this._mainDom)||t.removeChild(e)}},{key:"getMainContainer",value:function(){return this._mainDom}},{key:"getAudienceStat",value:function(){var e;return null==(e=this._kernel)?void 0:e.getAudienceStat()}},{key:"_setIsUseCanvas",value:function(e){this._video&&(this._video.style.display=e?"none":"block")}},{key:"_setError",value:function(e){var t=this;this._error=e,this._error&&setTimeout((function(){try{t.emit(_e.ERROR,t._error)}catch(e){}}),0)}},{key:"_resetPlayerStat",value:function(){var e,t;if(this._canvas){try{null==(e=this._mainDom)||e.removeChild(this._canvas)}catch(e){}this._canvas=void 0}this._setError(void 0),this._setIsUseCanvas(!1),null==(t=this._playerControls)||t.reset(),this._mediaInfo=void 0}},{key:"_destroyKernel",value:function(){this._kernel&&(this._kernel.destroy(),this._kernel=void 0)}},{key:"_bindVideo",value:function(){if(this._video)for(var e in this._eventHandlers)this._video.addEventListener(e,this._eventHandlers[e])}},{key:"_unbindVideo",value:function(){if(this._video)for(var e in this._eventHandlers)this._video.removeEventListener(e,this._eventHandlers[e])}},{key:"_parseData",value:function(e){e.src&&(this._src=e.src),e.config&&(this._config=e.config),e.crossOrigin&&(this.crossOrigin=e.crossOrigin),void 0!==e.preload&&(this.preload=e.preload),"number"==typeof e.defaultPlaybackRate&&(this.defaultPlaybackRate=e.defaultPlaybackRate),"number"==typeof e.playbackRate&&(this.playbackRate=e.playbackRate),void 0!==e.autoplay&&(this.autoplay=e.autoplay),void 0!==e.loop&&(this.loop=e.loop),void 0!==e.controls&&(this.controls=e.controls),"number"==typeof e.volume&&(this.volume=e.volume),void 0!==e.muted&&(this.muted=e.muted),void 0!==e.defaultMuted&&(this.defaultMuted=e.defaultMuted),void 0!==e.disablePictureInPicture&&(this.disablePictureInPicture=e.disablePictureInPicture),void 0!==e.disableDownload&&(this.disableDownload=e.disableDownload),void 0!==e.disableAdaptive&&(this.disableAdaptive=e.disableAdaptive),void 0!==e.playsinline&&(this.playsinline=e.playsinline),this.poster=e.poster||"",this._updateDom()}},{key:"_initKernel",value:function(){var e,t=this;if(this._video){if(this._destroyKernel(),!this._src&&!(null==(e=this._config)?void 0:e.src))return this._video.src="",void this._resetPlayerStat();this._config||(this._config={}),this._config.adaptive=!this._disableAdaptive;var i=Object.assign({},this._config);this._src&&(i.src=this._src),this._resetPlayerStat(),N.i(pe,"init kernel");var n=new U(this._video,i);if(n.on(B.VIDEO_RENDERER_CHANGE,(function(e){var i=t._mainDom;"canvas"===e.type&&(t._setIsUseCanvas(!0),t._canvas=e.canvas,null==i||i.appendChild(e.canvas),t._updateCanvasSize()),"video"===e.type&&(t._setIsUseCanvas(!1),t._canvas&&(null==i||i.removeChild(t._canvas)),t._canvas=void 0),t.emit(_e.VIDEO_RENDERER_CHANGE,e)})),n.on(B.MANIFEST_PARSED,(function(e){N.i(pe,B.MANIFEST_PARSED,e),t.emit(_e.MANIFEST_PARSED,e)})),n.on(B.LEVEL_SWITCHING,(function(e){t.emit(_e.LEVEL_SWITCHING,e)})),n.on(B.LEVEL_SWITCHED,(function(e){t.emit(_e.LEVEL_SWITCHED,e)})),n.on(B.LEVEL_SWITCH_PLAYING,(function(e){t.emit(_e.LEVEL_SWITCH_PLAYING,e)})),n.on(B.LEVEL_SWITCH_FAILED,(function(){t.emit(_e.LEVEL_SWITCH_FAILED)})),n.on(B.AUDIO_TRACK_SWITCHING,(function(e){t.emit(_e.AUDIO_TRACKS_SWITCHING,e)})),n.on(B.AUDIO_TRACK_SWITCHED,(function(e){t.emit(_e.AUDIO_TRACKS_SWITCHED,e)})),n.on(B.ERROR,(function(e){t._setError({code:e.code,message:e.reason})})),n.on(B.REPORT,(function(e){"mediaInfo"===e.type&&(t._videoWidth=e.value.width||0,t._videoHeight=e.value.height||0,t._mediaInfo=e.value,t._updateCanvasSize()),t.emit(_e.REPORT,e)})),(this._autoplay||""===this._preload||"auto"===this._preload||"metadata"===this._preload)&&(n.load(),this.autoplay)){var r=this._video.play();r instanceof Promise&&r.catch((function(){var e;N.i(pe,"autoplay fail, retry."),t._onMutedChange(!0),null==(e=t._video)||e.play().catch((function(){}))}))}this._kernel=n}}},{key:"_updateCanvasSize",value:function(e){N.i(pe,"updateCanvas",e||this._full.isFull(),this._videoWidth,this._videoHeight),void 0===e&&(e=this._full.isFull()),this._canvas&&this._videoWidth&&this._videoHeight&&(this._canvas.style.width=e?"100%":"".concat(this._videoWidth,"px"),this._canvas.style.height=e?"100%":"".concat(this._videoHeight,"px"))}},{key:"_initDom",value:function(){this._video||(this._video=document.createElement("video"),this._video.controls=!1,this._bindVideo())}},{key:"_updateDom",value:function(){var e=this._mainDom;this._video&&e&&(this._canvas&&e.contains(this._canvas)&&e.removeChild(this._canvas),e.contains(this._video)||e.appendChild(this._video),this._canvas&&!e.contains(this._canvas)&&e.appendChild(this._canvas))}},{key:"on",value:function(e,t){return c()(m()(i.prototype),"on",this).call(this,e,t)}},{key:"addListener",value:function(e,t){return c()(m()(i.prototype),"on",this).call(this,e,t)}}],[{key:"register",value:function(e){i.pluginBase.register(e)}},{key:"deregister",value:function(e){i.pluginBase.deregister(e)}}]),i}(se);D(me,"version","1.0.6-alpha.5"),D(me,"pluginBase",new le),function(){try{if("undefined"!=typeof document){var e=document.createElement("style");e.appendChild(document.createTextNode("")),document.head.appendChild(e)}}catch(e){console.error("vite-plugin-css-injected-by-js",e)}}(),function(){try{if("undefined"!=typeof document){var e=document.createElement("style");e.appendChild(document.createTextNode("")),document.head.appendChild(e)}}catch(e){console.error("vite-plugin-css-injected-by-js",e)}}();var ve=Object.defineProperty,ge=function(e,t,i){return function(e,t,i){t in e?ve(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i}(e,"symbol"!=typeof t?t+"":t,i),i};function ye(e,t){return t&&0!==t.length||(t=[e],e=""),e="kwai-p"+(e?"::"+e:""),t.unshift("["+e+"] > "),t}var Ee=function(){function e(){g()(this,e)}return E()(e,null,[{key:"level",value:function(t){switch(e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=e.ENABLE_DEBUG=e.ENABLE_VERBOSE=!1,t){case"e":e.ENABLE_ERROR=!0;break;case"w":e.ENABLE_ERROR=e.ENABLE_WARN=!0;break;case"i":e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=!0;break;case"d":e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=e.ENABLE_DEBUG=!0;break;case"v":e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=e.ENABLE_DEBUG=e.ENABLE_VERBOSE=!0}}},{key:"e",value:function(t){if(e.ENABLE_ERROR){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];var a=ye(t,n);(console.error||console.warn||console.log).apply(console,a)}}},{key:"w",value:function(t){if(e.ENABLE_WARN){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];var a=ye(t,n);(console.warn||console.log).apply(console,a)}}},{key:"i",value:function(t){if(e.ENABLE_INFO){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];var a=ye(t,n);(console.info||console.log).apply(console,a)}}},{key:"d",value:function(t){if(e.ENABLE_DEBUG){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];var a=ye(t,n);(console.debug||console.log).apply(console,a)}}},{key:"v",value:function(t){if(e.ENABLE_VERBOSE){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];var a=ye(t,n);console.log.apply(console,a)}}}]),e}(),be=Ee;ge(be,"ENABLE_ERROR",!0),ge(be,"ENABLE_WARN",!1),ge(be,"ENABLE_INFO",!1),ge(be,"ENABLE_DEBUG",!1),ge(be,"ENABLE_VERBOSE",!1);var Ae=function(){function e(){g()(this,e),ge(this,"timeout",6048e5)}return E()(e,[{key:"write",value:function(t,i){if(e.available)try{localStorage.setItem(t,JSON.stringify({value:i,time:Date.now()}))}catch(e){}}},{key:"read",value:function(t){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.available)try{var n=localStorage.getItem(t);if(n){var r=JSON.parse(n),a=r.value,s=r.time,o=void 0===s?0:s;if(!i)return a;if(Date.now()-o<this.timeout)return a}}catch(e){}}}],[{key:"available",get:function(){if(void 0===e._available)try{localStorage.setItem("alg","test"),e._available=!0}catch(t){e._available=!1}return e._available}}]),e}();ge(Ae,"_available");var Te=0;var Se={exports:{}},Re={},xe=A(),Le=60103;if(Re.Fragment=60107,"function"==typeof Symbol&&Symbol.for){var Ce=Symbol.for;Le=Ce("react.element"),Re.Fragment=Ce("react.fragment")}var De=xe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ie=Object.prototype.hasOwnProperty,we={key:!0,ref:!0,__self:!0,__source:!0};function ke(e,t,i){var n,r={},a=null,s=null;for(n in void 0!==i&&(a=""+i),void 0!==t.key&&(a=""+t.key),void 0!==t.ref&&(s=t.ref),t)Ie.call(t,n)&&!we.hasOwnProperty(n)&&(r[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===r[n]&&(r[n]=t[n]);return{$$typeof:Le,type:e,key:a,ref:s,props:r,_owner:De.current}}Re.jsx=ke,Re.jsxs=ke,Se.exports=Re;var Oe=Se.exports.jsx,Ne=[{e:"loadstart",cb:"onLoadStart"},{e:"progress",cb:"onProgress"},{e:"suspend",cb:"onSuspend"},{e:"abort",cb:"onAbort"},{e:"error",cb:"onError"},{e:"emptied",cb:"onEmptied"},{e:"stalled",cb:"onStalled"},{e:"loadedmetadata",cb:"onLoadedMetadata"},{e:"loadeddata",cb:"onLoadedData"},{e:"canplay",cb:"onCanPlay"},{e:"canplaythrough",cb:"onCanPlayThrough"},{e:"playing",cb:"onPlaying"},{e:"waiting",cb:"onWaiting"},{e:"seeking",cb:"onSeeking"},{e:"seeked",cb:"onSeeked"},{e:"ended",cb:"onEnded"},{e:"durationchange",cb:"onDurationChange"},{e:"timeupdate",cb:"onTimeUpdate"},{e:"play",cb:"onPlay"},{e:"pause",cb:"onPause"},{e:"ratechange",cb:"onRateChange"},{e:"resize",cb:"onResize"},{e:"volumechange",cb:"onVolumeChange"},{e:"manifestparsed",cb:"onManifestParsed"},{e:"levelswitching",cb:"onLevelSwitching"},{e:"levelswitched",cb:"onLevelSwitched"},{e:"levelswitchplaying",cb:"onLevelSwitchPlaying"},{e:"levelswitchfailed",cb:"onLevelSwitchFailed"},{e:"audiotrackswitching",cb:"onAudioTrackSwitching"},{e:"audiotrackswitched",cb:"onAudioTrackSwitched"},{e:"fullscreenchange",cb:"onFullscreenchange"}],Pe={src:{},config:{},crossOrigin:{},preload:{},defaultPlaybackRate:{},playbackRate:{},autoPlay:{playerAttr:"autoplay"},loop:{},controls:{},volume:{},muted:{},defaultMuted:{},poster:{},disablePictureInPicture:{},playsinline:{},disableDownload:{},disableAdaptive:{},currentLevel:{},nextLevel:{},audioTrack:{},totalVideoFrames:{},currentVideoFrame:{},showProgress:{},showTime:{},productName:{},buffered:{readonly:!0},duration:{readonly:!0},ended:{readonly:!0},error:{readonly:!0},played:{readonly:!0},readyState:{readonly:!0},seekable:{readonly:!0},seeking:{readonly:!0},networkState:{readonly:!0},paused:{readonly:!0},videoWidth:{readonly:!0},videoHeight:{readonly:!0}},Me=b.forwardRef((function(e,t){var i=(0,b.useState)(e.id||(Te=Te?Te+1:Date.now(),"c-".concat(Te))),n=S(s(),i,1)[0],r=(0,b.useRef)(void 0);return(0,b.useEffect)((function(){if(!r.current){var t={plugins:e.plugins};Object.keys(e).forEach((function(i){var n=Pe[i];n&&!n.readonly&&(t[n.playerAttr||i]=e[i])})),r.current=new me("#"+n,t),Ne.forEach((function(t){r.current.on(t.e,(function(i){e[t.cb]&&e[t.cb](i)}))}))}return function(){r.current&&r.current.destroy(),r.current=void 0}}),[]),b.useEffect((function(){r.current&&Object.keys(e).forEach((function(t){var i=Pe[t];i&&!i.readonly&&r.current[i.playerAttr||t]!==e[t]&&(r.current[i.playerAttr||t]=e[t])}))}),[e]),b.useImperativeHandle(t,(function(){var e=["load","pause","play","requestPictureInPicture","destroy","requestFullscreen","exitFullscreen"],t=e.reduce((function(e,t){return e[t]=function(){for(var e,i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];return null==(e=r.current)?void 0:e[t].call(r.current,n)},e}),{});return new Proxy({},{get:function(i,n){if(-1!==e.indexOf(n))return t[n];if(n in me)return me[n];var a=Pe[n];return r.current[(null==a?void 0:a.playerAttr)||n]},set:function(e,t,i){return r.current[t]=i,!0}})})),Oe("div",{id:n,className:e.className,style:e.style,children:Array.isArray(e.children)?e.children.map((function(e,t){return e})):e.children})})),Ve=Object.defineProperty,Fe=function(e,t,i){return function(e,t,i){t in e?Ve(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i}(e,"symbol"!=typeof t?t+"":t,i),i},Ue="WaterMarkPlugin",Be=function(e){l()(i,e);var t=L(i);function i(){var e;return g()(this,i),e=t.apply(this,arguments),Fe(d()(e),"name",Ue),Fe(d()(e),"player"),Fe(d()(e),"container"),e}return E()(i,[{key:"beforeInstall",value:function(){}},{key:"afterInstall",value:function(e){var t;this.player=e;var i=this.player.getMainContainer(),n=null==i?void 0:i.querySelector('[kwai-player-watermark=""]');n&&(this.container=this.player.createSubContainer(),null==(t=this.container)||t.appendChild(n),n.style.position="absolute",n.style.top="0",n.style.left="0",n.style.width="100%",n.style.height="100%")}},{key:"beforeUninstall",value:function(e){this.container&&(null==e||e.removeSubContainer(this.container)),this.player=void 0,this.container=void 0}},{key:"afterUninstall",value:function(){}}]),i}(he);!function(){try{if("undefined"!=typeof document){var e=document.createElement("style");e.appendChild(document.createTextNode('.controls{position:absolute;top:0;left:0;width:100%;height:100%;font-size:16px;font-family:Roboto,Noto,sans-serif;overflow:hidden}.controls .large{font-size:18px}.panel{position:relative;display:flex;flex-direction:column;justify-content:flex-end;height:100%;width:100%;background:0 bottom repeat-x linear-gradient(rgba(0,0,0,0),rgb(0,0,0));background-size:auto 5.75em;transition:opacity .3s ease-in}.button-panel{display:flex;position:relative;z-index:1;width:100%;justify-content:space-between}.button-panel-left,.button-panel-right{display:flex;flex-direction:row;align-items:center}.panel-button{position:relative;width:3em;height:3em;background:center no-repeat;background-size:1.25em 1.25em;cursor:pointer;-webkit-tap-highlight-color:transparent}.panel-button:hover>.panel-button-bg{background-color:#202124b5}.panel-button.disabled,.panel-button.disabled:hover>.panel-button-bg{background-color:initial;opacity:.3;cursor:default}.panel-button-wrapper{position:relative}.panel-button-wrapper.disabled:hover .panel-button-bg{left:0;background-color:transparent}.panel-button-wrapper:hover .panel-button-bg{left:0;background-color:#202124b5}.panel-button-wrapper .panel-button-bg{width:100%;left:0}.panel-button-bg{background-size:24px;position:absolute;width:36px;height:36px;left:6px;top:6px;pointer-events:none;z-index:-1;background-repeat:no-repeat;background-position:center center;border-radius:18px;transition:background-color .25s ease 0s}.panel-button-bg:hover{background-color:#202124b5}.current-time-display{font-size:.875em;color:#fff}.time-remaining-display{margin-left:.25em;font-size:.875em;color:#fff;white-space:nowrap}.timeline{display:block;margin:0 1em;padding-bottom:1.25em;cursor:pointer}.timeline:hover .thumb{opacity:1}.volume-button{display:flex;align-items:center;padding-left:1em}.volume-button .segmented-track{width:0em;transition:width .3s ease 0s,opacity .28s step-end 0s}.volume-button.disabled:hover .segmented-track{width:0em}.volume-button:hover .segmented-track{width:3.25em;transition:width .3s ease 0s,opacity .28s step-end 0s}.volume-progress{padding:1em 0;cursor:pointer}.segmented-track{position:relative;height:.25em;user-select:none}.thumb{position:absolute;top:-4px;width:12px;height:12px;background:rgb(255,255,255);border-radius:50%;opacity:0;transition:opacity .3s ease 0s}.segment-background{height:.25em;background-color:#ffffff4d}.segment-highlight-before{position:absolute;height:4px;border-radius:2px;background:rgb(255,255,255)}.segment-highlight-after{position:absolute;height:4px;border-radius:2px;background:rgba(255,255,255,.54)}.overlay{position:absolute;top:0;left:0;width:100%;height:100%;background:center no-repeat;background-size:contain}.overflow{position:absolute;right:16px;bottom:4px;z-index:20;max-height:250px;width:200px;overflow-x:hidden;white-space:nowrap;font-size:12px;box-shadow:#0006 0 1px 9px;background:#ffffff;border-radius:2px;transition:transform .3s ease-out,opacity .2s linear;transform-origin:right bottom;opacity:1;transform:scale(1)}.overflow.closed{transform:scale(0);transform-origin:right bottom;opacity:0}.overflow-item{height:3.75em;padding:0 1.375em;display:flex;align-items:center;cursor:pointer;user-select:none}.overflow-item:active,.overflow-item:focus,.overflow-item:hover{background-color:#e0e0e0}@media screen and (max-width: 600px){.overflow-item.overflow-item:hover{background-color:#fff}}.overflow-icon{width:2em;height:2em;margin-right:1em}.overflow-checkbox{-webkit-appearance:none;appearance:none;width:1.125em;height:1.125em;margin:.9375em;border:none}.overflow-checkbox:checked{background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE5LjIuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCAyNCAyNCIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMjQgMjQ7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPHN0eWxlIHR5cGU9InRleHQvY3NzIj4KCS5zdDB7ZmlsbDpub25lO30KCS5zdDF7ZmlsbDojNDI4NUY0O30KPC9zdHlsZT4KPHBhdGggY2xhc3M9InN0MCIgZD0iTTAsMGgyNHYyNEgwVjB6Ii8+CjxwYXRoIGNsYXNzPSJzdDEiIGQ9Ik05LDE2LjJMNC44LDEybC0xLjQsMS40TDksMTlMMjEsN2wtMS40LTEuNEw5LDE2LjJ6Ii8+Cjwvc3ZnPgo=)}.overflow-content{flex:1;display:flex;align-items:center;justify-content:space-between}.loading{position:absolute;left:0px;top:0px;right:0px;bottom:0px;z-index:1;pointer-events:none;overflow:hidden}.spinner{animation:container-rotate 1568ms linear infinite;height:100%;width:100%}.spinner:after{position:absolute;content:" ";top:-25%;left:-25%;width:150%;height:150%}.spinner:before{position:absolute;content:" ";top:2px;left:2px;right:2px;bottom:2px;border-radius:100%}.kwai-layer{width:100%;height:100%;white-space:nowrap;animation-name:fill-unfill-rotate;animation-duration:5332ms;animation-timing-function:cubic-bezier(.4,0,.2,1);animation-iteration-count:infinite}.spinner-mask-1{left:-50%}.spinner-mask-2{right:-50%}.spinner-mask-1,.spinner-mask-2{position:absolute;width:100%;height:200%;top:-50%;overflow:hidden}.loading-spinner-frame,.loading-panel-spinner-frame{position:absolute;top:50%;left:50%;height:72px;width:72px;margin-left:-36px;margin-top:-48px;overflow:hidden}.loading-spinner-mask-2-bg{animation-name:mask-2-spin}.loading .loading-spinner-mask-2-bg{left:-100%;background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE5LjIuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCAxOTYgMTk2IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAxOTYgMTk2OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik0xNDcsOThjMCwxOS42LTExLjUsMzYuNS0yOC4yLDQ0LjRsMCwwYy0wLjEsMC0wLjIsMC4xLTAuMywwLjEKCWMwLjEsMCwwLjItMC4xLDAuMy0wLjFsLTEuNy0zLjZDMTMyLjQsMTMxLjYsMTQzLDExNiwxNDMsOThjMC0yNC45LTIwLjEtNDUtNDUtNDV2LTRDMTI1LjEsNDksMTQ3LDcwLjksMTQ3LDk4eiIvPgo8L3N2Zz4K);background-position:right center}.loading-spinner-mask-1-bg{animation-name:mask-1-spin}.loading-spinner-mask-1-bg,.loading-spinner-mask-2-bg{position:absolute;background-repeat:no-repeat;width:200%;height:100%;top:0;animation-duration:1333ms;animation-timing-function:cubic-bezier(.4,0,.2,1);animation-iteration-count:infinite;animation-fill-mode:forwards}.loading .loading-spinner-mask-1-bg{left:0px;background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE5LjIuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCAxOTYgMTk2IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAxOTYgMTk2OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik05OCw0OXY0Yy0yNC45LDAtNDUsMjAuMS00NSw0NQoJYzAsMTgsMTAuNiwzMy42LDI1LjksNDAuOGwtMS43LDMuNmMwLjEsMCwwLjIsMC4xLDAuMywwLjFjLTAuMSwwLTAuMi0wLjEtMC4zLTAuMWwwLDBDNjAuNSwxMzQuNSw0OSwxMTcuNiw0OSw5OAoJQzQ5LDcwLjksNzAuOSw0OSw5OCw0OXoiLz4KPC9zdmc+Cg==);background-position:left center}.switchPanel{position:absolute;left:0;top:0;width:251px;background:rgba(19,18,18,.8);border:1px solid rgb(50,49,49);color:#fff;z-index:20;border-radius:2px}.switchMenu{padding:5px 0}.line{cursor:pointer;display:table-row;height:40px}.line:hover{background-color:#5559;color:#eee}.icon{display:table-cell;vertical-align:middle;width:47px;height:20px;padding:0 10px}.iconImg{width:1.5em;height:1.5em;background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjY2MjQ5Mjk5MTA5IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjQxNTAiIHdpZHRoPSIyNTAiIGhlaWdodD0iMjUwIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+PHBhdGggZD0iTTUxMiAxMDI0QTUxMiA1MTIgMCAxIDEgNTEyIDBhNTEyIDUxMiAwIDAgMSAwIDEwMjR6IG0zLjAwOC05Mi45OTJhNDE2IDQxNiAwIDEgMCAwLTgzMiA0MTYgNDE2IDAgMCAwIDAgODMyek00NDggNDQ4aDEyOHYzODRINDQ4VjQ0OHogbTAtMjU2aDEyOHYxMjhINDQ4VjE5MnoiIGZpbGw9IiNmZmZmZmYiIHAtaWQ9IjQxNTEiPjwvcGF0aD48L3N2Zz4=);background-size:contain}.label{display:table-cell;vertical-align:middle;padding:0 15px 0 0;width:191px;font-weight:400;font-size:13.3px}.switchPanel-checkbox{-webkit-appearance:none;appearance:none;width:1.125em;height:1.125em;margin:.9375em}.switchPanel-checkbox:checked{background-image:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjY2MTczNTA3OTc2IiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjQ0MjUiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjUwIiBoZWlnaHQ9IjI1MCI+PHBhdGggZD0iTTgxNy43MjggMTk4LjcybDExMS43NDQgMTE0LjU2LTU0NS4yMTYgNTMyLjEyOC0yODUuOTItMjczLjAyNCAxMTAuNTI4LTExNS43MTIgMTc0LjE3NiAxNjYuMzM2eiIgcC1pZD0iNDQyNiIgZmlsbD0iI2ZmZmZmZiI+PC9wYXRoPjwvc3ZnPg==);background-size:contain}@keyframes container-rotate{to{transform:rotate(360deg)}}@keyframes fill-unfill-rotate{12.5%{transform:rotate(135deg)}25%{transform:rotate(270deg)}37.5%{transform:rotate(405deg)}50%{transform:rotate(540deg)}62.5%{transform:rotate(675deg)}75%{transform:rotate(810deg)}87.5%{transform:rotate(945deg)}to{transform:rotate(1080deg)}}@keyframes mask-1-spin{0%{transform:rotate(157deg)}50%{transform:rotate(30deg)}to{transform:rotate(157deg)}}@keyframes mask-2-spin{0%{transform:rotate(-155deg)}50%{transform:rotate(-30deg)}to{transform:rotate(-155deg)}}')),document.head.appendChild(e)}}catch(e){console.error("vite-plugin-css-injected-by-js",e)}}();var He,je,We,ze,Ge,Ke=Object.defineProperty,Ye=function(e,t,i){return function(e,t,i){t in e?Ke(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i}(e,"symbol"!=typeof t?t+"":t,i),i},Xe={controls:"controls",large:"large",panel:"panel","button-panel":"button-panel","button-panel-left":"button-panel-left","button-panel-right":"button-panel-right","panel-button":"panel-button","panel-button-bg":"panel-button-bg",disabled:"disabled","panel-button-wrapper":"panel-button-wrapper","current-time-display":"current-time-display","time-remaining-display":"time-remaining-display",timeline:"timeline",thumb:"thumb","volume-button":"volume-button","segmented-track":"segmented-track","volume-progress":"volume-progress","segment-background":"segment-background","segment-highlight-before":"segment-highlight-before","segment-highlight-after":"segment-highlight-after",overlay:"overlay",overflow:"overflow",closed:"closed","overflow-item":"overflow-item","overflow-icon":"overflow-icon","overflow-checkbox":"overflow-checkbox","overflow-content":"overflow-content",loading:"loading",spinner:"spinner","container-rotate":"container-rotate","kwai-layer":"kwai-layer","fill-unfill-rotate":"fill-unfill-rotate","spinner-mask-1":"spinner-mask-1","spinner-mask-2":"spinner-mask-2","loading-spinner-frame":"loading-spinner-frame","loading-panel-spinner-frame":"loading-panel-spinner-frame","loading-spinner-mask-1-bg":"loading-spinner-mask-1-bg","loading-spinner-mask-2-bg":"loading-spinner-mask-2-bg","mask-1-spin":"mask-1-spin","mask-2-spin":"mask-2-spin",switchPanel:"switchPanel",switchMenu:"switchMenu",line:"line",icon:"icon",iconImg:"iconImg",label:"label","switchPanel-checkbox":"switchPanel-checkbox"},qe={},Ze=[],Qe=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function Je(e,t){for(var i in t)e[i]=t[i];return e}function $e(e){var t=e.parentNode;t&&t.removeChild(e)}function et(e,t,i){var n,r,a,s={};for(a in t)"key"==a?n=t[a]:"ref"==a?r=t[a]:s[a]=t[a];if(arguments.length>2&&(s.children=arguments.length>3?He.call(arguments,2):i),"function"==typeof e&&null!=e.defaultProps)for(a in e.defaultProps)void 0===s[a]&&(s[a]=e.defaultProps[a]);return tt(e,s,n,r,null)}function tt(e,t,i,n,r){var a={type:e,props:t,key:i,ref:n,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:null==r?++We:r};return null==r&&null!=je.vnode&&je.vnode(a),a}function it(e){return e.children}function nt(e,t){this.props=e,this.context=t}function rt(e,t){if(null==t)return e.__?rt(e.__,e.__.__k.indexOf(e)+1):null;for(var i;t<e.__k.length;t++)if(null!=(i=e.__k[t])&&null!=i.__e)return i.__e;return"function"==typeof e.type?rt(e):null}function at(e){var t,i;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(i=e.__k[t])&&null!=i.__e){e.__e=e.__c.base=i.__e;break}return at(e)}}function st(e){(!e.__d&&(e.__d=!0)&&ze.push(e)&&!ot.__r++||Ge!==je.debounceRendering)&&((Ge=je.debounceRendering)||setTimeout)(ot)}function ot(){for(var e;ot.__r=ze.length;)e=ze.sort((function(e,t){return e.__v.__b-t.__v.__b})),ze=[],e.some((function(e){var t,i,n,r,a,s;e.__d&&(a=(r=(t=e).__v).__e,(s=t.__P)&&(i=[],(n=Je({},r)).__v=r.__v+1,mt(s,r,n,t.__n,void 0!==s.ownerSVGElement,null!=r.__h?[a]:null,i,null==a?rt(r):a,r.__h),vt(i,r),r.__e!=a&&at(r)))}))}function ct(e,t,i,n,r,a,s,o,c,_){var d,u,l,h,f,p,m,v=n&&n.__k||Ze,g=v.length;for(i.__k=[],d=0;d<t.length;d++)if(null!=(h=i.__k[d]=null==(h=t[d])||"boolean"==typeof h?null:"string"==typeof h||"number"==typeof h||"bigint"==typeof h?tt(null,h,null,null,h):Array.isArray(h)?tt(it,{children:h},null,null,null):h.__b>0?tt(h.type,h.props,h.key,h.ref?h.ref:null,h.__v):h)){if(h.__=i,h.__b=i.__b+1,null===(l=v[d])||l&&h.key==l.key&&h.type===l.type)v[d]=void 0;else for(u=0;u<g;u++){if((l=v[u])&&h.key==l.key&&h.type===l.type){v[u]=void 0;break}l=null}mt(e,h,l=l||qe,r,a,s,o,c,_),f=h.__e,(u=h.ref)&&l.ref!=u&&(m||(m=[]),l.ref&&m.push(l.ref,null,h),m.push(u,h.__c||f,h)),null!=f?(null==p&&(p=f),"function"==typeof h.type&&h.__k===l.__k?h.__d=c=_t(h,c,e):c=ut(e,h,l,v,f,c),"function"==typeof i.type&&(i.__d=c)):c&&l.__e==c&&c.parentNode!=e&&(c=rt(l))}for(i.__e=p,d=g;d--;)null!=v[d]&&("function"==typeof i.type&&null!=v[d].__e&&v[d].__e==i.__d&&(i.__d=rt(n,d+1)),yt(v[d],v[d]));if(m)for(d=0;d<m.length;d++)gt(m[d],m[++d],m[++d])}function _t(e,t,i){for(var n,r=e.__k,a=0;r&&a<r.length;a++)(n=r[a])&&(n.__=e,t="function"==typeof n.type?_t(n,t,i):ut(i,n,n,r,n.__e,t));return t}function dt(e,t){return t=t||[],null==e||"boolean"==typeof e||(Array.isArray(e)?e.some((function(e){dt(e,t)})):t.push(e)),t}function ut(e,t,i,n,r,a){var s,o,c;if(void 0!==t.__d)s=t.__d,t.__d=void 0;else if(null==i||r!=a||null==r.parentNode)e:if(null==a||a.parentNode!==e)e.appendChild(r),s=null;else{for(o=a,c=0;(o=o.nextSibling)&&c<n.length;c+=2)if(o==r)break e;e.insertBefore(r,a),s=a}return void 0!==s?s:r.nextSibling}function lt(e,t,i){"-"===t[0]?e.setProperty(t,i):e[t]=null==i?"":"number"!=typeof i||Qe.test(t)?i:i+"px"}function ht(e,t,i,n,r){var a;e:if("style"===t)if("string"==typeof i)e.style.cssText=i;else{if("string"==typeof n&&(e.style.cssText=n=""),n)for(t in n)i&&t in i||lt(e.style,t,"");if(i)for(t in i)n&&i[t]===n[t]||lt(e.style,t,i[t])}else if("o"===t[0]&&"n"===t[1])a=t!==(t=t.replace(/Capture$/,"")),t=t.toLowerCase()in e?t.toLowerCase().slice(2):t.slice(2),e.l||(e.l={}),e.l[t+a]=i,i?n||e.addEventListener(t,a?pt:ft,a):e.removeEventListener(t,a?pt:ft,a);else if("dangerouslySetInnerHTML"!==t){if(r)t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if("href"!==t&&"list"!==t&&"form"!==t&&"tabIndex"!==t&&"download"!==t&&t in e)try{e[t]=null==i?"":i;break e}catch(e){}"function"==typeof i||(null!=i&&(!1!==i||"a"===t[0]&&"r"===t[1])?e.setAttribute(t,i):e.removeAttribute(t))}}function ft(e){this.l[e.type+!1](je.event?je.event(e):e)}function pt(e){this.l[e.type+!0](je.event?je.event(e):e)}function mt(e,t,i,n,r,a,s,o,c){var _,d,u,l,h,f,p,m,v,g,y,E,b,A=t.type;if(void 0!==t.constructor)return null;null!=i.__h&&(c=i.__h,o=t.__e=i.__e,t.__h=null,a=[o]),(_=je.__b)&&_(t);try{e:if("function"==typeof A){if(m=t.props,v=(_=A.contextType)&&n[_.__c],g=_?v?v.props.value:_.__:n,i.__c?p=(d=t.__c=i.__c).__=d.__E:("prototype"in A&&A.prototype.render?t.__c=d=new A(m,g):(t.__c=d=new nt(m,g),d.constructor=A,d.render=Et),v&&v.sub(d),d.props=m,d.state||(d.state={}),d.context=g,d.__n=n,u=d.__d=!0,d.__h=[]),null==d.__s&&(d.__s=d.state),null!=A.getDerivedStateFromProps&&(d.__s==d.state&&(d.__s=Je({},d.__s)),Je(d.__s,A.getDerivedStateFromProps(m,d.__s))),l=d.props,h=d.state,u)null==A.getDerivedStateFromProps&&null!=d.componentWillMount&&d.componentWillMount(),null!=d.componentDidMount&&d.__h.push(d.componentDidMount);else{if(null==A.getDerivedStateFromProps&&m!==l&&null!=d.componentWillReceiveProps&&d.componentWillReceiveProps(m,g),!d.__e&&null!=d.shouldComponentUpdate&&!1===d.shouldComponentUpdate(m,d.__s,g)||t.__v===i.__v){d.props=m,d.state=d.__s,t.__v!==i.__v&&(d.__d=!1),d.__v=t,t.__e=i.__e,t.__k=i.__k,t.__k.forEach((function(e){e&&(e.__=t)})),d.__h.length&&s.push(d);break e}null!=d.componentWillUpdate&&d.componentWillUpdate(m,d.__s,g),null!=d.componentDidUpdate&&d.__h.push((function(){d.componentDidUpdate(l,h,f)}))}if(d.context=g,d.props=m,d.__v=t,d.__P=e,y=je.__r,E=0,"prototype"in A&&A.prototype.render)d.state=d.__s,d.__d=!1,y&&y(t),_=d.render(d.props,d.state,d.context);else do{d.__d=!1,y&&y(t),_=d.render(d.props,d.state,d.context),d.state=d.__s}while(d.__d&&++E<25);d.state=d.__s,null!=d.getChildContext&&(n=Je(Je({},n),d.getChildContext())),u||null==d.getSnapshotBeforeUpdate||(f=d.getSnapshotBeforeUpdate(l,h)),b=null!=_&&_.type===it&&null==_.key?_.props.children:_,ct(e,Array.isArray(b)?b:[b],t,i,n,r,a,s,o,c),d.base=t.__e,t.__h=null,d.__h.length&&s.push(d),p&&(d.__E=d.__=null),d.__e=!1}else null==a&&t.__v===i.__v?(t.__k=i.__k,t.__e=i.__e):t.__e=function(e,t,i,n,r,a,s,o){var c,_,d,u=i.props,l=t.props,h=t.type,f=0;if("svg"===h&&(r=!0),null!=a)for(;f<a.length;f++)if((c=a[f])&&"setAttribute"in c==!!h&&(h?c.localName===h:3===c.nodeType)){e=c,a[f]=null;break}if(null==e){if(null===h)return document.createTextNode(l);e=r?document.createElementNS("http://www.w3.org/2000/svg",h):document.createElement(h,l.is&&l),a=null,o=!1}if(null===h)u===l||o&&e.data===l||(e.data=l);else{if(a=a&&He.call(e.childNodes),_=(u=i.props||qe).dangerouslySetInnerHTML,d=l.dangerouslySetInnerHTML,!o){if(null!=a)for(u={},f=0;f<e.attributes.length;f++)u[e.attributes[f].name]=e.attributes[f].value;(d||_)&&(d&&(_&&d.__html==_.__html||d.__html===e.innerHTML)||(e.innerHTML=d&&d.__html||""))}if(function(e,t,i,n,r){var a;for(a in i)"children"===a||"key"===a||a in t||ht(e,a,null,i[a],n);for(a in t)r&&"function"!=typeof t[a]||"children"===a||"key"===a||"value"===a||"checked"===a||i[a]===t[a]||ht(e,a,t[a],i[a],n)}(e,l,u,r,o),d)t.__k=[];else if(f=t.props.children,ct(e,Array.isArray(f)?f:[f],t,i,n,r&&"foreignObject"!==h,a,s,a?a[0]:i.__k&&rt(i,0),o),null!=a)for(f=a.length;f--;)null!=a[f]&&$e(a[f]);o||("value"in l&&void 0!==(f=l.value)&&(f!==e.value||"progress"===h&&!f||"option"===h&&f!==u.value)&&ht(e,"value",f,u.value,!1),"checked"in l&&void 0!==(f=l.checked)&&f!==e.checked&&ht(e,"checked",f,u.checked,!1))}return e}(i.__e,t,i,n,r,a,s,c);(_=je.diffed)&&_(t)}catch(e){t.__v=null,(c||null!=a)&&(t.__e=o,t.__h=!!c,a[a.indexOf(o)]=null),je.__e(e,t,i)}}function vt(e,t){je.__c&&je.__c(t,e),e.some((function(t){try{e=t.__h,t.__h=[],e.some((function(e){e.call(t)}))}catch(e){je.__e(e,t.__v)}}))}function gt(e,t,i){try{"function"==typeof e?e(t):e.current=t}catch(e){je.__e(e,i)}}function yt(e,t,i){var n,r;if(je.unmount&&je.unmount(e),(n=e.ref)&&(n.current&&n.current!==e.__e||gt(n,null,t)),null!=(n=e.__c)){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(e){je.__e(e,t)}n.base=n.__P=null,e.__c=void 0}if(n=e.__k)for(r=0;r<n.length;r++)n[r]&&yt(n[r],t,"function"!=typeof e.type);i||null==e.__e||$e(e.__e),e.__=e.__e=e.__d=void 0}function Et(e,t,i){return this.constructor(e,i)}function bt(e,t,i){var n,r,a;je.__&&je.__(e,t),r=(n="function"==typeof i)?null:i&&i.__k||t.__k,a=[],mt(t,e=(!n&&i||t).__k=et(it,null,[e]),r||qe,qe,void 0!==t.ownerSVGElement,!n&&i?[i]:r?null:t.firstChild?He.call(t.childNodes):null,a,!n&&i?i:r?r.__e:t.firstChild,n),vt(a,e)}He=Ze.slice,je={__e:function(e,t,i,n){for(var r,a,s;t=t.__;)if((r=t.__c)&&!r.__)try{if((a=r.constructor)&&null!=a.getDerivedStateFromError&&(r.setState(a.getDerivedStateFromError(e)),s=r.__d),null!=r.componentDidCatch&&(r.componentDidCatch(e,n||{}),s=r.__d),s)return r.__E=r}catch(t){e=t}throw e}},We=0,nt.prototype.setState=function(e,t){var i;i=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=Je({},this.state),"function"==typeof e&&(e=e(Je({},i),this.props)),e&&Je(i,e),null!=e&&this.__v&&(t&&this.__h.push(t),st(this))},nt.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),st(this))},nt.prototype.render=it,ze=[],ot.__r=0,"undefined"!=typeof window&&window.__PREACT_DEVTOOLS__&&window.__PREACT_DEVTOOLS__.attachPreact("10.11.0",je,{Fragment:it,Component:nt});var At={};function Tt(e){return e.type===it?"Fragment":"function"==typeof e.type?e.type.displayName||e.type.name:"string"==typeof e.type?e.type:"#text"}var St=[],Rt=[];function xt(){return St.length>0?St[St.length-1]:null}var Lt=!1;function Ct(e){return"function"==typeof e.type&&e.type!=it}function Dt(e){for(var t=[e],i=e;null!=i.__o;)t.push(i.__o),i=i.__o;return t.reduce((function(e,t){e+="  in "+Tt(t);var i=t.__source;return i?e+=" (at "+i.fileName+":"+i.lineNumber+")":Lt||(Lt=!0,console.warn("Add @babel/plugin-transform-react-jsx-source to get a more detailed component stack. Note that you should not add it to production builds of your App for bundle size reasons.")),e+"\n"}),"")}var It="function"==typeof WeakMap;function wt(e){return e?"function"==typeof e.type?wt(e.__):e:{}}var kt=nt.prototype.setState;nt.prototype.setState=function(e,t){return null==this.__v&&null==this.state&&console.warn('Calling "this.setState" inside the constructor of a component is a no-op and might be a bug in your application. Instead, set "this.state = {}" directly.\n\n'+Dt(xt())),kt.call(this,e,t)};var Ot=nt.prototype.forceUpdate;function Nt(e){var t=e.props,i=Tt(e),n="";for(var r in t)if(t.hasOwnProperty(r)&&"children"!==r){var a=t[r];"function"==typeof a&&(a="function "+(a.displayName||a.name)+"() {}"),a=Object(a)!==a||a.toString?a+"":Object.prototype.toString.call(a),n+=" "+r+"="+JSON.stringify(a)}var s=t.children;return"<"+i+n+(s&&s.length?">..</"+i+">":" />")}nt.prototype.forceUpdate=function(e){return null==this.__v?console.warn('Calling "this.forceUpdate" inside the constructor of a component is a no-op and might be a bug in your application.\n\n'+Dt(xt())):null==this.__P&&console.warn('Can\'t call "this.forceUpdate" on an unmounted component. This is a no-op, but it indicates a memory leak in your application. To fix, cancel all subscriptions and asynchronous tasks in the componentWillUnmount method.\n\n'+Dt(this.__v)),Ot.call(this,e)},function(){var e,t,i,n,r;e=je.__b,t=je.diffed,i=je.__,n=je.vnode,r=je.__r,je.diffed=function(e){Ct(e)&&Rt.pop(),St.pop(),t&&t(e)},je.__b=function(t){Ct(t)&&St.push(t),e&&e(t)},je.__=function(e,t){Rt=[],i&&i(e,t)},je.vnode=function(e){e.__o=Rt.length>0?Rt[Rt.length-1]:null,n&&n(e)},je.__r=function(e){Ct(e)&&Rt.push(e),r&&r(e)};var a=!1,s=je.__b,o=je.diffed,c=je.vnode,_=je.__e,d=je.__,u=je.__h,l=It?{useEffect:new WeakMap,useLayoutEffect:new WeakMap,lazyPropTypes:new WeakMap}:null,h=[];je.__e=function(e,t,i,n){if(t&&t.__c&&"function"==typeof e.then){var r=e;e=new Error("Missing Suspense. The throwing component was: "+Tt(t));for(var a=t;a;a=a.__)if(a.__c&&a.__c.__c){e=r;break}if(e instanceof Error)throw e}try{(n=n||{}).componentStack=Dt(t),_(e,t,i,n),"function"!=typeof e.then&&setTimeout((function(){throw e}))}catch(e){throw e}},je.__=function(e,t){if(!t)throw new Error("Undefined parent passed to render(), this is the second argument.\nCheck if the element is available in the DOM/has the correct id.");var i;switch(t.nodeType){case 1:case 11:case 9:i=!0;break;default:i=!1}if(!i){var n=Tt(e);throw new Error("Expected a valid HTML node as a second argument to render.\tReceived "+t+" instead: render(<"+n+" />, "+t+");")}d&&d(e,t)},je.__b=function(e){var t=e.type,i=wt(e.__);if(a=!0,void 0===t)throw new Error("Undefined component passed to createElement()\n\nYou likely forgot to export your component or might have mixed up default and named imports"+Nt(e)+"\n\n"+Dt(e));if(null!=t&&"object"==typeof t){if(void 0!==t.__k&&void 0!==t.__e)throw new Error("Invalid type passed to createElement(): "+t+"\n\nDid you accidentally pass a JSX literal as JSX twice?\n\n  let My"+Tt(e)+" = "+Nt(t)+";\n  let vnode = <My"+Tt(e)+" />;\n\nThis usually happens when you export a JSX literal and not the component.\n\n"+Dt(e));throw new Error("Invalid type passed to createElement(): "+(Array.isArray(t)?"array":t))}if("thead"!==t&&"tfoot"!==t&&"tbody"!==t||"table"===i.type?"tr"===t&&"thead"!==i.type&&"tfoot"!==i.type&&"tbody"!==i.type&&"table"!==i.type?console.error("Improper nesting of table. Your <tr> should have a <thead/tbody/tfoot/table> parent."+Nt(e)+"\n\n"+Dt(e)):"td"===t&&"tr"!==i.type?console.error("Improper nesting of table. Your <td> should have a <tr> parent."+Nt(e)+"\n\n"+Dt(e)):"th"===t&&"tr"!==i.type&&console.error("Improper nesting of table. Your <th> should have a <tr>."+Nt(e)+"\n\n"+Dt(e)):console.error("Improper nesting of table. Your <thead/tbody/tfoot> should have a <table> parent."+Nt(e)+"\n\n"+Dt(e)),void 0!==e.ref&&"function"!=typeof e.ref&&"object"!=typeof e.ref&&!("$$typeof"in e))throw new Error('Component\'s "ref" property should be a function, or an object created by createRef(), but got ['+typeof e.ref+"] instead\n"+Nt(e)+"\n\n"+Dt(e));if("string"==typeof e.type)for(var n in e.props)if("o"===n[0]&&"n"===n[1]&&"function"!=typeof e.props[n]&&null!=e.props[n])throw new Error("Component's \""+n+'" property should be a function, but got ['+typeof e.props[n]+"] instead\n"+Nt(e)+"\n\n"+Dt(e));if("function"==typeof e.type&&e.type.propTypes){if("Lazy"===e.type.displayName&&l&&!l.lazyPropTypes.has(e.type)){var r="PropTypes are not supported on lazy(). Use propTypes on the wrapped component itself. ";try{var o=e.type();l.lazyPropTypes.set(e.type,!0),console.warn(r+"Component wrapped in lazy() is "+Tt(o))}catch(e){console.warn(r+"We will log the wrapped component's name once it is loaded.")}}var c=e.props;e.type.__f&&delete(c=function(e,t){for(var i in t)e[i]=t[i];return e}({},c)).ref,function(e,t,i,n,r){Object.keys(e).forEach((function(i){var a;try{a=e[i](t,i,n,"prop",null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(e){a=e}a&&!(a.message in At)&&(At[a.message]=!0,console.error("Failed prop type: "+a.message+(r&&"\n"+r()||"")))}))}(e.type.propTypes,c,0,Tt(e),(function(){return Dt(e)}))}s&&s(e)},je.__h=function(e,t,i){if(!e||!a)throw new Error("Hook can only be invoked from render methods.");u&&u(e,t,i)};var f=function(e,t){return{get:function(){var i="get"+e+t;h&&h.indexOf(i)<0&&(h.push(i),console.warn("getting vnode."+e+" is deprecated, "+t))},set:function(){var i="set"+e+t;h&&h.indexOf(i)<0&&(h.push(i),console.warn("setting vnode."+e+" is not allowed, "+t))}}},p={nodeName:f("nodeName","use vnode.type"),attributes:f("attributes","use vnode.props"),children:f("children","use vnode.props.children")},m=Object.create({},p);je.vnode=function(e){var t=e.props;if(null!==e.type&&null!=t&&("__source"in t||"__self"in t)){var i=e.props={};for(var n in t){var r=t[n];"__source"===n?e.__source=r:"__self"===n?e.__self=r:i[n]=r}}e.__proto__=m,c&&c(e)},je.diffed=function(e){if(e.__k&&e.__k.forEach((function(t){if(t&&void 0===t.type){delete t.__,delete t.__b;var i=Object.keys(t).join(",");throw new Error("Objects are not valid as a child. Encountered an object with the keys {"+i+"}.\n\n"+Dt(e))}})),a=!1,o&&o(e),null!=e.__k)for(var t=[],i=0;i<e.__k.length;i++){var n=e.__k[i];if(n&&null!=n.key){var r=n.key;if(-1!==t.indexOf(r)){console.error('Following component has two or more children with the same key attribute: "'+r+'". This may cause glitches and misbehavior in rendering process. Component: \n\n'+Nt(e)+"\n\n"+Dt(e));break}t.push(r)}}}}();var Pt=0;function Mt(e,t,i,n,r){var a,s,o={};for(s in t)"ref"==s?a=t[s]:o[s]=t[s];var c={type:e,props:o,key:i,ref:a,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:--Pt,__source:r,__self:n};if("function"==typeof e&&(a=e.defaultProps))for(s in a)void 0===o[s]&&(o[s]=a[s]);return je.vnode&&je.vnode(c),c}function Vt(e){return Mt("div",{className:Xe.overlay,style:{backgroundImage:"url(".concat(e.poster,")")}})}var Ft,Ut,Bt,Ht,jt=0,Wt=[],zt=[],Gt=je.__b,Kt=je.__r,Yt=je.diffed,Xt=je.__c,qt=je.unmount;function Zt(e,t){je.__h&&je.__h(Ut,e,jt||t),jt=0;var i=Ut.__H||(Ut.__H={__:[],__h:[]});return e>=i.__.length&&i.__.push({__V:zt}),i.__[e]}function Qt(e){return jt=1,function(e,t,i){var n=Zt(Ft++,2);if(n.t=e,!n.__c&&(n.__=[i?i(t):oi(void 0,t),function(e){var t=n.__N?n.__N[0]:n.__[0],i=n.t(t,e);t!==i&&(n.__N=[i,n.__[1]],n.__c.setState({}))}],n.__c=Ut,!Ut.u)){Ut.u=!0;var r=Ut.shouldComponentUpdate;Ut.shouldComponentUpdate=function(e,t,i){if(!n.__c.__H)return!0;var a=n.__c.__H.__.filter((function(e){return e.__c}));if(a.every((function(e){return!e.__N})))return!r||r.call(this,e,t,i);var s=!1;return a.forEach((function(e){if(e.__N){var t=e.__[0];e.__=e.__N,e.__N=void 0,t!==e.__[0]&&(s=!0)}})),!!s&&(!r||r.call(this,e,t,i))}}return n.__N||n.__}(oi,e)}function Jt(e,t){var i=Zt(Ft++,3);!je.__s&&si(i.__H,t)&&(i.__=e,i.i=t,Ut.__H.__h.push(i))}function $t(e){return jt=5,ei((function(){return{current:e}}),[])}function ei(e,t){var i=Zt(Ft++,7);return si(i.__H,t)?(i.__V=e(),i.i=t,i.__h=e,i.__V):i.__}function ti(){for(var e;e=Wt.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(ri),e.__H.__h.forEach(ai),e.__H.__h=[]}catch(t){e.__H.__h=[],je.__e(t,e.__v)}}je.__b=function(e){"function"!=typeof e.type||e.o||e.type===it?e.o||(e.o=e.__&&e.__.o?e.__.o:""):e.o=(e.__&&e.__.o?e.__.o:"")+(e.__&&e.__.__k?e.__.__k.indexOf(e):0),Ut=null,Gt&&Gt(e)},je.__r=function(e){Kt&&Kt(e),Ft=0;var t=(Ut=e.__c).__H;t&&(Bt===Ut?(t.__h=[],Ut.__h=[],t.__.forEach((function(e){e.__N&&(e.__=e.__N),e.__V=zt,e.__N=e.i=void 0}))):(t.__h.forEach(ri),t.__h.forEach(ai),t.__h=[])),Bt=Ut},je.diffed=function(e){Yt&&Yt(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(1!==Wt.push(t)&&Ht===je.requestAnimationFrame||((Ht=je.requestAnimationFrame)||ni)(ti)),t.__H.__.forEach((function(e){e.i&&(e.__H=e.i),e.__V!==zt&&(e.__=e.__V),e.i=void 0,e.__V=zt}))),Bt=Ut=null},je.__c=function(e,t){t.some((function(e){try{e.__h.forEach(ri),e.__h=e.__h.filter((function(e){return!e.__||ai(e)}))}catch(i){t.some((function(e){e.__h&&(e.__h=[])})),t=[],je.__e(i,e.__v)}})),Xt&&Xt(e,t)},je.unmount=function(e){qt&&qt(e);var t,i=e.__c;i&&i.__H&&(i.__H.__.forEach((function(e){try{ri(e)}catch(e){t=e}})),i.__H=void 0,t&&je.__e(t,i.__v))};var ii="function"==typeof requestAnimationFrame;function ni(e){var t,i=function(){clearTimeout(n),ii&&cancelAnimationFrame(t),setTimeout(e)},n=setTimeout(i,100);ii&&(t=requestAnimationFrame(i))}function ri(e){var t=Ut,i=e.__c;"function"==typeof i&&(e.__c=void 0,i()),Ut=t}function ai(e){var t=Ut;e.__c=e.__(),Ut=t}function si(e,t){return!e||e.length!==t.length||t.some((function(t,i){return t!==e[i]}))}function oi(e,t){return"function"==typeof t?t(e):t}var ci=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=Math.floor(e)||0,i=String(t%60);+i<10&&(i="0"+i);var n="";return t>59&&(n=String(Math.floor(t/60))),+n<10&&(n="0"+n),0==+n&&(n="00"),"".concat(n,":").concat(i)},_i="undefined"!=typeof navigator&&/Android/.test(navigator.userAgent),di="undefined"!=typeof navigator&&/iPhone|iPad/.test(navigator.userAgent),ui=_i||di;function li(e){var t=$t(null),i=Qt(0),n=S(s(),i,2),r=n[0],a=n[1];Jt((function(){t.current&&a(t.current&&t.current.getBoundingClientRect().width)}),[t,e.beforeWidth,e.leftWidth]);var o=$t(null),c=ei((function(){var t;return e.beforeWidth/100*r-((null==(t=o.current)?void 0:t.getBoundingClientRect().width)||0)/2}),[e.beforeWidth,r,o]),_=Qt(!1),d=S(s(),_,2),u=d[0],l=d[1],h=function(){l(!0)},f=function(i){i.preventDefault();var n=i instanceof MouseEvent?i.clientX:i.changedTouches[0].clientX,r=i instanceof MouseEvent?i.clientY:i.changedTouches[0].clientY,a=t.current,s=t.current;if((u||i instanceof PointerEvent||ui&&i instanceof MouseEvent)&&a&&s){var o=a.getBoundingClientRect(),c=o.top,_=o.left,d=o.bottom,h=o.right;if(r<c||r>d||n<_||n>h)l(!1);else{var f=s.getBoundingClientRect(),p=(n-f.left)/f.width;p>1&&(p=1),p<0&&(p=0),e.onChange&&e.onChange(p)}}},p=function(){l(!1)};return Mt("div",{role:e.role,className:[Xe["segmented-track"],e.className].join(" "),style:{cursor:ui?"default":"pointer"},ref:t,onMouseUp:function(){l(!1)},onMouseLeave:p,onMouseDown:h,onMouseMove:f,onTouchStart:h,onTouchMove:f,onTouchEnd:p,onClick:f,children:[Mt("div",{className:Xe.thumb,ref:o,style:{left:c+"px"}}),Mt("div",{className:Xe["segment-background"],children:[Mt("div",{className:Xe["segment-highlight-before"],style:{width:e.beforeWidth+"%"}}),Mt("div",{className:Xe["segment-highlight-after"],style:{width:e.leftWidth+"%"}})]})]})}function hi(e,t){for(var i in t)e[i]=t[i];return e}function fi(e,t){for(var i in e)if("__source"!==i&&!(i in t))return!0;for(var n in t)if("__source"!==n&&e[n]!==t[n])return!0;return!1}function pi(e){this.props=e}(pi.prototype=new nt).isPureReactComponent=!0,pi.prototype.shouldComponentUpdate=function(e,t){return fi(this.props,e)||fi(this.state,t)};var mi=je.__b;je.__b=function(e){e.type&&e.type.__f&&e.ref&&(e.props.ref=e.ref,e.ref=null),mi&&mi(e)};var vi="undefined"!=typeof Symbol&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function gi(e){function t(t){var i=hi({},t);return delete i.ref,e(i,t.ref||null)}return t.$$typeof=vi,t.render=t,t.prototype.isReactComponent=t.__f=!0,t.displayName="ForwardRef("+(e.displayName||e.name)+")",t}var yi=je.__e;je.__e=function(e,t,i,n){if(e.then)for(var r,a=t;a=a.__;)if((r=a.__c)&&r.__c)return null==t.__e&&(t.__e=i.__e,t.__k=i.__k),r.__c(e,t);yi(e,t,i,n)};var Ei=je.unmount;function bi(e,t,i){return e&&(e.__c&&e.__c.__H&&(e.__c.__H.__.forEach((function(e){"function"==typeof e.__c&&e.__c()})),e.__c.__H=null),null!=(e=hi({},e)).__c&&(e.__c.__P===i&&(e.__c.__P=t),e.__c=null),e.__k=e.__k&&e.__k.map((function(e){return bi(e,t,i)}))),e}function Ai(e,t,i){return e&&(e.__v=null,e.__k=e.__k&&e.__k.map((function(e){return Ai(e,t,i)})),e.__c&&e.__c.__P===t&&(e.__e&&i.insertBefore(e.__e,e.__d),e.__c.__e=!0,e.__c.__P=i)),e}function Ti(){this.__u=0,this.t=null,this.__b=null}function Si(e){var t=e.__.__c;return t&&t.__a&&t.__a(e)}function Ri(){this.u=null,this.o=null}je.unmount=function(e){var t=e.__c;t&&t.__R&&t.__R(),t&&!0===e.__h&&(e.type=null),Ei&&Ei(e)},(Ti.prototype=new nt).__c=function(e,t){var i=t.__c,n=this;null==n.t&&(n.t=[]),n.t.push(i);var r=Si(n.__v),a=!1,s=function(){a||(a=!0,i.__R=null,r?r(o):o())};i.__R=s;var o=function(){if(!--n.__u){if(n.state.__a){var e=n.state.__a;n.__v.__k[0]=Ai(e,e.__c.__P,e.__c.__O)}var t;for(n.setState({__a:n.__b=null});t=n.t.pop();)t.forceUpdate()}},c=!0===t.__h;n.__u++||c||n.setState({__a:n.__b=n.__v.__k[0]}),e.then(s,s)},Ti.prototype.componentWillUnmount=function(){this.t=[]},Ti.prototype.render=function(e,t){if(this.__b){if(this.__v.__k){var i=document.createElement("div"),n=this.__v.__k[0].__c;this.__v.__k[0]=bi(this.__b,i,n.__O=n.__P)}this.__b=null}var r=t.__a&&et(it,null,e.fallback);return r&&(r.__h=null),[et(it,null,t.__a?null:e.children),r]};var xi=function(e,t,i){if(++i[1]===i[0]&&e.o.delete(t),e.props.revealOrder&&("t"!==e.props.revealOrder[0]||!e.o.size))for(i=e.u;i;){for(;i.length>3;)i.pop()();if(i[1]<i[0])break;e.u=i=i[2]}};(Ri.prototype=new nt).__a=function(e){var t=this,i=Si(t.__v),n=t.o.get(e);return n[0]++,function(r){var a=function(){t.props.revealOrder?(n.push(r),xi(t,e,n)):r()};i?i(a):a()}},Ri.prototype.render=function(e){this.u=null,this.o=new Map;var t=dt(e.children);e.revealOrder&&"b"===e.revealOrder[0]&&t.reverse();for(var i=t.length;i--;)this.o.set(t[i],this.u=[1,0,this.u]);return e.children},Ri.prototype.componentDidUpdate=Ri.prototype.componentDidMount=function(){var e=this;this.o.forEach((function(t,i){xi(e,i,t)}))};var Li="undefined"!=typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103,Ci=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,Di="undefined"!=typeof document,Ii=function(e){return("undefined"!=typeof Symbol&&"symbol"==typeof Symbol()?/fil|che|rad/i:/fil|che|ra/i).test(e)};nt.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach((function(e){Object.defineProperty(nt.prototype,e,{configurable:!0,get:function(){return this["UNSAFE_"+e]},set:function(t){Object.defineProperty(this,e,{configurable:!0,writable:!0,value:t})}})}));var wi=je.event;function ki(){}function Oi(){return this.cancelBubble}function Ni(){return this.defaultPrevented}je.event=function(e){return wi&&(e=wi(e)),e.persist=ki,e.isPropagationStopped=Oi,e.isDefaultPrevented=Ni,e.nativeEvent=e};var Pi={configurable:!0,get:function(){return this.class}},Mi=je.vnode;je.vnode=function(e){var t=e.type,i=e.props,n=i;if("string"==typeof t){var r=-1===t.indexOf("-");for(var a in n={},i){var s=i[a];Di&&"children"===a&&"noscript"===t||"value"===a&&"defaultValue"in i&&null==s||("defaultValue"===a&&"value"in i&&null==i.value?a="value":"download"===a&&!0===s?s="":/ondoubleclick/i.test(a)?a="ondblclick":/^onchange(textarea|input)/i.test(a+t)&&!Ii(i.type)?a="oninput":/^onfocus$/i.test(a)?a="onfocusin":/^onblur$/i.test(a)?a="onfocusout":/^on(Ani|Tra|Tou|BeforeInp|Compo)/.test(a)?a=a.toLowerCase():r&&Ci.test(a)?a=a.replace(/[A-Z0-9]/g,"-$&").toLowerCase():null===s&&(s=void 0),/^oninput$/i.test(a)&&(a=a.toLowerCase(),n[a]&&(a="oninputCapture")),n[a]=s)}"select"==t&&n.multiple&&Array.isArray(n.value)&&(n.value=dt(i.children).forEach((function(e){e.props.selected=-1!=n.value.indexOf(e.props.value)}))),"select"==t&&null!=n.defaultValue&&(n.value=dt(i.children).forEach((function(e){e.props.selected=n.multiple?-1!=n.defaultValue.indexOf(e.props.value):n.defaultValue==e.props.value}))),e.props=n,i.class!=i.className&&(Pi.enumerable="className"in i,null!=i.className&&(n.class=i.className),Object.defineProperty(n,"className",Pi))}e.$$typeof=Li,Mi&&Mi(e)};var Vi=je.__r;je.__r=function(e){Vi&&Vi(e),e.__c};var Fi=[{val:2,label:"2"},{val:1.75,label:"1.75"},{val:1.5,label:"1.5"},{val:1.25,label:"1.25"},{val:1,label:""},{val:.75,label:"0.75"},{val:.5,label:"0.5"},{val:.25,label:"0.25"}],Ui="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNHB4IiBoZWlnaHQ9IjI0cHgiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iV2luZG93VGV4dCI+CiAgICA8cGF0aCBkPSJNMTkgMTFoLTh2Nmg4di02em00IDhWNC45OEMyMyAzLjg4IDIyLjEgMyAyMSAzSDNjLTEuMSAwLTIgLjg4LTIgMS45OFYxOWMwIDEuMS45IDIgMiAyaDE4YzEuMSAwIDItLjkgMi0yem0tMiAuMDJIM1Y0Ljk3aDE4djE0LjA1eiIvPgogICAgPHBhdGggZmlsbD0ibm9uZSIgZD0iTTAgMGgyNHYyNEgwVjB6Ii8+Cjwvc3ZnPgo=",Bi="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHdpZHRoPSIyNCI+CiAgPHBhdGggZD0iTTAgMGgyNHYyNEgwVjB6IiBmaWxsPSJub25lIi8+CiAgPHBhdGggZD0iTTEzLjA1IDkuNzlMMTAgNy41djlsMy4wNS0yLjI5TDE2IDEybC0yLjk1LTIuMjF6bTAgMEwxMCA3LjV2OWwzLjA1LTIuMjlMMTYgMTJsLTIuOTUtMi4yMXptMCAwTDEwIDcuNXY5bDMuMDUtMi4yOUwxNiAxMmwtMi45NS0yLjIxek0xMSA0LjA3VjIuMDVjLTIuMDEuMi0zLjg0IDEtNS4zMiAyLjIxTDcuMSA1LjY5QTcuOTQxIDcuOTQxIDAgMDExMSA0LjA3ek01LjY5IDcuMUw0LjI2IDUuNjhBOS45NDkgOS45NDkgMCAwMDIuMDUgMTFoMi4wMmMuMTgtMS40Ni43Ni0yLjc5IDEuNjItMy45ek00LjA3IDEzSDIuMDVjLjIgMi4wMSAxIDMuODQgMi4yMSA1LjMybDEuNDMtMS40M0E3Ljg2OCA3Ljg2OCAwIDAxNC4wNyAxM3ptMS42MSA2Ljc0QTkuOTgxIDkuOTgxIDAgMDAxMSAyMS45NXYtMi4wMmE3Ljk0MSA3Ljk0MSAwIDAxLTMuOS0xLjYybC0xLjQyIDEuNDN6TTIyIDEyYzAgNS4xNi0zLjkyIDkuNDItOC45NSA5Ljk1di0yLjAyQzE2Ljk3IDE5LjQxIDIwIDE2LjA1IDIwIDEycy0zLjAzLTcuNDEtNi45NS03LjkzVjIuMDVDMTguMDggMi41OCAyMiA2Ljg0IDIyIDEyeiIvPgo8L3N2Zz4=",Hi="data:image/svg+xml;base64,PHN2ZyBmaWxsPSJXaW5kb3dUZXh0IiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxwYXRoIGQ9Ik0xOSA5aC00VjNIOXY2SDVsNyA3IDctN3pNNSAxOHYyaDE0di0ySDV6Ii8+CiAgICA8cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+Cjwvc3ZnPg==",ji="data:image/svg+xml;base64,PHN2ZyBmaWxsPSJXaW5kb3dUZXh0IiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxwYXRoIGQ9Ik0wIDBoMjR2MjRIMHoiIGZpbGw9Im5vbmUiLz4KICAgIDxwYXRoIGQ9Ik0yMCAxMUg3LjgzbDUuNTktNS41OUwxMiA0bC04IDggOCA4IDEuNDEtMS40MUw3LjgzIDEzSDIwdi0yeiIvPgo8L3N2Zz4=",Wi="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjRweCIgdmlld0JveD0iMCAwIDI0IDI0IiB3aWR0aD0iMjRweCIgZmlsbD0iIzAwMDAwMCI+PHBhdGggZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPjxwYXRoIGQ9Ik0xOCA0bDIgNGgtM2wtMi00aC0ybDIgNGgtM2wtMi00SDhsMiA0SDdMNSA0SDRjLTEuMSAwLTEuOTkuOS0xLjk5IDJMMiAxOGMwIDEuMS45IDIgMiAyaDE2YzEuMSAwIDItLjkgMi0yVjRoLTR6Ii8+PC9zdmc+",zi="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjRweCIgdmlld0JveD0iMCAwIDI0IDI0IiB3aWR0aD0iMjRweCIgZmlsbD0iIzAwMDAwMCI+PHBhdGggZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPjxwYXRoIGQ9Ik0xMiAzdjkuMjhjLS40Ny0uMTctLjk3LS4yOC0xLjUtLjI4QzguMDEgMTIgNiAxNC4wMSA2IDE2LjVTOC4wMSAyMSAxMC41IDIxYzIuMzEgMCA0LjItMS43NSA0LjQ1LTRIMTVWNmg0VjNoLTd6Ii8+PC9zdmc+",Gi=gi((function(e,t){var i=Qt(!1),n=S(s(),i,2),r=n[0],a=n[1],o=Mt(Ki,{checkedValue:e.playbackRate,onBack:function(){return a(!1)},levels:Fi.map((function(t){return 1===t.val&&(t.label=e.i18n.text("PLAYBACK_RATE_NORMAL")),t})),onCheck:function(t){e.onClickPlaybackRate(t),a(!1)},i18n:e.i18n}),c=Qt(!1),_=S(s(),c,2),d=_[0],u=_[1],l=Mt(Ki,{checkedValue:e.currentLevel,onBack:function(){return u(!1)},levels:e.levels,onCheck:function(t){e.onChangeLevel(t),u(!1)},i18n:e.i18n}),h=Qt(!1),f=S(s(),h,2),p=f[0],m=f[1],v=Mt(Ki,{checkedValue:e.currentAudioLevel,onBack:function(){return m(!1)},levels:e.audioLevels,onCheck:function(t){e.onChangeAudioLevel(t),m(!1)},i18n:e.i18n}),g=ei((function(){return e.showOverflow&&(r||d||p)}),[e.showOverflow,r,d,p]);return Jt((function(){e.showOverflow||(a(!1),u(!1),m(!1))}),[e.showOverflow]),Mt("div",{className:[Xe.overflow,e.className].join(" "),ref:t,role:"overflow",children:[r&&o,d&&l,p&&v,e.levels.length>1&&!g&&Mt(Yi,{role:"video-btn",onClick:function(){return u(!0)},icon:Wi,children:e.i18n.text("OVERFLOW_ITEM_VIDEO")}),e.audioLevels.length>1&&!g&&Mt(Yi,{role:"audio-btn",onClick:function(){return m(!0)},icon:zi,children:e.i18n.text("OVERFLOW_ITEM_AUDIO")}),e.showDownload&&!g&&Mt(Yi,{role:"download-btn",onClick:e.onClickDownload,icon:Hi,children:e.i18n.text("OVERFLOW_ITEM_DOWNLOAD")}),e.showPlaybackRate&&!g&&Mt(Yi,{onClick:function(){return a(!0)},icon:Bi,role:"rate-btn",children:e.i18n.text("OVERFLOW_ITEM_PLAYBACK_RATE")}),e.showPictureInPicture&&!g&&Mt(Yi,{role:"inline-btn",onClick:e.onClickPictureInPicture,icon:Ui,children:e.i18n.text("OVERFLOW_ITEM_PICTURE_IN_PICTURE")})]})}));function Ki(e){return Mt(it,{children:[Mt(Yi,{icon:ji,onClick:e.onBack,children:e.i18n.text("OVERFLOW_BACK")})].concat(e.levels.map((function(t){return Mt(Yi,{type:"checkbox",checked:e.checkedValue===t.val,onClick:function(){e.onCheck(t.val)},children:t.label})})))})}function Yi(e){return Mt("div",{className:Xe["overflow-item"],onClick:e.onClick,role:e.role,children:[Mt("div",{className:Xe["overflow-icon"],style:{backgroundImage:"url(".concat(e.icon,")")}}),Mt("div",{className:Xe["overflow-content"],children:[Mt("span",{children:e.children}),"checkbox"===e.type&&Mt("input",{type:"checkbox",className:Xe["overflow-checkbox"],checked:e.checked})]})]})}var Xi="data:image/svg+xml;base64,PHN2ZyBmaWxsPSJXaW5kb3ciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogICAgPHBhdGggZD0iTTggNXYxNGwxMS03eiIvPgogICAgPHBhdGggZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPgo8L3N2Zz4K",qi="data:image/svg+xml;base64,PHN2ZyBmaWxsPSJXaW5kb3ciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogICAgPHBhdGggZD0iTTYgMTloNFY1SDZ2MTR6bTgtMTR2MTRoNFY1aC00eiIvPgogICAgPHBhdGggZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPgo8L3N2Zz4K",Zi="data:image/svg+xml;base64,PHN2ZyBmaWxsPSJXaW5kb3ciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogICAgPHBhdGggZD0iTTMgOXY2aDRsNSA1VjRMNyA5SDN6bTEzLjUgM2MwLTEuNzctMS4wMi0zLjI5LTIuNS00LjAzdjguMDVjMS40OC0uNzMgMi41LTIuMjUgMi41LTQuMDJ6TTE0IDMuMjN2Mi4wNmMyLjg5Ljg2IDUgMy41NCA1IDYuNzFzLTIuMTEgNS44NS01IDYuNzF2Mi4wNmM0LjAxLS45MSA3LTQuNDkgNy04Ljc3cy0yLjk5LTcuODYtNy04Ljc3eiIvPgogICAgPHBhdGggZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPgo8L3N2Zz4K",Qi="data:image/svg+xml;base64,PHN2ZyBmaWxsPSJXaW5kb3ciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogICAgPHBhdGggZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPgogICAgPHBhdGggZD0iTTcgMTRINXY1aDV2LTJIN3YtM3ptLTItNGgyVjdoM1Y1SDV2NXptMTIgN2gtM3YyaDV2LTVoLTJ2M3pNMTQgNXYyaDN2M2gyVjVoLTV6Ii8+Cjwvc3ZnPgo=",Ji="data:image/svg+xml;base64,PHN2ZyBmaWxsPSJXaW5kb3ciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogICAgPHBhdGggZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPgogICAgPHBhdGggZD0iTTUgMTZoM3YzaDJ2LTVINXYyem0zLThINXYyaDVWNUg4djN6bTYgMTFoMnYtM2gzdi0yaC01djV6bTItMTFWNWgtMnY1aDVWOGgtM3oiLz4KPC9zdmc+Cg==",$i="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIKCSB2aWV3Qm94PSIwIDAgMjQgMjQiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDI1NSAyNTU7IiB4bWw6c3BhY2U9InByZXNlcnZlIiBmaWxsPSJXaW5kb3ciPgo8Zz4KCTxjaXJjbGUgY3g9IjEyIiBjeT0iNiIgcj0iMiIvPgoJPGNpcmNsZSBjeD0iMTIiIGN5PSIxMiIgcj0iMiIvPgoJPGNpcmNsZSBjeD0iMTIiIGN5PSIxOCIgcj0iMiIvPgo8L2c+Cjwvc3ZnPgo=",en="data:image/svg+xml;base64,PHN2ZyBmaWxsPSJXaW5kb3ciIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogICAgPHBhdGggZD0iTTE2LjUgMTJjMC0xLjc3LTEuMDItMy4yOS0yLjUtNC4wM3YyLjIxbDIuNDUgMi40NWMuMDMtLjIuMDUtLjQxLjA1LS42M3ptMi41IDBjMCAuOTQtLjIgMS44Mi0uNTQgMi42NGwxLjUxIDEuNTFDMjAuNjMgMTQuOTEgMjEgMTMuNSAyMSAxMmMwLTQuMjgtMi45OS03Ljg2LTctOC43N3YyLjA2YzIuODkuODYgNSAzLjU0IDUgNi43MXpNNC4yNyAzTDMgNC4yNyA3LjczIDlIM3Y2aDRsNSA1di02LjczbDQuMjUgNC4yNWMtLjY3LjUyLTEuNDIuOTMtMi4yNSAxLjE4djIuMDZjMS4zOC0uMzEgMi42My0uOTUgMy42OS0xLjgxTDE5LjczIDIxIDIxIDE5LjczbC05LTlMNC4yNyAzek0xMiA0TDkuOTEgNi4wOSAxMiA4LjE4VjR6Ii8+CiAgICA8cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+Cjwvc3ZnPgo=",tn="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iNDgiIHdpZHRoPSI0OCI+PHBhdGggZmlsbD0iI2ZmZiIgZD0iTTIzLjk1IDQwLjNxLTYuNzUgMC0xMS41MjUtNC43NzVUNy42NSAyNHEwLTYuNzUgNC43NzUtMTEuNTI1VDIzLjk1IDcuN3E0LjM1IDAgNy42IDEuNzV0NS42NSA0LjhWNy43aDMuMTV2MTMuMTVIMjcuMlYxNy43aDguMzVxLTEuOS0yLjk1LTQuOC00Ljc3NS0yLjktMS44MjUtNi44LTEuODI1LTUuNCAwLTkuMTUgMy43NVQxMS4wNSAyNHEwIDUuNCAzLjc1IDkuMTV0OS4xNSAzLjc1cTQuMSAwIDcuNTI1LTIuMzUgMy40MjUtMi4zNSA0Ljc3NS02LjJoMy41NVEzOC4zIDMzLjcgMzMuOTI1IDM3cS00LjM3NSAzLjMtOS45NzUgMy4zWiIvPjwvc3ZnPg==",nn=gi((function(e,t){var i=e.disabled,n=ei((function(){var t=e.duration;return e.duration===1/0&&e.buffered[0]&&e.buffered[0][1]&&(t=e.buffered[0][1]),e.currentTime/t*100}),[e.currentTime,e.duration,e.buffered]),r=Qt(0),a=S(s(),r,2),o=a[0],c=a[1];Jt((function(){return e.buffered[0]&&c((e.buffered[0][1]||0)/e.duration*100)}),[e.duration,e.buffered,e.duration]);var _=Qt(!1),d=S(s(),_,2),u=d[0],l=d[1],h=$t(null),f=$t(null);return Jt((function(){var e=function(e){h.current&&(h.current.contains(e.target)||f.current===e.target)||l(!1)};return document.addEventListener("click",e),function(){return document.removeEventListener("click",e)}}),[]),Jt((function(){e.showPanel||l(!1)}),[e.showPanel]),Mt("div",{ref:t,role:"panel",className:Xe.panel,onDblClick:e.onDblClick,onClick:e.onClick,onMouseMove:e.onMouseMove,onMouseLeave:e.onMouseLeave,style:e.style,children:[Mt("div",{className:Xe["button-panel"],children:[Mt("div",{className:Xe["button-panel-left"],children:[Mt(rn,{icon:e.paused?Xi:qi,onClick:e.onClickPlayButton,disabled:i,role:"play-btn"}),e.showTime&&Mt("div",{className:Xe["current-time-display"],children:ci(e.currentTime)}),e.duration!==1/0&&!i&&e.showTime&&Mt("div",{className:Xe["time-remaining-display"],children:["/ ",ci(e.duration)]})]}),Mt("div",{className:Xe["button-panel-right"],children:[!di&&!ui&&Mt(rn,{icon:e.muted?en:Zi,role:"mute-btn",className:Xe["volume-button"],onClick:e.onClickVolumeButton,disabled:i,children:Mt(li,{className:Xe["volume-progress"],beforeWidth:100*e.volume,leftWidth:0,onChange:function(t){return e.onChangeVolume(t)}})}),e.duration===1/0&&Mt(rn,{icon:tn,onClick:e.onClickRefresh,disabled:i}),Mt(rn,{icon:e.isFullscreen?Ji:Qi,onClick:e.onClickFullscreenButton,disabled:i,role:"fullscreen-btn"}),Mt(rn,{ref:f,icon:$i,role:"overflow-btn",style:{backgroundSize:"20px"},onClick:function(){return l(!u)},disabled:i}),Mt(Gi,{ref:h,className:Xe.overflow+" "+(u?"":Xe.closed),role:"overflow",i18n:e.i18n,levels:e.levels,audioLevels:e.audioLevels,currentLevel:e.currentLevel,currentAudioLevel:e.currentAudioLevel,playbackRate:e.playbackRate,showDownload:e.showDownload,showPlaybackRate:e.showPlaybackRate,showPictureInPicture:e.showPictureInPicture,showOverflow:u,onClickDownload:function(){l(!1),e.onClickDownload()},onClickPlaybackRate:function(t){l(!1),e.onClickPlaybackRate(t)},onClickPictureInPicture:function(){l(!1),e.onClickPictureInPicture()},onChangeLevel:function(t){l(!1),e.onChangeLevel(t)},onChangeAudioLevel:function(t){l(!1),e.onChangeAudioLevel(t)}})]})]}),e.showProgress&&Mt(li,{role:"timeline",className:Xe.timeline,beforeWidth:n,leftWidth:o,onChange:function(t){return e.onSeek(t*e.duration)}})]})})),rn=gi((function(e,t){var i=e.disabled,n=e.style,r=e.className,a=e.onClick,s=e.role,o="url(".concat(e.icon,")");return e.children?Mt("div",{ref:t,className:[Xe["panel-button-wrapper"],i?Xe.disabled:"",r].join(" "),children:[Mt("div",{className:Xe["panel-button-bg"]}),e.children,Mt("div",{role:s,onClick:function(e){return!i&&a(e)},className:[Xe["panel-button"],i?Xe.disabled:""].join(" "),style:Object.assign({backgroundImage:o},n)})]}):Mt("div",{ref:t,role:s,onClick:function(e){return!i&&a(e)},className:[Xe["panel-button"],i?Xe.disabled:"",r].join(" "),style:Object.assign({backgroundImage:o},n),children:Mt("div",{className:Xe["panel-button-bg"]})})}));function an(){return Mt("div",{className:Xe.loading,children:Mt("div",{className:Xe["loading-spinner-frame"],children:Mt("div",{className:Xe.spinner,children:Mt("div",{className:Xe["kwai-layer"],children:[Mt("div",{className:Xe["spinner-mask-1"],children:Mt("div",{className:Xe["loading-spinner-mask-1-bg"]})}),Mt("div",{className:Xe["spinner-mask-2"],children:Mt("div",{className:Xe["loading-spinner-mask-2-bg"]})})]})})})})}function sn(e){var t=e.player,i=(e.switchItems,Qt([])),n=S(s(),i,2),r=n[0],a=n[1];Jt((function(){var e=function(){var e,i,n;return(null==(e=t.buffered)?void 0:e.length)&&a([[null==(i=t.buffered)?void 0:i.start(0),null==(n=t.buffered)?void 0:n.end(0)]])};return t.on("progress",e),function(){return t.on("progress",e)}}),[]);var o=Qt(0),c=S(s(),o,2),_=c[0],d=c[1];Jt((function(){var e=function(){return d(t.currentTime)};return t.on("timeupdate",e),function(){return t.on("timeupdate",e)}}),[]);var u=Qt(0),l=S(s(),u,2),h=l[0],f=l[1];Jt((function(){var e=function(){return f(t.duration)};return t.on("durationchange",e),function(){return t.on("durationchange",e)}}),[]);var p=Qt(!0),m=S(s(),p,2),v=m[0],g=m[1],y=Qt(0),E=S(s(),y,2),b=E[0],A=E[1];Jt((function(){var e=function(){g(t.muted||0===t.volume),A(t.volume)};return t.on("volumechange",e),t.on("playing",e),function(){t.off("volumechange",e),t.off("playing",e)}}),[]);var T=Qt(!1),R=S(s(),T,2),x=R[0],L=R[1];Jt((function(){var e=function(){return L(!0)},i=function(){return L(!1)};return t.on("waiting",e),t.on("seeking",e),t.on("playing",i),t.on("seeked",i),t.on("timeupdate",i),function(){t.off("waiting",e),t.off("seeking",e),t.off("playing",i),t.off("seeked",i),t.off("timeupdate",i)}}),[]);var C=Qt(!0),D=S(s(),C,2),I=D[0],w=D[1],k=Qt(!0),O=S(s(),k,2),N=O[0],P=O[1];Jt((function(){var e=function(){w(t.paused),P(!1)};return t.on("pause",e),t.on("canplay",e),t.on("playing",e),function(){t.off("pause",e),t.off("canplay",e),t.off("playing",e)}}),[]);var M=Qt(!1),V=S(s(),M,2),F=V[0],U=V[1];Jt((function(){var e=function(e){var t=e.isFull;return U(t)};return t.on("fullscreenchange",e),function(){t.off("fullscreenchange",e)}}),[t]);var B=Qt(!0),H=S(s(),B,2),j=H[0],W=H[1];Jt((function(){var e=function(){W(!1)};return t.on("videorendererchange",e),function(){t.off("videorendererchange",e)}}),[t]),Jt((function(){var e=t.getMainContainer();e&&(e.style.display=F?"flex":"")}),[F]);var z=Qt(1),G=S(s(),z,2),K=G[0],Y=G[1];Jt((function(){var e=function(){return Y(t.playbackRate)};return t.on("ratechange",e),function(){t.off("ratechange",e)}}),[t]);var X=Qt(-1),q=S(s(),X,2),Z=q[0],Q=q[1],J=Qt(-1),$=S(s(),J,2),ee=$[0],te=$[1],ie=Qt([]),ne=S(s(),ie,2),re=ne[0],ae=ne[1],se=Qt([]),oe=S(s(),se,2),ce=oe[0],_e=oe[1];Jt((function(){var i=[],n=function(e){var n;if(e.levels.forEach((function(e,t){var n=e.qualityLabel||e.qualityType;n||(n=e.width&&e.height?Math.min(e.width,e.height)+"P":t.toString()),i.push({val:t,label:n})})),Q(e.currentLevel),!1!==(null==(n=null==t?void 0:t.config)?void 0:n.adaptive)&&i.length>1&&(i.unshift({val:-1,label:""}),Q(-1)),ae(i),e.audioTracks){var r=[];e.audioTracks.forEach((function(e,t){r.push({val:t,label:e.qualityLabel||e.qualityType||e.lang||t.toString()})})),_e(r),te(e.audioTrack||0)}};return Object.keys(e.manifest).length>0&&n(e.manifest),t.on("manifestparsed",n),function(){t.off("manifestparsed",n)}}),[e.manifest]);var de=Qt(!1),ue=S(s(),de,2),le=ue[0],he=ue[1],fe=Qt(!1),pe=S(s(),fe,2),me=pe[0],ve=pe[1],ge=Qt(!0),ye=S(s(),ge,2),Ee=ye[0],be=ye[1];Jt((function(){var e=function(e){"mediaInfo"!==e.type||"hls"===e.value.box||e.value.isLive||"object"==typeof(null==t?void 0:t.src)||he(!0),("mediaInfo"===e.type&&!e.value.isLive||ui)&&ve(!0),"mediaInfo"===e.type&&e.value.isLive&&be(!1)};return t.on("report",e),function(){t.off("report",e)}}));var Ae=Qt(!0),Te=S(s(),Ae,2),Se=Te[0],Re=Te[1],xe=Qt(0),Le=S(s(),xe,2),Ce=Le[0],De=Le[1];Jt((function(){var e=function(){clearTimeout(Ce),Re(!0)};return function(){clearTimeout(Ce);var e=+setTimeout((function(){!t.paused&&Re(!1)}),3e3);De(e)}(),t.on("pause",e),function(){t.off("pause",e)}}),[]);var Ie=ei((function(){return!t.src}),[t.src]),we=function(){t.paused?t.play():t.pause()},ke=function(){t.isFullscreen()?t.exitFullscreen():t.requestFullscreen()},Oe=$t(null),Ne=$t(null),Pe=Qt(0),Me=S(s(),Pe,2),Ve=(Me[0],Me[1]),Fe=Qt(0),Ue=S(s(),Fe,2),Be=(Ue[0],Ue[1]),He=Qt(!1),je=S(s(),He,2),We=(je[0],je[1]);Jt((function(){var t=function(t){var i;if(!(null==(i=Ne.current)?void 0:i.contains(t.target))){t.preventDefault();var n=0,r=0;We(!1),Ke(!0),setTimeout((function(){var i,a,s=null==(i=e.container)?void 0:i.getBoundingClientRect(),o=null==(a=Ne.current)?void 0:a.getBoundingClientRect(),c=s.width,_=s.height,d=s.left,u=s.top,l=null==o?void 0:o.width,h=null==o?void 0:o.height;l&&h&&(n=l&&t.clientX+l>=d+c?d+c-l:t.clientX,r=t.clientY+h>=u+_?u+_-h:t.clientY),Ve(n-d),Be(r-u),We(!0)}),0)}};return e.container.addEventListener("contextmenu",t),function(){return e.container.removeEventListener("contextmenu",t)}}),[]);var ze=Qt(!1),Ge=S(s(),ze,2),Ke=(Ge[0],Ge[1]);return Mt(it,{children:[x&&Mt(an,{}),N&&Mt(Vt,{poster:e.options.poster}),!1,Mt(nn,{style:{opacity:Se?1:0},ref:Oe,buffered:r,currentTime:_,duration:h,muted:v,paused:I,volume:b,playbackRate:K,isFullscreen:F,levels:re,audioLevels:ce,currentLevel:Z,currentAudioLevel:ee,showPanel:Se,showDownload:le,showPlaybackRate:me,showProgress:void 0===e.options.showProgress?Ee:e.options.showProgress,showTime:void 0===e.options.showTime||e.options.showTime,showPictureInPicture:!ui&&"requestPictureInPicture"in document.createElement("video")&&j&&!N,disabled:Ie,i18n:e.i18n,onClickPlayButton:we,onClickVolumeButton:function(){t.muted=!t.muted,t.volume=t.muted?0:1},onClickRefresh:function(){t.refresh()},onChangeVolume:function(e){t.volume=e},onSeek:function(e){t.duration!==1/0&&(t.currentTime=e,d(t.currentTime))},onClickFullscreenButton:ke,onClick:function(e){e.target!==Oe.current||Ie||we()},onDblClick:function(e){var t;e.target===Oe.current&&ke(),window.getSelection?null==(t=window.getSelection())||t.removeAllRanges():document.selection.empty()},onMouseMove:function(e){if(Re(!0),clearTimeout(Ce),Oe.current===e.target){var i=+setTimeout((function(){!t.paused&&Re(!1)}),3e3);De(i)}},onMouseLeave:function(){!t.paused&&Re(!1)},onClickDownload:function(){var e=document.createElement("a");e.style.display="none",e.download="true",e.target="_blank",e.href=t.src,document.body.appendChild(e),e.click(),setTimeout((function(){document.body.removeChild(e)}),200)},onClickPlaybackRate:function(e){t.playbackRate=e},onClickPictureInPicture:function(){t.requestPictureInPicture()},onChangeLevel:function(e){t.currentLevel=e,Q(e)},onChangeAudioLevel:function(e){t.audioTracks=e,te(e)}})]})}gi((function(e,t){var i=Qt(0),n=S(s(),i,2),r=n[0],a=n[1];return Mt(it,{children:0!==e.switchItems.length&&Mt("div",{ref:t,className:Xe.switchPanel,style:{left:e.left,top:e.top,visibility:e.visible?"visible":"hidden"},onMouseLeave:function(){var t=+setTimeout((function(){e.onChangeShowSwitchPanel()}),300);a(t)},onMouseEnter:function(){clearTimeout(r)},children:Mt("div",{className:Xe.switchMenu,children:e.switchItems.map((function(t){return Mt("div",{onClick:function(){var i;i=t.handle,e.onChangeShowSwitchPanel(),i()},className:Xe.line,children:[Mt("div",{className:Xe.icon,children:Mt("div",{className:Xe.iconImg,style:{backgroundSize:"contain",backgroundImage:"url(".concat(t.iconSrc,")")}})}),Mt("div",{className:Xe.label,children:t.name}),Mt("input",{type:"checkbox",checked:t.isChecked,className:Xe["switchPanel-checkbox"]})]})}))})})})}));var on,cn="ChromeControlsPlugin",_n=function(e){l()(i,e);var t=L(i);function i(){var e;return g()(this,i),e=t.apply(this,arguments),Ye(d()(e),"name",cn),Ye(d()(e),"version","1.0.2"),Ye(d()(e),"player"),Ye(d()(e),"container"),Ye(d()(e),"_options",{showProgress:void 0,showTime:void 0,poster:""}),Ye(d()(e),"i18n"),Ye(d()(e),"loopIconSrc","data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjRweCIgdmlld0JveD0iMCAwIDI0IDI0IiB3aWR0aD0iMjRweCIgZmlsbD0iI0ZGRkZGRiI+PHBhdGggZD0iTTAgMGgyNHYyNEgwVjB6IiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTEyIDRWMUw4IDVsNCA0VjZjMy4zMSAwIDYgMi42OSA2IDYgMCAxLjAxLS4yNSAxLjk3LS43IDIuOGwxLjQ2IDEuNDZDMTkuNTQgMTUuMDMgMjAgMTMuNTcgMjAgMTJjMC00LjQyLTMuNTgtOC04LTh6bTAgMTRjLTMuMzEgMC02LTIuNjktNi02IDAtMS4wMS4yNS0xLjk3LjctMi44TDUuMjQgNy43NEM0LjQ2IDguOTcgNCAxMC40MyA0IDEyYzAgNC40MiAzLjU4IDggOCA4djNsNC00LTQtNHYzeiIvPjwvc3ZnPg=="),Ye(d()(e),"isChecked",!1),Ye(d()(e),"switchItem"),Ye(d()(e),"onPlayLoop",(function(){e.player&&(e.player.loop=!e.player.loop,e.switchItem&&(e.switchItem.isChecked=!e.switchItem.isChecked))})),Ye(d()(e),"onPlayerEmit",(function(t){var i,n;"mediaInfo"!==t.type||t.value.isLive||(e.switchItem=e.addContextMenuItem((null==(i=e.i18n)?void 0:i.text("CONTEXT_MENU_LOOP"))||"",e.onPlayLoop,e.loopIconSrc,e.isChecked),null==(n=e.player)||n.off("report",e.onPlayerEmit))})),Ye(d()(e),"switchItems",[]),e}return E()(i,[{key:"beforeInstall",value:function(e){this.player=e,e.on("report",this.onPlayerEmit),this.i18n=e.getPluginInstance("I18nPlugin")}},{key:"afterInstall",value:function(e,t){var i,n,r,a,s=this;if(this.player=e,!e)throw new Error("player is undefined");if(this._options=Object.assign(this._options,{showProgress:void 0===(null==(i=this.player.data)?void 0:i.showProgress)||null==(n=this.player.data)?void 0:n.showProgress,showTime:void 0===(null==(r=this.player.data)?void 0:r.showTime)||null==(a=this.player.data)?void 0:a.showTime,poster:this.player.poster},t),this.container=e.createSubContainer(),!this.container)throw new Error("container is undefined");if(!this.i18n)throw new Error("i18n is undefined");this.container.className=Xe.controls;var o={};e.on("manifestparsed",(function(e){return Object.assign(o,e)})),e.on("attribute:change:src",(function(){if(!s.container)throw new Error("container is undefined");if(!s.i18n)throw new Error("i18n is undefined");bt(null,s.container),bt(Mt(sn,{player:e,manifest:o={},options:s._options,container:s.container,switchItems:s.switchItems,i18n:s.i18n}),s.container)})),e.controls||(this.container.style.display="none"),e.on("attribute:change:controls",(function(e){s.container&&(s.container.style.display=e?"block":"none")})),bt(Mt(sn,{player:e,manifest:o,options:this._options,container:this.container,switchItems:this.switchItems,i18n:this.i18n}),this.container)}},{key:"beforeUninstall",value:function(){this.container&&bt(null,this.container)}},{key:"afterUninstall",value:function(){}},{key:"showProgress",get:function(){return this._options.showProgress},set:function(e){this._options.showProgress=e}},{key:"showTime",get:function(){return this._options.showTime},set:function(e){this._options.showTime=e}},{key:"addContextMenuItem",value:function(e,t,i,n){var r={name:e,handle:t,iconSrc:i,isChecked:n};return this.switchItems.push(r),r}}]),i}(he),dn=Object.defineProperty,un=function(e,t,i){return function(e,t,i){t in e?dn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i}(e,"symbol"!=typeof t?t+"":t,i),i},ln=new Uint8Array(16);function hn(){if(!on&&!(on="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return on(ln)}for(var fn=[],pn=0;pn<256;++pn)fn.push((pn+256).toString(16).slice(1));var mn={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function vn(e,t,i){if(mn.randomUUID&&!t&&!e)return mn.randomUUID();var n=(e=e||{}).random||(e.rng||hn)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){i=i||0;for(var r=0;r<16;++r)t[i+r]=n[r];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(fn[e[t+0]]+fn[e[t+1]]+fn[e[t+2]]+fn[e[t+3]]+"-"+fn[e[t+4]]+fn[e[t+5]]+"-"+fn[e[t+6]]+fn[e[t+7]]+"-"+fn[e[t+8]]+fn[e[t+9]]+"-"+fn[e[t+10]]+fn[e[t+11]]+fn[e[t+12]]+fn[e[t+13]]+fn[e[t+14]]+fn[e[t+15]]).toLowerCase()}(n)}var gn="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==i.g?i.g:"undefined"!=typeof self?self:{},yn={exports:{}};!function(e,t){!function(i,n){var r="function",a="undefined",s="object",o="string",c="model",_="name",d="type",u="vendor",l="version",h="architecture",f="console",p="mobile",m="tablet",v="smarttv",g="wearable",y="embedded",E="Amazon",b="Apple",A="ASUS",T="BlackBerry",S="Firefox",R="Google",x="Huawei",L="LG",C="Microsoft",D="Motorola",I="Opera",w="Samsung",k="Sony",O="Xiaomi",N="Zebra",P="Facebook",M=function(e){for(var t={},i=0;i<e.length;i++)t[e[i].toUpperCase()]=e[i];return t},V=function(e,t){return typeof e===o&&-1!==F(t).indexOf(F(e))},F=function(e){return e.toLowerCase()},U=function(e,t){if(typeof e===o)return e=e.replace(/^\s\s*/,"").replace(/\s\s*$/,""),typeof t===a?e:e.substring(0,255)},B=function(e,t){for(var i,a,o,c,_,d,u=0;u<t.length&&!_;){var l=t[u],h=t[u+1];for(i=a=0;i<l.length&&!_;)if(_=l[i++].exec(e))for(o=0;o<h.length;o++)d=_[++a],typeof(c=h[o])===s&&c.length>0?2===c.length?typeof c[1]==r?this[c[0]]=c[1].call(this,d):this[c[0]]=c[1]:3===c.length?typeof c[1]!==r||c[1].exec&&c[1].test?this[c[0]]=d?d.replace(c[1],c[2]):n:this[c[0]]=d?c[1].call(this,d,c[2]):n:4===c.length&&(this[c[0]]=d?c[3].call(this,d.replace(c[1],c[2])):n):this[c]=d||n;u+=2}},H=function(e,t){for(var i in t)if(typeof t[i]===s&&t[i].length>0){for(var r=0;r<t[i].length;r++)if(V(t[i][r],e))return"?"===i?n:i}else if(V(t[i],e))return"?"===i?n:i;return e},j={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},W={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[l,[_,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[l,[_,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[_,l],[/opios[\/ ]+([\w\.]+)/i],[l,[_,"Opera Mini"]],[/\bopr\/([\w\.]+)/i],[l,[_,I]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[_,l],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[l,[_,"UCBrowser"]],[/\bqbcore\/([\w\.]+)/i],[l,[_,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[l,[_,"WeChat"]],[/konqueror\/([\w\.]+)/i],[l,[_,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[l,[_,"IE"]],[/yabrowser\/([\w\.]+)/i],[l,[_,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[_,/(.+)/,"$1 Secure Browser"],l],[/\bfocus\/([\w\.]+)/i],[l,[_,"Firefox Focus"]],[/\bopt\/([\w\.]+)/i],[l,[_,"Opera Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[l,[_,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[l,[_,"Dolphin"]],[/coast\/([\w\.]+)/i],[l,[_,"Opera Coast"]],[/miuibrowser\/([\w\.]+)/i],[l,[_,"MIUI Browser"]],[/fxios\/([-\w\.]+)/i],[l,[_,S]],[/\bqihu|(qi?ho?o?|360)browser/i],[[_,"360 Browser"]],[/(oculus|samsung|sailfish)browser\/([\w\.]+)/i],[[_,/(.+)/,"$1 Browser"],l],[/(comodo_dragon)\/([\w\.]+)/i],[[_,/_/g," "],l],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[_,l],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i],[_],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[_,P],l],[/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[_,l],[/\bgsa\/([\w\.]+) .*safari\//i],[l,[_,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[l,[_,"Chrome Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[_,"Chrome WebView"],l],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[l,[_,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[_,l],[/version\/([\w\.]+) .*mobile\/\w+ (safari)/i],[l,[_,"Mobile Safari"]],[/version\/([\w\.]+) .*(mobile ?safari|safari)/i],[l,_],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[_,[l,H,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[_,l],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[_,"Netscape"],l],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[l,[_,"Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[_,l]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[h,"amd64"]],[/(ia32(?=;))/i],[[h,F]],[/((?:i[346]|x)86)[;\)]/i],[[h,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[h,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[h,"armhf"]],[/windows (ce|mobile); ppc;/i],[[h,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[h,/ower/,"",F]],[/(sun4\w)[;\)]/i],[[h,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[h,F]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[pt]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[c,[u,w],[d,m]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[c,[u,w],[d,p]],[/\((ip(?:hone|od)[\w ]*);/i],[c,[u,b],[d,p]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[c,[u,b],[d,m]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[c,[u,x],[d,m]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}-[atu]?[ln][01259x][012359][an]?)\b(?!.+d\/s)/i],[c,[u,x],[d,p]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[c,/_/g," "],[u,O],[d,p]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[c,/_/g," "],[u,O],[d,m]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[c,[u,"OPPO"],[d,p]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[c,[u,"Vivo"],[d,p]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[c,[u,"Realme"],[d,p]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[c,[u,D],[d,p]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[c,[u,D],[d,m]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[c,[u,L],[d,m]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[c,[u,L],[d,p]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[c,[u,"Lenovo"],[d,m]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[c,/_/g," "],[u,"Nokia"],[d,p]],[/(pixel c)\b/i],[c,[u,R],[d,m]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[c,[u,R],[d,p]],[/droid.+ ([c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[c,[u,k],[d,p]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[c,"Xperia Tablet"],[u,k],[d,m]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[c,[u,"OnePlus"],[d,p]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[c,[u,E],[d,m]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[c,/(.+)/g,"Fire Phone $1"],[u,E],[d,p]],[/(playbook);[-\w\),; ]+(rim)/i],[c,u,[d,m]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[c,[u,T],[d,p]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[c,[u,A],[d,m]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[c,[u,A],[d,p]],[/(nexus 9)/i],[c,[u,"HTC"],[d,m]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic|sony)[-_ ]?([-\w]*)/i],[u,[c,/_/g," "],[d,p]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[c,[u,"Acer"],[d,m]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[c,[u,"Meizu"],[d,p]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[c,[u,"Sharp"],[d,p]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[u,c,[d,p]],[/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[u,c,[d,m]],[/(surface duo)/i],[c,[u,C],[d,m]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[c,[u,"Fairphone"],[d,p]],[/(u304aa)/i],[c,[u,"AT&T"],[d,p]],[/\bsie-(\w*)/i],[c,[u,"Siemens"],[d,p]],[/\b(rct\w+) b/i],[c,[u,"RCA"],[d,m]],[/\b(venue[\d ]{2,7}) b/i],[c,[u,"Dell"],[d,m]],[/\b(q(?:mv|ta)\w+) b/i],[c,[u,"Verizon"],[d,m]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[c,[u,"Barnes & Noble"],[d,m]],[/\b(tm\d{3}\w+) b/i],[c,[u,"NuVision"],[d,m]],[/\b(k88) b/i],[c,[u,"ZTE"],[d,m]],[/\b(nx\d{3}j) b/i],[c,[u,"ZTE"],[d,p]],[/\b(gen\d{3}) b.+49h/i],[c,[u,"Swiss"],[d,p]],[/\b(zur\d{3}) b/i],[c,[u,"Swiss"],[d,m]],[/\b((zeki)?tb.*\b) b/i],[c,[u,"Zeki"],[d,m]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[u,"Dragon Touch"],c,[d,m]],[/\b(ns-?\w{0,9}) b/i],[c,[u,"Insignia"],[d,m]],[/\b((nxa|next)-?\w{0,9}) b/i],[c,[u,"NextBook"],[d,m]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[u,"Voice"],c,[d,p]],[/\b(lvtel\-)?(v1[12]) b/i],[[u,"LvTel"],c,[d,p]],[/\b(ph-1) /i],[c,[u,"Essential"],[d,p]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[c,[u,"Envizen"],[d,m]],[/\b(trio[-\w\. ]+) b/i],[c,[u,"MachSpeed"],[d,m]],[/\btu_(1491) b/i],[c,[u,"Rotor"],[d,m]],[/(shield[\w ]+) b/i],[c,[u,"Nvidia"],[d,m]],[/(sprint) (\w+)/i],[u,c,[d,p]],[/(kin\.[onetw]{3})/i],[[c,/\./g," "],[u,C],[d,p]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[c,[u,N],[d,m]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[c,[u,N],[d,p]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[u,c,[d,f]],[/droid.+; (shield) bui/i],[c,[u,"Nvidia"],[d,f]],[/(playstation [345portablevi]+)/i],[c,[u,k],[d,f]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[c,[u,C],[d,f]],[/smart-tv.+(samsung)/i],[u,[d,v]],[/hbbtv.+maple;(\d+)/i],[[c,/^/,"SmartTV"],[u,w],[d,v]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[u,L],[d,v]],[/(apple) ?tv/i],[u,[c,"Apple TV"],[d,v]],[/crkey/i],[[c,"Chromecast"],[u,R],[d,v]],[/droid.+aft(\w)( bui|\))/i],[c,[u,E],[d,v]],[/\(dtv[\);].+(aquos)/i],[c,[u,"Sharp"],[d,v]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w ]*; *(\w[^;]*);([^;]*)/i],[[u,U],[c,U],[d,v]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[d,v]],[/((pebble))app/i],[u,c,[d,g]],[/droid.+; (glass) \d/i],[c,[u,R],[d,g]],[/droid.+; (wt63?0{2,3})\)/i],[c,[u,N],[d,g]],[/(quest( 2)?)/i],[c,[u,P],[d,g]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[u,[d,y]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[c,[d,p]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[c,[d,m]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[d,m]],[/(phone|mobile(?:[;\/]| safari)|pda(?=.+windows ce))/i],[[d,p]],[/(android[-\w\. ]{0,9});.+buil/i],[c,[u,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[l,[_,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[l,[_,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[_,l],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[l,_]],os:[[/microsoft (windows) (vista|xp)/i],[_,l],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[_,[l,H,j]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[_,"Windows"],[l,H,j]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[l,/_/g,"."],[_,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[_,"Mac OS"],[l,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86)/i],[l,_],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[_,l],[/\(bb(10);/i],[l,[_,T]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[l,[_,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[l,[_,"Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[l,[_,"webOS"]],[/crkey\/([\d\.]+)/i],[l,[_,"Chromecast"]],[/(cros) [\w]+ ([\w\.]+\w)/i],[[_,"Chromium OS"],l],[/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[_,l],[/(sunos) ?([\w\.\d]*)/i],[[_,"Solaris"],l],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[_,l]]},z=function e(t,r){if(typeof t===s&&(r=t,t=n),!(this instanceof e))return new e(t,r).getResult();var c=t||(typeof i!==a&&i.navigator&&i.navigator.userAgent?i.navigator.userAgent:""),_=r?function(e,t){var i={};for(var n in e)t[n]&&t[n].length%2==0?i[n]=t[n].concat(e[n]):i[n]=e[n];return i}(W,r):W;return this.getBrowser=function(){var e,t={};return t.name=n,t.version=n,B.call(t,c,_.browser),t.major=typeof(e=t.version)===o?e.replace(/[^\d\.]/g,"").split(".")[0]:n,t},this.getCPU=function(){var e={};return e.architecture=n,B.call(e,c,_.cpu),e},this.getDevice=function(){var e={};return e.vendor=n,e.model=n,e.type=n,B.call(e,c,_.device),e},this.getEngine=function(){var e={};return e.name=n,e.version=n,B.call(e,c,_.engine),e},this.getOS=function(){var e={};return e.name=n,e.version=n,B.call(e,c,_.os),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return c},this.setUA=function(e){return c=typeof e===o&&e.length>255?U(e,255):e,this},this.setUA(c),this};z.VERSION="1.0.2",z.BROWSER=M([_,l,"major"]),z.CPU=M([h]),z.DEVICE=M([c,u,d,f,p,v,m,g,y]),z.ENGINE=z.OS=M([_,l]),e.exports&&(t=e.exports=z),t.UAParser=z;var G=typeof i!==a&&(i.jQuery||i.Zepto);if(G&&!G.ua){var K=new z;G.ua=K.getResult(),G.ua.get=function(){return K.getUA()},G.ua.set=function(e){K.setUA(e);var t=K.getResult();for(var i in t)G.ua[i]=t[i]}}}("object"==typeof window?window:gn)}(yn,yn.exports);var En="undefined"!=typeof navigator&&yn.exports.UAParser(navigator.userAgent),bn=function e(t,i,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=new FormData;if(s.append("common",Rn(t,{service_name:"KwaiPlayerWeb"})),s.append("logs",JSON.stringify({event:[Sn(i,n)]})),a&&navigator.sendBeacon)navigator.sendBeacon("https://log-sdk.ksapisrv.com/rest/wd/common/log/collect/misc2",s);else{var o=new XMLHttpRequest;o.open("POST","https://log-sdk.ksapisrv.com/rest/wd/common/log/collect/misc2"),o.addEventListener("error",(function(a){console.error("sendLog error",a),r>0&&e(t,i,n,r--)})),o.timeout=5e3,o.addEventListener("timeout",(function(a){console.error("sendLog timeout",a),r>0&&e(t,i,n,r--)})),o.send(s)}},An="undefined"!=typeof localStorage&&localStorage.kwai_player_client_increment_id||0,Tn=(new Date).toString().match(/GMT\+\d+/);function Sn(e,t){An++,localStorage.kwai_player_client_increment_id=An;var i={identity:"",page:location.href,hostname:location.hostname},n=me.version;return{client_timestamp:Date.now(),client_increment_id:An,session_id:vn(),time_zone:Tn,stat_package:{custom_stat_event:{key:e,value:JSON.stringify(Object.assign({},t,{url_package:i,player_version:n}))}}}}function Rn(e,t){En||(En=yn.exports.UAParser(navigator.userAgent));var i=localStorage.getItem("kwai_player_device_id")||function(){for(var e=1e9*Math.random()>>>0,t=[],i="0123456789ABCDEF",n=0;n<7;n++)t.push(i.charAt(16*Math.random()));return"web_"+e+t.join("")}();localStorage.kwai_player_device_id||(localStorage.kwai_player_device_id=i);var n=10;return"iOS"===En.os.name&&(n=9),"Android"===En.os.name&&(n=8),JSON.stringify(Object.assign({identity_package:{device_id:i,global_id:"",user_id:""},app_package:{language:navigator.language,platform:n,container:"H5",package_name:"",product_name:e,version_name:"",channel:""},device_package:{os_version:En.os.version,model:En.os.name,ua:navigator.userAgent},need_encrypt:!1,sdk_version:""},t))}Tn=Tn&&Tn[0]?Tn[0]:"";var xn="LoggerPlugin",Ln=function(e){return e.summary="KP_WEB_SUMMARY",e.realtimeBeacon="KP_WEB_REALTIME",e.download="KP_WEB_DOWNLOAD",e.event="KP_WEB_EVENT",e}(Ln||{}),Cn=function(e){l()(i,e);var t=L(i);function i(){var e;return g()(this,i),e=t.apply(this,arguments),un(d()(e),"name",xn),un(d()(e),"player"),un(d()(e),"reportTypes",["summary","realtimeBeacon","download","event"]),un(d()(e),"productName","streamlake"),un(d()(e),"onBeforeunload",(function(){if(e.player){var t=e.player.getAudienceStat();bn(e.productName,"KP_WEB_SUMMARY",t,0,!0)}})),e}return E()(i,[{key:"beforeInstall",value:function(e,t){var i,n=this;this.player=e,this.productName=(null==t?void 0:t.productName)||(null==(i=e.data)?void 0:i.productName)||this.productName,this.player.on("report",this.onReport.bind(this)),this.player.on("attribute:change:src",(function(){var t=e.getAudienceStat();bn(n.productName,"KP_WEB_SUMMARY",t,0,!0)})),t&&t.reportTypes&&Array.isArray(t.reportTypes)&&(this.reportTypes=t.reportTypes),window.addEventListener("beforeunload",this.onBeforeunload),En&&"mobile"===En.device.type&&window.addEventListener("unload",this.onBeforeunload)}},{key:"afterInstall",value:function(){}},{key:"beforeUninstall",value:function(){var e,t=null==(e=this.player)?void 0:e.getAudienceStat();t&&bn(this.productName,"KP_WEB_SUMMARY",t)}},{key:"afterUninstall",value:function(){var e;null==(e=this.player)||e.off("report",this.onReport),window.removeEventListener("beforeunload",this.onBeforeunload),En&&"mobile"===En.device.type&&window.removeEventListener("unload",this.onBeforeunload)}},{key:"onReport",value:function(e){this.reportTypes.includes(e.type)&&bn(this.productName,Object.create(Ln)[e.type],e.value)}}]),i}(he),Dn=Object.defineProperty,In=function(e,t,i){return function(e,t,i){t in e?Dn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i}(e,"symbol"!=typeof t?t+"":t,i),i},wn={exports:{}},kn=1e3,On=6e4,Nn=60*On,Pn=24*Nn,Mn=7*Pn,Vn=365.25*Pn,Fn=function(e,t){t=t||{};var i=typeof e;if("string"===i&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var i=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return i*Vn;case"weeks":case"week":case"w":return i*Mn;case"days":case"day":case"d":return i*Pn;case"hours":case"hour":case"hrs":case"hr":case"h":return i*Nn;case"minutes":case"minute":case"mins":case"min":case"m":return i*On;case"seconds":case"second":case"secs":case"sec":case"s":return i*kn;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return i;default:return}}(e);if("number"===i&&isFinite(e))return t.long?function(e){var t=Math.abs(e);if(t>=Pn)return Un(e,t,Pn,"day");if(t>=Nn)return Un(e,t,Nn,"hour");if(t>=On)return Un(e,t,On,"minute");if(t>=kn)return Un(e,t,kn,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=Pn)return Math.round(e/Pn)+"d";if(t>=Nn)return Math.round(e/Nn)+"h";if(t>=On)return Math.round(e/On)+"m";if(t>=kn)return Math.round(e/kn)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function Un(e,t,i,n){var r=t>=1.5*i;return Math.round(e/i)+" "+n+(r?"s":"")}var Bn=function(e){function t(e){var n,r,a,s=null;function o(){for(var e=arguments.length,i=new Array(e),r=0;r<e;r++)i[r]=arguments[r];if(o.enabled){var a=o,s=Number(new Date),c=s-(n||s);a.diff=c,a.prev=n,a.curr=s,n=s,i[0]=t.coerce(i[0]),"string"!=typeof i[0]&&i.unshift("%O");var _=0;i[0]=i[0].replace(/%([a-zA-Z%])/g,(function(e,n){if("%%"===e)return"%";_++;var r=t.formatters[n];if("function"==typeof r){var s=i[_];e=r.call(a,s),i.splice(_,1),_--}return e})),t.formatArgs.call(a,i);var d=a.log||t.log;d.apply(a,i)}}return o.namespace=e,o.useColors=t.useColors(),o.color=t.selectColor(e),o.extend=i,o.destroy=t.destroy,Object.defineProperty(o,"enabled",{enumerable:!0,configurable:!1,get:function(){return null!==s?s:(r!==t.namespaces&&(r=t.namespaces,a=t.enabled(e)),a)},set:function(e){s=e}}),"function"==typeof t.init&&t.init(o),o}function i(e,i){var n=t(this.namespace+(void 0===i?":":i)+e);return n.log=this.log,n}function n(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){var e=[].concat(S(r(),t.names.map(n)),S(r(),t.skips.map(n).map((function(e){return"-"+e})))).join(",");return t.enable(""),e},t.enable=function(e){var i;t.save(e),t.namespaces=e,t.names=[],t.skips=[];var n=("string"==typeof e?e:"").split(/[\s,]+/),r=n.length;for(i=0;i<r;i++)n[i]&&("-"===(e=n[i].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;var i,n;for(i=0,n=t.skips.length;i<n;i++)if(t.skips[i].test(e))return!1;for(i=0,n=t.names.length;i<n;i++)if(t.names[i].test(e))return!0;return!1},t.humanize=Fn,t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((function(i){t[i]=e[i]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){for(var i=0,n=0;n<e.length;n++)i=(i<<5)-i+e.charCodeAt(n),i|=0;return t.colors[Math.abs(i)%t.colors.length]},t.enable(t.load()),t};!function(e,t){var i;t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;var i="color: "+this.color;t.splice(1,0,i,"color: inherit");var n=0,r=0;t[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(n++,"%c"===e&&(r=n))})),t.splice(r,0,i)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){var e;try{e=t.storage.getItem("debug")}catch(e){}!e&&"undefined"!=typeof process&&"env"in process&&(e={}.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(i=!1,function(){i||(i=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||function(){},e.exports=Bn(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}(wn,wn.exports);var Hn=wn.exports,jn=Hn("PreviewPlugin:parser"),Wn=function(){function e(){g()(this,e),In(this,"url",""),In(this,"base",""),In(this,"ranges",[])}return E()(e,[{key:"load",value:function(e){return this.url=e,this.base=e.slice(0,e.lastIndexOf("/")+1),fetch(this.url,{mode:"cors"}).then((function(e){return e.text()})).then((function(t){return jn("loaded",e),t}))}},{key:"loadSprite",value:function(){}},{key:"parse",value:function(e){if(!/^WEBVTT/.test(e))throw new Error("Not webVTT");for(;-1!=e.search("\n\n");){var t=e.search("\n\n")+2,i=e.slice(t).search("\n\n");-1!==i?i+=t:i=e.length-1;var n=e.slice(t,i+1);n.trim()&&this.ranges.push(new zn(this.base,n)),e=e.slice(i)}}},{key:"getPreview",value:function(e){return this.ranges.find((function(t){return t.start<=e&&e<=t.end}))}}]),e}(),zn=function e(t,i){g()(this,e),In(this,"start",0),In(this,"end",0),In(this,"position",{x:0,y:0}),In(this,"size",{width:0,height:0}),In(this,"picture",""),In(this,"text",""),this.text=i;var n=i.search("\n"),r=n+1,a=i.length-1,o=i.slice(0,n).split(" --\x3e ").map((function(e){return e.split(":").reduce((function(e,t,i){return e+=0===i?60*+t*60:1===i?60*+t:+t}),0)})),c=S(s(),o,2),_=c[0],d=c[1];this.start=_,this.end=d;var u=t+i.slice(r,a),l=u.slice(u.search("#xywh=")+6).split(",").map((function(e){return+e})),h=S(s(),l,4),f=h[0],p=h[1],m=h[2],v=h[3];this.picture=u.slice(0,u.search("#xywh=")),this.position.x=f,this.position.y=p,this.size.width=m,this.size.height=v},Gn="PreviewPlugin",Kn=Hn(Gn),Yn=function(e){l()(i,e);var t=L(i);function i(){var e;return g()(this,i),e=t.apply(this,arguments),In(d()(e),"name",Gn),In(d()(e),"vttUrl",""),In(d()(e),"player"),In(d()(e),"parser",new Wn),In(d()(e),"panel"),In(d()(e),"progress"),In(d()(e),"previewContainer"),In(d()(e),"previewTime"),In(d()(e),"hideTimer",0),In(d()(e),"onMousemoveProgress",(function(t){var i,n;if(e.vttUrl&&e.progress&&e.progress.parentElement&&e.previewContainer&&e.previewTime&&(null==(i=e.player)?void 0:i.duration)){clearTimeout(e.hideTimer),e.previewContainer.style.display="block";var r=e.progress.getBoundingClientRect(),a=r.x,s=r.width,o=e.progress.parentElement.getBoundingClientRect(),c=o.x,_=o.width,d=(t.clientX-a)/s*e.player.duration;d<0&&(d=0),d>e.player.duration&&(d=e.player.duration);var u=e.parser.getPreview(d),l=Math.floor(d%60),h=Math.floor(d/60),f=Math.floor(d/60/60);l=l<10?"0"+l:l,h=h<10?"0"+h:h,e.previewTime.innerHTML=f?"".concat(f,":").concat(h,":").concat(l):"".concat(h,":").concat(l),e.previewContainer.style.top=((null==(n=e.progress.parentElement)?void 0:n.getBoundingClientRect().height)||0)-e.panelInnerHeight+"px",e.previewContainer.style.visibility="hidden",e.previewContainer.style.backgroundImage="url(".concat(null==u?void 0:u.picture,")"),e.previewContainer.style.width="".concat(null==u?void 0:u.size.width,"px"),e.previewContainer.style.height="".concat(null==u?void 0:u.size.height,"px"),e.previewContainer.style.backgroundPosition="-".concat(null==u?void 0:u.position.x,"px -").concat(null==u?void 0:u.position.y,"px");var p=e.previewContainer.getBoundingClientRect().width;t.clientX-p/2<0?e.previewContainer.style.transform="translate(".concat(0,"px,-100%)"):t.clientX+p/2>+_?e.previewContainer.style.transform="translate(".concat(+_-p,"px,-100%)"):e.previewContainer.style.transform="translate(".concat(t.clientX-p/2-c,"px,-100%)"),e.previewContainer.style.visibility="visible"}})),In(d()(e),"onMouseleaveProgress",(function(){e.hideTimer=+setTimeout((function(){e.previewContainer&&(e.previewContainer.style.display="none")}),1e3)})),e}return E()(i,[{key:"beforeInstall",value:function(e,t){Kn("beforeInstall",t),this.player=e,t&&t.src&&this.load(t.src)}},{key:"afterInstall",value:function(e){Kn("install",e);var t=e.getPluginInstance("ChromeControlsPlugin");if(!t)throw new Error("Not exist controls instance");if(!t.container)throw new Error("Not exist controls container");var i=t.container.querySelector("[role=timeline]"),n=t.container.querySelector("[role=panel]");if(!n)throw new Error("not exist panel");if(!i)throw new Error("not exist progress");this.panel=n,this.progress=i,this.progress&&this.progress.addEventListener("mousemove",this.onMousemoveProgress),this.progress&&this.progress.addEventListener("mouseleave",this.onMouseleaveProgress);var r=this.previewContainer=document.createElement("div");r.style.width="200px",r.style.height="112.5px",r.style.position="absolute",r.style.top="0",r.style.left="0",r.style.backgroundColor="rgba(0,0,0,0.3)",r.style.border="3px solid #fff",r.style.display="none";var a=this.previewTime=document.createElement("span");a.style.position="absolute",a.style.top="0",a.style.left="0",a.style.right="0",a.style.textAlign="center",a.style.fontWeight="bold",a.style.fontSize="14px",a.style.color="#fff",r.appendChild(a),t.container.appendChild(r)}},{key:"beforeUninstall",value:function(e){Kn("beforeUninstall",e),this.progress&&this.progress.removeEventListener("mousemove",this.onMousemoveProgress),this.progress&&this.progress.removeEventListener("mouseleave",this.onMouseleaveProgress)}},{key:"afterUninstall",value:function(e){var t,i;Kn("afterUninstall",e),this.player=void 0,null==(i=null==(t=this.previewContainer)?void 0:t.parentElement)||i.removeChild(this.previewContainer)}},{key:"load",value:function(e){var t=this;return Kn("load",e),this.vttUrl=e,this.parser.load(this.vttUrl).then((function(e){return Kn("loaded vtt"),t.parser.parse(e)})).catch((function(e){throw Kn("parse vtt error",e),e}))}},{key:"panelInnerHeight",get:function(){if(!this.panel)return 0;var e,t=0,i=R(this.panel.children,!0);try{for(i.s();!(e=i.n()).done;){t+=e.value.getBoundingClientRect().height}}catch(e){i.e(e)}finally{i.f()}return t}}]),i}(he),Xn=Object.defineProperty,qn=function(e,t,i){return function(e,t,i){t in e?Xn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i}(e,"symbol"!=typeof t?t+"":t,i),i},Zn={CONTEXT_MENU_LOOP:"",PLAYBACK_RATE_NORMAL:"",OVERFLOW_BACK:"",OVERFLOW_ITEM_DOWNLOAD:"",OVERFLOW_ITEM_VIDEO:"",OVERFLOW_ITEM_AUDIO:"",OVERFLOW_ITEM_PLAYBACK_RATE:"",OVERFLOW_ITEM_PICTURE_IN_PICTURE:""},Qn=function(e){l()(i,e);var t=L(i);function i(){var e;return g()(this,i),e=t.apply(this,arguments),qn(d()(e),"name","I18nPlugin"),qn(d()(e),"lang","zh-Hans"),qn(d()(e),"locals",{"zh-Hans":Zn}),e}return E()(i,[{key:"beforeInstall",value:function(e,t){(null==t?void 0:t.lang)&&(this.locals[t.lang]||t.locals&&t.locals[t.lang])&&(this.lang=(null==t?void 0:t.lang)||this.lang,this.locals=Object.assign(this.locals,null==t?void 0:t.locals))}},{key:"afterInstall",value:function(){}},{key:"beforeUninstall",value:function(){}},{key:"afterUninstall",value:function(){}},{key:"text",value:function(e){return this.locals[this.lang]?this.locals[this.lang][e]:""}}]),i}(he);!function(){try{if("undefined"!=typeof document){var e=document.createElement("style");e.appendChild(document.createTextNode("._container_1m0zi_1{position:absolute;left:0;top:0;padding:5px;width:90%;max-width:300px;max-height:100%;overflow:scroll;background:rgba(0,0,0,.8);word-break:break-all;white-space:normal}._container-h5_1m0zi_15{position:absolute;left:0;top:0;padding:5px;width:100%;height:100%;overflow:scroll;background:rgba(0,0,0,.8);word-break:break-all;white-space:normal}._closeEventLog-btn_1m0zi_28{position:absolute;right:10px;top:2px;cursor:pointer}._eventLogItem_1m0zi_35{display:flex}._eventLogItem-name_1m0zi_39{min-width:30%;text-align:right}._eventLogItem-colon_1m0zi_44{text-align:center;flex:5% 0 0}._eventLogItem-value_1m0zi_49{flex:1;cursor:pointer}")),document.head.appendChild(e)}}catch(e){console.error("vite-plugin-css-injected-by-js",e)}}();var Jn,$n,er,tr,ir,nr=Object.defineProperty,rr=function(e,t,i){return function(e,t,i){t in e?nr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i}(e,"symbol"!=typeof t?t+"":t,i),i},ar={},sr=[],or=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function cr(e,t){for(var i in t)e[i]=t[i];return e}function _r(e){var t=e.parentNode;t&&t.removeChild(e)}function dr(e,t,i,n,r){var a={type:e,props:t,key:i,ref:n,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:null==r?++er:r};return null==r&&null!=$n.vnode&&$n.vnode(a),a}function ur(e){return e.children}function lr(e,t){this.props=e,this.context=t}function hr(e,t){if(null==t)return e.__?hr(e.__,e.__.__k.indexOf(e)+1):null;for(var i;t<e.__k.length;t++)if(null!=(i=e.__k[t])&&null!=i.__e)return i.__e;return"function"==typeof e.type?hr(e):null}function fr(e){var t,i;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(i=e.__k[t])&&null!=i.__e){e.__e=e.__c.base=i.__e;break}return fr(e)}}function pr(e){(!e.__d&&(e.__d=!0)&&tr.push(e)&&!mr.__r++||ir!==$n.debounceRendering)&&((ir=$n.debounceRendering)||setTimeout)(mr)}function mr(){for(var e;mr.__r=tr.length;)e=tr.sort((function(e,t){return e.__v.__b-t.__v.__b})),tr=[],e.some((function(e){var t,i,n,r,a,s;e.__d&&(a=(r=(t=e).__v).__e,(s=t.__P)&&(i=[],(n=cr({},r)).__v=r.__v+1,Sr(s,r,n,t.__n,void 0!==s.ownerSVGElement,null!=r.__h?[a]:null,i,null==a?hr(r):a,r.__h),Rr(i,r),r.__e!=a&&fr(r)))}))}function vr(e,t,i,n,r,a,s,o,c,_){var d,u,l,h,f,p,m,v=n&&n.__k||sr,g=v.length;for(i.__k=[],d=0;d<t.length;d++)if(null!=(h=i.__k[d]=null==(h=t[d])||"boolean"==typeof h?null:"string"==typeof h||"number"==typeof h||"bigint"==typeof h?dr(null,h,null,null,h):Array.isArray(h)?dr(ur,{children:h},null,null,null):h.__b>0?dr(h.type,h.props,h.key,h.ref?h.ref:null,h.__v):h)){if(h.__=i,h.__b=i.__b+1,null===(l=v[d])||l&&h.key==l.key&&h.type===l.type)v[d]=void 0;else for(u=0;u<g;u++){if((l=v[u])&&h.key==l.key&&h.type===l.type){v[u]=void 0;break}l=null}Sr(e,h,l=l||ar,r,a,s,o,c,_),f=h.__e,(u=h.ref)&&l.ref!=u&&(m||(m=[]),l.ref&&m.push(l.ref,null,h),m.push(u,h.__c||f,h)),null!=f?(null==p&&(p=f),"function"==typeof h.type&&h.__k===l.__k?h.__d=c=gr(h,c,e):c=yr(e,h,l,v,f,c),"function"==typeof i.type&&(i.__d=c)):c&&l.__e==c&&c.parentNode!=e&&(c=hr(l))}for(i.__e=p,d=g;d--;)null!=v[d]&&Lr(v[d],v[d]);if(m)for(d=0;d<m.length;d++)xr(m[d],m[++d],m[++d])}function gr(e,t,i){for(var n,r=e.__k,a=0;r&&a<r.length;a++)(n=r[a])&&(n.__=e,t="function"==typeof n.type?gr(n,t,i):yr(i,n,n,r,n.__e,t));return t}function yr(e,t,i,n,r,a){var s,o,c;if(void 0!==t.__d)s=t.__d,t.__d=void 0;else if(null==i||r!=a||null==r.parentNode)e:if(null==a||a.parentNode!==e)e.appendChild(r),s=null;else{for(o=a,c=0;(o=o.nextSibling)&&c<n.length;c+=2)if(o==r)break e;e.insertBefore(r,a),s=a}return void 0!==s?s:r.nextSibling}function Er(e,t,i){"-"===t[0]?e.setProperty(t,i):e[t]=null==i?"":"number"!=typeof i||or.test(t)?i:i+"px"}function br(e,t,i,n,r){var a;e:if("style"===t)if("string"==typeof i)e.style.cssText=i;else{if("string"==typeof n&&(e.style.cssText=n=""),n)for(t in n)i&&t in i||Er(e.style,t,"");if(i)for(t in i)n&&i[t]===n[t]||Er(e.style,t,i[t])}else if("o"===t[0]&&"n"===t[1])a=t!==(t=t.replace(/Capture$/,"")),t=t.toLowerCase()in e?t.toLowerCase().slice(2):t.slice(2),e.l||(e.l={}),e.l[t+a]=i,i?n||e.addEventListener(t,a?Tr:Ar,a):e.removeEventListener(t,a?Tr:Ar,a);else if("dangerouslySetInnerHTML"!==t){if(r)t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if("href"!==t&&"list"!==t&&"form"!==t&&"tabIndex"!==t&&"download"!==t&&t in e)try{e[t]=null==i?"":i;break e}catch(e){}"function"==typeof i||(null==i||!1===i&&-1==t.indexOf("-")?e.removeAttribute(t):e.setAttribute(t,i))}}function Ar(e){this.l[e.type+!1]($n.event?$n.event(e):e)}function Tr(e){this.l[e.type+!0]($n.event?$n.event(e):e)}function Sr(e,t,i,n,r,a,s,o,c){var _,d,u,l,h,f,p,m,v,g,y,E,b,A=t.type;if(void 0!==t.constructor)return null;null!=i.__h&&(c=i.__h,o=t.__e=i.__e,t.__h=null,a=[o]),(_=$n.__b)&&_(t);try{e:if("function"==typeof A){m=t.props,v=(_=A.contextType)&&n[_.__c],g=_?v?v.props.value:_.__:n,i.__c?p=(d=t.__c=i.__c).__=d.__E:("prototype"in A&&A.prototype.render?t.__c=d=new A(m,g):(t.__c=d=new lr(m,g),d.constructor=A,d.render=Cr),v&&v.sub(d),d.props=m,d.state||(d.state={}),d.context=g,d.__n=n,u=d.__d=!0,d.__h=[],d._sb=[]),null==d.__s&&(d.__s=d.state),null!=A.getDerivedStateFromProps&&(d.__s==d.state&&(d.__s=cr({},d.__s)),cr(d.__s,A.getDerivedStateFromProps(m,d.__s))),l=d.props,h=d.state;for(_=0;_<d._sb.length;_++)d.__h.push(d._sb[_]),d._sb=[];if(u)null==A.getDerivedStateFromProps&&null!=d.componentWillMount&&d.componentWillMount(),null!=d.componentDidMount&&d.__h.push(d.componentDidMount);else{if(null==A.getDerivedStateFromProps&&m!==l&&null!=d.componentWillReceiveProps&&d.componentWillReceiveProps(m,g),!d.__e&&null!=d.shouldComponentUpdate&&!1===d.shouldComponentUpdate(m,d.__s,g)||t.__v===i.__v){d.props=m,d.state=d.__s,t.__v!==i.__v&&(d.__d=!1),d.__v=t,t.__e=i.__e,t.__k=i.__k,t.__k.forEach((function(e){e&&(e.__=t)})),d.__h.length&&s.push(d);break e}null!=d.componentWillUpdate&&d.componentWillUpdate(m,d.__s,g),null!=d.componentDidUpdate&&d.__h.push((function(){d.componentDidUpdate(l,h,f)}))}if(d.context=g,d.props=m,d.__v=t,d.__P=e,y=$n.__r,E=0,"prototype"in A&&A.prototype.render)d.state=d.__s,d.__d=!1,y&&y(t),_=d.render(d.props,d.state,d.context);else do{d.__d=!1,y&&y(t),_=d.render(d.props,d.state,d.context),d.state=d.__s}while(d.__d&&++E<25);d.state=d.__s,null!=d.getChildContext&&(n=cr(cr({},n),d.getChildContext())),u||null==d.getSnapshotBeforeUpdate||(f=d.getSnapshotBeforeUpdate(l,h)),b=null!=_&&_.type===ur&&null==_.key?_.props.children:_,vr(e,Array.isArray(b)?b:[b],t,i,n,r,a,s,o,c),d.base=t.__e,t.__h=null,d.__h.length&&s.push(d),p&&(d.__E=d.__=null),d.__e=!1}else null==a&&t.__v===i.__v?(t.__k=i.__k,t.__e=i.__e):t.__e=function(e,t,i,n,r,a,s,o){var c,_,d,u=i.props,l=t.props,h=t.type,f=0;if("svg"===h&&(r=!0),null!=a)for(;f<a.length;f++)if((c=a[f])&&"setAttribute"in c==!!h&&(h?c.localName===h:3===c.nodeType)){e=c,a[f]=null;break}if(null==e){if(null===h)return document.createTextNode(l);e=r?document.createElementNS("http://www.w3.org/2000/svg",h):document.createElement(h,l.is&&l),a=null,o=!1}if(null===h)u===l||o&&e.data===l||(e.data=l);else{if(a=a&&Jn.call(e.childNodes),_=(u=i.props||ar).dangerouslySetInnerHTML,d=l.dangerouslySetInnerHTML,!o){if(null!=a)for(u={},f=0;f<e.attributes.length;f++)u[e.attributes[f].name]=e.attributes[f].value;(d||_)&&(d&&(_&&d.__html==_.__html||d.__html===e.innerHTML)||(e.innerHTML=d&&d.__html||""))}if(function(e,t,i,n,r){var a;for(a in i)"children"===a||"key"===a||a in t||br(e,a,null,i[a],n);for(a in t)r&&"function"!=typeof t[a]||"children"===a||"key"===a||"value"===a||"checked"===a||i[a]===t[a]||br(e,a,t[a],i[a],n)}(e,l,u,r,o),d)t.__k=[];else if(f=t.props.children,vr(e,Array.isArray(f)?f:[f],t,i,n,r&&"foreignObject"!==h,a,s,a?a[0]:i.__k&&hr(i,0),o),null!=a)for(f=a.length;f--;)null!=a[f]&&_r(a[f]);o||("value"in l&&void 0!==(f=l.value)&&(f!==e.value||"progress"===h&&!f||"option"===h&&f!==u.value)&&br(e,"value",f,u.value,!1),"checked"in l&&void 0!==(f=l.checked)&&f!==e.checked&&br(e,"checked",f,u.checked,!1))}return e}(i.__e,t,i,n,r,a,s,c);(_=$n.diffed)&&_(t)}catch(e){t.__v=null,(c||null!=a)&&(t.__e=o,t.__h=!!c,a[a.indexOf(o)]=null),$n.__e(e,t,i)}}function Rr(e,t){$n.__c&&$n.__c(t,e),e.some((function(t){try{e=t.__h,t.__h=[],e.some((function(e){e.call(t)}))}catch(e){$n.__e(e,t.__v)}}))}function xr(e,t,i){try{"function"==typeof e?e(t):e.current=t}catch(e){$n.__e(e,i)}}function Lr(e,t,i){var n,r;if($n.unmount&&$n.unmount(e),(n=e.ref)&&(n.current&&n.current!==e.__e||xr(n,null,t)),null!=(n=e.__c)){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(e){$n.__e(e,t)}n.base=n.__P=null,e.__c=void 0}if(n=e.__k)for(r=0;r<n.length;r++)n[r]&&Lr(n[r],t,i||"function"!=typeof e.type);i||null==e.__e||_r(e.__e),e.__=e.__e=e.__d=void 0}function Cr(e,t,i){return this.constructor(e,i)}function Dr(e,t,i){var n,r,a;$n.__&&$n.__(e,t),r=(n="function"==typeof i)?null:i&&i.__k||t.__k,a=[],Sr(t,e=(!n&&i||t).__k=function(e,t,i){var n,r,a,s={};for(a in t)"key"==a?n=t[a]:"ref"==a?r=t[a]:s[a]=t[a];if(arguments.length>2&&(s.children=arguments.length>3?Jn.call(arguments,2):i),"function"==typeof e&&null!=e.defaultProps)for(a in e.defaultProps)void 0===s[a]&&(s[a]=e.defaultProps[a]);return dr(e,s,n,r,null)}(ur,null,[e]),r||ar,ar,void 0!==t.ownerSVGElement,!n&&i?[i]:r?null:t.firstChild?Jn.call(t.childNodes):null,a,!n&&i?i:r?r.__e:t.firstChild,n),Rr(a,e)}Jn=sr.slice,$n={__e:function(e,t,i,n){for(var r,a,s;t=t.__;)if((r=t.__c)&&!r.__)try{if((a=r.constructor)&&null!=a.getDerivedStateFromError&&(r.setState(a.getDerivedStateFromError(e)),s=r.__d),null!=r.componentDidCatch&&(r.componentDidCatch(e,n||{}),s=r.__d),s)return r.__E=r}catch(t){e=t}throw e}},er=0,lr.prototype.setState=function(e,t){var i;i=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=cr({},this.state),"function"==typeof e&&(e=e(cr({},i),this.props)),e&&cr(i,e),null!=e&&this.__v&&(t&&this._sb.push(t),pr(this))},lr.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),pr(this))},lr.prototype.render=ur,tr=[],mr.__r=0;var Ir,wr,kr,Or,Nr=0,Pr=[],Mr=[],Vr=$n.__b,Fr=$n.__r,Ur=$n.diffed,Br=$n.__c,Hr=$n.unmount;function jr(e,t){$n.__h&&$n.__h(wr,e,Nr||t),Nr=0;var i=wr.__H||(wr.__H={__:[],__h:[]});return e>=i.__.length&&i.__.push({__V:Mr}),i.__[e]}function Wr(e){return Nr=1,function(e,t,i){var n=jr(Ir++,2);if(n.t=e,!n.__c&&(n.__=[i?i(t):qr(void 0,t),function(e){var t=n.__N?n.__N[0]:n.__[0],i=n.t(t,e);t!==i&&(n.__N=[i,n.__[1]],n.__c.setState({}))}],n.__c=wr,!wr.u)){wr.u=!0;var r=wr.shouldComponentUpdate;wr.shouldComponentUpdate=function(e,t,i){if(!n.__c.__H)return!0;var a=n.__c.__H.__.filter((function(e){return e.__c}));if(a.every((function(e){return!e.__N})))return!r||r.call(this,e,t,i);var s=!1;return a.forEach((function(e){if(e.__N){var t=e.__[0];e.__=e.__N,e.__N=void 0,t!==e.__[0]&&(s=!0)}})),!(!s&&n.__c.props===e)&&(!r||r.call(this,e,t,i))}}return n.__N||n.__}(qr,e)}function zr(){for(var e;e=Pr.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(Yr),e.__H.__h.forEach(Xr),e.__H.__h=[]}catch(t){e.__H.__h=[],$n.__e(t,e.__v)}}$n.__b=function(e){"function"!=typeof e.type||e.__m||e.type===ur?e.__m||(e.__m=e.__&&e.__.__m?e.__.__m:""):e.__m=(e.__&&e.__.__m?e.__.__m:"")+(e.__&&e.__.__k?e.__.__k.indexOf(e):0),wr=null,Vr&&Vr(e)},$n.__r=function(e){Fr&&Fr(e),Ir=0;var t=(wr=e.__c).__H;t&&(kr===wr?(t.__h=[],wr.__h=[],t.__.forEach((function(e){e.__N&&(e.__=e.__N),e.__V=Mr,e.__N=e.i=void 0}))):(t.__h.forEach(Yr),t.__h.forEach(Xr),t.__h=[])),kr=wr},$n.diffed=function(e){Ur&&Ur(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(1!==Pr.push(t)&&Or===$n.requestAnimationFrame||((Or=$n.requestAnimationFrame)||Kr)(zr)),t.__H.__.forEach((function(e){e.i&&(e.__H=e.i),e.__V!==Mr&&(e.__=e.__V),e.i=void 0,e.__V=Mr}))),kr=wr=null},$n.__c=function(e,t){t.some((function(e){try{e.__h.forEach(Yr),e.__h=e.__h.filter((function(e){return!e.__||Xr(e)}))}catch(i){t.some((function(e){e.__h&&(e.__h=[])})),t=[],$n.__e(i,e.__v)}})),Br&&Br(e,t)},$n.unmount=function(e){Hr&&Hr(e);var t,i=e.__c;i&&i.__H&&(i.__H.__.forEach((function(e){try{Yr(e)}catch(e){t=e}})),i.__H=void 0,t&&$n.__e(t,i.__v))};var Gr="function"==typeof requestAnimationFrame;function Kr(e){var t,i=function(){clearTimeout(n),Gr&&cancelAnimationFrame(t),setTimeout(e)},n=setTimeout(i,100);Gr&&(t=requestAnimationFrame(i))}function Yr(e){var t=wr,i=e.__c;"function"==typeof i&&(e.__c=void 0,i()),wr=t}function Xr(e){var t=wr;e.__c=e.__(),wr=t}function qr(e,t){return"function"==typeof t?t(e):t}var Zr="_container_1m0zi_1",Qr="_container-h5_1m0zi_15",Jr="_closeEventLog-btn_1m0zi_28",$r="_eventLogItem_1m0zi_35",ea="_eventLogItem-name_1m0zi_39",ta="_eventLogItem-colon_1m0zi_44",ia="_eventLogItem-value_1m0zi_49",na=0;function ra(e,t,i,n,r){var a,s,o={};for(s in t)"ref"==s?a=t[s]:o[s]=t[s];var c={type:e,props:o,key:i,ref:a,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:--na,__source:r,__self:n};if("function"==typeof e&&(a=e.defaultProps))for(s in a)void 0===o[s]&&(o[s]=a[s]);return $n.vnode&&$n.vnode(c),c}function aa(e){var t=!0;(navigator.userAgent.indexOf("iPhone")>-1||navigator.userAgent.indexOf("Android")>-1)&&(t=!1);var i=e.player,n=e.onChangeShowEventLog,r=e.DID,a=e.showDid,o=Wr(!1),c=S(s(),o,2),_=c[0],d=c[1],u=Wr(""),l=S(s(),u,2),h=l[0],f=l[1],p=Wr(!1),m=S(s(),p,2),v=m[0],g=m[1],y=Wr(""),E=S(s(),y,2),b=E[0],A=E[1],T=Wr(!1),R=S(s(),T,2),x=R[0],L=R[1],C=Wr(""),D=S(s(),C,2),I=D[0],w=D[1],k=Wr(!1),O=S(s(),k,2),N=O[0],P=O[1],M=Wr(""),V=S(s(),M,2),F=V[0],U=V[1],B=Wr(!1),H=S(s(),B,2),j=H[0],W=H[1],z=Wr(""),G=S(s(),z,2),K=G[0],Y=G[1],X=Wr(!1),q=S(s(),X,2),Z=q[0],Q=q[1],J=Wr(""),$=S(s(),J,2),ee=$[0],te=$[1],ie=Wr(!1),ne=S(s(),ie,2),re=ne[0],ae=ne[1],se=Wr(""),oe=S(s(),se,2),ce=oe[0],de=oe[1],ue=Wr(!1),le=S(s(),ue,2),he=le[0],fe=le[1],pe=Wr(""),me=S(s(),pe,2),ve=me[0],ge=me[1],ye=Wr(!1),Ee=S(s(),ye,2),be=Ee[0],Ae=Ee[1],Te=Wr(""),Se=S(s(),Te,2),Re=Se[0],xe=Se[1],Le=Wr(!1),Ce=S(s(),Le,2),De=Ce[0],Ie=Ce[1],we=Wr(""),ke=S(s(),we,2),Oe=ke[0],Ne=ke[1],Pe=Wr(!1),Me=S(s(),Pe,2),Ve=Me[0],Fe=Me[1],Ue=Wr(""),Be=S(s(),Ue,2),He=Be[0],je=Be[1],We=Wr(!1),ze=S(s(),We,2),Ge=ze[0],Ke=ze[1],Ye=Wr(""),Xe=S(s(),Ye,2),qe=Xe[0],Ze=Xe[1];!function(e,t){var i=jr(Ir++,3);!$n.__s&&function(e,t){return!e||e.length!==t.length||t.some((function(t,i){return t!==e[i]}))}(i.__H,t)&&(i.__=e,i.i=t,wr.__H.__h.push(i))}((function(){for(var e=function(e){e&&"mediaInfo"===e.type&&(null!==e.value.streamHost&&void 0!==e.value.streamHost?(d(!0),f(e.value.streamHost)):d(!1),null!==e.value.colorSpace&&void 0!==e.value.colorSpace?(g(!0),A(e.value.colorSpace)):g(!1),null!==e.value.width&&void 0!==e.value.width&&null!==e.value.height&&void 0!==e.value.height&&null!==e.value.fps&&void 0!==e.value.fps?(L(!0),w(e.value.width+"x"+e.value.height+"@"+e.value.fps)):L(!1),null!==e.value.videoCodec&&void 0!==e.value.videoCodec&&null!==e.value.audioCodec&&void 0!==e.value.audioCodec?(P(!0),U(e.value.videoCodec+"/"+e.value.audioCodec)):P(!1),null!==e.value.sid&&void 0!==e.value.sid?(Ke(!0),Ze(e.value.sid)):Ke(!1)),e&&"heartbeat"===e.type&&(null!==e.value.decodedFPS&&void 0!==e.value.decodedFPS&&null!==e.value.droppedFPS&&void 0!==e.value.droppedFPS&&null!==e.value.decodedFrames&&void 0!==e.value.decodedFrames&&null!==e.value.droppedFrames&&void 0!==e.value.droppedFrames?(W(!0),Y(e.value.decodedFPS+"/"+e.value.droppedFPS+" "+e.value.decodedFrames+"/"+e.value.droppedFrames)):W(!1),null!==e.value.videoBuffered&&void 0!==e.value.videoBuffered?(Q(!0),te(e.value.videoBuffered+" ms")):Q(!1),null!==e.value.audioBuffered&&void 0!==e.value.audioBuffered?(ae(!0),de(e.value.audioBuffered+" ms")):ae(!1),null!==e.value.speed&&void 0!==e.value.speed?(fe(!0),ge((e.value.speed/1e3).toFixed(2)+" KB/s")):fe(!1),null!==e.value.videoDataRate&&void 0!==e.value.videoDataRate?(Ae(!0),xe(e.value.videoDataRate+" kbps")):Ae(!1),null!==e.value.audioDataRate&&void 0!==e.value.audioDataRate?(Ie(!0),Ne(e.value.audioDataRate+" kbps")):Ie(!1),null!==e.value.totalReceive&&void 0!==e.value.totalReceive?(Fe(!0),je((e.value.totalReceive/1024).toFixed(2)+" KB")):Fe(!1))},t=0,n=Object.values(_e);t<n.length;t++){var r=n[t];i.addListener(r,e)}return function(){for(var t=0,n=Object.values(_e);t<n.length;t++){var r=n[t];i.off(r,e)}}}),[]);var Qe=function(e){var t=e.target.innerHTML;navigator.clipboard.writeText(t).catch((function(){console.log("clipboard write failed!")}))};return ra("div",{className:t?Zr:Qr,onContextMenu:function(e){e.stopPropagation()},children:[ra("div",{className:Jr,onClick:n,children:"[x]"}),_&&ra("div",{className:$r,children:[ra("div",{className:ea,children:"StreamHost"}),ra("div",{className:ta,children:":"}),ra("div",{className:ia,onClick:Qe,children:h})]}),v&&ra("div",{className:$r,children:[ra("div",{className:ea,children:"ColorSpace"}),ra("div",{className:ta,children:":"}),ra("div",{className:ia,onClick:Qe,children:b})]}),x&&ra("div",{className:$r,children:[ra("div",{className:ea,children:"Res"}),ra("div",{className:ta,children:":"}),ra("div",{className:ia,onClick:Qe,children:I})]}),N&&ra("div",{className:$r,children:[ra("div",{className:ea,children:"Codec"}),ra("div",{className:ta,children:":"}),ra("div",{className:ia,onClick:Qe,children:F})]}),j&&ra("div",{className:$r,children:[ra("div",{className:ea,children:"Frames"}),ra("div",{className:ta,children:":"}),ra("div",{className:ia,onClick:Qe,children:K})]}),Z&&ra("div",{className:$r,children:[ra("div",{className:ea,children:"VideoBuffered"}),ra("div",{className:ta,children:":"}),ra("div",{className:ia,onClick:Qe,children:ee})]}),re&&ra("div",{className:$r,children:[ra("div",{className:ea,children:"AudioBuffered"}),ra("div",{className:ta,children:":"}),ra("div",{className:ia,onClick:Qe,children:ce})]}),he&&ra("div",{className:$r,children:[ra("div",{className:ea,children:"Speed"}),ra("div",{className:ta,children:":"}),ra("div",{className:ia,onClick:Qe,children:ve})]}),be&&ra("div",{className:$r,children:[ra("div",{className:ea,children:"VideoDataRate"}),ra("div",{className:ta,children:":"}),ra("div",{className:ia,onClick:Qe,children:Re})]}),De&&ra("div",{className:$r,children:[ra("div",{className:ea,children:"AudioDataRate"}),ra("div",{className:ta,children:":"}),ra("div",{className:ia,onClick:Qe,children:Oe})]}),Ve&&ra("div",{className:$r,children:[ra("div",{className:ea,children:"TotalReceive"}),ra("div",{className:ta,children:":"}),ra("div",{className:ia,onClick:Qe,children:He})]}),a&&ra("div",{className:$r,children:[ra("div",{className:ea,children:"DeviceId"}),ra("div",{className:ta,children:":"}),ra("div",{className:ia,onClick:Qe,children:r})]}),Ge&&ra("div",{className:$r,children:[ra("div",{className:ea,children:"SessionId"}),ra("div",{className:ta,children:":"}),ra("div",{className:ia,onClick:Qe,children:qe})]})]})}var sa="EventLogPlugin",oa=function(e){l()(i,e);var t=L(i);function i(){var e;return g()(this,i),e=t.apply(this,arguments),rr(d()(e),"name",sa),rr(d()(e),"did",""),rr(d()(e),"showDid",!1),rr(d()(e),"player"),rr(d()(e),"color","#fff"),rr(d()(e),"maxLogNumber",10),rr(d()(e),"container"),rr(d()(e),"exclude",[]),rr(d()(e),"iconSrc","data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjRweCIgdmlld0JveD0iMCAwIDI0IDI0IiB3aWR0aD0iMjRweCIgZmlsbD0iI0ZGRkZGRiI+PHBhdGggZD0iTTAgMGgyNHYyNEgwVjB6IiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTExIDdoMnYyaC0yem0wIDRoMnY2aC0yem0xLTlDNi40OCAyIDIgNi40OCAyIDEyczQuNDggMTAgMTAgMTAgMTAtNC40OCAxMC0xMFMxNy41MiAyIDEyIDJ6bTAgMThjLTQuNDEgMC04LTMuNTktOC04czMuNTktOCA4LTggOCAzLjU5IDggOC0zLjU5IDgtOCA4eiIvPjwvc3ZnPg=="),rr(d()(e),"isChecked",!1),rr(d()(e),"switchItem"),rr(d()(e),"onChangeShowEventLog",(function(){e.container&&("block"===e.container.style.display?e.container.style.display="none":e.container.style.display="block",e.switchItem&&(e.switchItem.isChecked=!e.switchItem.isChecked))})),e}return E()(i,[{key:"beforeInstall",value:function(e,t){}},{key:"afterInstall",value:function(e,t){var i=e.getPluginInstance("ChromeControlsPlugin");if(i&&(this.switchItem=i.addContextMenuItem("",this.onChangeShowEventLog,this.iconSrc,this.isChecked)),t&&t.color&&(this.color=t.color),t&&t.maxLogNumber&&(this.maxLogNumber=t.maxLogNumber),t&&t.exclude&&(this.exclude=t.exclude),this.player=e,this.player){this.container||(this.container=this.player.createSubContainer(),this.container.style.color=this.color,this.container.style.fontSize="12px",this.container.style.display="none",this.container.style.zIndex="10");var n=localStorage.getItem("kwai_player_device_id");null!==n?(this.showDid=!0,this.did=n):this.showDid=!1,Dr(ra(aa,{player:e,DID:this.did,showDid:this.showDid,onChangeShowEventLog:this.onChangeShowEventLog}),this.container)}}},{key:"beforeUninstall",value:function(e){}},{key:"afterUninstall",value:function(e){this.container&&e.removeSubContainer(this.container),this.player=void 0}}]),i}(he);me.register(Qn),me.register(Cn),me.register(Be),me.register(_n),me.register(oa),me.register(Yn),me.version="1.0.12"}}]);
//# sourceMappingURL=column.lib_6efc30be.9d8807815115c964a8d1.js.map